<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Creator Users Management</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <link rel="stylesheet" href="/static/css/lamb.css">
</head>
<body>
    {% include 'navigation.html' %}

    <div id="main-content">
        <h1>Creator Users Management</h1>
        
        <div id="api-key-section">
            <label for="apiKey">API Key:</label>
            <input type="text" id="apiKey" required value="{{ api_key }}">
        </div>

        <!-- Create Creator User Form -->
        <div class="form-section">
            <h3>Create Creator User</h3>
            <form id="createCreatorUserForm">
                <label for="createUserEmail">Email:</label>
                <input type="email" id="createUserEmail" required><br>
                
                <label for="createUserName">Name:</label>
                <input type="text" id="createUserName" required><br>
                
                <label for="createUserPassword">Password:</label>
                <input type="password" id="createUserPassword" required><br>
                
                <button type="submit">Create User</button>
            </form>
            <pre id="createCreatorUserResponse"></pre>
        </div>

        <!-- Check Creator User Form -->
        <div class="form-section">
            <h3>Check Creator User</h3>
            <form id="checkCreatorUserForm">
                <label for="checkUserEmail">Email:</label>
                <input type="email" id="checkUserEmail" required><br>
                
                <button type="submit">Check User</button>
            </form>
            <pre id="checkCreatorUserResponse"></pre>
        </div>

        <!-- List Creator Users -->
        <div class="form-section">
            <h3>List All Creator Users</h3>
            <button onclick="listCreatorUsers()">List Users</button>
            <div id="creatorUsersTable" style="margin-top: 20px;">
                <table class="users-table" style="display: none;">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Config</th>
                        </tr>
                    </thead>
                    <tbody id="creatorUsersBody">
                    </tbody>
                </table>
            </div>
            <pre id="listCreatorUsersResponse"></pre>
        </div>
    </div>

    <script>
        // Add event listeners when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('createCreatorUserForm').addEventListener('submit', handleCreateUser);
            document.getElementById('checkCreatorUserForm').addEventListener('submit', handleCheckUser);
        });

        async function handleCreateUser(event) {
            event.preventDefault();
            const apiKey = document.getElementById('apiKey').value;
            
            const userData = {
                email: document.getElementById('createUserEmail').value,
                name: document.getElementById('createUserName').value,
                password: document.getElementById('createUserPassword').value
            };

            try {
                const response = await axios.post('/lamb/v1/creator_user/create', userData, {
                    headers: { 'Authorization': `Bearer ${apiKey}` }
                });
                
                document.getElementById('createCreatorUserResponse').innerHTML = 
                    `<p style="color: green;">User created successfully with ID: ${response.data}</p>`;
                
                // Clear form
                this.reset();
                
                // Refresh the users list if it's visible
                if (document.querySelector('.users-table').style.display !== 'none') {
                    await listCreatorUsers();
                }
            } catch (error) {
                document.getElementById('createCreatorUserResponse').innerHTML = 
                    `<p style="color: red;">Error creating user: ${error.response?.data?.detail || error.message}</p>`;
            }
        }

        async function handleCheckUser(event) {
            event.preventDefault();
            const apiKey = document.getElementById('apiKey').value;
            const email = document.getElementById('checkUserEmail').value;

            try {
                const response = await axios.get(`/lamb/v1/creator_user/check/${encodeURIComponent(email)}`, {
                    headers: { 'Authorization': `Bearer ${apiKey}` }
                });
                
                const userId = response.data;
                document.getElementById('checkCreatorUserResponse').innerHTML = userId ? 
                    `<p style="color: green;">User exists with ID: ${userId}</p>` :
                    `<p style="color: orange;">User not found</p>`;
                
            } catch (error) {
                document.getElementById('checkCreatorUserResponse').innerHTML = 
                    `<p style="color: red;">Error checking user: ${error.response?.data?.detail || error.message}</p>`;
            }
        }

        async function listCreatorUsers() {
            const apiKey = document.getElementById('apiKey').value;
            const table = document.querySelector('.users-table');
            const tbody = document.getElementById('creatorUsersBody');
            const responseElement = document.getElementById('listCreatorUsersResponse');

            try {
                const response = await axios.get('/lamb/v1/creator_user/list', {
                    headers: { 'Authorization': `Bearer ${apiKey}` }
                });
                
                tbody.innerHTML = '';
                
                if (response.data && response.data.length > 0) {
                    response.data.forEach(user => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${user.id}</td>
                            <td>${user.name}</td>
                            <td>${user.email}</td>
                            <td><pre style="margin: 0;">${JSON.stringify(user.user_config, null, 2)}</pre></td>
                        `;
                        tbody.appendChild(row);
                    });
                    
                    table.style.display = 'table';
                    responseElement.innerHTML = '';
                } else {
                    table.style.display = 'none';
                    responseElement.innerHTML = '<p>No creator users found</p>';
                }
            } catch (error) {
                table.style.display = 'none';
                responseElement.innerHTML = 
                    `<p style="color: red;">Error listing users: ${error.response?.data?.detail || error.message}</p>`;
            }
        }
    </script>

    <style>
        .form-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .form-section h3 {
            margin-top: 0;
            margin-bottom: 20px;
            color: #333;
        }

        .users-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .users-table th,
        .users-table td {
            padding: 12px;
            text-align: left;
            border: 1px solid #ddd;
        }

        .users-table th {
            background-color: #f5f5f5;
            font-weight: bold;
        }

        .users-table tr:hover {
            background-color: #f9f9f9;
        }

        pre {
            white-space: pre-wrap;
            word-wrap: break-word;
        }
    </style>
</body>
</html> 