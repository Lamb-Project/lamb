<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple LTI Management</title>
    <link rel="stylesheet" href="/static/css/lamb.css">
</head>
<body>
    {% include 'navigation.html' %}

    <!-- Secondary Navigation -->
    <div id="secondary-sidebar">
        <h2>Features</h2>
        <div class="menu-item active" onclick="showFeature('lti-config')">LTI Configuration</div>
        <div class="menu-item" onclick="showFeature('lti-launch')">LTI Launch</div>
        <div class="menu-item" onclick="showFeature('lti-settings')">Settings</div>
    </div>

    <div id="main-content" class="has-secondary-sidebar">
        <h1>Simple LTI Management</h1>

        <div id="lti-config" class="feature-section active">
            <h2>LTI Configuration</h2>
            <div class="api-form">
                <label for="ltiVersion">LTI Version:</label>
                <select id="ltiVersion" name="ltiVersion">
                    <option value="1.1">LTI 1.1</option>
                    <option value="1.3" selected>LTI 1.3</option>
                </select>

                <label for="toolName">Tool Name:</label>
                <input type="text" id="toolName" name="toolName" value="Simple LTI Tool" required><br>

                <label for="toolDescription">Description:</label>
                <textarea id="toolDescription" name="toolDescription" required>A simple LTI tool implementation</textarea><br>

                <label for="launchUrl">Launch URL:</label>
                <input type="url" id="launchUrl" name="launchUrl" required><br>

                <button onclick="saveConfig()">Save Configuration</button>
                <pre id="configResult"></pre>
            </div>
        </div>

        <div id="lti-launch" class="feature-section">
            <h2>LTI Launch Testing</h2>
            <div class="api-form">
                <label for="consumerKey">Consumer Key:</label>
                <input type="text" id="consumerKey" required><br>

                <label for="consumerSecret">Consumer Secret:</label>
                <input type="password" id="consumerSecret" required><br>

                <button onclick="testLaunch()">Test Launch</button>
                <pre id="launchResult"></pre>
            </div>
        </div>

        <div id="lti-settings" class="feature-section">
            <h2>LTI Settings</h2>
            <div class="api-form">
                <label for="enableGrading">Enable Grading:</label>
                <input type="checkbox" id="enableGrading"><br>

                <label for="enableRoster">Enable Roster Service:</label>
                <input type="checkbox" id="enableRoster"><br>

                <label for="customParameters">Custom Parameters:</label>
                <textarea id="customParameters" placeholder="Enter custom parameters in JSON format"></textarea><br>

                <button onclick="saveSettings()">Save Settings</button>
                <pre id="settingsResult"></pre>
            </div>
        </div>
    </div>

    <script>
        function showFeature(featureId) {
            // Hide all feature sections
            document.querySelectorAll('.feature-section').forEach(section => {
                section.style.display = 'none';
            });
            
            // Remove active class from all menu items
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Show selected feature
            document.getElementById(featureId).style.display = 'block';
            
            // Add active class to selected menu item
            Array.from(document.querySelectorAll('.menu-item')).find(
                item => item.textContent.toLowerCase().includes(featureId)
            )?.classList.add('active');
        }

        async function saveConfig() {
            const config = {
                version: document.getElementById('ltiVersion').value,
                toolName: document.getElementById('toolName').value,
                description: document.getElementById('toolDescription').value,
                launchUrl: document.getElementById('launchUrl').value
            };

            try {
                const response = await fetch('/lamb/v1/simple_lti/config', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer {{ api_key }}'
                    },
                    body: JSON.stringify(config)
                });
                const result = await response.json();
                document.getElementById('configResult').textContent = JSON.stringify(result, null, 2);
            } catch (error) {
                document.getElementById('configResult').textContent = 'Error: ' + error.message;
            }
        }

        async function testLaunch() {
            const launchData = {
                consumerKey: document.getElementById('consumerKey').value,
                consumerSecret: document.getElementById('consumerSecret').value
            };

            try {
                const response = await fetch('/lamb/v1/simple_lti/launch', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer {{ api_key }}'
                    },
                    body: JSON.stringify(launchData)
                });
                const result = await response.json();
                document.getElementById('launchResult').textContent = JSON.stringify(result, null, 2);
            } catch (error) {
                document.getElementById('launchResult').textContent = 'Error: ' + error.message;
            }
        }

        async function saveSettings() {
            const settings = {
                enableGrading: document.getElementById('enableGrading').checked,
                enableRoster: document.getElementById('enableRoster').checked,
                customParameters: JSON.parse(document.getElementById('customParameters').value || '{}')
            };

            try {
                const response = await fetch('/lamb/v1/simple_lti/settings', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer {{ api_key }}'
                    },
                    body: JSON.stringify(settings)
                });
                const result = await response.json();
                document.getElementById('settingsResult').textContent = JSON.stringify(result, null, 2);
            } catch (error) {
                document.getElementById('settingsResult').textContent = 'Error: ' + error.message;
            }
        }

        // Add class to body to indicate secondary sidebar presence
        document.body.classList.add('has-secondary-sidebar');
    </script>
</body>
</html> 
