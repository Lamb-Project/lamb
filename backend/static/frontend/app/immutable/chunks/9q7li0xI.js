import{ag as E}from"./D10uF6KO.js";import{a as m}from"./BVlmaXU-.js";import{a as h}from"./ngrFHoWO.js";const y=!0,D=y,g="lamb_assistant_capabilities",f="lamb_assistant_defaults",R=3600*1e3,l={systemCapabilities:null,configDefaults:null,loading:!1,error:null,lastLoadedTimestamp:null};function b(){return console.warn("Using hardcoded fallback defaults"),{config:{system_prompt:"You are a wise surfer dude and a helpful teaching assistant that uses Retrieval-Augmented Generation (RAG) to improve your answers.",prompt_template:`You are a wise surfer dude and a helpful teaching assistant that uses Retrieval-Augmented Generation (RAG) to improve your answers.
This is the user input: {user_input}
This is the context: {context}
Now answer the question:`,prompt_processor:"simple_augment",connector:"openai",llm:"gpt-4o-mini",rag_processor:"no_rag",RAG_Top_k:"3"}}}function C(){return console.warn("Using hardcoded fallback capabilities"),{prompt_processors:["simple_augment"],connectors:{openai:{models:["gpt-4o-mini","gpt-4"]}},rag_processors:["no_rag","simple_rag","single_file_rag"]}}function S(a){const o=localStorage.getItem(a);if(!o)return null;try{const t=JSON.parse(o);if(Date.now()-t.timestamp<R)return t.value}catch(t){console.error(`Error reading cache for ${a}:`,t)}return localStorage.removeItem(a),null}function _(a,o){try{const t={value:o,timestamp:Date.now()};localStorage.setItem(a,JSON.stringify(t))}catch(t){console.error(`Error setting cache for ${a}:`,t)}}function A(){const{subscribe:a,set:o,update:t}=E(l);async function w(){var p,d;console.log("assistantConfigStore: loadConfig called (with caching).");let u=!1;if(t(e=>(u=e.loading,e)),u){console.log("assistantConfigStore: Config load already in progress...");return}console.log("assistantConfigStore: Checking cache...");let s=S(g),r=S(f);if(s&&r){console.log("assistantConfigStore: Config loaded from cache."),o({systemCapabilities:s,configDefaults:r,loading:!1,error:null,lastLoadedTimestamp:Date.now()});return}t(e=>({...e,loading:!0,error:null})),t(e=>({...l,loading:!0,systemCapabilities:s,configDefaults:r})),console.log("assistantConfigStore: Cache miss or expired. Fetching fresh config...");try{if(!s)try{const e=m(),n=(p=e==null?void 0:e.api)==null?void 0:p.lambServer;if(!n)throw new Error("Lamb server base URL (lambServer) is not configured within config.api.");const i=`${n.replace(/\/$/,"")}/lamb/v1/completions/list`;console.log(`assistantConfigStore: Fetching capabilities from: ${i}`);const c=D?localStorage.getItem("userToken"):null,v=c?{Authorization:`Bearer ${c}`}:{};s=(await h.get(i,{headers:v})).data,console.log("Fetched Capabilities (raw):",s),_(g,s)}catch(e){console.error("Error fetching system capabilities:",e),s=C()}if(!r)try{const e=m(),n=(d=e==null?void 0:e.api)==null?void 0:d.lambServer;if(!n)throw new Error("Lamb server base URL (lambServer) is not configured within config.api.");const i=`${n.replace(/\/$/,"")}/static/json/defaults.json`;console.log(`assistantConfigStore: Fetching defaults from: ${i}`),r=(await h.get(i)).data,console.log("Fetched Defaults:",r),_(f,r)}catch(e){console.error("Error fetching defaults.json:",e),r=b()}o({systemCapabilities:s,configDefaults:r,loading:!1,error:null,lastLoadedTimestamp:Date.now()})}catch(e){console.error("Error in loadConfig process:",e),t(n=>({...n,systemCapabilities:n.systemCapabilities||C(),configDefaults:n.configDefaults||b(),loading:!1,error:e instanceof Error?e.message:"Failed to load assistant configuration"}))}}return{subscribe:a,loadConfig:w,reset:()=>{console.log("assistantConfigStore: Resetting store to initial state."),o(l)},clearCache:()=>{console.log("assistantConfigStore: Clearing cached capabilities and defaults."),localStorage.removeItem(g),localStorage.removeItem(f),o(l)}}}const T=A(),U=Object.freeze(Object.defineProperty({__proto__:null,assistantConfigStore:T},Symbol.toStringTag,{value:"Module"}));export{T as a,D as b,U as c};
