import"./Bzak7iHL.js";import"./CbD3bVMs.js";import{a7 as Ia,p as La,aY as Ra,aQ as fa,aR as Da,k as X,l as R,c as _,h as Ja,ae as D,i as n,O as B,g as a,f as y,j as o,r,b as f,t as F,m as h,K as w,e as T}from"./D10uF6KO.js";import{i as $}from"./B5RjaZpx.js";import{e as Ka,i as Na}from"./BY88_K0J.js";import{r as Qa,s as Ya,d as qa}from"./gDFrtnMu.js";import{i as Ha}from"./9AfmHA9f.js";import{p as ua}from"./Dpgw__wX.js";import{s as Va,a as Wa}from"./CAofB27F.js";import{g as Z}from"./BVlmaXU-.js";import{u as Xa}from"./DSpOhgIp.js";function Za(c){return function(...e){var s=e[0];return s.stopPropagation(),c==null?void 0:c.apply(this,e)}}function ae(c,e){var l;var s=(l=c.$$events)==null?void 0:l[e.type],g=Ia(s)?s.slice():s==null?[]:[s];for(var u of g)u.call(this,e)}async function be(c){try{const e=await fetch(Z("/admin/org-admin/assistants"),{method:"GET",headers:{Authorization:`Bearer ${c}`,"Content-Type":"application/json"}});if(!e.ok){const s=await e.json();throw new Error(s.detail||"Failed to fetch organization assistants")}return await e.json()}catch(e){throw console.error("Error fetching organization assistants:",e),e}}async function ee(c,e){try{const s=await fetch(Z(`/admin/org-admin/assistants/${e}/access`),{method:"GET",headers:{Authorization:`Bearer ${c}`,"Content-Type":"application/json"}});if(!s.ok){const g=await s.json();throw new Error(g.detail||"Failed to fetch assistant access info")}return await s.json()}catch(s){throw console.error("Error fetching assistant access:",s),s}}async function pa(c,e,s,g){try{const u=await fetch(Z(`/admin/org-admin/assistants/${e}/access`),{method:"PUT",headers:{Authorization:`Bearer ${c}`,"Content-Type":"application/json"},body:JSON.stringify({user_emails:s,action:g})});if(!u.ok){const l=await u.json();throw new Error(l.detail||"Failed to update assistant access")}return await u.json()}catch(u){throw console.error("Error updating assistant access:",u),u}}var se=y('<div class="loading svelte-rkaw9j">Loading...</div>'),te=y('<div class="error-message svelte-rkaw9j"> </div>'),re=y('<div class="success-message svelte-rkaw9j"> </div>'),ne=y('<span class="owner-badge svelte-rkaw9j">Owner</span>'),oe=y('<label><input type="checkbox" class="svelte-rkaw9j"/> <div class="user-info svelte-rkaw9j"><span class="user-name svelte-rkaw9j"> </span> <span class="user-email svelte-rkaw9j"> </span> <span class="user-type-badge svelte-rkaw9j"> </span> <!></div></label>'),ie=y('<div class="assistant-info svelte-rkaw9j"><p class="svelte-rkaw9j"><strong>Owner:</strong> </p></div> <!> <div class="users-list svelte-rkaw9j"><h3 class="svelte-rkaw9j">Select users with access:</h3> <div class="users-grid svelte-rkaw9j"></div></div>',1),ce=y('<div class="modal-overlay svelte-rkaw9j" role="presentation"><div class="modal-content svelte-rkaw9j" role="dialog" aria-modal="true" aria-labelledby="modal-title" tabindex="-1"><div class="modal-header svelte-rkaw9j"><h2 id="modal-title" class="svelte-rkaw9j"> </h2> <button class="close-btn svelte-rkaw9j">&times;</button></div> <div class="modal-body svelte-rkaw9j"><!></div> <div class="modal-footer svelte-rkaw9j"><button class="btn btn-secondary svelte-rkaw9j">Cancel</button> <button class="btn btn-primary svelte-rkaw9j"> </button></div></div></div>');function je(c,e){La(e,!1);const s=()=>Wa(Xa,"$user",g),[g,u]=Va();let l=ua(e,"assistant",8,null),z=ua(e,"show",8,!1);const aa=Ra();let p=B(!1),v=B(null),k=B(new Set),b=B(""),C=B("");async function ea(){n(p,!0),n(b,"");try{n(v,await ee(s().token,l().id)),n(k,new Set(a(v).users_with_access))}catch(i){n(b,i.message)}finally{n(p,!1)}}function _a(i){const d=new Set(a(k));d.has(i)?d.delete(i):d.add(i),n(k,d)}async function wa(){if(a(v)){n(p,!0),n(b,""),n(C,"");try{const i=new Set(a(v).users_with_access),d=a(k),A=[...d].filter(j=>!i.has(j)),x=[...i].filter(j=>!d.has(j));A.length>0&&await pa(s().token,l().id,A,"grant"),x.length>0&&await pa(s().token,l().id,x,"revoke"),n(C,"Access updated successfully"),await ea(),aa("updated"),setTimeout(()=>{P()},1500)}catch(i){n(b,i.message)}finally{n(p,!1)}}}function P(){aa("close")}function ma(){n(v,null),n(k,new Set),n(b,""),n(C,"")}function ha(i){return i==="creator"?"Creator":"End User"}fa(()=>(D(z()),D(l())),()=>{z()&&l()&&ea()}),fa(()=>D(z()),()=>{z()||ma()}),Da(),Ha();var sa=X(),ga=R(sa);{var ka=i=>{var d=ce(),A=o(d),x=o(A),j=o(x),ba=o(j);r(j);var ja=f(j,2);r(x);var J=f(x,2),ya=o(J);{var Aa=m=>{var I=se();_(m,I)},xa=m=>{var I=X(),Ea=R(I);{var Ta=S=>{var E=te(),N=o(E,!0);r(E),F(()=>h(N,a(b))),_(S,E)},$a=S=>{var E=X(),N=R(E);{var za=Q=>{var ra=ie(),Y=R(ra),na=o(Y),Ca=f(o(na));r(na),r(Y);var oa=f(Y,2);{var Ua=U=>{var t=re(),la=o(t,!0);r(t),F(()=>h(la,a(C))),_(U,t)};$(oa,U=>{a(C)&&U(Ua)})}var ia=f(oa,2),ca=f(o(ia),2);Ka(ca,5,()=>(a(v),w(()=>a(v).organization_users)),Na,(U,t,la,le)=>{var L=oe();let va;var O=o(L);Qa(O);var da=f(O,2),q=o(da),Oa=o(q,!0);r(q);var H=f(q,2),Ma=o(H,!0);r(H);var V=f(H,2),Ba=o(V,!0);r(V);var Fa=f(V,2);{var Pa=M=>{var W=ne();_(M,W)};$(Fa,M=>{a(t),w(()=>a(t).is_owner)&&M(Pa)})}r(da),r(L),F((M,W,Ga)=>{va=Ya(L,1,"user-item svelte-rkaw9j",null,va,M),qa(O,W),O.disabled=(a(t),a(p),w(()=>a(t).is_owner||a(p))),h(Oa,(a(t),w(()=>a(t).name))),h(Ma,(a(t),w(()=>a(t).email))),h(Ba,Ga)},[()=>({"is-owner":a(t).is_owner}),()=>(a(k),a(t),w(()=>a(k).has(a(t).email))),()=>(a(t),w(()=>ha(a(t).user_type)))]),T("change",O,()=>_a(a(t).email)),_(U,L)}),r(ca),r(ia),F(()=>h(Ca,` ${a(v),w(()=>a(v).assistant.owner)??""}`)),_(Q,ra)};$(N,Q=>{a(v)&&Q(za)},!0)}_(S,E)};$(Ea,S=>{a(b)?S(Ta):S($a,!1)},!0)}_(m,I)};$(ya,m=>{a(p)&&!a(v)?m(Aa):m(xa,!1)})}r(J);var ta=f(J,2),K=o(ta),G=f(K,2),Sa=o(G,!0);r(G),r(ta),r(A),r(d),F(()=>{h(ba,`Manage Access: ${D(l()),w(()=>l().name)??""}`),K.disabled=a(p),G.disabled=a(p)||!a(v),h(Sa,a(p)?"Saving...":"Save Changes")}),T("click",ja,P),T("click",K,P),T("click",G,wa),T("click",A,Za(function(m){ae.call(this,e,m)})),T("click",d,P),_(i,d)};$(ga,i=>{z()&&l()&&i(ka)})}_(c,sa),Ja(),u()}export{je as A,be as g};
