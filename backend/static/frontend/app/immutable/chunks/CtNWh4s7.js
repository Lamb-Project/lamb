import{a as w}from"./t--hEgTQ.js";import{g as b}from"./BWNE5xtz.js";async function m(){var i,c,l,f,n;const d=localStorage.getItem("userToken");if(!d)throw new Error("User not authenticated.");const g=b("/knowledgebases");console.log(`Fetching knowledge bases from: ${g}`);try{const s=await w.get(g,{headers:{Authorization:`Bearer ${d}`}});if(console.log("Raw KB Response Data:",s.data),s.data&&Array.isArray(s.data.knowledge_bases))return console.log("Successfully fetched knowledge bases:",s.data.knowledge_bases.length),s.data.knowledge_bases;{console.error("Unexpected response structure for KBs:",s.data);const t=((i=s.data)==null?void 0:i.detail)||((c=s.data)==null?void 0:c.message)||JSON.stringify(s.data);throw new Error(`Failed to fetch knowledge bases: Invalid response format. Received: ${t}`)}}catch(s){console.error("Raw Error fetching knowledge bases:",s);let t="Failed to fetch knowledge bases.";throw w.isAxiosError(s)?(console.error("Axios Error Response Data:",(l=s.response)==null?void 0:l.data),s.response&&(t=((f=s.response.data)==null?void 0:f.detail)||((n=s.response.data)==null?void 0:n.message)||`Request failed with status ${s.response.status}`)):s instanceof Error&&(t=s.message),new Error(t)}}async function y(d){var c,l,f,n,s,t,u;const g=localStorage.getItem("userToken");if(!g)throw new Error("User not authenticated.");const i=b("/knowledgebases");console.log(`Creating knowledge base at: ${i}`);try{const r=await w.post(i,d,{headers:{Authorization:`Bearer ${g}`,"Content-Type":"application/json"}});if(console.log("Knowledge base creation response:",r.data),r.data&&(r.data.kb_id||r.data.status==="success"))return r.data;{console.error("Unexpected response structure for KB creation:",r.data);const e=((c=r.data)==null?void 0:c.detail)||((l=r.data)==null?void 0:l.message)||JSON.stringify(r.data);throw new Error(`Failed to create knowledge base: Invalid response format. Received: ${e}`)}}catch(r){console.error("Error creating knowledge base:",r);let e="Failed to create knowledge base.";throw w.isAxiosError(r)?(console.error("Axios Error Response Data:",(f=r.response)==null?void 0:f.data),((s=(n=r.response)==null?void 0:n.data)==null?void 0:s.kb_server_available)===!1?e="Knowledge Base server offline. Please try again later.":r.response&&(e=((t=r.response.data)==null?void 0:t.detail)||((u=r.response.data)==null?void 0:u.message)||`Request failed with status ${r.response.status}`)):r instanceof Error&&(e=r.message),new Error(e)}}async function v(d){var c,l,f,n,s,t,u,r,e,p;const g=localStorage.getItem("userToken");if(!g)throw new Error("User not authenticated.");const i=b(`/knowledgebases/kb/${d}`);console.log(`Fetching knowledge base details from: ${i}`);try{const a=await w.get(i,{headers:{Authorization:`Bearer ${g}`}});if(console.log("Knowledge base details response:",a.data),((c=a.data)==null?void 0:c.status)==="error"&&((l=a.data)==null?void 0:l.kb_server_available)===!1)throw new Error("Knowledge Base server offline. Please try again later.");if(a.data&&a.data.id)return a.data;{console.error("Unexpected response structure for KB details:",a.data);const o=((f=a.data)==null?void 0:f.detail)||((n=a.data)==null?void 0:n.message)||JSON.stringify(a.data);throw new Error(`Failed to fetch knowledge base details: Invalid response format. Received: ${o}`)}}catch(a){console.error("Error fetching knowledge base details:",a);let o="Failed to fetch knowledge base details.";throw w.isAxiosError(a)?(console.error("Axios Error Response Data:",(s=a.response)==null?void 0:s.data),((u=(t=a.response)==null?void 0:t.data)==null?void 0:u.kb_server_available)===!1?o="Knowledge Base server offline. Please try again later.":((r=a.response)==null?void 0:r.status)===404?o=`Knowledge base not found. ID: ${d}`:a.response&&(o=((e=a.response.data)==null?void 0:e.detail)||((p=a.response.data)==null?void 0:p.message)||`Request failed with status ${a.response.status}`)):a instanceof Error&&(o=a.message),new Error(o)}}async function $(){var i,c,l,f,n,s,t,u,r;const d=localStorage.getItem("userToken");if(!d)throw new Error("User not authenticated.");const g=b("/knowledgebases/ingestion-plugins");console.log(`Fetching ingestion plugins from: ${g}`);try{const e=await w.get(g,{headers:{Authorization:`Bearer ${d}`}});if(console.log("Ingestion plugins response:",e.data),((i=e.data)==null?void 0:i.status)==="error"&&((c=e.data)==null?void 0:c.kb_server_available)===!1)throw new Error("Knowledge Base server offline. Please try again later.");if(e.data&&e.data.plugins&&Array.isArray(e.data.plugins))return e.data.plugins;{console.error("Unexpected response structure for ingestion plugins:",e.data);const p=((l=e.data)==null?void 0:l.detail)||((f=e.data)==null?void 0:f.message)||JSON.stringify(e.data);throw new Error(`Failed to fetch ingestion plugins: Invalid response format. Received: ${p}`)}}catch(e){console.error("Error fetching ingestion plugins:",e);let p="Failed to fetch ingestion plugins.";throw w.isAxiosError(e)?(console.error("Axios Error Response Data:",(n=e.response)==null?void 0:n.data),((t=(s=e.response)==null?void 0:s.data)==null?void 0:t.kb_server_available)===!1?p="Knowledge Base server offline. Please try again later.":e.response&&(p=((u=e.response.data)==null?void 0:u.detail)||((r=e.response.data)==null?void 0:r.message)||`Request failed with status ${e.response.status}`)):e instanceof Error&&(p=e.message),new Error(p)}}async function A(d,g,i,c={}){var s,t,u,r,e,p,a;const l=localStorage.getItem("userToken");if(!l)throw new Error("User not authenticated.");const f=b(`/knowledgebases/kb/${d}/plugin-ingest-file`);console.log(`Uploading file to KB ${d} using plugin ${i}`);const n=new FormData;n.append("file",g),n.append("plugin_name",i),Object.entries(c).forEach(([o,h])=>{h!=null&&n.append(o,h.toString())});try{const o=await w.post(f,n,{headers:{Authorization:`Bearer ${l}`,"Content-Type":"multipart/form-data"}});if(console.log("File upload response:",o.data),((s=o.data)==null?void 0:s.status)==="error"&&((t=o.data)==null?void 0:t.kb_server_available)===!1)throw new Error("Knowledge Base server offline. Please try again later.");return o.data}catch(o){console.error("Error uploading file:",o);let h="Failed to upload file.";throw w.isAxiosError(o)?(console.error("Axios Error Response Data:",(u=o.response)==null?void 0:u.data),((e=(r=o.response)==null?void 0:r.data)==null?void 0:e.kb_server_available)===!1?h="Knowledge Base server offline. Please try again later.":o.response&&(h=((p=o.response.data)==null?void 0:p.detail)||((a=o.response.data)==null?void 0:a.message)||`Request failed with status ${o.response.status}`)):o instanceof Error&&(h=o.message),new Error(h)}}export{v as a,$ as b,y as c,m as g,A as u};
