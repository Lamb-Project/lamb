import{a as u}from"./ngrFHoWO.js";import{g as b}from"./BVlmaXU-.js";async function m(){var p,i,d,g,n;const f=localStorage.getItem("userToken");if(!f)throw new Error("User not authenticated.");const l=b("/knowledgebases");console.log(`Fetching knowledge bases from: ${l}`);try{const e=await u.get(l,{headers:{Authorization:`Bearer ${f}`}});if(console.log("Raw KB Response Data:",e.data),e.data&&Array.isArray(e.data.knowledge_bases))return console.log("Successfully fetched knowledge bases:",e.data.knowledge_bases.length),e.data.knowledge_bases;{console.error("Unexpected response structure for KBs:",e.data);const o=((p=e.data)==null?void 0:p.detail)||((i=e.data)==null?void 0:i.message)||JSON.stringify(e.data);throw new Error(`Failed to fetch knowledge bases: Invalid response format. Received: ${o}`)}}catch(e){console.error("Raw Error fetching knowledge bases:",e);let o="Failed to fetch knowledge bases.";throw u.isAxiosError(e)?(console.error("Axios Error Response Data:",(d=e.response)==null?void 0:d.data),e.response&&(o=((g=e.response.data)==null?void 0:g.detail)||((n=e.response.data)==null?void 0:n.message)||`Request failed with status ${e.response.status}`)):e instanceof Error&&(o=e.message),new Error(o)}}async function y(f){var i,d,g,n,e,o,c;const l=localStorage.getItem("userToken");if(!l)throw new Error("User not authenticated.");const p=b("/knowledgebases");console.log(`Creating knowledge base at: ${p}`);try{const a=await u.post(p,f,{headers:{Authorization:`Bearer ${l}`,"Content-Type":"application/json"}});if(console.log("Knowledge base creation response:",a.data),a.data&&(a.data.kb_id||a.data.status==="success"))return a.data;{console.error("Unexpected response structure for KB creation:",a.data);const s=((i=a.data)==null?void 0:i.detail)||((d=a.data)==null?void 0:d.message)||JSON.stringify(a.data);throw new Error(`Failed to create knowledge base: Invalid response format. Received: ${s}`)}}catch(a){console.error("Error creating knowledge base:",a);let s="Failed to create knowledge base.";throw u.isAxiosError(a)?(console.error("Axios Error Response Data:",(g=a.response)==null?void 0:g.data),((e=(n=a.response)==null?void 0:n.data)==null?void 0:e.kb_server_available)===!1?s="Knowledge Base server offline. Please try again later.":a.response&&(s=((o=a.response.data)==null?void 0:o.detail)||((c=a.response.data)==null?void 0:c.message)||`Request failed with status ${a.response.status}`)):a instanceof Error&&(s=a.message),new Error(s)}}async function $(f){var i,d,g,n,e,o,c,a,s,w;const l=localStorage.getItem("userToken");if(!l)throw new Error("User not authenticated.");const p=b(`/knowledgebases/kb/${f}`);console.log(`Fetching knowledge base details from: ${p}`);try{const t=await u.get(p,{headers:{Authorization:`Bearer ${l}`}});if(console.log("Knowledge base details response:",t.data),((i=t.data)==null?void 0:i.status)==="error"&&((d=t.data)==null?void 0:d.kb_server_available)===!1)throw new Error("Knowledge Base server offline. Please try again later.");if(t.data&&t.data.id)return t.data;{console.error("Unexpected response structure for KB details:",t.data);const r=((g=t.data)==null?void 0:g.detail)||((n=t.data)==null?void 0:n.message)||JSON.stringify(t.data);throw new Error(`Failed to fetch knowledge base details: Invalid response format. Received: ${r}`)}}catch(t){console.error("Error fetching knowledge base details:",t);let r="Failed to fetch knowledge base details.";throw u.isAxiosError(t)?(console.error("Axios Error Response Data:",(e=t.response)==null?void 0:e.data),((c=(o=t.response)==null?void 0:o.data)==null?void 0:c.kb_server_available)===!1?r="Knowledge Base server offline. Please try again later.":((a=t.response)==null?void 0:a.status)===404?r=`Knowledge base not found. ID: ${f}`:t.response&&(r=((s=t.response.data)==null?void 0:s.detail)||((w=t.response.data)==null?void 0:w.message)||`Request failed with status ${t.response.status}`)):t instanceof Error&&(r=t.message),new Error(r)}}async function v(){var p,i,d,g,n,e,o,c,a;const f=localStorage.getItem("userToken");if(!f)throw new Error("User not authenticated.");const l=b("/knowledgebases/ingestion-plugins");console.log(`Fetching ingestion plugins from: ${l}`);try{const s=await u.get(l,{headers:{Authorization:`Bearer ${f}`}});if(console.log("Ingestion plugins response:",s.data),((p=s.data)==null?void 0:p.status)==="error"&&((i=s.data)==null?void 0:i.kb_server_available)===!1)throw new Error("Knowledge Base server offline. Please try again later.");if(s.data&&s.data.plugins&&Array.isArray(s.data.plugins))return s.data.plugins;{console.error("Unexpected response structure for ingestion plugins:",s.data);const w=((d=s.data)==null?void 0:d.detail)||((g=s.data)==null?void 0:g.message)||JSON.stringify(s.data);throw new Error(`Failed to fetch ingestion plugins: Invalid response format. Received: ${w}`)}}catch(s){console.error("Error fetching ingestion plugins:",s);let w="Failed to fetch ingestion plugins.";throw u.isAxiosError(s)?(console.error("Axios Error Response Data:",(n=s.response)==null?void 0:n.data),((o=(e=s.response)==null?void 0:e.data)==null?void 0:o.kb_server_available)===!1?w="Knowledge Base server offline. Please try again later.":s.response&&(w=((c=s.response.data)==null?void 0:c.detail)||((a=s.response.data)==null?void 0:a.message)||`Request failed with status ${s.response.status}`)):s instanceof Error&&(w=s.message),new Error(w)}}async function B(f,l,p,i={}){var e,o,c,a,s,w,t;const d=localStorage.getItem("userToken");if(!d)throw new Error("User not authenticated.");const g=b(`/knowledgebases/kb/${f}/plugin-ingest-file`);console.log(`Uploading file to KB ${f} using plugin ${p}`);const n=new FormData;n.append("file",l),n.append("plugin_name",p),Object.entries(i).forEach(([r,h])=>{h!=null&&n.append(r,h.toString())});try{const r=await u.post(g,n,{headers:{Authorization:`Bearer ${d}`,"Content-Type":"multipart/form-data"}});if(console.log("File upload response:",r.data),((e=r.data)==null?void 0:e.status)==="error"&&((o=r.data)==null?void 0:o.kb_server_available)===!1)throw new Error("Knowledge Base server offline. Please try again later.");return r.data}catch(r){console.error("Error uploading file:",r);let h="Failed to upload file.";throw u.isAxiosError(r)?(console.error("Axios Error Response Data:",(c=r.response)==null?void 0:c.data),((s=(a=r.response)==null?void 0:a.data)==null?void 0:s.kb_server_available)===!1?h="Knowledge Base server offline. Please try again later.":r.response&&(h=((w=r.response.data)==null?void 0:w.detail)||((t=r.response.data)==null?void 0:t.message)||`Request failed with status ${r.response.status}`)):r instanceof Error&&(h=r.message),new Error(h)}}async function A(f,l,p={}){var n,e,o,c,a,s,w,t;const i=localStorage.getItem("userToken");if(!i)throw new Error("User not authenticated.");const d=b(`/knowledgebases/kb/${f}/plugin-ingest-base`);console.log(`Running base ingestion on KB ${f} using plugin ${l}`);const g={plugin_name:l,parameters:p};try{const r=await u.post(d,g,{headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"}});if(console.log("Base ingestion response:",r.data),((n=r.data)==null?void 0:n.status)==="error"&&((e=r.data)==null?void 0:e.kb_server_available)===!1)throw new Error("Knowledge Base server offline. Please try again later.");if(((o=r.data)==null?void 0:o.status)==="error")throw new Error(r.data.message||"Base ingestion failed with an unspecified error.");return r.data}catch(r){console.error("Error running base ingestion:",r);let h="Failed to run base ingestion.";throw u.isAxiosError(r)?(console.error("Axios Error Response Data:",(c=r.response)==null?void 0:c.data),((s=(a=r.response)==null?void 0:a.data)==null?void 0:s.kb_server_available)===!1?h="Knowledge Base server offline. Please try again later.":r.response&&(h=((w=r.response.data)==null?void 0:w.detail)||((t=r.response.data)==null?void 0:t.message)||`Request failed with status ${r.response.status}`)):r instanceof Error&&(h=r.message),new Error(h)}}async function _(f,l,p=!0){var g,n,e,o;const i=localStorage.getItem("userToken");if(!i)throw new Error("User not authenticated.");const d=b(`/knowledgebases/kb/${f}/files/${l}`)+`?hard=${p}`;try{return(await u.delete(d,{headers:{Authorization:`Bearer ${i}`}})).data}catch(c){let a="Failed to delete file.";throw u.isAxiosError(c)?a=((n=(g=c.response)==null?void 0:g.data)==null?void 0:n.detail)||((o=(e=c.response)==null?void 0:e.data)==null?void 0:o.message)||a:c instanceof Error&&(a=c.message),new Error(a)}}async function K(f){var i,d,g,n;const l=localStorage.getItem("userToken");if(!l)throw new Error("User not authenticated.");const p=b(`/knowledgebases/kb/${f}`);try{return(await u.delete(p,{headers:{Authorization:`Bearer ${l}`}})).data}catch(e){let o="Failed to delete knowledge base.";throw u.isAxiosError(e)?o=((d=(i=e.response)==null?void 0:i.data)==null?void 0:d.detail)||((n=(g=e.response)==null?void 0:g.data)==null?void 0:n.message)||o:e instanceof Error&&(o=e.message),new Error(o)}}export{$ as a,v as b,y as c,K as d,_ as e,m as g,A as r,B as u};
