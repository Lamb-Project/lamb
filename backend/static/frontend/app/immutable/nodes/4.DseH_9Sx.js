import"../chunks/Bzak7iHL.js";import{ag as to,d as es,p as Ga,s as _,aj as Xa,aY as qs,a as lr,M as Cs,i as a,g as e,f as l,l as q,j as r,r as t,b as o,c as n,h as Ka,t as d,m as i,k as we,o as ja,Q as jr,u as Ia,ab as ro,aK as ga,q as la,aP as js,e as Zr,n as gs,O as Nr,P as Es,R as ao,b6 as Ys,aO as so}from"../chunks/D10uF6KO.js";import{i as v}from"../chunks/B5RjaZpx.js";import{e as ar,i as Qr}from"../chunks/BY88_K0J.js";import{a as Ct,s as Ht,r as Pr}from"../chunks/gDFrtnMu.js";import{s as Gs}from"../chunks/BPb77SYP.js";import{a as da,s as ts}from"../chunks/CAofB27F.js";import{h as Ba}from"../chunks/ClvIeoc1.js";import{g as Ua}from"../chunks/5D1vQkJ2.js";import{a as ms,$ as bs}from"../chunks/Cct3hKQg.js";import{u as Ks}from"../chunks/DSpOhgIp.js";import{g as za,a as zs}from"../chunks/BVlmaXU-.js";import{a as Ta}from"../chunks/ngrFHoWO.js";import{b as Oa}from"../chunks/CjgJlaKl.js";import{b as na,a as oo,c as fs}from"../chunks/CF2p2rhS.js";import{b as Ss}from"../chunks/DRu2A6f6.js";import{b as Zs}from"../chunks/DXcfmTg0.js";import{p as Mr}from"../chunks/Dpgw__wX.js";import{a as Ma,b as Js}from"../chunks/9q7li0xI.js";import{g as Qs}from"../chunks/XvA01ktp.js";import{h as io,i as no}from"../chunks/DUGLaF72.js";import"../chunks/CbD3bVMs.js";import{i as lo}from"../chunks/9AfmHA9f.js";import{p as Vs}from"../chunks/-YgP7Ysb.js";const co=to(!1);async function uo(j=10,f=0){const h=localStorage.getItem("userToken");if(!h)throw new Error("Not authenticated");console.log("Checking window.LAMB_CONFIG in getAssistants:",window.LAMB_CONFIG,"typeof:",typeof window.LAMB_CONFIG),window.LAMB_CONFIG&&(console.log("Checking window.LAMB_CONFIG.api:",window.LAMB_CONFIG.api,"typeof:",typeof window.LAMB_CONFIG.api),window.LAMB_CONFIG.api&&console.log("Checking window.LAMB_CONFIG.api.lambServer:",window.LAMB_CONFIG.api.lambServer,"typeof:",typeof window.LAMB_CONFIG.api.lambServer));const s=new URLSearchParams({limit:j.toString(),offset:f.toString()}),M=za(`/assistant/get_assistants?${s}`);console.log("Fetching assistants from absolute URL:",M),console.log(`Equivalent curl command:
curl -X GET "${M}" -H "Authorization: Bearer ${h}"`);const J=await fetch(M,{headers:{Authorization:`Bearer ${h}`,"Content-Type":"application/json"}});if(!J.ok){let c="Failed to fetch assistants";try{const m=await J.json();c=(m==null?void 0:m.detail)||c}catch{}throw console.error("API error response status:",J.status,"Detail:",c),new Error(c)}const w=await J.json();return{assistants:Array.isArray(w==null?void 0:w.assistants)?w.assistants:[],total_count:typeof(w==null?void 0:w.total_count)=="number"?w.total_count:0}}async function Hs(j){const f=localStorage.getItem("userToken");if(!f)throw new Error("Not authenticated");const h=za(`/assistant/get_assistant/${j}`);console.log("Fetching assistant by ID from absolute URL:",h);const s=await fetch(h,{headers:{Authorization:`Bearer ${f}`,"Content-Type":"application/json"}});if(!s.ok){let M=`Failed to fetch assistant with ID ${j}`;try{const J=await s.json();M=(J==null?void 0:J.detail)||M}catch{}throw console.error("API error response status:",s.status,"Detail:",M),new Error(M)}return await s.json()}async function vo(j,f,h){const s=localStorage.getItem("userToken");if(!s)throw new Error("Not authenticated");const M=za(`/assistant/unpublish_assistant/${j}/${f}?user_email=${encodeURIComponent(h)}`),J=await fetch(M,{method:"DELETE",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"}});if(!J.ok){let w="Failed to unpublish assistant";try{const c=await J.json();w=(c==null?void 0:c.detail)||w}catch{}throw console.error("Unpublish error:",J.status,w),new Error(w)}return await J.json()}async function po(j){try{const f=localStorage.getItem("userToken");if(!f)throw new Error("Not authenticated");const h=localStorage.getItem("userEmail");if(!h)throw new Error("User email not found in localStorage");const s=za(`/assistant/delete_assistant/${j}?owner=${encodeURIComponent(h)}`),M=await fetch(s,{method:"DELETE",headers:{Authorization:`Bearer ${f}`}});if(!M.ok){let w={detail:`Error: ${M.status}`};try{w=await M.json()}catch{}throw M.status===403?new Error("You do not have permission to delete this assistant"):M.status===404?new Error("Assistant not found"):new Error(w.detail||`Error: ${M.status}`)}const J=await M.text();return J?JSON.parse(J):{}}catch(f){throw console.error("Error deleting assistant:",f),f instanceof Error?f:new Error("An unknown error occurred during assistant deletion")}}async function Xs(j){var s;const f=localStorage.getItem("userToken");if(!f)throw new Error("Not authenticated");const h=za("/assistant/create_assistant");console.log("Creating assistant with data:",j);try{const M=await Ta.post(h,j,{headers:{Authorization:`Bearer ${f}`,"Content-Type":"application/json"}});return console.log("Assistant created successfully:",M.data),M.data}catch(M){console.error("Error creating assistant:",M);let J="Failed to create assistant.";if(Ta.isAxiosError(M)&&M.response){const w=M.response.data;if(console.error("API Error Response:",w),(s=w==null?void 0:w.detail)!=null&&s.includes("already exists for this owner")){const c=w.detail.match(/named '([^']+)' already exists/);J=`An assistant named '${c?c[1]:"this name"}' already exists. Please choose a different name.`}else J=(w==null?void 0:w.detail)||(w==null?void 0:w.message)||`Request failed with status ${M.response.status}`}else M instanceof Error&&(J=M.message);throw new Error(J)}}async function fo(j,f){const h=localStorage.getItem("userToken");if(!h)throw new Error("Not authenticated");const s=["name","description","system_prompt","prompt_template","RAG_Top_k","RAG_collections","metadata"],M=Object.keys(f).filter(w=>s.includes(w)).reduce((w,c)=>{const m=w;return f[c]!==null&&f[c]!==void 0?m[c]=f[c]:c==="description"&&(m[c]=""),m},{}),J=za(`/assistant/update_assistant/${j}`);console.log(`Updating assistant ${j} at URL:`,J),console.log("With data:",M);try{const w=await fetch(J,{method:"PUT",headers:{Authorization:`Bearer ${h}`,"Content-Type":"application/json"},body:JSON.stringify(M)});if(!w.ok){let c=`Failed to update assistant with ID ${j}`;try{const m=await w.json();c=(m==null?void 0:m.detail)||c}catch{}throw console.error("API error response status:",w.status,"Detail:",c),new Error(c)}return await w.json()}catch(w){console.error("Error updating assistant:",w);let c="Failed to update assistant.";throw w instanceof Error&&(c=w.message),new Error(c)}}async function mo(j,f){const h=localStorage.getItem("userToken");if(!h)throw new Error("Not authenticated");const s=`/assistant/publish/${j}`,M=za(s);console.log(`Setting publish status to ${f} for ${j} at ${M}`);const J="PUT";try{const w=await fetch(M,{method:J,headers:{Authorization:`Bearer ${h}`,"Content-Type":"application/json"},body:JSON.stringify({publish_status:f})});if(!w.ok){let c=`Failed to set publish status for assistant ${j}`;try{const m=await w.json();c=(m==null?void 0:m.detail)||c}catch{}throw console.error("API error response status:",w.status,"Detail:",c),new Error(c)}return await w.json()}catch(w){console.error("Error setting publish status:",w);let c="Failed to set publish status.";throw w instanceof Error&&(c=w.message),new Error(c)}}es(["click"]);async function go(j,f,h,s,M){e(f)||(console.log("Manual refresh triggered..."),a(f,!0),await h(e(s),M),a(f,!1))}function bo(j,f,h,s){e(f)>1&&h(e(f)-1,s)}function _o(j,f,h,s,M){e(f)<e(h)&&s(e(f)+1,M)}var ho=l('<p class="text-center text-gray-500 py-4"> </p>'),xo=l('<div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative" role="alert"><strong class="font-bold"> </strong> <span class="block sm:inline"> </span></div>'),yo=l('<p class="text-center text-gray-500 py-4"> </p>'),wo=(j,f,h)=>f(e(h).id),ko=l('<span class="inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800 px-2 py-0.5"> </span>'),$o=l('<span class="inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800 px-2 py-0.5"> </span>'),Ao=(j,f,h)=>f(e(h).id),Eo=(j,f,h)=>f("duplicate",{id:e(h).id,name:e(h).name}),So=(j,f,h)=>f("export",{id:e(h).id}),Co=(j,f,h)=>f({detail:{assistantId:e(h).id,groupId:e(h).group_id,ownerEmail:e(h).owner}}),No=l('<button class="text-yellow-600 hover:text-yellow-900 p-1 rounded hover:bg-yellow-100 transition-colors duration-150"><!></button>'),Po=(j,f,h)=>f("delete",{id:e(h).id,name:e(h).name,published:e(h).published}),Mo=l('<button class="text-red-600 hover:text-red-900 p-1 rounded hover:bg-red-100 transition-colors duration-150"><!></button>'),To=l('<tr class="bg-gray-50 border-b border-gray-200"><td colspan="2" class="px-6 py-2 text-sm"><div class="flex flex-wrap"><div class="mr-6 mb-1"><span class="text-brand font-medium"> </span> <span class="ml-1"> </span></div> <div><span class="text-brand font-medium"> </span> <span class="ml-1 truncate"> </span></div></div></td><td class="px-6 py-2"></td></tr>'),Io=l('<tr class="bg-gray-50 border-b border-gray-200"><td colspan="2" class="px-6 py-2 text-sm"><div class="flex flex-wrap items-center"><span class="text-brand font-medium mr-1"> </span> <span class="mr-3"> </span> <span class="text-brand font-medium mr-1"> </span> <span class="mr-3"> </span> <span class="text-brand font-medium mr-1"> </span> <span class="mr-3"> </span> <span class="text-brand font-medium mr-1"> </span> <span> </span></div></td><td class="px-6 py-2"></td></tr> <!>',1),Ro=l('<tr class="bg-gray-50 border-b border-gray-200"><td colspan="2" class="px-6 py-2 text-sm text-gray-500"><span class="text-brand font-medium"> </span> <span class="ml-1"> </span></td><td class="px-6 py-2"></td></tr>'),Do=l('<tr class="hover:bg-gray-50"><td class="px-6 py-4 whitespace-normal align-top"><button class="text-sm font-medium text-brand hover:underline break-words text-left"> </button> <div class="mt-1"><!></div></td><td class="px-6 py-4 align-top"><div class="text-sm text-gray-500 break-words max-w-md"> </div></td><td class="px-6 py-4 whitespace-nowrap text-sm font-medium align-top"><div class="flex items-center space-x-1 sm:space-x-2"><button class="text-green-600 hover:text-green-900 p-1 rounded hover:bg-green-100 transition-colors duration-150"><!></button> <button class="text-blue-600 hover:text-blue-900 p-1 rounded hover:bg-blue-100 transition-colors duration-150"><!></button> <button class="text-green-600 hover:text-green-900 p-1 rounded hover:bg-green-100 transition-colors duration-150"><!></button> <!></div> <div class="text-xs text-gray-400 mt-2"> </div></td></tr> <!>',1),Lo=l('<div class="flex justify-center items-center mt-4 space-x-4 text-sm text-gray-700"><button class="p-1.5 font-medium bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"><span><!></span></button> <button class="px-3 py-1 font-medium bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"> </button> <span> <span class="mx-2">|</span> <span class="font-medium text-brand"> </span> <span class="font-medium text-brand"> </span> <span class="font-medium text-brand"> </span></span> <button class="px-3 py-1 font-medium bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"> </button></div>'),Fo=l('<div class="overflow-x-auto shadow-md sm:rounded-lg mb-6 border border-gray-200"><table class="min-w-full divide-y divide-gray-200"><thead class="bg-gray-50"><tr><th scope="col" class="px-6 py-3 text-left text-xs font-medium text-brand uppercase tracking-wider"> </th><th scope="col" class="px-6 py-3 text-left text-xs font-medium text-brand uppercase tracking-wider"> </th><th scope="col" class="px-6 py-3 text-left text-xs font-medium text-brand uppercase tracking-wider"> </th></tr></thead><tbody class="bg-white divide-y divide-gray-200"></tbody></table></div> <!>',1),Bo=l('<div class="container mx-auto px-4 py-8"><!></div> <!>',1);function Uo(j,f){Ga(f,!0);const h=()=>da(Ks,"$user",J),s=()=>da(bs,"$_",J),M=()=>da(co,"$publishModalOpen",J),[J,w]=ts();let c=_(!!Xa(ms));const m=qs();let A=_(lr([])),z=_(!0),F=_(null),me=5,le=_(1),I=_(0),B=jr(()=>Math.ceil(e(I)/me)),ve=()=>{},Ge=()=>{};Cs(()=>(ve=ms.subscribe(S=>{S&&a(c,!0)}),Ge=Ks.subscribe(R=>{R.isLoggedIn?e(A).length===0&&!e(z)&&(console.log("User logged in, loading initial assistants..."),oe(1,me)):(console.log("User logged out, clearing assistants."),a(A,[],!0),a(I,0),a(le,1),a(F,null),a(z,!1))}),h().isLoggedIn&&(console.log("User already logged in on mount, loading initial assistants..."),oe(e(le),me)),()=>{ve(),Ge&&Ge()}));let be=_(!1);async function oe(S,R){a(z,!0),a(F,null);try{const pe=(S-1)*R;console.log(`Calling getAssistants with limit=${R}, offset=${pe}`);const X=await uo(R,pe);console.log("Received data from getAssistants:",X),a(A,X.assistants,!0),a(I,X.total_count,!0),a(le,S,!0)}catch(pe){console.error("Error loading assistants:",pe),a(F,pe instanceof Error?pe.message:"Failed to load assistants",!0),a(A,[],!0),a(I,0)}finally{a(z,!1)}await new Promise(pe=>setTimeout(pe,500)),a(z,!1)}function ie(S){console.log(`View assistant (navigate to detail view): ${S}`);const R=`${Oa}/assistants?view=detail&id=${S}`;console.log("[AssistantsList] Navigating to view:",R),Ua(R)}async function Ke(S){const R=Number(S.detail.assistantId),{groupId:pe,ownerEmail:X}=S.detail;if(!pe||!X){alert(e(c)?s()("assistants.unpublishErrorMissingData"):"Cannot unpublish: Missing group ID or owner email.");return}const ke=e(A).find(Se=>Se.id===R),Ne=e(c)?s()("assistants.unpublishConfirm",{values:{name:(ke==null?void 0:ke.name)||R}}):`Are you sure you want to unpublish assistant ${R}?`;if(confirm(Ne))try{await vo(R.toString(),pe,X),await oe(e(le),me),alert(e(c)?s()("assistants.unpublishSuccess"):"Assistant unpublished successfully!")}catch(Se){console.error("Error unpublishing assistant:",Se);const de=Se instanceof Error?Se.message:"Failed to unpublish assistant";a(F,de,!0),alert(e(c)?s()("assistants.unpublishError",{values:{error:de}}):`Error: ${de}`)}}function Ae(S){if(!S)return{};try{return JSON.parse(S)}catch(R){return console.error("Error parsing metadata:",R,S),{}}}const it='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z" /><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" /></svg>',Ee='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75c-.621 0-1.125-.504-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75" /></svg>',Ze='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" /></svg>',Te='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99" /></svg>',Ce='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3" /></svg>',ge='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75c-.621 0-1.125-.504-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75" /></svg>';var K=Bo(),Ve=q(K),He=r(Ve);{var U=S=>{var R=ho(),pe=r(R,!0);t(R),d(X=>i(pe,X),[()=>e(c)?s()("assistants.loading",{default:"Loading assistants..."}):"Loading assistants..."]),n(S,R)},k=S=>{var R=we(),pe=q(R);{var X=Ne=>{var Se=xo(),de=r(Se),We=r(de,!0);t(de);var re=o(de,2),ce=r(re,!0);t(re),t(Se),d(Ie=>{i(We,Ie),i(ce,e(F))},[()=>e(c)?s()("assistants.errorTitle"):"Error:"]),n(Ne,Se)},ke=Ne=>{var Se=we(),de=q(Se);{var We=ce=>{var Ie=yo(),nt=r(Ie,!0);t(Ie),d(Tt=>i(nt,Tt),[()=>e(c)?s()("assistants.noAssistants",{default:"No assistants found."}):"No assistants found."]),n(ce,Ie)},re=ce=>{var Ie=Fo(),nt=q(Ie),Tt=r(nt),It=r(Tt),Xr=r(It),Ot=r(Xr),Wt=r(Ot,!0);t(Ot);var Nt=o(Ot),dr=r(Nt,!0);t(Nt);var Tr=o(Nt),Ea=r(Tr,!0);t(Tr),t(Xr),t(It);var fe=o(It);ar(fe,21,()=>e(A),Ue=>Ue.id,(Ue,ae)=>{var ee=Do(),te=q(ee),et=r(te),Oe=r(et);Oe.__click=[wo,ie,ae];var lt=r(Oe,!0);t(Oe);var Rt=o(Oe,2),Yt=r(Rt);{var xt=Y=>{var H=ko(),u=r(H,!0);t(H),d(g=>i(u,g),[()=>e(c)?s()("assistants.status.published",{default:"Published"}):"Published"]),n(Y,H)},je=Y=>{var H=$o(),u=r(H,!0);t(H),d(g=>i(u,g),[()=>e(c)?s()("assistants.status.unpublished",{default:"Unpublished"}):"Unpublished"]),n(Y,H)};v(Yt,Y=>{e(ae).published?Y(xt):Y(je,!1)})}t(Rt),t(et);var Pe=o(et),vt=r(Pe),yt=r(vt,!0);t(vt),t(Pe);var wt=o(Pe),Zt=r(wt),pt=r(Zt);pt.__click=[Ao,ie,ae];var wr=r(pt);Ba(wr,()=>it),t(pt);var b=o(pt,2);b.__click=[Eo,m,ae];var p=r(b);Ba(p,()=>Ee),t(b);var x=o(b,2);x.__click=[So,m,ae];var D=r(x);Ba(D,()=>Ce),t(x);var O=o(x,2);{var V=Y=>{var H=No();H.__click=[Co,Ke,ae];var u=r(H);Ba(u,()=>ge),t(H),d(g=>Ct(H,"title",g),[()=>e(c)?s()("assistants.actions.unpublish",{default:"Unpublish"}):"Unpublish"]),n(Y,H)},_e=Y=>{var H=Mo();H.__click=[Po,m,ae];var u=r(H);Ba(u,()=>Ze),t(H),d(g=>Ct(H,"title",g),[()=>e(c)?s()("assistants.actions.delete",{default:"Delete"}):"Delete"]),n(Y,H)};v(O,Y=>{e(ae).published?Y(V):Y(_e,!1)})}t(Zt);var dt=o(Zt,2),jt=r(dt);t(dt),t(wt),t(te);var Kt=o(te,2);{var kt=Y=>{const H=jr(()=>Ae(e(ae).metadata));var u=Io(),g=q(u),T=r(g),C=r(T),G=r(C),se=r(G);t(G);var L=o(G,2),ft=r(L,!0);t(L);var tt=o(L,2),cr=r(tt);t(tt);var Le=o(tt,2),Fe=r(Le,!0);t(Le);var Qe=o(Le,2),Gr=r(Qe);t(Qe);var Kr=o(Qe,2),ca=r(Kr,!0);t(Kr);var ue=o(Kr,2),Q=r(ue);t(ue);var Ir=o(ue,2),Lt=r(Ir,!0);t(Ir),t(C),t(T),ja(),t(g);var sr=o(g,2);{var kr=zt=>{var mt=To(),Qt=r(mt),Xt=r(Qt),Rr=r(Xt),Dr=r(Rr),ua=r(Dr);t(Dr);var va=o(Dr,2),$r=r(va,!0);t(va),t(Rr);var zr=o(Rr,2),ea=r(zr),qr=r(ea);t(ea);var ta=o(ea,2),ur=r(ta,!0);t(ta),t(zr),t(Xt),t(Qt),ja(),t(mt),d((vr,Lr,or,ra)=>{i(ua,`${vr??""}:`),i($r,Lr),i(qr,`${or??""}:`),Ct(ta,"title",e(ae).RAG_collections||""),i(ur,ra)},[()=>e(c)?s()("assistants.table.ragTopK",{default:"RAG Top K"}):"RAG Top K",()=>e(ae).RAG_Top_k??(e(c)?s()("assistants.notSet",{default:"Not set"}):"Not set"),()=>e(c)?s()("assistants.table.ragCollections",{default:"RAG Collections"}):"RAG Collections",()=>e(ae).RAG_collections||(e(c)?s()("assistants.notSet",{default:"Not set"}):"Not set")]),n(zt,mt)};v(sr,zt=>{e(H).rag_processor==="simple_rag"&&zt(kr)})}d((zt,mt,Qt,Xt,Rr,Dr,ua,va)=>{i(se,`${zt??""}:`),i(ft,mt),i(cr,`${Qt??""}:`),i(Fe,Xt),i(Gr,`${Rr??""}:`),i(ca,Dr),i(Q,`${ua??""}:`),i(Lt,va)},[()=>e(c)?s()("assistants.table.promptProcessor",{default:"Prompt Processor"}):"Prompt Processor",()=>e(H).prompt_processor||(e(c)?s()("assistants.notSet",{default:"Not set"}):"Not set"),()=>e(c)?s()("assistants.table.connector",{default:"Connector"}):"Connector",()=>e(H).connector||(e(c)?s()("assistants.notSet",{default:"Not set"}):"Not set"),()=>e(c)?s()("assistants.table.llm",{default:"LLM"}):"LLM",()=>e(H).llm||(e(c)?s()("assistants.notSet",{default:"Not set"}):"Not set"),()=>e(c)?s()("assistants.table.ragProcessor",{default:"RAG Processor"}):"RAG Processor",()=>e(H).rag_processor||(e(c)?s()("assistants.notSet",{default:"Not set"}):"Not set")]),n(Y,u)},Dt=Y=>{var H=Ro(),u=r(H),g=r(u),T=r(g);t(g);var C=o(g,2),G=r(C,!0);t(C),t(u),ja(),t(H),d((se,L)=>{i(T,`${se??""}:`),i(G,L)},[()=>e(c)?s()("assistants.table.config",{default:"Configuration"}):"Configuration",()=>e(c)?s()("assistants.notSet",{default:"Not available"}):"Not available"]),n(Y,H)};v(Kt,Y=>{e(ae).metadata?Y(kt):Y(Dt,!1)})}d((Y,H,u,g)=>{i(lt,e(ae).name||"-"),i(yt,Y),Ct(pt,"title",H),Ct(b,"title",u),Ct(x,"title",g),i(jt,`ID: ${e(ae).id??""}`)},[()=>e(ae).description||(e(c)?s()("assistants.noDescription",{default:"No description provided"}):"No description provided"),()=>e(c)?s()("assistants.actions.view",{default:"View"}):"View",()=>e(c)?s()("assistants.actions.duplicate",{default:"Duplicate"}):"Duplicate",()=>e(c)?s()("assistants.actions.export",{default:"Export JSON"}):"Export JSON"]),n(Ue,ee)}),t(fe),t(Tt),t(nt);var Be=o(nt,2);{var ht=Ue=>{var ae=Lo(),ee=r(ae);ee.__click=[go,be,oe,le,me];var te=r(ee);let et;var Oe=r(te);Ba(Oe,()=>Te),t(te),t(ee);var lt=o(ee,2);lt.__click=[bo,le,oe,me];var Rt=r(lt,!0);t(lt);var Yt=o(lt,2),xt=r(Yt),je=o(xt,2),Pe=o(je),vt=r(Pe,!0);t(Pe);var yt=o(Pe),wt=o(yt),Zt=r(wt,!0);t(wt);var pt=o(wt),wr=o(pt),b=r(wr,!0);t(wr),t(Yt);var p=o(Yt,2);p.__click=[_o,le,B,oe,me];var x=r(p,!0);t(p),t(ae),d((D,O,V,_e,dt,jt,Kt,kt,Dt,Y)=>{ee.disabled=e(z)||e(be),Ct(ee,"title",D),et=Ht(te,1,"",null,et,O),lt.disabled=e(le)===1||e(z),i(Rt,V),i(xt,`${_e??""} ${e(le)??""} ${dt??""} ${e(B)??""} `),i(je,` ${jt??""} `),i(vt,(e(le)-1)*me+1),i(yt,` ${Kt??""} `),i(Zt,kt),i(pt,` ${Dt??""} `),i(b,e(I)),p.disabled=e(le)===e(B)||e(z),i(x,Y)},[()=>e(c)?s()("common.refresh",{default:"Refresh"}):"Refresh",()=>({"animate-spin":e(be)}),()=>e(c)?s()("pagination.previousShort",{default:"<"}):"<",()=>e(c)?s()("pagination.page",{default:"Page"}):"Page",()=>e(c)?s()("pagination.of",{default:"of"}):"of",()=>e(c)?s()("pagination.resultsSimple",{default:"Results"}):"Results",()=>e(c)?s()("pagination.to",{default:"to"}):"to",()=>Math.min(e(le)*me,e(I)),()=>e(c)?s()("pagination.of",{default:"of"}):"of",()=>e(c)?s()("pagination.nextShort",{default:">"}):">"]),n(Ue,ae)};v(Be,Ue=>{e(B)>1&&Ue(ht)})}d((Ue,ae,ee)=>{i(Wt,Ue),i(dr,ae),i(Ea,ee)},[()=>e(c)?s()("assistants.table.name",{default:"Assistant Name"}):"Assistant Name",()=>e(c)?s()("assistants.table.description",{default:"Description"}):"Description",()=>e(c)?s()("assistants.table.actions",{default:"Actions"}):"Actions"]),n(ce,Ie)};v(de,ce=>{e(A).length===0&&e(I)===0?ce(We):ce(re,!1)},!0)}n(Ne,Se)};v(pe,Ne=>{e(F)?Ne(X):Ne(ke,!1)},!0)}n(S,R)};v(He,S=>{e(z)?S(U):S(k,!1)})}t(Ve);var N=o(Ve,2);{var E=S=>{};v(N,S=>{M()&&S(E)})}n(j,K),Ka(),w()}es(["click"]);function Oo(j,f,h,s,M){e(f)&&h(e(f)),a(s,""),a(M,""),console.log("Switched back to VIEW mode")}async function jo(j,f,h,s,M){console.log("Connector changed to:",e(f)),h(),await ga(),e(s).includes(e(M))||(a(M,e(s).length>0?e(s)[0]:"",!0),console.log("Resetting LLM to:",e(M)))}function Go(){var j;(j=document.getElementById("import-assistant-json"))==null||j.click()}var Ko=l(" <!>",1),zo=l('<div><button type="button" class="inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand"><svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"></path></svg> </button></div>'),qo=l('<div class="mt-3 p-3 border border-red-200 bg-red-50 rounded-md"><div class="flex"><div class="flex-shrink-0"><svg class="h-5 w-5 text-red-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path></svg></div> <div class="ml-3"><h3 class="text-sm font-medium text-red-800"> </h3> <p class="mt-1 text-sm text-red-700"> </p></div></div></div>'),Jo=l('<p class="text-center text-gray-600 py-10"> </p>'),Vo=l('<p class="text-center text-red-600 py-10"> </p>'),Ho=l('<p class="text-center text-gray-600 py-10"> </p>'),Wo=l('<input type="text" id="assistant-name" name="name" class="mt-1 block w-full px-3 py-2 border border-gray-300 bg-gray-100 rounded-md shadow-sm focus:outline-none focus:ring-brand focus:border-brand sm:text-sm"/>'),Yo=l('<input type="text" id="assistant-name" name="name" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-brand focus:border-brand sm:text-sm"/>'),Zo=(j,f,h)=>f(e(h)),Qo=l('<button type="button" class="ml-1 px-2 py-0.5 text-xs bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 rounded focus:outline-none focus:ring-2 focus:ring-brand-500"> </button>'),Xo=l('<div class="mt-2 p-3 bg-gray-50 border border-gray-200 rounded text-sm"><div class="text-xs text-gray-500 mb-1"> </div> <div class="whitespace-pre-wrap" data-testid="prompt-preview"><!></div></div>'),ei=l('<p class="mt-1 text-xs text-gray-500"> </p>'),ti=l('<p class="text-sm text-gray-500"> </p>'),ri=l('<p class="text-sm text-red-600"> </p>'),ai=l('<p class="text-sm text-gray-500"> <a href="/evaluaitor" class="text-blue-600 hover:underline" target="_blank"> </a></p>'),si=l('<span class="text-xs">ðŸŒŸ</span>'),oi=l('<p class="mt-1 text-xs text-blue-700"> </p>'),ii=l('<div class="mb-4 p-3 bg-blue-50 border border-blue-200 rounded-md"><div class="flex items-start justify-between"><div class="flex-1"><div class="flex items-center gap-2"><span class="text-sm font-semibold text-blue-900"> </span> <span class="text-sm font-medium text-blue-800"> </span> <!></div> <!></div> <a target="_blank" rel="noopener noreferrer" class="ml-2 text-sm text-blue-600 hover:text-blue-800 hover:underline whitespace-nowrap"> </a></div></div>'),ni=l('<tr><td colspan="5" class="px-3 py-4 text-sm text-gray-500 text-center"> </td></tr>'),li=l('<span class="text-xs" title="Showcase rubric">ðŸŒŸ</span>'),di=l('<span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800"> </span>'),ci=l('<span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-800"> </span>'),ui=l('<tr><td class="px-3 py-3 whitespace-nowrap text-center"><input type="radio" name="rubric-selector" class="h-4 w-4 text-brand focus:ring-brand"/></td><td class="px-3 py-3"><div class="flex items-center gap-2"><span class="text-sm font-medium text-gray-900"> </span> <!></div></td><td class="px-3 py-3"><p class="text-sm text-gray-600 line-clamp-2"> </p></td><td class="px-3 py-3 whitespace-nowrap"><!></td><td class="px-3 py-3 whitespace-nowrap text-center"><a target="_blank" rel="noopener noreferrer" class="text-sm text-blue-600 hover:text-blue-800 hover:underline"> </a></td></tr>'),vi=l('<p class="mt-2 text-xs text-red-500"> </p>'),pi=l('<div class="mb-4"><label for="rubric-search" class="sr-only"> </label> <input type="text" id="rubric-search" class="w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-brand focus:border-brand sm:text-sm"/></div> <!> <div class="border rounded-md overflow-hidden"><div class="max-h-96 overflow-y-auto"><table class="min-w-full divide-y divide-gray-200"><thead class="bg-gray-50 sticky top-0"><tr><th scope="col" class="w-12 px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"> </th><th scope="col" class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"> </th><th scope="col" class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"> </th><th scope="col" class="w-24 px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"> </th><th scope="col" class="w-20 px-3 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider"> </th></tr></thead><tbody class="bg-white divide-y divide-gray-200"><!></tbody></table></div></div> <!> <div class="mt-6 pt-4 border-t border-gray-200"><div class="block text-sm font-medium text-gray-700 mb-3"> </div> <div class="flex gap-6"><label class="flex items-center cursor-pointer"><input type="radio" class="h-4 w-4 text-brand focus:ring-brand mr-2"/> <span class="text-sm"> </span></label> <label class="flex items-center cursor-pointer"><input type="radio" class="h-4 w-4 text-brand focus:ring-brand mr-2"/> <span class="text-sm"> </span></label></div> <p class="mt-2 text-xs text-gray-500"> </p></div>',1),fi=l('<div class="mt-6 pt-6 border-t border-gray-200"><h4 class="text-lg font-medium text-gray-900 mb-4"> </h4> <!></div>'),mi=l(`<div class="mb-3"><label class="inline-flex items-center cursor-pointer"><input type="checkbox" class="sr-only peer"/> <div class="relative w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"></div> <span class="ms-3 text-sm font-medium text-gray-900 dark:text-gray-300"> </span></label></div>`),gi=l("<option> </option>"),bi=l('<div><label for="prompt-processor" class="block text-sm font-medium text-gray-700"> </label> <select id="prompt-processor" name="prompt_processor" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-brand focus:border-brand sm:text-sm"></select></div>'),_i=l("<option> </option>"),hi=l('<div><label for="connector" class="block text-sm font-medium text-gray-700"> </label> <select id="connector" name="connector" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-brand focus:border-brand sm:text-sm"></select></div>'),xi=l("<option> </option>"),yi=l("<option disabled> </option>"),wi=l("<option> </option>"),ki=l('<div class="p-3 bg-blue-50 border border-blue-200 rounded-md"><p class="text-sm text-blue-800"> </p></div>'),$i=l('<div><label for="rag-top-k" class="block text-sm font-medium text-gray-700"> </label> <input type="number" id="rag-top-k" name="RAG_Top_k" min="1" max="10" class="mt-1 block w-24 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-brand focus:border-brand sm:text-sm disabled:bg-gray-100 disabled:cursor-not-allowed"/> <p class="mt-1 text-xs text-gray-500"> </p></div>'),Ai=l('<p class="text-sm text-gray-500"> </p>'),Ei=l('<p class="text-sm text-red-600"> </p>'),Si=l('<p class="text-sm text-gray-500"> </p>'),Ci=l('<label class="flex items-center space-x-2 cursor-pointer"><input type="checkbox" class="rounded border-gray-300 text-brand shadow-sm focus:border-brand focus:ring focus:ring-offset-0 focus:ring-brand focus:ring-opacity-50"/> <span class="text-sm text-gray-700"> </span></label>'),Ni=l('<div class="mt-2 space-y-2 max-h-48 overflow-y-auto border rounded p-2" role="group" aria-labelledby="kb-group-label"><span id="kb-group-label" class="sr-only"> </span> <!></div>'),Pi=l('<div><h4 class="block text-sm font-medium text-gray-700 mb-1"> </h4> <!></div>'),Mi=l('<span class="ml-2 text-sm text-gray-500"> </span>'),Ti=l('<p class="mt-1 text-sm text-red-600"> </p>'),Ii=l('<p class="text-sm text-gray-500"> </p>'),Ri=l('<p class="text-sm text-red-600"> </p>'),Di=l('<p class="text-sm text-gray-500"> </p>'),Li=l('<label><input type="radio" name="file-selector" class="h-4 w-4 text-brand rounded focus:ring-brand"/> <span class="text-sm text-gray-700"> </span></label>'),Fi=l('<p class="mt-1 text-xs text-red-500"> </p>'),Bi=l('<div class="mt-2 space-y-2 max-h-48 overflow-y-auto border rounded p-2"></div> <!>',1),Ui=l(`<div><h4 class="block text-sm font-medium text-gray-700 mb-1"> </h4> <div class="mb-4"><label for="file-upload" class="block text-sm text-gray-700"> </label> <div class="mt-1 flex items-center"><input id="file-upload" type="file" accept=".txt,.json,.md,.pdf,.doc,.docx" class="block w-full text-sm text-gray-500
														file:mr-4 file:py-2 file:px-4
														file:rounded-md file:border-0
														file:text-sm file:font-semibold
														file:bg-gray-50 file:text-gray-700
														hover:file:bg-gray-100 disabled:cursor-not-allowed"/> <!></div> <!></div> <!></div>`),Oi=l('<div class="pt-4 border-t border-gray-200 space-y-4"><h4 class="text-md font-medium text-gray-700"> </h4> <!> <!> <!> <!></div>'),ji=l('<p class="text-sm text-red-600 mt-4 p-2 border border-red-200 bg-red-50 rounded"> </p>'),Gi=l('<p class="text-sm text-green-600 mt-4 p-2 border border-green-200 bg-green-50 rounded"> </p>'),Ki=l('<button type="button" class="py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed"> </button>'),zi=l('<form class="space-y-6" id="assistant-form-main"><div class="flex flex-col md:flex-row md:space-x-6"><div class="md:w-2/3 space-y-6"><div><label for="assistant-name" class="block text-sm font-medium text-gray-700"> <span class="text-red-600">*</span></label> <!></div> <div><label for="assistant-description" class="block text-sm font-medium text-gray-700"> </label> <div class="mt-1 flex rounded-md shadow-sm"><textarea id="assistant-description" name="description" rows="3" class="flex-1 block w-full px-3 py-2 border border-blue-300 rounded-l-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-white"></textarea> <button type="button" class="relative -ml-px inline-flex items-center space-x-2 rounded-r-md border border-gray-300 bg-gray-50 px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand disabled:opacity-50 disabled:cursor-not-allowed"><span> </span></button></div> <p class="mt-1 text-xs text-gray-500"> </p></div> <div><label for="system-prompt" class="block text-sm font-medium text-gray-700"> </label> <textarea id="system-prompt" name="system_prompt" rows="4" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-brand focus:border-brand sm:text-sm"></textarea></div> <div><label for="prompt-template" class="block text-sm font-medium text-gray-700"> </label> <div class="mt-1 mb-2"><span class="text-xs text-gray-600 dark:text-gray-400"> </span> <!></div> <textarea id="prompt_template" rows="6" class="mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white"></textarea> <!> <!></div> <!></div> <div class="md:w-1/3"><!> <fieldset class="border p-4 rounded-md space-y-4 h-full"><legend class="text-lg font-medium text-brand px-1"> </legend> <!> <!> <div><label for="llm" class="block text-sm font-medium text-gray-700"> </label> <select id="llm" name="llm" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-brand focus:border-brand sm:text-sm rounded-md"><!></select></div> <div><label for="rag-processor" class="block text-sm font-medium text-gray-700"> </label> <select id="rag-processor" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-brand focus:border-brand sm:text-sm rounded-md disabled:bg-gray-100 disabled:cursor-not-allowed"></select></div> <!></fieldset></div></div> <!> <!> <div class="pt-5"><div class="flex justify-end space-x-3"><!> <button type="submit" form="assistant-form-main" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-brand hover:bg-brand-hover focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand disabled:opacity-50 disabled:cursor-not-allowed" style="background-color: #2271b3;"><!></button></div></div></form>'),qi=l('<div class="p-4 md:p-6 border rounded-md shadow-sm bg-white"><div class="mb-6 pb-4 border-b border-gray-200"><div class="flex justify-between items-center"><h2 class="text-2xl font-semibold text-brand"><!></h2> <!></div> <!></div> <!> <input type="file" id="import-assistant-json" accept=".json" style="display: none;"/></div>');function Ws(j,f){Ga(f,!0);const h=()=>da(Ma,"$assistantConfigStore",M),s=()=>da(bs,"$_",M),[M,J]=ts(),w=[],c=[],m=[],A=[];console.log("AssistantForm.svelte: Initializing script...");const z=qs();let F=Mr(f,"assistant",3,null),me=Mr(f,"startInEdit",3,!1);console.log(`[AssistantForm] Received props: assistant=${!!F()}, startInEdit=${me()}`);let le=F()?"edit":"create";console.log(`[AssistantForm] Calculated initialMode: ${le}`);let I=_(lr(le)),B=_(null),ve=_(""),Ge=_(""),be=_(""),oe=_(""),ie=_(3),Ke=_(!1),Ae=_(lr([])),it=_(lr([])),Ee=_(lr([])),Ze=_(lr([])),Te=_(""),Ce=_(""),ge=_(""),K=_(""),Ve=_(lr([])),He=_(lr([])),U=_(!1),k=_(""),N=_(!1),E=_(lr([])),S=_(""),R=_(!1),pe=_(""),X=_(!1),ke=_(""),Ne=_(!1),Se=_(lr([])),de=_(""),We=_("markdown"),re=_(!1),ce=_(""),Ie=_(!1),nt=_(""),Tt=_(""),It=_(!1),Xr=_(!1),Ot=_(!1),Wt=_(""),Nt=_(""),dr=_(null),Tr=_(lr([]));const Ea="e.g. Use the {context} to answer the question: {user_input}";function fe(u){return e(I)==="create",!0}function Be(u){if(!u)return"";let g=u;g=g.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;");for(const T of e(Tr)){const C=T.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;");g=g.replace(new RegExp(C.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"g"),`<span class="bg-blue-100 text-blue-800 font-medium px-1 rounded">${C}</span>`)}return g}Ia(()=>{var T,C;console.log("AssistantForm.svelte: $effect (assistant prop) running...");const u=((T=F())==null?void 0:T.id)!==((C=e(B))==null?void 0:C.id),g=F()===null&&e(B)!==null||F()!==null&&e(B)===null;u||g?(console.log(`[AssistantForm] Assistant change detected (ID changed: ${u}, Null status changed: ${g})`),F()?(console.log("[AssistantForm] Assistant prop received or changed:",F()),console.log("Assistant prop received or changed:",F()),a(B,{...F()},!0),console.log("Stored initial assistant data:",e(B)),a(I,"edit"),console.log(`Initial formState set to: ${e(I)}`),Ue(F()),a(Tt,""),a(Wt,"")):(console.log("No assistant prop, setting create mode."),a(I,"create"),a(B,null),e(Ot)&&ht())):F()&&(console.log("Assistant reference changed, repopulating fields (preserving description)."),Ue(F(),!0))}),ro(()=>(!e(Ot)&&!h().loading&&!h().systemCapabilities&&(console.log("AssistantForm.svelte: $effect.pre - Explicitly calling loadConfig()..."),Ma.loadConfig()),Ma.subscribe(g=>{if(!g.loading&&g.systemCapabilities&&g.configDefaults&&!e(Ot)){const T=g.systemCapabilities;console.log("Populating dropdown options from capabilities..."),a(Ae,T.prompt_processors||[],!0),a(it,Object.keys(T.connectors||{}),!0),a(Ze,T.rag_processors||[],!0),a(Ot,!0),e(I)==="create"?(console.log("Applying defaults for CREATE mode..."),ht()):(console.log("Config loaded for VIEW/EDIT mode. Repopulating fields."),Ue(e(B)))}})));function ht(){var T,C;const u=((T=Xa(Ma).configDefaults)==null?void 0:T.config)||{};a(be,u.system_prompt||"",!0),a(oe,u.prompt_template||"",!0),a(ie,parseInt(u.RAG_Top_k||"3",10)||3,!0),a(Te,u.prompt_processor||(e(Ae).length>0?e(Ae)[0]:""),!0),a(Ce,u.connector||(e(it).length>0?e(it)[0]:""),!0);let g=(C=u.rag_processor)==null?void 0:C.trim().toLowerCase();g==="no rag"&&(g="no_rag"),a(K,g||(e(Ze).length>0?e(Ze)[0]:""),!0);try{a(Tr,Array.isArray(u.rag_placeholders)?u.rag_placeholders:["{context}","{user_input}"],!0)}catch(G){console.warn("Could not load rag_placeholders from config, using defaults:",G),a(Tr,["{context}","{user_input}"],!0)}ee(),a(ge,u.llm||(e(Ee).length>0?e(Ee)[0]:""),!0),a(He,[],!0),a(S,""),console.log("Form reset to defaults for CREATE:",{selectedPromptProcessor:e(Te),selectedConnector:e(Ce),selectedLlm:e(ge),selectedRagProcessor:e(K)}),e(K)==="simple_rag"&&ga().then(te),e(K)==="single_file_rag"&&ga().then(Oe),e(K)==="rubric_rag"&&ga().then(et)}function Ue(u,g=!1){var T,C,G;if(u){if(console.log("Populating form fields from:",u),a(ve,((T=u.name)==null?void 0:T.replace(/^\d+_/,""))||"",!0),g||a(Ge,u.description||"",!0),a(be,u.system_prompt||"",!0),a(oe,u.prompt_template||"",!0),a(ie,u.RAG_Top_k??3,!0),e(Ot)){a(Te,u.prompt_processor||(e(Ae).length>0?e(Ae)[0]:""),!0),a(Ce,u.connector||(e(it).length>0?e(it)[0]:""),!0),a(K,u.rag_processor||(e(Ze).length>0?e(Ze)[0]:""),!0),ee(),a(ge,u.llm||(e(Ee).length>0?e(Ee)[0]:""),!0),a(He,((C=u.RAG_collections)==null?void 0:C.split(",").filter(Boolean))||[],!0);const se=((G=Xa(Ma).configDefaults)==null?void 0:G.config)||{};try{a(Tr,Array.isArray(se.rag_placeholders)?se.rag_placeholders:["{context}","{user_input}"],!0)}catch(L){console.warn("Could not load rag_placeholders from config in edit mode, using defaults:",L),a(Tr,["{context}","{user_input}"],!0)}if(e(K)==="simple_rag"&&!e(N)&&!e(U)&&(console.log("Populate: Triggering KB fetch"),ga().then(te)),e(K)==="rubric_rag")try{let L=u.metadata;typeof L=="string"&&(L=JSON.parse(L)),a(de,(L==null?void 0:L.rubric_id)||"",!0),a(We,(L==null?void 0:L.rubric_format)||"markdown",!0),!e(Ie)&&!e(re)&&(console.log("Populate: Triggering rubrics fetch"),ga().then(et))}catch(L){console.warn("Failed to parse rubric metadata:",L),a(de,""),a(We,"markdown")}}console.log("Form fields populated:",{name:e(ve),description:e(Ge),selectedPromptProcessor:e(Te),selectedConnector:e(Ce),selectedLlm:e(ge),selectedRagProcessor:e(K)})}}function ae(u){return u?Array.isArray(u.models)?u.models:Array.isArray(u.available_llms)?u.available_llms:typeof u.models=="object"&&u.models!==null?Object.keys(u.models):[]:[]}function ee(){const u=Xa(Ma);if(!u||!u.systemCapabilities||!u.systemCapabilities.connectors){a(Ee,[],!0);return}const g=u.systemCapabilities.connectors[e(Ce)];a(Ee,ae(g),!0)}async function te(){if(e(U)||e(N)){console.log(`Skipping KB fetch (Loading: ${e(U)}, Attempted: ${e(N)})`);return}if(e(K)!=="simple_rag"){console.log("Skipping KB fetch (RAG processor is not simple_rag)");return}console.log("Fetching knowledge bases..."),a(U,!0),a(k,"");try{const u=await Qs();u.sort((g,T)=>g.name.localeCompare(T.name)),a(Ve,u,!0)}catch(u){console.error("Error fetching knowledge bases:",u),a(k,u instanceof Error?u.message:"Failed to load knowledge bases",!0),a(Ve,[],!0)}finally{a(U,!1),a(N,!0),console.log(`KB Fetch complete (Attempted: ${e(N)}, Error: '${e(k)}', Count: ${e(Ve).length})`)}}async function et(){if(e(re)||e(Ie)){console.log(`Skipping rubrics fetch (Loading: ${e(re)}, Attempted: ${e(Ie)})`);return}if(e(K)!=="rubric_rag"){console.log("Skipping rubrics fetch (RAG processor is not rubric_rag)");return}console.log("Fetching accessible rubrics..."),a(re,!0),a(ce,"");try{const g=(await io()).rubrics||[];a(Se,g,!0),console.log(`Loaded ${g.length} accessible rubrics`)}catch(u){console.error("Error fetching accessible rubrics:",u),a(ce,u instanceof Error?u.message:"Failed to load rubrics",!0),a(Se,[],!0)}finally{a(re,!1),a(Ie,!0),console.log(`Rubrics Fetch complete (Attempted: ${e(Ie)}, Error: '${e(ce)}', Count: ${e(Se).length})`)}}async function Oe(){var u,g,T,C;if(e(R)){console.log("Skipping files fetch (already loading)");return}console.log("Fetching user files..."),a(R,!0),a(pe,"");try{const G=Rt();if(!G)throw new Error("Authentication token not found");const se=(g=(u=window.LAMB_CONFIG)==null?void 0:u.api)==null?void 0:g.lambServer;if(!se)throw new Error("LAMB server URL not configured in window.LAMB_CONFIG.api.lambServer");const ft=`${se.replace(/\/$/,"")}/creator/files/list`,tt=await fetch(ft,{headers:{Authorization:`Bearer ${G}`}});if(!tt.ok){const Fe=await tt.text();throw new Error(`API error: ${tt.status} - ${Fe||"Unknown error"}`)}const cr=await tt.json();a(E,cr,!0);const Le=((T=F())==null?void 0:T.metadata)||((C=F())==null?void 0:C.api_callback);if(Le)try{const Fe=JSON.parse(Le);Fe.file_path&&e(E).some(Qe=>Qe.path===Fe.file_path)&&a(S,Fe.file_path,!0)}catch(Fe){console.error("Error parsing metadata for file path:",Fe)}console.log(`Fetched ${e(E).length} files`)}catch(G){console.error("Error fetching user files:",G),a(pe,G instanceof Error?G.message:"Failed to load files",!0),a(E,[],!0)}finally{a(R,!1),a(Ne,!0)}}async function lt(u){var C,G;const g=u.target;if(!g||!(g instanceof HTMLInputElement)||!g.files||g.files.length===0)return;const T=g.files[0];if(T){a(X,!0),a(ke,"");try{const se=Rt();if(!se)throw new Error("Authentication token not found");const L=(G=(C=window.LAMB_CONFIG)==null?void 0:C.api)==null?void 0:G.lambServer;if(!L)throw new Error("LAMB server URL not configured");const ft=new FormData;ft.append("file",T);const cr=`${L.replace(/\/$/,"")}/creator/files/upload`,Le=await fetch(cr,{method:"POST",headers:{Authorization:`Bearer ${se}`},body:ft});if(!Le.ok){const Qe=await Le.text();throw new Error(`API error: ${Le.status} - ${Qe||"Unknown error"}`)}const Fe=await Le.json();console.log("File uploaded successfully:",Fe),await Oe(),Fe.path&&a(S,Fe.path,!0),g.value=""}catch(se){console.error("Error uploading file:",se),a(ke,se instanceof Error?se.message:"Failed to upload file",!0)}finally{a(X,!1)}}}function Rt(){if(typeof localStorage<"u"){const u=localStorage.getItem("userToken");if(u)return console.debug("Auth token found in localStorage"),u}return console.debug("Token not found in localStorage, checking cookie"),document.cookie.replace(/(?:(?:^|.*;\\s*)token\\s*=\\s*([^;]*).*$)|^.*$/,"$1")}async function Yt(){var T,C;if(!e(ve).trim()){alert(s()("assistants.form.description.nameRequired",{default:"Please provide an assistant name first"}));return}const u=Rt();if(console.debug("Auth token found:",u?"Yes (length: "+u.length+")":"No"),!u){console.error("Authentication token not found"),alert(s()("assistants.form.description.authError",{default:"Authentication error. Please try logging in again."}));return}a(Xr,!0);let g="";try{const G=(C=(T=window.LAMB_CONFIG)==null?void 0:T.api)==null?void 0:C.lambServer;if(!G)throw new Error("LAMB server URL not configured in window.LAMB_CONFIG.api.lambServer");const se=new AbortController,L=setTimeout(()=>se.abort(),15e3),tt=`${G.replace(/\/$/,"")}/creator/assistant/generate_assistant_description`;console.debug("Calling generate_assistant_description at URL:",tt);const cr={name:e(ve),instructions:e(be)||"",prompt_template:e(oe)||"",connector:e(Ce)||"",llm:e(ge)||"",rag_processor:e(K)||""},Le=await fetch(tt,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${u}`},body:JSON.stringify(cr),signal:se.signal});if(clearTimeout(L),!Le.ok){const Qe=await Le.text();throw console.error("API error response:",Qe),Le.status===403||Le.status===401?new Error(`Authentication error (${Le.status}): Please try logging in again.`):new Error(`API error: ${Le.status} - ${Qe||"Unknown error"}`)}const Fe=await Le.json();if(Fe.description){let Qe=Fe.description.trim().replace(/^["']|["']$/g,"");Qe.length>500&&(Qe=Qe.substring(0,497)+"..."),a(Ge,Qe,!0),console.log("Description generated successfully")}else throw new Error(Fe.error||"Failed to generate description")}catch(G){console.error("Error generating description:",G),G instanceof Error&&G.name==="AbortError"?g=s()("assistants.form.description.timeout",{default:"Request timed out. Please try again."}):g=G instanceof Error?G.message:s()("assistants.form.description.error",{default:"Failed to generate description"}),alert(g)}finally{a(Xr,!1)}}const xt=jr(()=>e(K)&&e(K)!=="no_rag"),je=jr(()=>e(K)==="simple_rag"),Pe=jr(()=>e(K)==="single_file_rag"),vt=jr(()=>e(K)==="rubric_rag"),yt=jr(()=>()=>{if(!e(nt).trim())return e(Se);const u=e(nt).toLowerCase();return e(Se).filter(g=>g.title.toLowerCase().includes(u)||g.description&&g.description.toLowerCase().includes(u))});Ia(()=>{console.log(`Effect: RAG processor changed to ${e(K)}`),e(K)==="simple_rag"&&e(Ot)?(console.log(`Effect: Checking KB fetch need (Attempted: ${e(N)})`),!e(N)&&!e(U)?(console.log("Effect: Conditions met (simple_rag, not attempted), calling fetchKnowledgeBases()"),te()):console.log("Effect: Skipping KB fetch (already attempted or loading).")):e(K)==="single_file_rag"&&e(Ot)?!e(Ne)&&!e(R)?(console.log("Effect: Conditions met (single_file_rag, not attempted), calling fetchUserFiles()"),Oe()):console.log("Effect: Skipping files fetch (already attempted or loading)."):e(K)==="rubric_rag"&&e(Ot)?!e(Ie)&&!e(re)?(console.log("Effect: Conditions met (rubric_rag, not attempted), calling fetchRubricsList()"),ga().then(et)):console.log("Effect: Skipping rubrics fetch (already attempted or loading)."):((e(Ve).length>0||e(He).length>0||e(k)||e(N))&&(console.log("Effect: Clearing KB state and fetch attempt flag"),a(Ve,[],!0),a(He,[],!0),a(k,""),a(N,!1)),e(K)!=="single_file_rag"&&(e(S)||e(E).length>0)&&a(S,""),e(K)!=="rubric_rag"&&(e(de)||e(Se).length>0)&&(a(de,""),a(We,"markdown")))});async function wt(u){var C,G,se;if(u.preventDefault(),a(Tt,""),a(Wt,""),a(It,!0),!((C=e(ve))!=null&&C.trim())){a(Tt,"Assistant Name is required."),a(It,!1);return}if(e(K)==="rubric_rag"&&!e(de)){a(Tt,"Please select a rubric when using Rubric RAG."),a(It,!1);return}if(e(I)==="create"&&!e(Ke)){const L=((G=Xa(Ma).configDefaults)==null?void 0:G.config)||{};a(Te,L.prompt_processor||(e(Ae).length>0?e(Ae)[0]:""),!0),a(Ce,L.connector||(e(it).length>0?e(it)[0]:""),!0),await ga(),ee(),e(Ee).includes(e(ge))||a(ge,L.llm||(e(Ee).length>0?e(Ee)[0]:""),!0)}const g={prompt_processor:e(Te),connector:e(Ce),llm:e(ge),rag_processor:e(K),file_path:e(K)==="single_file_rag"?e(S):""};e(K)==="rubric_rag"&&(g.rubric_id=e(de),g.rubric_format=e(We));const T={name:e(ve).trim(),description:e(Ge),system_prompt:e(be),prompt_template:e(oe),RAG_Top_k:Number(e(ie))||3,RAG_collections:e(K)==="simple_rag"?e(He).join(","):"",metadata:JSON.stringify(g),pre_retrieval_endpoint:"",post_retrieval_endpoint:"",RAG_endpoint:""};try{let L;if(e(I)==="edit"&&((se=e(B))!=null&&se.id)){console.log("Submitting UPDATE for assistant:",e(B).id,T);const ft=await fo(e(B).id.toString(),T);a(Wt,"Assistant updated successfully!"),a(B,{...e(B),...T},!0),Ue(e(B)),z("formSuccess",{assistantId:e(B).id})}else if(e(I)==="create"){const ft=await Xs(T);if(!(ft!=null&&ft.assistant_id))throw new Error("Create assistant response did not include an assistant_id.");a(Wt,"Assistant created successfully!"),z("formSuccess",{assistantId:ft.assistant_id})}else throw new Error("Invalid form state for submission.")}catch(L){console.error(`Error ${e(I)==="edit"?"updating":"creating"} assistant:`,L),a(Tt,L instanceof Error?L.message:`Failed to ${e(I)==="edit"?"update":"create"} assistant`,!0),a(Wt,"")}finally{a(It,!1)}}function Zt(u){const g=u.target,T=g.files;a(Nt,"");let C=["Starting validation..."];if(T&&T.length>0){const G=T[0];if(console.log("Selected file:",G.name,G.type,G.size),G.type!=="application/json"&&!G.name.toLowerCase().endsWith(".json")){a(Nt,s()("assistants.form.import.invalidFile",{default:"Invalid file type. Please select a .json file."}),!0),console.error(e(Nt)),g.value="";return}const se=new FileReader;se.onload=async L=>{var tt,cr,Le,Fe,Qe,Gr,Kr,ca;const ft=(tt=L.target)==null?void 0:tt.result;if(typeof ft=="string"){console.log("--- Imported Assistant JSON Content ---"),console.log("-------------------------------------");let ue;try{ue=JSON.parse(ft),C.push("âœ… JSON parsed successfully.")}catch(Lt){C.push(`âŒ Invalid JSON format: ${Lt instanceof Error?Lt.message:"Unknown JSON error"}`),ue=null}let Q=null;if(ue&&typeof ue=="object"){const sr=Xa(Ma).systemCapabilities;if(!sr)C.push("âš ï¸ System capabilities not loaded. Skipping detailed validation.");else{C.push("â„¹ï¸ System capabilities loaded. Performing detailed checks...");const kr=["name","system_prompt","metadata"];for(const mt of kr)mt in ue||C.push(`âŒ Missing required field: ${mt}`);const zt=ue.metadata||ue.api_callback;if(zt&&typeof zt=="string")try{if(Q=JSON.parse(zt),C.push("âœ… Parsed metadata successfully."),Q.prompt_processor&&!((cr=sr.prompt_processors)!=null&&cr.includes(Q.prompt_processor))&&C.push(`âš ï¸ Invalid prompt_processor: ${Q.prompt_processor}. Available: ${(Le=sr.prompt_processors)==null?void 0:Le.join(", ")}`),Q.connector&&!((Fe=sr.connectors)!=null&&Fe[Q.connector]))C.push(`âš ï¸ Invalid connector: ${Q.connector}. Available: ${Object.keys(sr.connectors||{}).join(", ")}`);else if(Q.connector&&Q.llm){const mt=(Qe=sr.connectors)==null?void 0:Qe[Q.connector];if(mt){const Qt=ae(mt);Qt.includes(Q.llm)||C.push(`âš ï¸ Invalid llm for connector ${Q.connector}: ${Q.llm}. Available: ${Qt.join(", ")}`)}else C.push(`âš ï¸ Could not retrieve capabilities for connector ${Q.connector}.`)}Q.rag_processor&&!((Gr=sr.rag_processors)!=null&&Gr.includes(Q.rag_processor))&&C.push(`âš ï¸ Invalid rag_processor: ${Q.rag_processor}. Available: ${(Kr=sr.rag_processors)==null?void 0:Kr.join(", ")}`),Q.rag_processor==="single_file_rag"&&!Q.file_path&&C.push("âŒ Missing file_path in metadata for single_file_rag processor.")}catch(mt){C.push(`âŒ Error parsing metadata JSON: ${mt instanceof Error?mt.message:"Unknown error"}`)}else C.push("âŒ metadata field is missing or not a string.");(Q==null?void 0:Q.rag_processor)==="simple_rag"&&((ue.RAG_Top_k===void 0||typeof ue.RAG_Top_k!="number")&&C.push(`âš ï¸ RAG_Top_k is missing or not a number (Required for simple_rag). Found: ${typeof ue.RAG_Top_k}`),(ue.RAG_collections===void 0||typeof ue.RAG_collections!="string")&&C.push(`âš ï¸ RAG_collections is missing or not a string (Required for simple_rag). Found: ${typeof ue.RAG_collections}`))}}else ue!==null&&C.push("âŒ Imported data is not a valid JSON object.");if(console.log("--- Assistant Import Validation Results ---"),C.forEach(Lt=>console.log(Lt)),console.log("-------------------------------------------"),!C.some(Lt=>Lt.startsWith("âŒ"))&&ue&&Q)try{C.push("â„¹ï¸ Populating form fields..."),a(ve,ue.name||"",!0),a(Ge,ue.description||"",!0),a(be,ue.system_prompt||"",!0),a(oe,ue.prompt_template||"",!0),a(ie,ue.RAG_Top_k??3,!0),a(Te,Q.prompt_processor||(e(Ae).length>0?e(Ae)[0]:""),!0),a(Ce,Q.connector||(e(it).length>0?e(it)[0]:""),!0),a(K,Q.rag_processor||(e(Ze).length>0?e(Ze)[0]:""),!0),ee(),await ga(),e(Ee).includes(Q.llm)?a(ge,Q.llm,!0):(a(ge,e(Ee).length>0?e(Ee)[0]:"",!0),C.push(`âš ï¸ Imported LLM '${Q.llm}' not available for connector '${e(Ce)}'. Defaulting to '${e(ge)}'.`)),e(K)==="simple_rag"?(a(He,((ca=ue.RAG_collections)==null?void 0:ca.split(",").filter(Boolean))||[],!0),a(S,""),e(N)||te()):e(K)==="single_file_rag"?(a(S,Q.file_path||"",!0),a(He,[],!0),e(Ne)||Oe()):(a(He,[],!0),a(S,"")),C.push("âœ… Form fields populated successfully."),a(Nt,""),a(Wt,s()("assistants.form.import.success",{default:"Assistant data imported successfully! Please review and save."}),!0),setTimeout(()=>{a(Wt,"")},5e3)}catch(Lt){C.push(`âŒ Error populating form: ${Lt instanceof Error?Lt.message:"Unknown population error"}`),a(Nt,s()("assistants.form.import.populationError",{default:"Error populating form from imported data. Check console."}),!0)}else a(Nt,s()("assistants.form.import.validationFailed",{default:"Import validation failed. Form not populated. Check console for details."}),!0)}else console.error("Failed to read file content as string."),a(Nt,s()("assistants.form.import.readError",{default:"Could not read file content."}),!0),C.push(`âŒ ${e(Nt)}`)},se.onerror=L=>{console.error("Error reading file:",L),a(Nt,s()("assistants.form.import.fileReadError",{default:"Error reading the selected file."}),!0),C.push(`âŒ ${e(Nt)}`)},se.readAsText(G)}g.value=""}function pt(u){if(e(dr)){const g=e(dr).selectionStart,T=e(dr).selectionEnd,C=e(oe);a(oe,C.substring(0,g)+u+C.substring(T)),e(dr).focus(),ga().then(()=>{e(dr)&&(e(dr).selectionStart=e(dr).selectionEnd=g+u.length)})}}var wr=qi(),b=r(wr),p=r(b),x=r(p),D=r(x);{var O=u=>{var g=la();d(T=>i(g,T),[()=>s()("assistants.form.titleCreate",{default:"Create New Assistant"})]),n(u,g)},V=u=>{var g=Ko(),T=q(g),C=o(T);{var G=se=>{var L=la();d(()=>i(L,`(ID: ${e(B).id??""})`)),n(se,L)};v(C,se=>{var L;(L=e(B))!=null&&L.id&&se(G)})}d(se=>i(T,`${se??""} `),[()=>s()("assistants.form.titleViewEdit",{default:"Assistant Details"})]),n(u,g)};v(D,u=>{e(I)==="create"?u(O):u(V,!1)})}t(x);var _e=o(x,2);{var dt=u=>{var g=zo(),T=r(g);T.__click=[Go];var C=o(r(T));t(T),t(g),d(G=>i(C,` ${G??""}`),[()=>s()("assistants.form.import.button",{default:"Import from JSON"})]),n(u,g)};v(_e,u=>{e(I)==="create"&&u(dt)})}t(p);var jt=o(p,2);{var Kt=u=>{var g=qo(),T=r(g),C=o(r(T),2),G=r(C),se=r(G,!0);t(G);var L=o(G,2),ft=r(L,!0);t(L),t(C),t(T),t(g),d(tt=>{i(se,tt),i(ft,e(Nt))},[()=>s()("assistants.form.import.error",{default:"Import Error"})]),n(u,g)};v(jt,u=>{e(Nt)&&u(Kt)})}t(b);var kt=o(b,2);{var Dt=u=>{var g=Jo(),T=r(g,!0);t(g),d(C=>i(T,C),[()=>s()("assistants.loadingConfig",{default:"Loading configuration..."})]),n(u,g)},Y=u=>{var g=we(),T=q(g);{var C=se=>{var L=Vo(),ft=r(L);t(L),d(tt=>i(ft,`${tt??""} ${h().error??""}`),[()=>s()("assistants.errorConfig",{default:"Error loading configuration:"})]),n(se,L)},G=se=>{var L=we(),ft=q(L);{var tt=Le=>{var Fe=Ho(),Qe=r(Fe,!0);t(Fe),d(Gr=>i(Qe,Gr),[()=>s()("assistants.initializingForm",{default:"Initializing form..."})]),n(Le,Fe)},cr=Le=>{var Fe=zi(),Qe=r(Fe),Gr=r(Qe),Kr=r(Gr),ca=r(Kr),ue=r(ca);ja(),t(ca);var Q=o(ca,2);{var Ir=y=>{var $=Wo();Pr($),$.disabled=!0,d(P=>Ct($,"placeholder",P),[()=>s()("assistants.form.name.placeholder")]),na($,()=>e(ve),P=>a(ve,P)),n(y,$)},Lt=y=>{var $=Yo();Pr($),$.disabled=!1,d(P=>Ct($,"placeholder",P),[()=>s()("assistants.form.name.placeholder")]),na($,()=>e(ve),P=>a(ve,P)),n(y,$)};v(Q,y=>{e(I)==="edit"?y(Ir):y(Lt,!1)})}t(Kr);var sr=o(Kr,2),kr=r(sr),zt=r(kr,!0);t(kr);var mt=o(kr,2),Qt=r(mt);js(Qt),Qt.disabled=!1;var Xt=o(Qt,2);Xt.__click=Yt;var Rr=r(Xt),Dr=r(Rr,!0);t(Rr),t(Xt),t(mt);var ua=o(mt,2),va=r(ua,!0);t(ua),t(sr);var $r=o(sr,2),zr=r($r),ea=r(zr,!0);t(zr);var qr=o(zr,2);js(qr),qr.disabled=!1,t($r);var ta=o($r,2),ur=r(ta),vr=r(ur,!0);t(ur);var Lr=o(ur,2),or=r(Lr),ra=r(or);t(or);var Fr=o(or,2);ar(Fr,17,()=>e(Tr),Qr,(y,$)=>{var P=Qo();P.__click=[Zo,pt,$];var Z=r(P,!0);t(P),d(()=>i(Z,e($))),n(y,P)}),t(Lr);var Jr=o(Lr,2);js(Jr),Ct(Jr,"placeholder",Ea),Zs(Jr,y=>a(dr,y),()=>e(dr));var Sa=o(Jr,2);{var rs=y=>{var $=Xo(),P=r($),Z=r(P,!0);t(P);var ne=o(P,2),W=r(ne);Ba(W,()=>Be(e(oe))),t(ne),t($),d(he=>i(Z,he),[()=>s()("preview")||"Preview with highlighted placeholders:"]),n(y,$)};v(Sa,y=>{e(oe)&&y(rs)})}var pr=o(Sa,2);{var pa=y=>{var $=ei(),P=r($,!0);t($),d(Z=>i(P,Z),[()=>s()("assistants.form.promptTemplate.help",{default:"This processor requires a valid prompt template."})]),n(y,$)};v(pr,y=>{e(Te)==="template_validator_processor"&&y(pa)})}t(ta);var ba=o(ta,2);{var Ra=y=>{var $=fi(),P=r($),Z=r(P,!0);t(P);var ne=o(P,2);{var W=xe=>{var rt=ti(),Pt=r(rt,!0);t(rt),d(Ft=>i(Pt,Ft),[()=>s()("assistants.form.rubric.loading",{default:"Loading rubrics..."})]),n(xe,rt)},he=xe=>{var rt=we(),Pt=q(rt);{var Ft=ye=>{var Me=ri(),Ye=r(Me);t(Me),d(at=>i(Ye,`${at??""} ${e(ce)??""}`),[()=>s()("assistants.form.rubric.error",{default:"Error loading rubrics:"})]),n(ye,Me)},Gt=ye=>{var Me=we(),Ye=q(Me);{var at=ut=>{var $t=ai(),Re=r($t),Je=o(Re),tr=r(Je);t(Je),t($t),d((Jt,mr)=>{i(Re,`${Jt??""} `),i(tr,`${mr??""} â†’`)},[()=>s()("assistants.form.rubric.noneFound",{default:"No rubrics available."}),()=>s()("assistants.form.rubric.createLink",{default:"Create a rubric"})]),n(ut,$t)},qe=ut=>{var $t=pi(),Re=q($t),Je=r(Re),tr=r(Je,!0);t(Je);var Jt=o(Je,2);Pr(Jt),t(Re);var mr=o(Re,2);{var rr=_t=>{const Mt=jr(()=>e(Se).find(Yr=>Yr.rubric_id===e(de)));var sa=we(),oa=q(sa);{var yr=Yr=>{var ya=ii(),wa=r(ya),Na=r(wa),ka=r(Na),Pa=r(ka),us=r(Pa,!0);t(Pa);var vs=o(Pa,2),Rs=r(vs,!0);t(vs);var Ds=o(vs,2);{var ps=ia=>{var $a=si();n(ia,$a)};v(Ds,ia=>{e(Mt).is_showcase&&ia(ps)})}t(ka);var $s=o(ka,2);{var Ls=ia=>{var $a=oi(),As=r($a,!0);t($a),d(()=>i(As,e(Mt).description)),n(ia,$a)};v($s,ia=>{e(Mt).description&&ia(Ls)})}t(Na);var Fa=o(Na,2),Fs=r(Fa);t(Fa),t(wa),t(ya),d((ia,$a)=>{i(us,ia),i(Rs,e(Mt).title),Ct(Fa,"href",`/evaluaitor/${e(Mt).rubric_id??""}`),i(Fs,`${$a??""} â†’`)},[()=>s()("assistants.form.rubric.selected",{default:"Selected:"}),()=>s()("assistants.form.rubric.view",{default:"View"})]),n(Yr,ya)};v(oa,Yr=>{e(Mt)&&Yr(yr)})}n(_t,sa)};v(mr,_t=>{e(de)&&_t(rr)})}var Bt=o(mr,2),Er=r(Bt),st=r(Er),De=r(st),$e=r(De),Xe=r($e),Ut=r(Xe,!0);t(Xe);var ir=o(Xe),Vt=r(ir,!0);t(ir);var St=o(ir),Sr=r(St,!0);t(St);var gr=o(St),ot=r(gr,!0);t(gr);var bt=o(gr),At=r(bt,!0);t(bt),t($e),t(De);var nr=o(De),br=r(nr);{var _a=_t=>{var Mt=ni(),sa=r(Mt),oa=r(sa,!0);t(sa),t(Mt),d(yr=>i(oa,yr),[()=>s()("assistants.form.rubric.noMatches",{default:"No rubrics match your search."})]),n(_t,Mt)},_r=_t=>{var Mt=we(),sa=q(Mt);ar(sa,17,()=>e(yt)(),oa=>oa.rubric_id,(oa,yr)=>{var Yr=ui(),ya=r(Yr),wa=r(ya);Pr(wa);var Na;t(ya);var ka=o(ya),Pa=r(ka),us=r(Pa),vs=r(us,!0);t(us);var Rs=o(us,2);{var Ds=Cr=>{var Aa=li();n(Cr,Aa)};v(Rs,Cr=>{e(yr).is_showcase&&Cr(Ds)})}t(Pa),t(ka);var ps=o(ka),$s=r(ps),Ls=r($s,!0);t($s),t(ps);var Fa=o(ps),Fs=r(Fa);{var ia=Cr=>{var Aa=di(),Us=r(Aa,!0);t(Aa),d(Os=>i(Us,Os),[()=>s()("assistants.form.rubric.mine",{default:"Mine"})]),n(Cr,Aa)},$a=Cr=>{var Aa=ci(),Us=r(Aa,!0);t(Aa),d(Os=>i(Us,Os),[()=>s()("assistants.form.rubric.public",{default:"Public"})]),n(Cr,Aa)};v(Fs,Cr=>{e(yr).is_mine?Cr(ia):Cr($a,!1)})}t(Fa);var As=o(Fa),Bs=r(As),eo=r(Bs);t(Bs),t(As),t(Yr),d(Cr=>{Ht(Yr,1,`hover:bg-gray-50 ${e(de)===e(yr).rubric_id?"bg-blue-50":""}`),Na!==(Na=e(yr).rubric_id)&&(wa.value=(wa.__value=e(yr).rubric_id)??""),i(vs,e(yr).title),i(Ls,e(yr).description||""),Ct(Bs,"href",`/evaluaitor/${e(yr).rubric_id??""}`),i(eo,`${Cr??""} â†’`)},[()=>s()("assistants.form.rubric.view",{default:"View"})]),fs(w,[],wa,()=>(e(yr).rubric_id,e(de)),Cr=>a(de,Cr)),n(oa,Yr)}),n(_t,Mt)};v(br,_t=>{e(yt)().length===0?_t(_a):_t(_r,!1)})}t(nr),t(st),t(Er),t(Bt);var Et=o(Bt,2);{var hr=_t=>{var Mt=vi(),sa=r(Mt,!0);t(Mt),d(oa=>i(sa,oa),[()=>s()("assistants.form.rubric.required",{default:"Please select a rubric"})]),n(_t,Mt)};v(Et,_t=>{e(de)||_t(hr)})}var xr=o(Et,2),ma=r(xr),Wa=r(ma,!0);t(ma);var Hr=o(ma,2),Wr=r(Hr),ha=r(Wr);Pr(ha),ha.value=ha.__value="markdown";var Ya=o(ha,2),Is=r(Ya,!0);t(Ya),t(Wr);var xa=o(Wr,2),Or=r(xa);Pr(Or),Or.value=Or.__value="json";var Za=o(Or,2),Qa=r(Za,!0);t(Za),t(xa),t(Hr);var ds=o(Hr,2),cs=r(ds,!0);t(ds),t(xr),d((_t,Mt,sa,oa,yr,Yr,ya,wa,Na,ka,Pa)=>{i(tr,_t),Ct(Jt,"placeholder",Mt),i(Ut,sa),i(Vt,oa),i(Sr,yr),i(ot,Yr),i(At,ya),i(Wa,wa),i(Is,Na),i(Qa,ka),i(cs,Pa)},[()=>s()("assistants.form.rubric.search.label",{default:"Search rubrics"}),()=>s()("assistants.form.rubric.search.placeholder",{default:"Search rubrics by title or description..."}),()=>s()("assistants.form.rubric.table.select",{default:"Select"}),()=>s()("assistants.form.rubric.table.title",{default:"Title"}),()=>s()("assistants.form.rubric.table.description",{default:"Description"}),()=>s()("assistants.form.rubric.table.type",{default:"Type"}),()=>s()("assistants.form.rubric.table.actions",{default:"Actions"}),()=>s()("assistants.form.rubric.format.label",{default:"Rubric Format for LLM"}),()=>s()("assistants.form.rubric.format.markdown",{default:"Markdown (table format)"}),()=>s()("assistants.form.rubric.format.json",{default:"JSON (structured data)"}),()=>s()("assistants.form.rubric.format.help",{default:"Choose the format that works best with your selected LLM. You can test both to see which produces better results."})]),na(Jt,()=>e(nt),_t=>a(nt,_t)),fs(c,[],ha,()=>e(We),_t=>a(We,_t)),fs(c,[],Or,()=>e(We),_t=>a(We,_t)),n(ut,$t)};v(Ye,ut=>{e(Se).length===0?ut(at):ut(qe,!1)},!0)}n(ye,Me)};v(Pt,ye=>{e(ce)?ye(Ft):ye(Gt,!1)},!0)}n(xe,rt)};v(ne,xe=>{e(re)?xe(W):xe(he,!1)})}t($),d(xe=>i(Z,xe),[()=>s()("assistants.form.rubric.label",{default:"Select Rubric"})]),n(y,$)};v(ba,y=>{e(vt)&&y(Ra)})}t(Gr);var aa=o(Gr,2),Br=r(aa);{var Ur=y=>{var $=mi(),P=r($),Z=r(P);Pr(Z);var ne=o(Z,4),W=r(ne,!0);t(ne),t(P),t($),d(he=>i(W,he),[()=>s()("assistants.form.advancedMode")||"Advanced Mode"]),oo(Z,()=>e(Ke),he=>a(Ke,he)),n(y,$)};v(Br,y=>{e(I)==="create"&&y(Ur)})}var Ar=o(Br,2),Vr=r(Ar),Da=r(Vr,!0);t(Vr);var qa=o(Vr,2);{var Ja=y=>{var $=bi(),P=r($),Z=r(P,!0);t(P);var ne=o(P,2);ne.disabled=!1,ar(ne,21,()=>e(Ae),Qr,(W,he)=>{var xe=gi(),rt=r(xe,!0);t(xe);var Pt={};d(()=>{i(rt,e(he)),Pt!==(Pt=e(he))&&(xe.value=(xe.__value=e(he))??"")}),n(W,xe)}),t(ne),t($),d(W=>i(Z,W),[()=>s()("assistants.form.promptProcessor.label",{default:"Prompt Processor"})]),Ss(ne,()=>e(Te),W=>a(Te,W)),n(y,$)};v(qa,y=>{(e(Ke)||e(I)==="edit")&&y(Ja)})}var _s=o(qa,2);{var as=y=>{var $=hi(),P=r($),Z=r(P,!0);t(P);var ne=o(P,2);ne.__change=[jo,Ce,ee,Ee,ge],ne.disabled=!1,ar(ne,21,()=>e(it),Qr,(W,he)=>{var xe=_i(),rt=r(xe,!0);t(xe);var Pt={};d(()=>{i(rt,e(he)),Pt!==(Pt=e(he))&&(xe.value=(xe.__value=e(he))??"")}),n(W,xe)}),t(ne),t($),d(W=>i(Z,W),[()=>s()("assistants.form.connector.label",{default:"Connector"})]),Ss(ne,()=>e(Ce),W=>a(Ce,W)),n(y,$)};v(_s,y=>{(e(Ke)||e(I)==="edit")&&y(as)})}var La=o(_s,2),ss=r(La),hs=r(ss,!0);t(ss);var Va=o(ss,2),os=r(Va);{var is=y=>{var $=we(),P=q($);ar(P,17,()=>e(Ee),Qr,(Z,ne)=>{var W=xi(),he=r(W,!0);t(W);var xe={};d(()=>{i(he,e(ne)),xe!==(xe=e(ne))&&(W.value=(W.__value=e(ne))??"")}),n(Z,W)}),n(y,$)},Ns=y=>{var $=yi(),P=r($,!0);t($),$.value=$.__value="",d(Z=>i(P,Z),[()=>s()("assistants.form.llm.noneAvailable",{default:"No models available for selected connector"})]),n(y,$)};v(os,y=>{e(Ee).length>0?y(is):y(Ns,!1)})}t(Va),t(La);var Ha=o(La,2),ns=r(Ha),ls=r(ns,!0);t(ns);var Ca=o(ns,2);ar(Ca,21,()=>e(Ze),Qr,(y,$)=>{var P=wi(),Z=r(P,!0);t(P);var ne={};d(W=>{i(Z,W),ne!==(ne=e($))&&(P.value=(P.__value=e($))??"")},[()=>e($).replace(/_/g," ").replace(/\b\w/g,W=>W.toUpperCase())]),n(y,P)}),t(Ca),t(Ha);var Ps=o(Ha,2);{var xs=y=>{var $=Oi(),P=r($),Z=r(P,!0);t(P);var ne=o(P,2);{var W=ye=>{var Me=ki(),Ye=r(Me),at=r(Ye);t(Ye),t(Me),d(qe=>i(at,`ðŸ“‹ ${qe??""}`),[()=>s()("assistants.form.rubric.configLocation",{default:"See rubric options below the Prompt Template section"})]),n(ye,Me)};v(ne,ye=>{e(K)==="rubric_rag"&&ye(W)})}var he=o(ne,2);{var xe=ye=>{var Me=$i(),Ye=r(Me),at=r(Ye,!0);t(Ye);var qe=o(Ye,2);Pr(qe),qe.disabled=!1;var ut=o(qe,2),$t=r(ut,!0);t(ut),t(Me),d((Re,Je)=>{i(at,Re),i($t,Je)},[()=>s()("assistants.form.ragTopK.label",{default:"RAG Top K"}),()=>s()("assistants.form.ragTopK.help",{default:"Number of relevant documents to retrieve (1-10)."})]),na(qe,()=>e(ie),Re=>a(ie,Re)),n(ye,Me)};v(he,ye=>{e(K)==="simple_rag"&&ye(xe)})}var rt=o(he,2);{var Pt=ye=>{var Me=Pi(),Ye=r(Me),at=r(Ye,!0);t(Ye);var qe=o(Ye,2);{var ut=Re=>{var Je=Ai(),tr=r(Je,!0);t(Je),d(Jt=>i(tr,Jt),[()=>s()("assistants.form.knowledgeBases.loading",{default:"Loading knowledge bases..."})]),n(Re,Je)},$t=Re=>{var Je=we(),tr=q(Je);{var Jt=rr=>{var Bt=Ei(),Er=r(Bt);t(Bt),d(st=>i(Er,`${st??""} ${e(k)??""}`),[()=>s()("assistants.form.knowledgeBases.error",{default:"Error loading knowledge bases:"})]),n(rr,Bt)},mr=rr=>{var Bt=we(),Er=q(Bt);{var st=$e=>{var Xe=Si(),Ut=r(Xe,!0);t(Xe),d(ir=>i(Ut,ir),[()=>s()("assistants.form.knowledgeBases.noneFound",{default:"No accessible knowledge bases found."})]),n($e,Xe)},De=$e=>{var Xe=Ni(),Ut=r(Xe),ir=r(Ut,!0);t(Ut);var Vt=o(Ut,2);ar(Vt,17,()=>e(Ve),St=>St.id,(St,Sr)=>{var gr=Ci(),ot=r(gr);Pr(ot),ot.disabled=!1;var bt,At=o(ot,2),nr=r(At,!0);t(At),t(gr),d(()=>{bt!==(bt=e(Sr).id)&&(ot.value=(ot.__value=e(Sr).id)??""),i(nr,e(Sr).name)}),fs(m,[],ot,()=>(e(Sr).id,e(He)),br=>a(He,br)),n(St,gr)}),t(Xe),d(St=>i(ir,St),[()=>s()("assistants.form.knowledgeBases.label",{default:"Knowledge Bases"})]),n($e,Xe)};v(Er,$e=>{e(Ve).length===0?$e(st):$e(De,!1)},!0)}n(rr,Bt)};v(tr,rr=>{e(k)?rr(Jt):rr(mr,!1)},!0)}n(Re,Je)};v(qe,Re=>{e(U)?Re(ut):Re($t,!1)})}t(Me),d(Re=>i(at,Re),[()=>s()("assistants.form.knowledgeBases.label",{default:"Knowledge Bases"})]),n(ye,Me)};v(rt,ye=>{e(je)&&ye(Pt)})}var Ft=o(rt,2);{var Gt=ye=>{var Me=Ui(),Ye=r(Me),at=r(Ye,!0);t(Ye);var qe=o(Ye,2),ut=r(qe),$t=r(ut,!0);t(ut);var Re=o(ut,2),Je=r(Re);Je.__change=lt;var tr=o(Je,2);{var Jt=De=>{var $e=Mi(),Xe=r($e,!0);t($e),d(Ut=>i(Xe,Ut),[()=>s()("assistants.form.singleFile.uploading",{default:"Uploading..."})]),n(De,$e)};v(tr,De=>{e(X)&&De(Jt)})}t(Re);var mr=o(Re,2);{var rr=De=>{var $e=Ti(),Xe=r($e,!0);t($e),d(()=>i(Xe,e(ke))),n(De,$e)};v(mr,De=>{e(ke)&&De(rr)})}t(qe);var Bt=o(qe,2);{var Er=De=>{var $e=Ii(),Xe=r($e,!0);t($e),d(Ut=>i(Xe,Ut),[()=>s()("assistants.form.singleFile.loading",{default:"Loading files..."})]),n(De,$e)},st=De=>{var $e=we(),Xe=q($e);{var Ut=Vt=>{var St=Ri(),Sr=r(St);t(St),d(gr=>i(Sr,`${gr??""} ${e(pe)??""}`),[()=>s()("assistants.form.singleFile.error",{default:"Error loading files:"})]),n(Vt,St)},ir=Vt=>{var St=we(),Sr=q(St);{var gr=bt=>{var At=Di(),nr=r(At,!0);t(At),d(br=>i(nr,br),[()=>s()("assistants.form.singleFile.noneFound",{default:"No files found. Please upload a file."})]),n(bt,At)},ot=bt=>{var At=Bi(),nr=q(At);ar(nr,21,()=>e(E),_r=>_r.path,(_r,Et)=>{var hr=Li(),xr=r(hr);Pr(xr),xr.disabled=!1;var ma,Wa=o(xr,2),Hr=r(Wa,!0);t(Wa),t(hr),d(()=>{Ht(hr,1,`flex items-center space-x-2 p-1 cursor-pointer ${e(S)===e(Et).path?"bg-blue-50":"hover:bg-gray-50"}`),ma!==(ma=e(Et).path)&&(xr.value=(xr.__value=e(Et).path)??""),i(Hr,e(Et).name)}),fs(A,[],xr,()=>(e(Et).path,e(S)),Wr=>a(S,Wr)),n(_r,hr)}),t(nr);var br=o(nr,2);{var _a=_r=>{var Et=Fi(),hr=r(Et,!0);t(Et),d(xr=>i(hr,xr),[()=>s()("assistants.form.singleFile.required",{default:"Please select a file"})]),n(_r,Et)};v(br,_r=>{!e(S)&&e(I)==="edit"&&_r(_a)})}n(bt,At)};v(Sr,bt=>{e(E).length===0?bt(gr):bt(ot,!1)},!0)}n(Vt,St)};v(Xe,Vt=>{e(pe)?Vt(Ut):Vt(ir,!1)},!0)}n(De,$e)};v(Bt,De=>{e(R)?De(Er):De(st,!1)})}t(Me),d((De,$e)=>{i(at,De),i($t,$e),Je.disabled=e(X)},[()=>s()("assistants.form.singleFile.label",{default:"Select File"}),()=>s()("assistants.form.singleFile.upload",{default:"Upload New File"})]),n(ye,Me)};v(Ft,ye=>{e(Pe)&&ye(Gt)})}t($),d(ye=>i(Z,ye),[()=>s()("assistants.form.ragOptions.title",{default:"RAG Options"})]),n(y,$)};v(Ps,y=>{e(xt)&&y(xs)})}t(Ar),t(aa),t(Qe);var ys=o(Qe,2);{var Ms=y=>{var $=ji(),P=r($);t($),d(()=>i(P,`Error: ${e(Tt)??""}`)),n(y,$)};v(ys,y=>{e(Tt)&&y(Ms)})}var ws=o(ys,2);{var Ts=y=>{var $=Gi(),P=r($,!0);t($),d(()=>i(P,e(Wt))),n(y,$)};v(ws,y=>{e(Wt)&&e(I)!=="edit"&&y(Ts)})}var ks=o(ws,2),ze=r(ks),ct=r(ze);{var er=y=>{var $=Ki();$.__click=[Oo,B,Ue,Tt,Wt];var P=r($,!0);t($),d(Z=>{$.disabled=e(It),i(P,Z)},[()=>s()("common.cancel",{default:"Cancel"})]),n(y,$)};v(ct,y=>{e(I)==="edit"&&y(er)})}var fr=o(ct,2),fa=r(fr);{var gt=y=>{var $=la();d(P=>i($,P),[()=>e(It)?s()("common.saving",{default:"Saving..."}):s()("common.save",{default:"Save"})]),n(y,$)},qt=y=>{var $=la();d(P=>i($,P),[()=>e(It)?s()("common.saving",{default:"Saving..."}):s()("common.saveChanges",{default:"Save Changes"})]),n(y,$)};v(fa,y=>{e(I)==="create"?y(gt):y(qt,!1)})}t(fr),t(ze),t(ks),t(Fe),d((y,$,P,Z,ne,W,he,xe,rt,Pt,Ft,Gt,ye)=>{i(ue,`${y??""} `),i(zt,$),Ct(Qt,"placeholder",P),Xt.disabled=e(Xr),i(Dr,Z),i(va,ne),i(ea,W),Ct(qr,"placeholder",he),i(vr,xe),i(ra,`${rt??""}:`),Jr.disabled=Pt,i(Da,Ft),i(hs,Gt),Va.disabled=e(Ee).length===0,i(ls,ye),Ca.disabled=e(I)==="edit",fr.disabled=e(It)||e(I)==="create"&&!h().systemCapabilities},[()=>s()("assistants.form.name.label"),()=>s()("assistants.form.description.label",{default:"Description"}),()=>s()("assistants.form.description.placeholder",{default:"A brief summary of the assistant"}),()=>e(Xr)?s()("assistants.form.description.generating",{default:"Generating..."}):s()("assistants.form.description.generateButton",{default:"Generate"}),()=>s()("assistants.form.description.help",{default:"Click Generate after filling in name and prompts."}),()=>s()("assistants.form.systemPrompt.label",{default:"System Prompt"}),()=>s()("assistants.form.systemPrompt.placeholder",{default:"Define the assistant's role and personality..."}),()=>s()("assistants.form.promptTemplate.label",{default:"Prompt Template"}),()=>s()("insert_placeholder")||"Insert placeholder:",()=>!fe(),()=>s()("assistants.form.configSection.title",{default:"Configuration"}),()=>s()("assistants.form.llm.label",{default:"Language Model (LLM)"}),()=>s()("assistants.form.ragProcessor.label")]),Zr("submit",Fe,wt),na(Qt,()=>e(Ge),y=>a(Ge,y)),na(qr,()=>e(be),y=>a(be,y)),na(Jr,()=>e(oe),y=>a(oe,y)),Ss(Va,()=>e(ge),y=>a(ge,y)),Ss(Ca,()=>e(K),y=>a(K,y)),n(Le,Fe)};v(ft,Le=>{e(Ot)?Le(cr,!1):Le(tt)},!0)}n(se,L)};v(T,se=>{h().error?se(C):se(G,!1)},!0)}n(u,g)};v(kt,u=>{h().loading&&!e(Ot)?u(Dt):u(Y,!1)})}var H=o(kt,2);H.__change=Zt,t(wr),n(j,wr),Ka(),J()}es(["click","change"]);var Ji=l('<span class="italic"> </span>'),Vi=l('<p class="whitespace-pre-wrap"> </p>'),Hi=l("<div><div><!></div></div>"),Wi=l('<div class="flex justify-start"><div class="max-w-xs md:max-w-md lg:max-w-lg xl:max-w-xl px-4 py-2 rounded-lg shadow bg-gray-200 text-gray-800 italic">Thinking...</div></div>'),Yi=gs('<svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>'),Zi=l('<div class="flex flex-col h-full chat-max-height border border-gray-300 rounded-md overflow-hidden shadow-sm svelte-o2sewt"><div class="p-2 border-b border-gray-200 bg-gray-50 flex items-center justify-between"><h2 class="text-lg font-semibold text-gray-700">Chat</h2> <!></div> <div class="flex-grow p-4 overflow-y-auto space-y-4 bg-white"><!> <!></div> <div class="p-3 border-t border-gray-200 bg-gray-50"><form class="flex items-center space-x-2"><input type="text" placeholder="Type your message..." class="flex-grow border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100"/> <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed"><!></button></form></div></div>');function Qi(j,f){Ga(f,!0);let h=Mr(f,"apiUrl",3,""),s=Mr(f,"userToken",3,""),M=Mr(f,"initialModel",3,null),J=Mr(f,"assistantId",3,null),w=_(lr([])),c=_(""),m=_(!1),A=_(lr([])),z=_(lr(M()??"gpt-3.5-turbo")),F=_(!1),me=_(null),le=_(!1),I=_(null);function B(U){const k=new Date().toISOString().split("T")[1].replace("Z","");console.log(`[${k}] CHAT: ${U}`)}async function ve(){if(!h()||!s()){a(me,"API URL or user token is not configured."),console.error(e(me));return}a(F,!0),a(me,null),B(`Fetching models from ${h()}/creator/models`);try{const U=await fetch(`${h()}/creator/models`,{method:"GET",headers:{Authorization:`Bearer ${s()}`}});if(!U.ok)throw new Error(`Failed to fetch models: ${U.status}`);const k=await U.json();if(k.data&&Array.isArray(k.data)){const N=k.data.map(E=>E.id).sort();if(a(A,N,!0),B(`Models loaded: ${N.join(", ")}`),N.length>0&&(!e(z)||!N.includes(e(z)))){if(M()&&N.includes(M()))a(z,M());else{const E=N.filter(S=>S.includes("gpt"));a(z,E.length>0?E[0]:N[0],!0)}B(`Selected model set to: ${e(z)}`)}}else throw new Error("Invalid model data format")}catch(U){const k=U instanceof Error?U.message:"Failed to load models";a(me,k,!0),console.error("Error fetching models:",U),a(A,["gpt-3.5-turbo","gpt-4"],!0),(!e(z)||!e(A).includes(e(z)))&&a(z,e(A)[0],!0),B(`Using fallback models due to error. Selected: ${e(z)}`)}finally{a(F,!1)}}async function Ge(){if(!e(c).trim()||e(m)||!h()||!s())return;B(`Submitting message with model: ${e(z)}`),a(m,!0),a(le,!0);const U={id:Date.now().toString(),role:"user",content:e(c)};a(w,[...e(w),U],!0);const k={model:J()?`lamb_assistant.${J()}`:e(z),messages:e(w).map(({role:S,content:R})=>({role:S,content:R})),stream:!0};B(`Using model: ${k.model}`),a(c,"");const N=(Date.now()+1).toString();a(w,[...e(w),{id:N,role:"assistant",content:""}],!0);let E="";try{if(!J())throw new Error("Assistant ID is required for chat");if(!s())throw new Error("User authentication token is required");const S=`${h()}/creator/assistant/${J()}/chat/completions`;B(`Sending request to ${S}`);const R=await fetch(S,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s()}`},body:JSON.stringify(k)});if(!R.ok){const Ne=await R.text();throw new Error(`API Error: ${R.status} - ${Ne}`)}if(!R.body)throw new Error("Response body is null");const pe=R.body.getReader(),X=new TextDecoder;let ke="";for(B("Starting stream processing");;){const{done:Ne,value:Se}=await pe.read();if(Ne){B("Stream finished.");break}ke+=X.decode(Se,{stream:!0});const de=ke.split(`
`);ke=de.pop()||"";for(const We of de){if(We.trim()===""||!We.startsWith("data: "))continue;const re=We.substring(5).trim();if(re==="[DONE]"){B("Received [DONE] signal");continue}try{const ce=JSON.parse(re);if(ce.choices&&ce.choices[0]&&ce.choices[0].delta){const Ie=ce.choices[0].delta.content;Ie&&(E+=Ie,a(w,e(w).map(nt=>nt.id===N?{...nt,content:E}:nt),!0))}else B(`Received non-delta data chunk: ${re.slice(0,100)}...`)}catch(ce){B(`Error parsing JSON line: ${We} - Error: ${ce}`)}}if(ke.startsWith("data: ")){const We=ke.substring(5).trim()}}a(w,e(w).map(Ne=>Ne.id===N?{...Ne,content:E}:Ne),!0)}catch(S){B(`Error during chat submission: ${S.message}`),console.error("Chat error:",S),a(w,e(w).map(R=>R.id===N?{...R,content:`Error: ${S.message}`}:R),!0)}finally{a(m,!1),a(le,!1),B("Chat submission finished.")}}Cs(()=>{B("ChatInterface mounted."),ve()}),Ia(()=>{e(w)&&e(I)&&Promise.resolve().then(()=>{e(I)&&(e(I).scrollTop=e(I).scrollHeight,B("Scrolled chat container to bottom."))})});var be=Zi(),oe=r(be),ie=o(r(oe),2);v(ie,U=>{}),t(oe);var Ke=o(oe,2),Ae=r(Ke);ar(Ae,17,()=>e(w),U=>U.id,(U,k)=>{var N=Hi(),E=r(N),S=r(E);{var R=X=>{var ke=Ji(),Ne=r(ke,!0);t(ke),d(()=>i(Ne,e(k).content||"Thinking...")),n(X,ke)},pe=X=>{var ke=Vi(),Ne=r(ke,!0);t(ke),d(()=>i(Ne,e(k).content)),n(X,ke)};v(S,X=>{e(k).role==="assistant"&&e(le)&&e(k).id===e(w)[e(w).length-1].id?X(R):X(pe,!1)})}t(E),t(N),d(()=>{Ht(N,1,`flex ${e(k).role==="user"?"justify-end":"justify-start"}`),Ht(E,1,`max-w-xs md:max-w-md lg:max-w-lg xl:max-w-xl px-4 py-2 rounded-lg shadow ${e(k).role==="user"?"bg-blue-500 text-white":"bg-gray-200 text-gray-800"}`)}),n(U,N)});var it=o(Ae,2);{var Ee=U=>{var k=Wi();n(U,k)};v(it,U=>{var k;e(m)&&!e(le)&&((k=e(w)[e(w).length-1])==null?void 0:k.role)==="user"&&U(Ee)})}t(Ke),Zs(Ke,U=>a(I,U),()=>e(I));var Ze=o(Ke,2),Te=r(Ze),Ce=r(Te);Pr(Ce);var ge=o(Ce,2),K=r(ge);{var Ve=U=>{var k=Yi();n(U,k)},He=U=>{var k=la("Send");n(U,k)};v(K,U=>{e(m)?U(Ve):U(He,!1)})}t(ge),t(Te),t(Ze),t(be),d(U=>{Ce.disabled=e(m),ge.disabled=U},[()=>e(m)||!e(c).trim()]),Zr("submit",Te,U=>(U.preventDefault(),Ge(),!1)),na(Ce,()=>e(c),U=>a(c,U)),n(j,be),Ka()}var Xi=l('<div class="bg-yellow-100 border border-yellow-400 text-yellow-700 px-4 py-3 rounded"><strong>Authentication Required:</strong> Please log in to access the MCP testing interface.</div>'),en=l('<div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded"><strong>Error:</strong> </div>'),tn=l('<div class="bg-blue-100 border border-blue-400 text-blue-700 px-4 py-3 rounded">Loading...</div>'),rn=l('<span class="px-2 py-1 bg-blue-100 text-blue-800 rounded text-sm"> </span>'),an=l('<div class="space-y-3"><div class="flex items-center"><span class="font-medium text-gray-700 w-24">Status:</span> <span class="px-2 py-1 bg-green-100 text-green-800 rounded-full text-sm">Connected</span></div> <div class="flex items-center"><span class="font-medium text-gray-700 w-24">Version:</span> <span class="text-gray-600"> </span></div> <div class="flex items-center"><span class="font-medium text-gray-700 w-24">Capabilities:</span> <div class="flex flex-wrap gap-2"></div></div></div>'),sn=l('<p class="text-gray-500">Loading status...</p>'),on=l('<button><div class="font-medium"> </div> <div class="text-sm text-gray-600"> </div></button>'),nn=l('<div><label class="block text-sm font-medium text-gray-700 mb-1"> </label> <input type="text" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#2271b3] focus:border-transparent"/></div>'),ln=l('<div class="mt-4"><h5 class="font-medium text-gray-700 mb-2">Result:</h5> <pre class="bg-gray-100 p-3 rounded text-sm overflow-auto"> </pre></div>'),dn=l('<div><h4 class="font-medium text-gray-700 mb-2"> </h4> <div class="space-y-3"><!> <button class="bg-[#2271b3] text-white px-4 py-2 rounded hover:bg-[#1e5a8a]">Test Prompt</button></div> <!></div>'),cn=l('<div class="p-6"><div class="grid grid-cols-1 lg:grid-cols-2 gap-6"><div><h4 class="font-medium text-gray-700 mb-3">Available Prompts</h4> <div class="space-y-2"></div></div> <!></div></div>'),un=l('<div class="p-6 text-center text-gray-500"><p>No prompts available. You need to create assistants first.</p></div>'),vn=l('<button><div class="font-medium"> </div> <div class="text-sm text-gray-600"> </div></button>'),pn=l('<div><label class="block text-sm font-medium text-gray-700 mb-1"> </label> <input type="text" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#2271b3] focus:border-transparent"/></div>'),fn=l('<div class="mt-4"><h5 class="font-medium text-gray-700 mb-2">Result:</h5> <pre class="bg-gray-100 p-3 rounded text-sm overflow-auto"> </pre></div>'),mn=l('<div><h4 class="font-medium text-gray-700 mb-2"> </h4> <div class="space-y-3"><!> <button class="bg-[#2271b3] text-white px-4 py-2 rounded hover:bg-[#1e5a8a]">Test Tool</button></div> <!></div>'),gn=l('<div class="p-6"><div class="grid grid-cols-1 lg:grid-cols-2 gap-6"><div><h4 class="font-medium text-gray-700 mb-3">Available Tools</h4> <div class="space-y-2"></div></div> <!></div></div>'),bn=l('<div class="p-6 text-center text-gray-500"><p>No tools available yet.</p></div>'),_n=l('<div class="border rounded p-3"><div class="font-medium"> </div> <div class="text-sm text-gray-600"> </div> <div class="text-xs text-gray-500 mt-1"> </div></div>'),hn=l('<div class="p-6"><h4 class="font-medium text-gray-700 mb-3">Available Resources</h4> <div class="space-y-3"></div></div>'),xn=l('<div class="p-6 text-center text-gray-500"><p>No resources available yet.</p></div>'),yn=l('<div class="p-6"><h4 class="font-medium text-gray-700 mb-3">MCP Client Setup</h4> <div class="space-y-4"><div class="bg-gray-50 p-4 rounded"><h5 class="font-medium mb-2">Server Configuration</h5> <pre class="text-sm text-gray-700"> </pre></div> <div class="text-sm text-gray-600"><p>Add this configuration to your MCP client to connect to the LAMB server.</p> <p class="mt-2"><strong>Note:</strong> Replace the API key with your actual LAMB API key.</p></div></div></div>'),wn=l('<!> <!> <div class="bg-white rounded-lg shadow-md p-6"><h3 class="text-lg font-semibold text-gray-800 mb-4">MCP Server Status</h3> <!></div> <div class="bg-white rounded-lg shadow-md"><div class="border-b border-gray-200"><nav class="-mb-px flex space-x-8 px-6"><button>Prompts</button> <button>Tools</button> <button>Resources</button> <button>Client Setup</button></nav></div> <!> <!> <!> <!></div>',1),kn=l('<div class="space-y-6"><!></div>');function $n(j,f){Ga(f,!1);const h=()=>da(Ks,"$user",s),[s,M]=ts();let J=Nr({}),w=Nr(null),c=Nr([]),m=Nr([]),A=Nr([]),z=Nr(!1),F=Nr(null),me=Nr(null),le=Nr({}),I=Nr(null),B=Nr(null),ve=Nr({}),Ge=Nr(null),be=Nr("prompts");Cs(()=>{a(J,zs()),Ke()});function oe(k){var E,S;return`${(((S=(E=e(J))==null?void 0:E.api)==null?void 0:S.lambServer)||"http://localhost:9099").replace(/\/$/,"")}/lamb/v1/mcp${k}`}function ie(){var E,S;const k=((S=(E=e(J))==null?void 0:E.api)==null?void 0:S.ltiSecret)||"pepino-secret-key",N=h().email||"test@example.com";return{Authorization:`Bearer ${k}`,"X-User-Email":N,"Content-Type":"application/json"}}async function Ke(){var k,N;a(z,!0),a(F,null);try{const E=await Ta.get(oe("/status"),{headers:ie()});a(w,E.data)}catch(E){console.error("Error loading MCP status:",E),a(F,((N=(k=E.response)==null?void 0:k.data)==null?void 0:N.detail)||E.message||"Failed to load MCP status")}finally{a(z,!1)}}async function Ae(){var k,N;a(be,"prompts"),a(z,!0),a(F,null);try{const E=await Ta.get(oe("/prompts"),{headers:ie()});a(c,E.data.prompts||[])}catch(E){console.error("Error loading MCP prompts:",E),a(F,((N=(k=E.response)==null?void 0:k.data)==null?void 0:N.detail)||E.message||"Failed to load MCP prompts")}finally{a(z,!1)}}async function it(){var k,N;a(be,"tools"),a(z,!0),a(F,null);try{const E=await Ta.get(oe("/tools"),{headers:ie()});a(m,E.data.tools||[])}catch(E){console.error("Error loading MCP tools:",E),a(F,((N=(k=E.response)==null?void 0:k.data)==null?void 0:N.detail)||E.message||"Failed to load MCP tools")}finally{a(z,!1)}}async function Ee(){var k,N;a(be,"resources"),a(z,!0),a(F,null);try{const E=await Ta.get(oe("/resources"),{headers:ie()});a(A,E.data.resources||[])}catch(E){console.error("Error loading MCP resources:",E),a(F,((N=(k=E.response)==null?void 0:k.data)==null?void 0:N.detail)||E.message||"Failed to load MCP resources")}finally{a(z,!1)}}async function Ze(){var k,N;if(e(me)){a(z,!0),a(F,null);try{const E=await Ta.post(oe("/prompts/get"),{name:e(me).name,arguments:e(le)},{headers:ie()});a(I,E.data)}catch(E){console.error("Error testing prompt:",E),a(F,((N=(k=E.response)==null?void 0:k.data)==null?void 0:N.detail)||E.message||"Failed to test prompt")}finally{a(z,!1)}}}async function Te(){var k,N;if(e(B)){a(z,!0),a(F,null);try{const E=await Ta.post(oe("/tools/call"),{name:e(B).name,arguments:e(ve)},{headers:ie()});a(Ge,E.data)}catch(E){console.error("Error testing tool:",E),a(F,((N=(k=E.response)==null?void 0:k.data)==null?void 0:N.detail)||E.message||"Failed to test tool")}finally{a(z,!1)}}}function Ce(k){a(me,k),a(le,{}),a(I,null),k.arguments&&k.arguments.forEach(N=>{Es(le,e(le)[N.name]="")})}function ge(k){a(B,k),a(ve,{}),a(Ge,null),k.inputSchema&&k.inputSchema.properties&&Object.keys(k.inputSchema.properties).forEach(N=>{Es(ve,e(ve)[N]="")})}lo();var K=kn(),Ve=r(K);{var He=k=>{var N=Xi();n(k,N)},U=k=>{var N=wn(),E=q(N);{var S=fe=>{var Be=en(),ht=o(r(Be));t(Be),d(()=>i(ht,` ${e(F)??""}`)),n(fe,Be)};v(E,fe=>{e(F)&&fe(S)})}var R=o(E,2);{var pe=fe=>{var Be=tn();n(fe,Be)};v(R,fe=>{e(z)&&fe(pe)})}var X=o(R,2),ke=o(r(X),2);{var Ne=fe=>{var Be=an(),ht=o(r(Be),2),Ue=o(r(ht),2),ae=r(Ue,!0);t(Ue),t(ht);var ee=o(ht,2),te=o(r(ee),2);ar(te,5,()=>e(w).capabilities||[],Qr,(et,Oe)=>{var lt=rn(),Rt=r(lt,!0);t(lt),d(()=>i(Rt,e(Oe))),n(et,lt)}),t(te),t(ee),t(Be),d(()=>i(ae,e(w).version||"Unknown")),n(fe,Be)},Se=fe=>{var Be=sn();n(fe,Be)};v(ke,fe=>{e(w)?fe(Ne):fe(Se,!1)})}t(X);var de=o(X,2),We=r(de),re=r(We),ce=r(re),Ie=o(ce,2),nt=o(Ie,2),Tt=o(nt,2);t(re),t(We);var It=o(We,2);{var Xr=fe=>{var Be=we(),ht=q(Be);{var Ue=ee=>{var te=cn(),et=r(te),Oe=r(et),lt=o(r(Oe),2);ar(lt,5,()=>e(c),Qr,(xt,je)=>{var Pe=on(),vt=r(Pe),yt=r(vt,!0);t(vt);var wt=o(vt,2),Zt=r(wt,!0);t(wt),t(Pe),d(()=>{var pt;Ht(Pe,1,`w-full text-left p-3 border rounded hover:bg-gray-50 ${((pt=e(me))==null?void 0:pt.name)===e(je).name?"border-[#2271b3] bg-blue-50":"border-gray-200"}`),i(yt,e(je).name),i(Zt,e(je).description)}),Zr("click",Pe,()=>Ce(e(je))),n(xt,Pe)}),t(lt),t(Oe);var Rt=o(Oe,2);{var Yt=xt=>{var je=dn(),Pe=r(je),vt=r(Pe);t(Pe);var yt=o(Pe,2),wt=r(yt);{var Zt=p=>{var x=we(),D=q(x);ar(D,1,()=>e(me).arguments,Qr,(O,V)=>{var _e=nn(),dt=r(_e),jt=r(dt);t(dt);var Kt=o(dt,2);Pr(Kt),t(_e),d(()=>{Ct(dt,"for",`prompt-arg-${e(V).name??""}`),i(jt,`${e(V).name??""} ${e(V).required?"*":""}`),Ct(Kt,"id",`prompt-arg-${e(V).name??""}`),Ct(Kt,"placeholder",e(V).description)}),na(Kt,()=>e(le)[e(V).name],kt=>Es(le,e(le)[e(V).name]=kt)),n(O,_e)}),n(p,x)};v(wt,p=>{e(me).arguments&&p(Zt)})}var pt=o(wt,2);t(yt);var wr=o(yt,2);{var b=p=>{var x=ln(),D=o(r(x),2),O=r(D,!0);t(D),t(x),d(V=>i(O,V),[()=>JSON.stringify(e(I),null,2)]),n(p,x)};v(wr,p=>{e(I)&&p(b)})}t(je),d(()=>{i(vt,`Test Prompt: ${e(me).name??""}`),pt.disabled=e(z)}),Zr("click",pt,Ze),n(xt,je)};v(Rt,xt=>{e(me)&&xt(Yt)})}t(et),t(te),n(ee,te)},ae=ee=>{var te=un();n(ee,te)};v(ht,ee=>{e(c).length>0?ee(Ue):ee(ae,!1)})}n(fe,Be)};v(It,fe=>{e(be)==="prompts"&&fe(Xr)})}var Ot=o(It,2);{var Wt=fe=>{var Be=we(),ht=q(Be);{var Ue=ee=>{var te=gn(),et=r(te),Oe=r(et),lt=o(r(Oe),2);ar(lt,5,()=>e(m),Qr,(xt,je)=>{var Pe=vn(),vt=r(Pe),yt=r(vt,!0);t(vt);var wt=o(vt,2),Zt=r(wt,!0);t(wt),t(Pe),d(()=>{var pt;Ht(Pe,1,`w-full text-left p-3 border rounded hover:bg-gray-50 ${((pt=e(B))==null?void 0:pt.name)===e(je).name?"border-[#2271b3] bg-blue-50":"border-gray-200"}`),i(yt,e(je).name),i(Zt,e(je).description)}),Zr("click",Pe,()=>ge(e(je))),n(xt,Pe)}),t(lt),t(Oe);var Rt=o(Oe,2);{var Yt=xt=>{var je=mn(),Pe=r(je),vt=r(Pe);t(Pe);var yt=o(Pe,2),wt=r(yt);{var Zt=p=>{var x=we(),D=q(x);ar(D,1,()=>Object.entries(e(B).inputSchema.properties),Qr,(O,V)=>{var _e=jr(()=>ao(e(V),2));let dt=()=>e(_e)[0],jt=()=>e(_e)[1];var Kt=pn(),kt=r(Kt),Dt=r(kt);t(kt);var Y=o(kt,2);Pr(Y),t(Kt),d(H=>{Ct(kt,"for",`tool-arg-${dt()??""}`),i(Dt,`${dt()??""} ${H??""}`),Ct(Y,"id",`tool-arg-${dt()??""}`),Ct(Y,"placeholder",jt().description||"")},[()=>{var H;return(H=e(B).inputSchema.required)!=null&&H.includes(dt())?"*":""}]),na(Y,()=>e(ve)[dt()],H=>Es(ve,e(ve)[dt()]=H)),n(O,Kt)}),n(p,x)};v(wt,p=>{var x;(x=e(B).inputSchema)!=null&&x.properties&&p(Zt)})}var pt=o(wt,2);t(yt);var wr=o(yt,2);{var b=p=>{var x=fn(),D=o(r(x),2),O=r(D,!0);t(D),t(x),d(V=>i(O,V),[()=>JSON.stringify(e(Ge),null,2)]),n(p,x)};v(wr,p=>{e(Ge)&&p(b)})}t(je),d(()=>{i(vt,`Test Tool: ${e(B).name??""}`),pt.disabled=e(z)}),Zr("click",pt,Te),n(xt,je)};v(Rt,xt=>{e(B)&&xt(Yt)})}t(et),t(te),n(ee,te)},ae=ee=>{var te=bn();n(ee,te)};v(ht,ee=>{e(m).length>0?ee(Ue):ee(ae,!1)})}n(fe,Be)};v(Ot,fe=>{e(be)==="tools"&&fe(Wt)})}var Nt=o(Ot,2);{var dr=fe=>{var Be=we(),ht=q(Be);{var Ue=ee=>{var te=hn(),et=o(r(te),2);ar(et,5,()=>e(A),Qr,(Oe,lt)=>{var Rt=_n(),Yt=r(Rt),xt=r(Yt,!0);t(Yt);var je=o(Yt,2),Pe=r(je,!0);t(je);var vt=o(je,2),yt=r(vt);t(vt),t(Rt),d(()=>{i(xt,e(lt).name),i(Pe,e(lt).description),i(yt,`URI: ${e(lt).uri??""}`)}),n(Oe,Rt)}),t(et),t(te),n(ee,te)},ae=ee=>{var te=xn();n(ee,te)};v(ht,ee=>{e(A).length>0?ee(Ue):ee(ae,!1)})}n(fe,Be)};v(Nt,fe=>{e(be)==="resources"&&fe(dr)})}var Tr=o(Nt,2);{var Ea=fe=>{var Be=yn(),ht=o(r(Be),2),Ue=r(ht),ae=o(r(Ue),2),ee=r(ae,!0);t(ae),t(Ue),ja(2),t(ht),t(Be),d(te=>i(ee,te),[()=>{var te,et;return JSON.stringify({command:"python",args:["-m","lamb.mcp_server"],env:{LAMB_SERVER_URL:((et=(te=e(J))==null?void 0:te.api)==null?void 0:et.lambServer)||"http://localhost:9099",LAMB_API_KEY:"***REDACTED***"}},null,2)}]),n(fe,Be)};v(Tr,fe=>{e(be)==="setup"&&fe(Ea)})}t(de),d(()=>{Ht(ce,1,`py-4 px-1 border-b-2 font-medium text-sm ${e(be)==="prompts"?"border-[#2271b3] text-[#2271b3]":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`),Ht(Ie,1,`py-4 px-1 border-b-2 font-medium text-sm ${e(be)==="tools"?"border-[#2271b3] text-[#2271b3]":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`),Ht(nt,1,`py-4 px-1 border-b-2 font-medium text-sm ${e(be)==="resources"?"border-[#2271b3] text-[#2271b3]":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`),Ht(Tt,1,`py-4 px-1 border-b-2 font-medium text-sm ${e(be)==="setup"?"border-[#2271b3] text-[#2271b3]":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`)}),Zr("click",ce,Ae),Zr("click",Ie,it),Zr("click",nt,Ee),Zr("click",Tt,()=>a(be,"setup")),n(k,N)};v(Ve,k=>{h().isLoggedIn?k(U,!1):k(He)})}t(K),n(j,K),Ka(),M()}var An=l('<div class="mt-4 bg-red-100 border border-red-400 text-red-700 px-4 py-2 rounded text-sm" role="alert"> </div>'),En=gs('<svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> ',1),Sn=l('<div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity z-40" aria-hidden="true"></div> <div class="fixed inset-0 z-50 flex items-center justify-center p-4"><div class="relative bg-white rounded-lg shadow-xl overflow-hidden max-w-lg w-full border border-gray-300" role="dialog" aria-modal="true" aria-labelledby="modal-title"><div class="bg-gray-50 px-4 py-3 sm:px-6 border-b border-gray-200"><h3 class="text-lg leading-6 font-medium text-gray-900" id="modal-title"> </h3></div> <div class="px-4 py-5 sm:p-6"><p class="text-sm text-gray-600 mb-4"> </p> <div><label for="new-assistant-name" class="block text-sm font-medium text-gray-700"> </label> <div class="mt-1"><input type="text" id="new-assistant-name" class="shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md disabled:bg-gray-100"/></div></div> <!></div> <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse border-t border-gray-200"><button type="button" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-brand text-base font-medium text-white hover:bg-brand-hover focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:ml-3 sm:w-auto sm:text-sm disabled:opacity-50" style="background-color: #2271b3;"><!></button> <button type="button" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm disabled:opacity-50"> </button></div></div></div>',1);function Cn(j,f){Ga(f,!0);const h=()=>da(bs,"$_",s),[s,M]=ts();let J=Mr(f,"isOpen",11,!1),w=Mr(f,"originalName",3,""),c=Mr(f,"defaultNewName",3,""),m=Mr(f,"isSubmitting",11,!1),A=Mr(f,"error",3,""),z=_(""),F=_(!1);Ia(()=>{c()&&a(z,c())});let me=()=>{};Ia(()=>(me=ms.subscribe(ie=>{a(F,!!ie)}),()=>{me()}));function le(){var ie;!e(z).trim()||m()||(ie=f.onSubmit)==null||ie.call(f,{newName:e(z).trim()})}function I(){var ie;(ie=f.onClose)==null||ie.call(f)}function B(ie){const Ke=ie.target,Ae=Ke.value.replace(/[^a-zA-Z0-9_-]/g,"");Ke.value!==Ae&&(Ke.value=Ae),a(z,Ae,!0)}function ve(ie){ie.key==="Escape"&&I(),ie.key==="Enter"&&le()}var Ge=we();Zr("keydown",Ys,ve);var be=q(Ge);{var oe=ie=>{var Ke=Sn(),Ae=q(Ke);Ae.__click=I;var it=o(Ae,2),Ee=r(it),Ze=r(Ee),Te=r(Ze),Ce=r(Te,!0);t(Te),t(Ze);var ge=o(Ze,2),K=r(ge),Ve=r(K,!0);t(K);var He=o(K,2),U=r(He),k=r(U,!0);t(U);var N=o(U,2),E=r(N);Pr(E),E.__input=B,t(N),t(He);var S=o(He,2);{var R=re=>{var ce=An(),Ie=r(ce,!0);t(ce),d(()=>i(Ie,A())),n(re,ce)};v(S,re=>{A()&&re(R)})}t(ge);var pe=o(ge,2),X=r(pe);X.__click=le;var ke=r(X);{var Ne=re=>{var ce=En(),Ie=o(q(ce),1,!0);d(nt=>i(Ie,nt),[()=>e(F)?h()("assistants.duplicateModal.submitting",{default:"Creating..."}):"Creating..."]),n(re,ce)},Se=re=>{var ce=la();d(Ie=>i(ce,Ie),[()=>e(F)?h()("assistants.duplicateModal.submitButton",{default:"Create Duplicate"}):"Create Duplicate"]),n(re,ce)};v(ke,re=>{m()?re(Ne):re(Se,!1)})}t(X);var de=o(X,2);de.__click=I;var We=r(de,!0);t(de),t(pe),t(Ee),t(it),d((re,ce,Ie,nt,Tt,It)=>{i(Ce,re),i(Ve,ce),i(k,Ie),E.disabled=m(),Ct(E,"placeholder",nt),X.disabled=Tt,de.disabled=m(),i(We,It)},[()=>e(F)?h()("assistants.duplicateModal.title",{default:"Duplicate Assistant"}):"Duplicate Assistant",()=>e(F)?h()("assistants.duplicateModal.description",{values:{name:w()},default:`Creating a copy of assistant: ${w()}`}):`Creating a copy of assistant: ${w()}`,()=>e(F)?h()("assistants.duplicateModal.newNameLabel",{default:"New Assistant Name"}):"New Assistant Name",()=>e(F)?h()("assistants.duplicateModal.newNamePlaceholder",{default:"Enter name for the copy..."}):"Enter name for the copy...",()=>m()||!e(z).trim(),()=>e(F)?h()("common.cancel",{default:"Cancel"}):"Cancel"]),na(E,()=>e(z),re=>a(z,re)),n(ie,Ke)};v(be,ie=>{J()&&ie(oe)})}n(j,Ge),Ka(),M()}es(["click","input"]);function Nn(j,f,h){console.log("[DeleteConfirmationModal] handleConfirm called"),!f()&&(console.log("[DeleteConfirmationModal] About to dispatch confirm event"),h("confirm"))}var Pn=l('<p class="text-sm text-red-600 mt-2"> </p>'),Mn=gs('<svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>'),Tn=l('<div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity z-40" aria-hidden="true"></div> <div class="fixed inset-0 z-50 flex items-center justify-center p-4"><div class="relative bg-white rounded-lg shadow-xl overflow-hidden max-w-lg w-full border border-gray-300" role="dialog" aria-modal="true" aria-labelledby="modal-title-delete"><div class="bg-red-50 px-4 py-3 sm:px-6 border-b border-red-200 flex items-center"><svg class="h-6 w-6 text-red-600 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z"></path></svg> <h3 class="text-lg leading-6 font-medium text-red-900" id="modal-title-delete"> </h3></div> <div class="px-4 py-5 sm:p-6"><p class="text-sm text-gray-700"> </p> <!></div> <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse border-t border-gray-200"><button type="button" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:ml-3 sm:w-auto sm:text-sm disabled:opacity-50"><!> </button> <button type="button" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm disabled:opacity-50"> </button></div></div></div>',1);function In(j,f){Ga(f,!0);const h=()=>da(bs,"$_",s),[s,M]=ts(),J=qs();let w=Mr(f,"isOpen",11,!1),c=Mr(f,"assistantName",3,""),m=Mr(f,"isDeleting",11,!1),A=_(!1),z=()=>{};Ia(()=>(z=ms.subscribe(ve=>{a(A,!!ve)}),()=>{z()}));function F(){m()||J("close")}function me(ve){ve.key==="Escape"&&F()}var le=we();Zr("keydown",Ys,me);var I=q(le);{var B=ve=>{var Ge=Tn(),be=q(Ge);be.__click=F;var oe=o(be,2),ie=r(oe),Ke=r(ie),Ae=o(r(Ke),2),it=r(Ae,!0);t(Ae),t(Ke);var Ee=o(Ke,2),Ze=r(Ee),Te=r(Ze,!0);t(Ze);var Ce=o(Ze,2);{var ge=S=>{var R=Pn(),pe=r(R,!0);t(R),d(X=>i(pe,X),[()=>e(A)?h()("assistants.deleteModal.deleting",{default:"Deleting..."}):"Deleting..."]),n(S,R)};v(Ce,S=>{m()&&S(ge)})}t(Ee);var K=o(Ee,2),Ve=r(K);Ve.__click=[Nn,m,J];var He=r(Ve);{var U=S=>{var R=Mn();n(S,R)};v(He,S=>{m()&&S(U)})}var k=o(He);t(Ve);var N=o(Ve,2);N.__click=F;var E=r(N,!0);t(N),t(K),t(ie),t(oe),d((S,R,pe,X)=>{i(it,S),i(Te,R),Ve.disabled=m(),i(k,` ${pe??""}`),N.disabled=m(),i(E,X)},[()=>e(A)?h()("assistants.deleteModal.title",{default:"Delete Assistant"}):"Delete Assistant",()=>e(A)?h()("assistants.deleteModal.confirmation",{values:{name:c()},default:`Are you sure you want to delete the assistant "${c()}"? This action cannot be undone.`}):`Are you sure you want to delete the assistant "${c()}"? This action cannot be undone.`,()=>e(A)?h()("assistants.deleteModal.confirmButton",{default:"Delete"}):"Delete",()=>e(A)?h()("common.cancel",{default:"Cancel"}):"Cancel"]),n(ve,Ge)};v(I,ve=>{w()&&ve(B)})}n(j,le),Ka(),M()}es(["click"]);function Rn(j,f,h,s,M){console.log("Navigating to MCP Testing"),a(f,null),a(h,"mcp"),a(s,!1),a(M,"properties"),Ua(`${Oa}/assistants?view=mcp`,{replaceState:!0})}var Dn=l('<div class="relative"><button class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm rounded-t-md bg-brand text-white border-brand cursor-default" style="background-color: #2271b3; color: white; border-color: #2271b3;" disabled> <!></button></div>'),Ln=l('<div class="mt-6"><div class="bg-white shadow rounded-lg p-4 border border-gray-200"><!></div></div>'),Fn=l('<div class="mt-6"><div class="bg-white shadow rounded-lg p-6 border border-gray-200"><!></div></div>'),Bn=(j,f)=>a(f,"properties"),Un=(j,f)=>a(f,"edit"),On=(j,f)=>a(f,"chat"),jn=l("<p> </p>"),Gn=l('<div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative" role="alert"><strong class="font-bold"> </strong> <span class="block sm:inline"> </span> <button class="ml-4 underline"> </button></div>'),Kn=(j,f)=>a(f,"edit"),zn=(j,f,h)=>f({detail:{id:e(h).id,name:e(h).name}}),qn=(j,f,h)=>f({detail:{id:e(h).id}}),Jn=gs('<svg class="animate-spin -ml-1 mr-2 h-4 w-4 text-white inline" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> ',1),Vn=gs('<svg class="animate-spin -ml-1 mr-2 h-4 w-4 text-white inline" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> ',1),Hn=(j,f,h)=>f({detail:{id:e(h).id,name:e(h).name,published:e(h).published}}),Wn=l('<div class="bg-white border border-gray-200 p-3 rounded-md text-gray-500 italic text-sm"> </div>'),Yn=l('<div class="bg-red-50 border border-red-200 p-3 rounded-md text-red-600 text-sm"><strong> </strong> </div>'),Zn=l('<div class="bg-white border border-gray-300 rounded-md p-4"><div class="mb-3 pb-3 border-b border-gray-200"><div class="text-xs text-gray-600 space-y-1"><div><span class="font-medium"> </span> <code class="ml-1 text-xs bg-gray-100 px-1 py-0.5 rounded"> </code></div> <div><span class="font-medium"> </span> <span class="ml-1 inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800"> </span></div></div></div> <details open><summary class="cursor-pointer text-sm font-medium text-blue-600 hover:text-blue-800 mb-2"> </summary> <div class="mt-3 p-4 bg-gray-50 border border-gray-200 rounded max-h-96 overflow-y-auto"><pre class="text-xs whitespace-pre-wrap font-mono text-gray-800"> </pre></div></details></div>'),Qn=l('<div class="bg-white border border-gray-200 p-3 rounded-md text-gray-500 italic text-sm"> </div>'),Xn=l('<div class="mt-6 pt-6 border-t border-gray-200"><div class="block text-sm font-medium text-gray-700 mb-2"> </div> <!></div>'),el=l('<div class="p-4 border border-blue-200 rounded bg-blue-50"><h3 class="text-lg font-semibold text-blue-800 mb-2"> </h3> <div class="space-y-1 text-sm text-blue-700 break-words"><div><span class="font-medium"> </span> <code class="ml-1 bg-blue-100 px-1 rounded"> </code></div> <div><span class="font-medium"> </span> <code class="ml-1 bg-blue-100 px-1 rounded"> </code></div> <div><span class="font-medium"> </span> <code class="ml-1 bg-blue-100 px-1 rounded">ASK ADMIN FOR THE SECRET</code></div></div></div>'),tl=l('<div><div class="font-medium text-gray-700 mb-1"> </div> <div class="bg-white border border-gray-200 p-2 rounded w-24 text-center"> </div></div>'),rl=l('<div class="bg-white border border-gray-200 p-2 rounded text-gray-500 italic"> </div>'),al=l('<div class="bg-red-50 border border-red-200 p-2 rounded text-red-600 italic"> </div>'),sl=l('<span class="inline-block bg-gray-200 rounded px-2 py-0.5 text-xs font-medium text-gray-700"> </span>'),ol=l('<div class="bg-white border border-gray-200 p-2 rounded space-y-1"></div>'),il=l('<div class="bg-white border border-gray-200 p-2 rounded text-gray-500 italic"> </div>'),nl=l('<div><div class="font-medium text-gray-700 mb-1"> </div> <!></div>'),ll=l('<div><div class="font-medium text-gray-700 mb-1"> </div> <div class="bg-white border border-gray-200 p-2 rounded break-all"> </div></div>'),dl=l('<div class="pt-3 mt-3 border-t border-gray-300 space-y-3"><h4 class="text-md font-medium text-gray-700"> </h4> <!> <!> <!></div>'),cl=l('<div class="space-y-3 text-sm"><div><div class="font-medium text-gray-700 mb-1"> </div> <div class="bg-white border border-gray-200 p-2 rounded"> </div></div> <div><div class="font-medium text-gray-700 mb-1"> </div> <div class="bg-white border border-gray-200 p-2 rounded"> </div></div> <div><div class="font-medium text-gray-700 mb-1"> </div> <div class="bg-white border border-gray-200 p-2 rounded"> </div></div> <div><div class="font-medium text-gray-700 mb-1"> </div> <div class="bg-white border border-gray-200 p-2 rounded"> </div></div> <!></div>'),ul=l('<div class="md:w-1/3 mt-6 md:mt-0 space-y-4"><!> <div class="p-4 border border-gray-200 rounded bg-gray-50"><h3 class="text-lg font-semibold text-gray-800 mb-2"> </h3> <!></div></div>'),vl=l('<div class="flex justify-between items-center px-6 py-4 border-b border-gray-200"><h2 class="text-xl font-semibold text-gray-800"> </h2> <div class="flex space-x-2"><button type="button" class="px-3 py-1 text-sm font-medium rounded text-indigo-600 bg-white border border-indigo-600 hover:bg-indigo-100 transition-colors"> </button> <button type="button" class="px-3 py-1 text-sm font-medium rounded text-white hover:bg-opacity-90 transition-colors" style="background-color: #2271b3;"> </button> <button type="button" class="px-3 py-1 text-sm font-medium rounded bg-green-600 text-white hover:bg-green-700 transition-colors"><!></button> <button type="button"><!></button> <button type="button" class="px-3 py-1 text-sm font-medium rounded bg-red-600 text-white hover:bg-red-700 transition-colors"> </button></div></div> <div class="flex flex-col md:flex-row md:space-x-6 px-6 py-4"><div class="flex-grow md:w-2/3 space-y-4"><div><div class="block text-sm font-medium text-gray-700"> <span class="text-red-600">*</span></div> <div class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm bg-gray-100 cursor-not-allowed sm:text-sm"> </div></div> <div><div class="block text-sm font-medium text-gray-700"> </div> <div class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm bg-gray-100 sm:text-sm min-h-[6em] whitespace-pre-wrap select-text cursor-text"> </div></div> <div><div class="block text-sm font-medium text-gray-700"> </div> <div class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm bg-gray-100 sm:text-sm min-h-[8em] whitespace-pre-wrap select-text cursor-text"> </div></div> <div><div class="block text-sm font-medium text-gray-700"> </div> <div class="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-md shadow-sm bg-gray-100 sm:text-sm max-h-96 overflow-y-auto whitespace-pre-wrap select-text cursor-text"> </div></div> <!></div> <!></div>',1),pl=l('<div class="px-6 py-4"><div class="mb-6 pb-4 border-b border-gray-200"><h2 class="text-xl font-semibold text-gray-800"> </h2></div> <div class="w-full"><!></div></div>'),fl=l('<div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative" role="alert"><strong class="font-bold"> </strong> <span class="block sm:inline"> </span></div>'),ml=l('<div class="px-6 py-4 border-b border-gray-200"><h2 class="text-xl font-semibold text-gray-800"> </h2></div> <!>',1),gl=l("<p> </p>"),bl=l('<div class="mb-4 border-b border-gray-300 flex space-x-4"><button> </button> <button> </button> <button> <!></button></div> <div class="bg-white shadow rounded-lg border border-gray-200"><!></div>',1),_l=l("<p> </p>"),hl=l("<p> </p>"),xl=l('<h1 class="text-3xl font-bold mb-4 text-brand"> </h1> <div class="mb-6 border-b border-gray-200"><nav class="-mb-px flex space-x-8" aria-label="Tabs"><button> </button> <button> </button> <button> </button> <!></nav></div> <!> <!> <!> <!>',1);function ql(j,f){Ga(f,!0);const h=()=>da(Vs,"$page",J),s=()=>da(bs,"$_",J),M=()=>da(ms,"$locale",J),[J,w]=ts();let c=_("list"),m=_(null),A=_(null),z=_(null),F=_(!1),me=_(""),le=_(!1),I=_(lr(h().url.searchParams.get("startInEdit")==="true"?"edit":"properties")),B=_(""),ve=_(""),Ge=_(""),be=null,oe=_(!1),ie=_(null),Ke=_(null),Ae=_(null),it=_(!1),Ee=_(!1),Ze=_(""),Te=_(""),Ce=_(!1),ge=_(null),K=_(null),Ve=_(!1),He=_(""),U=_(!1),k=_(null),N=_(!1),E=_(""),S=_(lr([])),R=_(!1),pe=_(""),X=_(!1),ke=_(""),Ne=_(!1),Se=_(""),de=_(!1);function We(){console.log("Navigating to create form"),a(A,null),a(c,"create"),a(le,!1),Ua(`${Oa}/assistants?view=create`,{replaceState:!0})}function re(){console.log("Navigating back to list view (assistants base path)"),a(c,"list"),a(le,!1),Ua(`${Oa}/assistants`,{replaceState:!0})}async function ce(b){if(e(z)!==b){a(z,b,!0),a(F,!0),a(me,""),a(A,null),a(c,"detail");try{console.log(`Fetching assistant ID: ${b}.`);const p=await Hs(b);if(p){let x={};const D=p.metadata||p.api_callback;if(D)try{x=JSON.parse(D)}catch(V){console.error("Error parsing metadata JSON:",V)}const O={...p,...x,id:p.id.toString()};a(A,O,!0),console.log("Assigned selectedAssistantData:",e(A)),Ua(`${Oa}/assistants?view=detail&id=${b}`,{replaceState:!0,noScroll:!0})}else a(me,s()("assistant_not_found",{values:{id:b}}),!0),console.error(e(me)),re()}catch(p){console.error("Error fetching assistant details:",p),a(me,p instanceof Error?p.message:s()("error_fetching_assistant"),!0),re()}finally{a(F,!1)}}}Cs(()=>{console.log("Assistants page mounted");try{const b=zs();if(console.log("[DEBUG] Assistants page onMount: Config object received:",JSON.stringify(b,null,2)),b&&b.api&&b.api.baseUrl)a(B,b.api.lambServer.replace(/\/$/,""),!0),console.log("LAMB config loaded for chat - API URL:",e(B)),console.log("LAMB config loaded for chat - Using user authentication");else throw new Error("Missing required LAMB configuration (baseUrl).")}catch(b){a(Ge,b instanceof Error?b.message:"Failed to load LAMB configuration.",!0),console.error(e(Ge))}a(ve,localStorage.getItem("userToken")||"",!0),e(ve)?console.log("User token loaded for chat authentication"):console.warn("No user token found - chat functionality may be limited"),a(m,M()??null,!0),be=Vs.subscribe(b=>{var V;console.log("Page store updated:",b.url.searchParams.toString());const p=b.url.searchParams.get("view"),x=b.url.searchParams.get("id"),D=b.url.searchParams.get("startInEdit");console.log(`[+page.svelte] URL Params: view=${p}, id=${x}, startInEdit=${D}`);const O=D==="true";if(console.log(`[+page.svelte] requestedStartEdit evaluated to: ${O}`),p==="create")e(c)!=="create"&&(console.log("URL indicates 'create' view."),We());else if(p==="mcp")e(c)!=="mcp"&&(console.log("URL indicates 'mcp' view."),a(c,"mcp"));else if(p==="detail"&&x){const _e=parseInt(x,10);isNaN(_e)?(console.warn("Invalid assistant ID in URL parameter."),re()):(a(le,O),console.log(`[+page.svelte] Set startEditMode state to: ${e(le)}`),e(c)!=="detail"&&(a(c,"detail"),a(I,"properties")),((V=e(A))==null?void 0:V.id)!==_e.toString()?(console.log(`[+page.svelte] Fetching detail for new ID: ${_e}`),ce(_e)):(console.log(`[+page.svelte] ID ${_e} already loaded. Skipping fetch.`),a(F,!1)))}else e(c)!=="list"&&(console.log("URL indicates 'list' view."),re())})}),so(()=>{console.log("Assistants page unmounting"),be&&be()}),Ia(()=>{(M()??null)!==e(m)&&(console.log(`Locale changed from ${e(m)} to ${M()}`),a(m,M()??null,!0))});function Ie(b){if(b.detail&&typeof b.detail.assistantId=="number"){const p=b.detail.assistantId;console.log(`Assistant created with ID: ${p}, navigating to list view.`),Ua(`${Oa}/assistants`,{replaceState:!0})}else console.error("handleAssistantCreated received event without expected detail:",b),a(me,"Failed to navigate to new assistant. Event detail missing."),re()}async function nt(b){const{id:p,name:x}=b.detail;console.log(`Duplicate request received for ID: ${p}, Name: ${x}`),a(ie,p,!0),a(Ke,x,!0),a(Ae,null),a(it,!0),a(oe,!1),a(Te,"");try{const D=await Hs(p);if(D){a(Ae,D,!0);const O=x.includes("_")?x.substring(x.indexOf("_")+1):x;a(Ze,`Copy_${O}`),a(oe,!0)}else throw new Error(`Assistant with ID ${p} not found.`)}catch(D){console.error("Error fetching assistant details for duplication:",D),a(Te,D instanceof Error?D.message:s()("error_fetching_assistant"),!0),alert(`Error preparing duplication: ${e(Te)}`)}finally{a(it,!1)}}async function Tt(b){const p=b.detail.newName;if(!e(Ae)||!p){a(Te,"Missing data for duplication.");return}a(Ee,!0),a(Te,"");try{const x=e(Ae),D={name:p,description:x.description||"",system_prompt:x.system_prompt||x.instructions||"",prompt_template:x.prompt_template||"",metadata:x.metadata||x.api_callback||"",pre_retrieval_endpoint:x.pre_retrieval_endpoint||"",post_retrieval_endpoint:x.post_retrieval_endpoint||"",RAG_endpoint:x.RAG_endpoint||"",RAG_Top_k:x.RAG_Top_k??3,RAG_collections:x.RAG_collections||""};console.log("Creating duplicate assistant with data:",D);const O=await Xs(D);if(O&&O.assistant_id)console.log("Duplicate created successfully, ID:",O.assistant_id),a(oe,!1),a(ie,null),a(Ae,null),a(Ke,null),a(Ze,""),Ua(`${Oa}/assistants?view=detail&id=${O.assistant_id}`,{replaceState:!0});else throw new Error("Create operation did not return a valid assistant ID.")}catch(x){console.error("Error creating duplicate assistant:",x),a(Te,x instanceof Error?x.message:s()("assistants.duplicateModal.submitError",{default:"Failed to create duplicate."}),!0)}finally{a(Ee,!1)}}function It({detail:b}){const{id:p,name:x,published:D}=b;if(console.log(`Delete request received for ID: ${p}, Name: ${x}, Published: ${D}`),D){alert(e(m)?s()("assistants.deleteErrorPublished"):"Cannot delete a published assistant. Please unpublish it first.");return}a(ge,p,!0),a(K,x,!0),a(He,""),a(Ce,!0)}async function Xr(){var b;if(console.log("[Delete Modal] handleDeleteConfirm called"),!e(ge)){console.log("[Delete Modal] No assistantToDeleteId, aborting delete");return}a(Ve,!0),a(He,"");try{console.log(`[Delete Modal] Attempting to delete assistant ID: ${e(ge)}`),await po(e(ge)),console.log(`[Delete Modal] Assistant ${e(ge)} deleted successfully.`),a(Ce,!1);const p=e(ge);a(ge,null),a(K,null),e(c)==="detail"&&((b=e(A))==null?void 0:b.id)===p.toString()?(console.log("[Delete Modal] Deleted from detail view, navigating to list"),re()):(console.log("[Delete Modal] Deleted from list view, navigating to list"),re())}catch(p){console.error(`[Delete Modal] Error deleting assistant ${e(ge)}:`,p),a(He,p instanceof Error?p.message:s()("assistants.deleteModal.deleteError",{default:"Failed to delete assistant."}),!0)}finally{a(Ve,!1),console.log("[Delete Modal] handleDeleteConfirm finished")}}function Ot(b){if(!b)return"assistant_export.json";const p=b.match(/filename=["']?([^"';]+)["']?/);return(p==null?void 0:p[1])||"assistant_export.json"}async function Wt({detail:b}){var D;const{id:p}=b;if(console.log(`Export request received for ID: ${p}`),e(U))return;a(k,p,!0),a(U,!0);let x=null;try{if(Js&&(x=localStorage.getItem("userToken")),!x)throw new Error("Authentication token not found.");let O="";try{const Y=zs();if(O=(D=Y==null?void 0:Y.api)==null?void 0:D.lambServer,!O)throw new Error}catch{throw console.error("Failed to get server URL from config for export"),new Error("Configuration error, cannot determine export URL.")}const V=`${O.replace(/\/$/,"")}/creator/assistant/export/${p}`;console.log(`Fetching export from: ${V}`);const _e=await fetch(V,{headers:{Authorization:`Bearer ${x}`}});if(!_e.ok){let Y=`Failed to export assistant ${p}`;try{const H=await _e.json();Y=(H==null?void 0:H.detail)||`${Y} (Status: ${_e.status})`}catch{Y=`${Y} (Status: ${_e.status})`}throw new Error(Y)}const dt=_e.headers.get("Content-Disposition"),jt=Ot(dt),Kt=await _e.blob(),kt=URL.createObjectURL(Kt),Dt=document.createElement("a");Dt.href=kt,Dt.download=jt,document.body.appendChild(Dt),Dt.click(),document.body.removeChild(Dt),URL.revokeObjectURL(kt),console.log(`Successfully triggered download for ${jt}`)}catch(O){console.error("Error during assistant export:",O),alert(`Export failed: ${O instanceof Error?O.message:"Unknown error"}`)}finally{a(U,!1),a(k,null)}}async function Nt(){if(!e(A)||!e(A).id)return;const b=parseInt(e(A).id,10),x=!e(A).published;a(N,!0),a(E,"");let D=null;try{if(Js&&(D=localStorage.getItem("userToken")),!D)throw new Error("Authentication token not found.");console.log(`Attempting to set publish status for ${b} to ${x}`);const O=await mo(b,x);a(A,O,!0),console.log("Publish status updated successfully.")}catch(O){console.error("Error toggling publish status:",O),a(E,O instanceof Error?O.message:"Failed to update publish status.",!0),alert(`Error: ${e(E)}`)}finally{a(N,!1)}}async function dr(){var x,D;if(e(R)||e(X))return;let b="";const p=((x=e(A))==null?void 0:x.metadata)||((D=e(A))==null?void 0:D.api_callback);if(p)try{b=JSON.parse(p).rag_processor}catch(O){console.error("Error parsing metadata for KB fetch check:",O)}if(b!=="simple_rag"){console.log("Skipping KB fetch for detail view (not simple_rag)"),a(S,[],!0),a(pe,""),a(X,!0);return}console.log("Fetching knowledge bases for detail view..."),a(R,!0),a(pe,""),a(S,[],!0);try{const O=await Qs();O.sort((V,_e)=>V.name.localeCompare(_e.name)),a(S,O,!0),console.log("Fetched KBs for detail view:",e(S))}catch(O){console.error("Error fetching knowledge bases for detail view:",O),a(pe,O instanceof Error?O.message:"Failed to load knowledge bases",!0)}finally{a(R,!1),a(X,!0)}}async function Tr(){var D,O;if(e(Ne)||e(de))return;let b="",p="";const x=((D=e(A))==null?void 0:D.metadata)||((O=e(A))==null?void 0:O.api_callback);if(x)try{const V=JSON.parse(x);b=V.rag_processor,p=V.rubric_id}catch(V){console.error("Error parsing metadata for rubric fetch check:",V)}if(b!=="rubric_rag"||!p){console.log("Skipping rubric fetch for detail view (not rubric_rag or no rubric_id)"),a(ke,""),a(Se,""),a(de,!0);return}console.log("Fetching rubric markdown for detail view..."),a(Ne,!0),a(Se,""),a(ke,"");try{const V=await no(p);a(ke,V,!0),console.log("Fetched rubric markdown for detail view")}catch(V){console.error("Error fetching rubric markdown for detail view:",V),a(Se,V instanceof Error?V.message:"Failed to load rubric",!0)}finally{a(Ne,!1),a(de,!0)}}Ia(()=>{var x,D,O;const b=(D=(x=e(A))==null?void 0:x.id)==null?void 0:D.toString(),p=(O=e(z))==null?void 0:O.toString();e(c)==="detail"&&b&&(b===p&&!e(X)&&(console.log(`$effect triggering KB fetch for detail view (ID: ${b})`),dr()),b===p&&!e(de)&&(console.log(`$effect triggering Rubric fetch for detail view (ID: ${b})`),Tr())),(e(c)!=="detail"||b&&p&&b!==p)&&(e(X)&&(console.log(`$effect resetting KB fetch trigger. CurrentView: ${e(c)}, assistantIdStr: ${b}, lastAttemptedIdStr: ${p}`),a(X,!1),a(S,[],!0),a(pe,"")),e(de)&&(console.log("$effect resetting Rubric fetch trigger"),a(de,!1),a(ke,""),a(Se,"")))});var Ea=xl(),fe=q(Ea),Be=r(fe,!0);t(fe);var ht=o(fe,2),Ue=r(ht),ae=r(Ue);ae.__click=re;var ee=r(ae,!0);t(ae);var te=o(ae,2);te.__click=We;var et=r(te,!0);t(te);var Oe=o(te,2);Oe.__click=[Rn,A,c,le,I];var lt=r(Oe,!0);t(Oe);var Rt=o(Oe,2);{var Yt=b=>{var p=Dn(),x=r(p),D=r(x),O=o(D);{var V=_e=>{var dt=la();d(jt=>i(dt,`(${jt??""})`),[()=>{var jt;return((jt=e(A).name)==null?void 0:jt.replace(/^\d+_/,""))||"..."}]),n(_e,dt)};v(O,_e=>{e(A)&&_e(V)})}t(x),t(p),d(_e=>i(D,`${_e??""} `),[()=>e(m)?s()("assistants.detailViewTab"):"Assistant Detail"]),n(b,p)};v(Rt,b=>{e(c)==="detail"&&(e(A)||e(F))&&b(Yt)})}t(Ue),t(ht);var xt=o(ht,2);{var je=b=>{var p=Ln(),x=r(p),D=r(x);Uo(D,{$$events:{duplicate:nt,delete:It,export:Wt}}),t(x),t(p),n(b,p)},Pe=b=>{var p=we(),x=q(p);{var D=V=>{Ws(V,{assistant:null,$$events:{formSuccess:Ie}})},O=V=>{var _e=we(),dt=q(_e);{var jt=kt=>{var Dt=Fn(),Y=r(Dt),H=r(Y);$n(H,{}),t(Y),t(Dt),n(kt,Dt)},Kt=kt=>{var Dt=we(),Y=q(Dt);{var H=g=>{var T=bl(),C=q(T),G=r(C);G.__click=[Bn,I];var se=r(G,!0);t(G);var L=o(G,2);L.__click=[Un,I];var ft=r(L,!0);t(L);var tt=o(L,2);tt.__click=[On,I];var cr=r(tt),Le=o(cr);{var Fe=ue=>{var Q=la();d((Ir,Lt)=>i(Q,`${Ir??""} ${Lt??""}`),[()=>e(m)?s()("assistants.detail.chatWith",{default:"with"}):"with",()=>e(A).name.replace(/^\d+_/,"")]),n(ue,Q)};v(Le,ue=>{e(A)&&e(A).name&&ue(Fe)})}t(tt),t(C);var Qe=o(C,2),Gr=r(Qe);{var Kr=ue=>{var Q=jn(),Ir=r(Q,!0);t(Q),d(Lt=>i(Ir,Lt),[()=>e(m)?s()("assistants.loadingDetail"):"Loading assistant details..."]),n(ue,Q)},ca=ue=>{var Q=we(),Ir=q(Q);{var Lt=kr=>{var zt=Gn(),mt=r(zt),Qt=r(mt,!0);t(mt);var Xt=o(mt,2),Rr=r(Xt,!0);t(Xt);var Dr=o(Xt,2);Dr.__click=re;var ua=r(Dr,!0);t(Dr),t(zt),d((va,$r)=>{i(Qt,va),i(Rr,e(me)),i(ua,$r)},[()=>e(m)?s()("assistants.errorTitle"):"Error:",()=>e(m)?s()("common.backToList"):"Back to list"]),n(kr,zt)},sr=kr=>{var zt=we(),mt=q(zt);{var Qt=Xt=>{var Rr=we(),Dr=q(Rr);{var ua=$r=>{var zr=vl(),ea=q(zr),qr=r(ea),ta=r(qr,!0);t(qr);var ur=o(qr,2),vr=r(ur);vr.__click=[Kn,I];var Lr=r(vr,!0);t(vr);var or=o(vr,2);or.__click=[zn,nt,A];var ra=r(or,!0);t(or);var Fr=o(or,2);Fr.__click=[qn,Wt,A];var Jr=r(Fr);{var Sa=ze=>{var ct=Jn(),er=o(q(ct),1,!0);d(fr=>i(er,fr),[()=>e(m)?s()("common.exporting",{default:"Exporting..."}):"Exporting..."]),n(ze,ct)},rs=ze=>{var ct=la();d(er=>i(ct,er),[()=>e(m)?s()("common.export",{default:"Export"}):"Export"]),n(ze,ct)};v(Jr,ze=>{e(U)&&e(k)===e(A).id?ze(Sa):ze(rs,!1)})}t(Fr);var pr=o(Fr,2);pr.__click=Nt;var pa=r(pr);{var ba=ze=>{var ct=Vn(),er=o(q(ct),1,!0);d(fr=>i(er,fr),[()=>e(m)?s()("common.updating",{default:"Updating..."}):"Updating..."]),n(ze,ct)},Ra=ze=>{var ct=we(),er=q(ct);{var fr=gt=>{var qt=la();d(y=>i(qt,y),[()=>e(m)?s()("common.unpublish",{default:"Unpublish"}):"Unpublish"]),n(gt,qt)},fa=gt=>{var qt=la();d(y=>i(qt,y),[()=>e(m)?s()("common.publish",{default:"Publish"}):"Publish"]),n(gt,qt)};v(er,gt=>{var qt;(qt=e(A))!=null&&qt.published?gt(fr):gt(fa,!1)},!0)}n(ze,ct)};v(pa,ze=>{e(N)?ze(ba):ze(Ra,!1)})}t(pr);var aa=o(pr,2);aa.__click=[Hn,It,A];var Br=r(aa,!0);t(aa),t(ur),t(ea);var Ur=o(ea,2),Ar=r(Ur),Vr=r(Ar),Da=r(Vr),qa=r(Da);ja(),t(Da);var Ja=o(Da,2),_s=r(Ja,!0);t(Ja),t(Vr);var as=o(Vr,2),La=r(as),ss=r(La,!0);t(La);var hs=o(La,2),Va=r(hs,!0);t(hs),t(as);var os=o(as,2),is=r(os),Ns=r(is,!0);t(is);var Ha=o(is,2),ns=r(Ha,!0);t(Ha),t(os);var ls=o(os,2),Ca=r(ls),Ps=r(Ca,!0);t(Ca);var xs=o(Ca,2),ys=r(xs,!0);t(xs),t(ls);var Ms=o(ls,2);{var ws=ze=>{const ct=jr(()=>(()=>{try{const gt=e(A).metadata||e(A).api_callback;return typeof gt=="string"?JSON.parse(gt):gt||{}}catch(gt){return console.error("Error parsing metadata:",gt),{}}})());var er=we(),fr=q(er);{var fa=gt=>{var qt=Xn(),y=r(qt),$=r(y,!0);t(y);var P=o(y,2);{var Z=W=>{var he=Wn(),xe=r(he,!0);t(he),d(rt=>i(xe,rt),[()=>s()("assistants.form.rubric.loading",{default:"Loading rubric..."})]),n(W,he)},ne=W=>{var he=we(),xe=q(he);{var rt=Ft=>{var Gt=Yn(),ye=r(Gt),Me=r(ye,!0);t(ye);var Ye=o(ye);t(Gt),d(at=>{i(Me,at),i(Ye,` ${e(Se)??""}`)},[()=>s()("assistants.form.rubric.error",{default:"Error loading rubric:"})]),n(Ft,Gt)},Pt=Ft=>{var Gt=we(),ye=q(Gt);{var Me=at=>{var qe=Zn(),ut=r(qe),$t=r(ut),Re=r($t),Je=r(Re),tr=r(Je,!0);t(Je);var Jt=o(Je,2),mr=r(Jt,!0);t(Jt),t(Re);var rr=o(Re,2),Bt=r(rr),Er=r(Bt,!0);t(Bt);var st=o(Bt,2),De=r(st,!0);t(st),t(rr),t($t),t(ut);var $e=o(ut,2),Xe=r($e),Ut=r(Xe,!0);t(Xe);var ir=o(Xe,2),Vt=r(ir),St=r(Vt,!0);t(Vt),t(ir),t($e),t(qe),d((Sr,gr,ot)=>{i(tr,Sr),i(mr,e(ct).rubric_id||"N/A"),i(Er,gr),i(De,e(ct).rubric_format||"markdown"),i(Ut,ot),i(St,e(ke))},[()=>s()("assistants.form.rubric.id",{default:"Rubric ID:"}),()=>s()("assistants.form.rubric.format.label",{default:"Format:"}),()=>s()("assistants.form.rubric.viewRubric",{default:"View Rubric Content"})]),n(at,qe)},Ye=at=>{var qe=Qn(),ut=r(qe,!0);t(qe),d($t=>i(ut,$t),[()=>e(ct).rubric_id||(e(m)?s()("common.notSpecified",{default:"Not specified"}):"Not specified")]),n(at,qe)};v(ye,at=>{e(ke)?at(Me):at(Ye,!1)},!0)}n(Ft,Gt)};v(xe,Ft=>{e(Se)?Ft(rt):Ft(Pt,!1)},!0)}n(W,he)};v(P,W=>{e(Ne)?W(Z):W(ne,!1)})}t(qt),d(W=>i($,W),[()=>s()("assistants.form.rubric.selectedLabel",{default:"Selected Rubric"})]),n(gt,qt)};v(fr,gt=>{e(ct).rag_processor==="rubric_rag"&&gt(fa)})}n(ze,er)};v(Ms,ze=>{e(A)&&ze(ws)})}t(Ar);var Ts=o(Ar,2);{var ks=ze=>{var ct=ul(),er=r(ct);{var fr=P=>{var Z=el(),ne=r(Z),W=r(ne,!0);t(ne);var he=o(ne),xe=o(he),rt=r(xe),Pt=r(rt),Ft=r(Pt);t(Pt);var Gt=o(Pt,2),ye=r(Gt);t(Gt),t(rt);var Me=o(rt,2),Ye=r(Me),at=r(Ye);t(Ye);var qe=o(Ye,2),ut=r(qe,!0);t(qe),t(Me);var $t=o(Me,2),Re=r($t),Je=r(Re);t(Re),ja(2),t($t),t(xe),t(Z),d((tr,Jt,mr,rr,Bt,Er)=>{i(W,tr),i(he,` ${Jt??""} `),i(Ft,`${mr??""}:`),i(ye,`${e(B)??""}/lamb/v1/lti_users/lti`),i(at,`${rr??""}:`),i(ut,Bt),i(Je,`${Er??""}:`)},[()=>e(m)?s()("assistants.detail.ltiTitle",{default:"LTI Publish Details"}):"LTI Publish Details",()=>console.log("Checking selectedAssistantData for LTI box:",e(A)),()=>e(m)?s()("assistants.detail.ltiToolUrl",{default:"Tool URL"}):"Tool URL",()=>e(m)?s()("assistants.detail.ltiConsumerKey",{default:"Consumer Key"}):"Consumer Key",()=>e(A).oauth_consumer_name||(e(m)?s()("common.notAvailable",{default:"N/A"}):"N/A"),()=>e(m)?s()("assistants.detail.ltiSecret",{default:"Secret"}):"Secret"]),n(P,Z)};v(er,P=>{e(A).published&&P(fr)})}var fa=o(er,2),gt=r(fa),qt=r(gt,!0);t(gt);var y=o(gt,2);{var $=P=>{const Z=jr(()=>(()=>{try{const st=e(A).metadata||e(A).api_callback;return typeof st=="string"?JSON.parse(st):st||{}}catch(st){return console.error("Error parsing metadata:",st),{}}})());var ne=cl(),W=r(ne),he=r(W),xe=r(he,!0);t(he);var rt=o(he,2),Pt=r(rt,!0);t(rt),t(W);var Ft=o(W,2),Gt=r(Ft),ye=r(Gt,!0);t(Gt);var Me=o(Gt,2),Ye=r(Me,!0);t(Me),t(Ft);var at=o(Ft,2),qe=r(at),ut=r(qe,!0);t(qe);var $t=o(qe,2),Re=r($t,!0);t($t),t(at);var Je=o(at,2),tr=r(Je),Jt=r(tr,!0);t(tr);var mr=o(tr,2),rr=r(mr,!0);t(mr),t(Je);var Bt=o(Je,2);{var Er=st=>{var De=dl(),$e=r(De),Xe=r($e,!0);t($e);var Ut=o($e,2);{var ir=ot=>{var bt=tl(),At=r(bt),nr=r(At,!0);t(At);var br=o(At,2),_a=r(br,!0);t(br),t(bt),d(_r=>{i(nr,_r),i(_a,e(A).RAG_Top_k??3)},[()=>s()("assistants.form.ragTopK.label",{default:"RAG Top K"})]),n(ot,bt)};v(Ut,ot=>{e(Z).rag_processor!=="single_file_rag"&&e(Z).rag_processor!=="rubric_rag"&&ot(ir)})}var Vt=o(Ut,2);{var St=ot=>{var bt=nl(),At=r(bt),nr=r(At,!0);t(At);var br=o(At,2);{var _a=Et=>{var hr=rl(),xr=r(hr,!0);t(hr),d(ma=>i(xr,ma),[()=>s()("assistants.form.knowledgeBases.loading",{default:"Loading..."})]),n(Et,hr)},_r=Et=>{var hr=we(),xr=q(hr);{var ma=Hr=>{var Wr=al(),ha=r(Wr,!0);t(Wr),d(Ya=>i(ha,Ya),[()=>s()("assistants.form.knowledgeBases.error",{default:"Error loading KBs"})]),n(Hr,Wr)},Wa=Hr=>{var Wr=we(),ha=q(Wr);{var Ya=xa=>{var Or=ol();ar(Or,21,()=>e(A).RAG_collections.split(","),Qr,(Za,Qa)=>{const ds=jr(()=>e(S).find(Mt=>Mt.id===e(Qa)));var cs=sl(),_t=r(cs,!0);t(cs),d(()=>i(_t,e(ds)?e(ds).name:`${e(Qa)} (Not Found)`)),n(Za,cs)}),t(Or),n(xa,Or)},Is=xa=>{var Or=il(),Za=r(Or,!0);t(Or),d(Qa=>i(Za,Qa),[()=>s()("common.none",{default:"None"})]),n(xa,Or)};v(ha,xa=>{e(A).RAG_collections?xa(Ya):xa(Is,!1)},!0)}n(Hr,Wr)};v(xr,Hr=>{e(pe)?Hr(ma):Hr(Wa,!1)},!0)}n(Et,hr)};v(br,Et=>{e(R)?Et(_a):Et(_r,!1)})}t(bt),d(Et=>i(nr,Et),[()=>s()("assistants.form.knowledgeBases.label",{default:"Knowledge Bases"})]),n(ot,bt)};v(Vt,ot=>{e(Z).rag_processor==="simple_rag"&&ot(St)})}var Sr=o(Vt,2);{var gr=ot=>{var bt=ll(),At=r(bt),nr=r(At,!0);t(At);var br=o(At,2),_a=r(br,!0);t(br),t(bt),d((_r,Et)=>{i(nr,_r),i(_a,Et)},[()=>s()("assistants.form.singleFile.selectedLabel",{default:"Selected File"}),()=>e(Z).file_path||(e(m)?s()("common.notSpecified",{default:"Not specified"}):"Not specified")]),n(ot,bt)};v(Sr,ot=>{e(Z).rag_processor==="single_file_rag"&&ot(gr)})}t(De),d(ot=>i(Xe,ot),[()=>s()("assistants.form.ragOptions.title",{default:"RAG Options"})]),n(st,De)};v(Bt,st=>{e(Z).rag_processor&&e(Z).rag_processor!=="no_rag"&&st(Er)})}t(ne),d((st,De,$e,Xe,Ut,ir,Vt,St)=>{i(xe,st),i(Pt,De),i(ye,$e),i(Ye,Xe),i(ut,Ut),i(Re,ir),i(Jt,Vt),i(rr,St)},[()=>e(m)?s()("assistants.form.promptProcessor.label",{default:"Prompt Processor"}):"Prompt Processor",()=>e(Z).prompt_processor||(e(m)?s()("common.notSpecified",{default:"Not specified"}):"Not specified"),()=>e(m)?s()("assistants.form.connector.label",{default:"Connector"}):"Connector",()=>e(Z).connector||(e(m)?s()("common.notSpecified",{default:"Not specified"}):"Not specified"),()=>e(m)?s()("assistants.form.llm.label",{default:"Language Model (LLM)"}):"Language Model (LLM)",()=>e(Z).llm||(e(m)?s()("common.notSpecified",{default:"Not specified"}):"Not specified"),()=>e(m)?s()("assistants.form.ragProcessor.label",{default:"RAG Processor"}):"RAG Processor",()=>{var st;return((st=e(Z).rag_processor)==null?void 0:st.replace(/_/g," ").replace(/\b\w/g,De=>De.toUpperCase()))||(e(m)?s()("common.notSpecified",{default:"Not specified"}):"Not specified")}]),n(P,ne)};v(y,P=>{e(A)&&P($)})}t(fa),t(ct),d(P=>i(qt,P),[()=>e(m)?s()("assistants.detail.configuration",{default:"Configuration"}):"Configuration"]),n(ze,ct)};v(Ts,ze=>{e(A)&&ze(ks)})}t(Ur),d((ze,ct,er,fr,fa,gt,qt,y,$,P,Z,ne)=>{var W;i(ta,ze),i(Lr,ct),or.disabled=e(it),i(ra,er),Fr.disabled=e(U)&&e(k)===e(A).id,Ht(pr,1,`px-3 py-1 text-sm font-medium rounded text-white transition-colors ${(W=e(A))!=null&&W.published?"bg-yellow-600 hover:bg-yellow-700 disabled:bg-gray-400 disabled:cursor-not-allowed":"bg-green-600 hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed"}`),pr.disabled=e(N),i(Br,fr),i(qa,`${fa??""} `),i(_s,gt),i(ss,qt),i(Va,y),i(Ns,$),i(ns,P),i(Ps,Z),i(ys,ne)},[()=>e(m)?s()("assistants.detail.propertiesTitle",{default:"Assistant Properties"}):"Assistant Properties",()=>e(m)?s()("common.edit",{default:"Edit"}):"Edit",()=>e(m)?s()("common.duplicate"):"Duplicate",()=>e(m)?s()("common.delete"):"Delete",()=>s()("assistants.form.name.label"),()=>{var ze;return((ze=e(A).name)==null?void 0:ze.replace(/^\d+_/,""))||(e(m)?s()("common.notAvailable",{default:"N/A"}):"N/A")},()=>s()("assistants.form.description.label",{default:"Description"}),()=>e(A).description||(e(m)?s()("common.notSpecified",{default:"Not specified"}):"Not specified"),()=>s()("assistants.form.systemPrompt.label",{default:"System Prompt"}),()=>e(A).system_prompt||(e(m)?s()("common.notSpecified",{default:"Not specified"}):"Not specified"),()=>s()("assistants.form.promptTemplate.label",{default:"Prompt Template"}),()=>e(A).prompt_template||(e(m)?s()("common.notSpecified",{default:"Not specified"}):"Not specified")]),n($r,zr)},va=$r=>{var zr=we(),ea=q(zr);{var qr=ur=>{var vr=pl(),Lr=r(vr),or=r(Lr),ra=r(or,!0);t(or),t(Lr);var Fr=o(Lr,2),Jr=r(Fr);Ws(Jr,{get assistant(){return e(A)},id:"assistant-edit-form",$$events:{formSuccess:()=>{ce(e(A).id),a(I,"properties")}}}),t(Fr),t(vr),d(Sa=>i(ra,Sa),[()=>e(m)?s()("assistants.detail.editTitle",{default:"Edit Assistant"}):"Edit Assistant"]),n(ur,vr)},ta=ur=>{var vr=we(),Lr=q(vr);{var or=ra=>{var Fr=we(),Jr=q(Fr);{var Sa=pr=>{var pa=fl(),ba=r(pa),Ra=r(ba,!0);t(ba);var aa=o(ba,2),Br=r(aa);t(aa),t(pa),d((Ur,Ar)=>{i(Ra,Ur),i(Br,`${e(Ge)??""} - ${Ar??""}`)},[()=>e(m)?s()("assistants.detail.configErrorTitle",{default:"Configuration Error:"}):"Configuration Error:",()=>e(m)?s()("assistants.chatDisabled"):"Chat functionality is disabled."]),n(pr,pa)},rs=pr=>{var pa=we(),ba=q(pa);{var Ra=Br=>{var Ur=ml(),Ar=q(Ur),Vr=r(Ar),Da=r(Vr,!0);t(Vr),t(Ar);var qa=o(Ar,2);Qi(qa,{get apiUrl(){return e(B)},get userToken(){return e(ve)},get assistantId(){return e(A).id},get initialModel(){return e(A).llm}}),d(Ja=>i(Da,Ja),[()=>e(m)?s()("assistants.detail.chatTitle",{default:"Chat"}):"Chat"]),n(Br,Ur)},aa=Br=>{var Ur=gl(),Ar=r(Ur,!0);t(Ur),d(Vr=>i(Ar,Vr),[()=>e(m)?s()("assistants.chatLoadingConfig"):"Loading chat configuration..."]),n(Br,Ur)};v(ba,Br=>{e(B)&&e(ve)?Br(Ra):Br(aa,!1)},!0)}n(pr,pa)};v(Jr,pr=>{e(Ge)?pr(Sa):pr(rs,!1)})}n(ra,Fr)};v(Lr,ra=>{e(I)==="chat"&&ra(or)},!0)}n(ur,vr)};v(ea,ur=>{e(I)==="edit"?ur(qr):ur(ta,!1)},!0)}n($r,zr)};v(Dr,$r=>{e(I)==="properties"?$r(ua):$r(va,!1)})}n(Xt,Rr)};v(mt,Xt=>{e(A)&&Xt(Qt)},!0)}n(kr,zt)};v(Ir,kr=>{e(me)?kr(Lt):kr(sr,!1)},!0)}n(ue,Q)};v(Gr,ue=>{e(F)?ue(Kr):ue(ca,!1)})}t(Qe),d((ue,Q,Ir)=>{Ht(G,1,`py-2 px-4 text-sm font-medium rounded-t-md ${e(I)==="properties"?"bg-gray-100 border border-b-0 border-gray-300 text-brand":"text-gray-600 hover:text-gray-800"}`),i(se,ue),Ht(L,1,`py-2 px-4 text-sm font-medium rounded-t-md ${e(I)==="edit"?"bg-gray-100 border border-b-0 border-gray-300 text-brand":"text-gray-600 hover:text-gray-800"}`),i(ft,Q),Ht(tt,1,`py-2 px-4 text-sm font-medium rounded-t-md ${e(I)==="chat"?"bg-gray-100 border border-b-0 border-gray-300 text-brand":"text-gray-600 hover:text-gray-800"}`),i(cr,`${Ir??""} `)},[()=>e(m)?s()("assistants.detail.propertiesTab",{default:"Properties"}):"Properties",()=>e(m)?s()("assistants.detail.editTab",{default:"Edit"}):"Edit",()=>e(m)?s()("assistants.detail.chatTab",{default:"Chat"}):"Chat"]),n(g,T)},u=g=>{var T=_l(),C=r(T,!0);t(T),d(G=>i(C,G),[()=>e(m)?s()("assistants.noAssistantData"):"Assistant data not available."]),n(g,T)};v(Y,g=>{e(c)==="detail"?g(H):g(u,!1)},!0)}n(kt,Dt)};v(dt,kt=>{e(c)==="mcp"?kt(jt):kt(Kt,!1)},!0)}n(V,_e)};v(x,V=>{e(c)==="create"?V(D):V(O,!1)},!0)}n(b,p)};v(xt,b=>{e(c)==="list"?b(je):b(Pe,!1)})}var vt=o(xt,2);{var yt=b=>{Cn(b,{get originalName(){return e(Ke)},get defaultNewName(){return e(Ze)},get error(){return e(Te)},get isOpen(){return e(oe)},set isOpen(p){a(oe,p,!0)},get isSubmitting(){return e(Ee)},set isSubmitting(p){a(Ee,p,!0)},$$events:{submit:Tt,close:()=>{a(oe,!1),a(ie,null),a(Ae,null),a(Te,"")}}})};v(vt,b=>{e(oe)&&b(yt)})}var wt=o(vt,2);{var Zt=b=>{{let p=jr(()=>e(K)||"");In(b,{get assistantName(){return e(p)},get isOpen(){return e(Ce)},set isOpen(x){a(Ce,x,!0)},get isDeleting(){return e(Ve)},set isDeleting(x){a(Ve,x,!0)},$$events:{confirm:Xr,close:()=>{a(Ce,!1),a(ge,null),a(K,null),a(He,"")}}})}};v(wt,b=>{e(Ce)&&b(Zt)})}var pt=o(wt,2);{var wr=b=>{var p=hl(),x=r(p,!0);t(p),d(D=>i(x,D),[()=>e(m)?s()("assistants.loadingDetail"):"Loading assistant details..."]),n(b,p)};v(pt,b=>{e(F)&&b(wr)})}d((b,p,x,D)=>{i(Be,b),Ht(ae,1,`whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm rounded-t-md transition-colors duration-150 ${e(c)==="list"?"bg-brand text-white border-brand":"border-transparent text-gray-800 hover:text-gray-900 hover:border-gray-400"}`),Gs(ae,e(c)==="list"?"background-color: #2271b3; color: white; border-color: #2271b3;":""),i(ee,p),Ht(te,1,`whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm rounded-t-md ${e(c)==="create"?"bg-brand text-white border-brand":"border-transparent text-gray-800 hover:text-gray-900 hover:border-gray-400"}`),Gs(te,e(c)==="create"?"background-color: #2271b3; color: white; border-color: #2271b3;":""),i(et,x),Ht(Oe,1,`whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm rounded-t-md ${e(c)==="mcp"?"bg-brand text-white border-brand":"border-transparent text-gray-800 hover:text-gray-900 hover:border-gray-400"}`),Gs(Oe,e(c)==="mcp"?"background-color: #2271b3; color: white; border-color: #2271b3;":""),i(lt,D)},[()=>e(m)?s()("assistants.title"):"Learning Assistants",()=>e(m)?s()("assistants.myAssistantsTab"):"My Assistants",()=>e(m)?s()("assistants.createAssistantTab"):"Create Assistant",()=>e(m)?s()("assistants.mcpTestingTab",{default:"MCP Testing"}):"MCP Testing"]),n(j,Ea),Ka(),w()}es(["click"]);export{ql as component};
