import{d as xe,t as w,e as ye,b as f,s as K,n as _e,f as Se}from"../chunks/DbBWcICI.js";import{p as ke,j as x,k as re,u as oe,l as p,t as T,m as t,n as Ee,o as m,r as u,q as o,v as Ie,w as $e}from"../chunks/DMsokd5p.js";import{i as E}from"../chunks/MBI0PpQy.js";import{e as ae,i as ne}from"../chunks/D6e1hy_S.js";import{r as Ae,s as ie}from"../chunks/gPkShxx4.js";import{b as Me}from"../chunks/CFRbuANL.js";import{b as Ce}from"../chunks/BVQ_Nsm3.js";import"../chunks/DlJa0Cru.js";function De(W,z){z()}var Re=w('<div class="flex items-center"><svg class="animate-spin mr-3 h-5 w-5 text-indigo-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> <span>Loading available models...</span></div>'),Pe=w('<div class="text-red-500 mb-2"> </div> <button class="px-4 py-1 bg-indigo-500 text-white rounded hover:bg-indigo-600">Retry</button>',1),Te=w("<p>No models available.</p>"),ze=w("<option> </option>"),Le=w('<div class="flex items-center"><label for="model-select" class="mr-2">Choose a model:</label> <select id="model-select" class="border p-2 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"></select></div>'),Oe=w('<span class="ml-1 inline-block w-2 h-4 bg-current animate-pulse"></span>'),Ue=w("<div><div> <!></div></div>"),qe=w('<div class="text-left"><div class="inline-block px-4 py-2 rounded-lg bg-gray-200 text-gray-800 animate-pulse">...</div></div>'),Be=_e('<svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> Sending...',1),Ne=w('<div class="space-y-6"><h1 class="text-2xl font-bold text-gray-800">OpenAI Chat</h1> <div class="p-4 border rounded-md bg-white shadow-sm"><h2 class="text-lg font-semibold text-gray-700">Connection Details</h2> <p></p> <p></p></div> <div class="p-4 border rounded-md bg-white shadow-sm"><h2 class="text-lg font-semibold text-gray-700 mb-2">Model Selection</h2> <!></div> <div class="p-4 border rounded-md bg-white shadow-sm space-y-4"><h2 class="text-lg font-semibold text-gray-700">Chat</h2> <div class="h-96 overflow-y-auto border rounded p-3 space-y-3 bg-gray-50" id="chat-messages"><!> <!></div> <form class="flex space-x-2"><input type="text" placeholder="Send a message..." class="flex-grow px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"> <button type="submit" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-brand hover:bg-brand-hover focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand disabled:opacity-50 disabled:cursor-not-allowed" style="background-color: #2271b3;"><!></button></form></div></div>');function Ye(W,z){ke(z,!0);let i=x(re([])),I=x(""),_=x(!1),C=x(re([])),S=x("gpt-3.5-turbo"),L=x(!1),D=x(null),O=x(!1);const U="http://localhost:9099",G="0p3n-w3bu!";function a(e){const s=new Date().toISOString().split("T")[1].replace("Z","");console.log(`[${s}] ${e}`)}async function Y(){o(L,!0),o(D,null);try{const e=await fetch(`${U}/models`,{method:"GET",headers:{Authorization:`Bearer ${G}`}});if(!e.ok)throw new Error(`Failed to fetch models: ${e.status}`);const s=await e.json();if(s.data&&Array.isArray(s.data)){const r=s.data.map(c=>c.id).sort();if(o(C,r,!0),r.length>0){const c=r.filter(l=>l.includes("gpt"));c.length>0?o(S,c[0],!0):o(S,r[0],!0)}}else throw new Error("Invalid model data format")}catch(e){console.error("Error fetching models:",e);const s=e instanceof Error?e.message:"Failed to load models";o(D,s,!0),o(C,["gpt-3.5-turbo","gpt-4"],!0)}finally{o(L,!1)}}oe(()=>{const e=document.getElementById("chat-messages");e&&(e.scrollTop=e.scrollHeight)}),oe(()=>{localStorage.removeItem("messages"),localStorage.removeItem("userInputField"),Y()});function le(e){if(!e)return;const s=Date.now();a(`Starting UI update with content length: ${e.length}`);const r=t(i).length-1;r>=0&&t(i)[r].role==="assistant"?(a(`Found assistant message at index ${r}, updating content`),o(i,[...t(i).slice(0,r),{...t(i)[r],content:e}],!0)):a("No assistant message found to update"),a(`Message store updated in ${Date.now()-s}ms`)}async function de(e){var c,l,h;e.preventDefault();const s=t(I);if(!s.trim())return;a(`Submitting message: "${s}"`);const r={id:Date.now().toString(),role:"user",content:s};o(i,[...t(i),r],!0),o(I,""),o(_,!0),o(O,!0);try{const d=t(i).map(n=>({role:n.role,content:n.content}));a(`Sending request with ${d.length} messages to model: ${t(S)}`);const v={id:(Date.now()+1).toString(),role:"assistant",content:""};o(i,[...t(i),v],!0),a("Added placeholder assistant message");const g=Date.now(),y={method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${G}`},body:JSON.stringify({model:t(S),messages:d,stream:!0})};a(`Request details prepared, connecting to ${U}/chat/completions`);try{const n=await fetch(`${U}/chat/completions`,y);if(a(`API responded in ${Date.now()-g}ms with status: ${n.status}`),!n.ok)throw new Error(`API error: ${n.status}`);if(!n.body)throw new Error("Response body is not readable");a("Starting to process response stream");const $=n.body.getReader(),A=new TextDecoder;let b="",k="";for(;;){const{done:V,value:ee}=await $.read();if(V){a("Stream completed");break}a(`Received chunk of size: ${ee.byteLength} bytes`);const we=A.decode(ee,{stream:!0});k+=we;const te=k.split(`
`);k=te.pop()||"";for(const J of te){if(!J.trim()||!J.startsWith("data: "))continue;const se=J.slice(5).trim();if(se!=="[DONE]")try{const M=(h=(l=(c=JSON.parse(se).choices)==null?void 0:c[0])==null?void 0:l.delta)==null?void 0:h.content;M&&(b+=M,a(`Received text: "${M}" (current length: ${b.length})`),le(b))}catch(P){const M=P instanceof Error?P.message:String(P);a(`Error parsing: ${M}`)}}}a("Streaming completed successfully")}catch(n){throw a(`Stream error: ${n instanceof Error?n.message:String(n)}`),n}}catch(d){a(`Error during request: ${d instanceof Error?d.message:"Unknown error"}`),console.error("Error details:",d);const v={id:Date.now().toString(),role:"assistant",content:"Sorry, an error occurred. Please try again."};o(i,[...t(i),v],!0)}finally{o(_,!1),o(O,!1),a("Request handling completed")}}var q=Ne(),B=p(m(q),2),Z=p(m(B),2);Z.textContent="Using API URL: http://localhost:9099";var ce=p(Z,2);ce.textContent="Using API Key: 0p3n-w3bu!",u(B);var N=p(B,2),pe=p(m(N),2);{var ue=e=>{var s=Re();f(e,s)},ge=(e,s)=>{{var r=l=>{var h=Pe(),d=$e(h),v=m(d,!0);u(d);var g=p(d,2);g.__click=[De,Y],T(()=>K(v,t(D))),f(l,h)},c=(l,h)=>{{var d=g=>{var y=Te();f(g,y)},v=g=>{var y=Le(),n=p(m(y),2);ae(n,21,()=>t(C),ne,($,A)=>{var b=ze(),k={},V=m(b,!0);u(b),T(()=>{k!==(k=t(A))&&(b.value=(b.__value=t(A))??""),K(V,t(A))}),f($,b)}),u(n),u(y),Ce(n,()=>t(S),$=>o(S,$)),f(g,y)};E(l,g=>{t(C).length===0?g(d):g(v,!1)},h)}};E(e,l=>{t(D)?l(r):l(c,!1)},s)}};E(pe,e=>{t(L)?e(ue):e(ge,!1)})}u(N);var Q=p(N,2),F=p(m(Q),2),X=m(F);ae(X,17,()=>t(i),ne,(e,s)=>{var r=Ue(),c=m(r),l=m(c),h=p(l);{var d=v=>{var g=Oe();f(v,g)};E(h,v=>{t(O)&&t(s).role==="assistant"&&t(s)===t(i)[t(i).length-1]&&v(d)})}u(c),u(r),T(()=>{ie(r,1,t(s).role==="user"?"text-right":"text-left"),ie(c,1,`inline-block px-4 py-2 rounded-lg ${t(s).role==="user"?"bg-blue-500 text-white":"bg-gray-200 text-gray-800"}`),K(l,`${t(s).content??""} `)}),f(e,r)});var me=p(X,2);{var ve=e=>{var s=qe();f(e,s)};E(me,e=>{t(_)&&t(i).length===0&&e(ve)})}u(F);var j=p(F,2),R=m(j);Ae(R);var H=p(R,2),fe=m(H);{var he=e=>{var s=Be();Ie(),f(e,s)},be=e=>{var s=Se("Send");f(e,s)};E(fe,e=>{t(_)?e(he):e(be,!1)})}u(H),u(j),u(Q),u(q),T(()=>{R.disabled=t(_),H.disabled=t(_)||!t(I).length}),ye("submit",j,de),Me(R,()=>t(I),e=>o(I,e)),f(W,q),Ee()}xe(["click"]);export{Ye as component};
