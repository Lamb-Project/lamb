import{d as ma,t as v,b as n,s as i,f as yr,r as Qa,e as vr,g as Rr,n as Ia}from"../chunks/DbBWcICI.js";import{E as ms,p as la,j as w,I as fa,av as gs,k as jt,A as Oa,q as a,m as e,w as Je,o as r,r as t,l as o,n as da,t as p,v as na,aD as Wr,u as Yr,aq as ks,aC as aa,B as Wt,C as La,D as Fa,aO as bs,ab as As}from"../chunks/DMsokd5p.js";import{i as b}from"../chunks/MBI0PpQy.js";import{e as It,i as pr}from"../chunks/D6e1hy_S.js";import{a as ut,s as yt,r as Tr}from"../chunks/gPkShxx4.js";import{s as es}from"../chunks/CG3iaoFh.js";import{a as wr,s as ga}from"../chunks/BsHaMxS4.js";import{h as sa}from"../chunks/QT65TrHe.js";import{b as oa,g as ia}from"../chunks/DlJa0Cru.js";import{a as Na,$ as Ta}from"../chunks/B9q8dB_t.js";import{u as rs}from"../chunks/CmzVOFLo.js";import{g as ca,a as Ua}from"../chunks/BWNE5xtz.js";import{a as Dr}from"../chunks/t--hEgTQ.js";import{b as Mr,a as Es,c as ss}from"../chunks/CFRbuANL.js";import{b as Ba}from"../chunks/BVQ_Nsm3.js";import{p as Yt,b as _s}from"../chunks/DEkYYQ3O.js";import{g as hs}from"../chunks/CtNWh4s7.js";import{i as $s}from"../chunks/BW7Rn8V3.js";import{p as os}from"../chunks/3ElTuAwM.js";const Cs=!0,is=Cs,Ss=ms(!1);async function Ps(M=10,u=0){const f=localStorage.getItem("userToken");if(!f)throw new Error("Not authenticated");console.log("Checking window.LAMB_CONFIG in getAssistants:",window.LAMB_CONFIG,"typeof:",typeof window.LAMB_CONFIG),window.LAMB_CONFIG&&(console.log("Checking window.LAMB_CONFIG.api:",window.LAMB_CONFIG.api,"typeof:",typeof window.LAMB_CONFIG.api),window.LAMB_CONFIG.api&&console.log("Checking window.LAMB_CONFIG.api.lambServer:",window.LAMB_CONFIG.api.lambServer,"typeof:",typeof window.LAMB_CONFIG.api.lambServer));const q=new URLSearchParams({limit:M.toString(),offset:u.toString()}),C=ca(`/assistant/get_assistants?${q}`);console.log("Fetching assistants from absolute URL:",C),console.log(`Equivalent curl command:
curl -X GET "${C}" -H "Authorization: Bearer ${f}"`);const s=await fetch(C,{headers:{Authorization:`Bearer ${f}`,"Content-Type":"application/json"}});if(!s.ok){let l="Failed to fetch assistants";try{const d=await s.json();l=(d==null?void 0:d.detail)||l}catch{}throw console.error("API error response status:",s.status,"Detail:",l),new Error(l)}const g=await s.json();return{assistants:Array.isArray(g==null?void 0:g.assistants)?g.assistants:[],total_count:typeof(g==null?void 0:g.total_count)=="number"?g.total_count:0}}async function ns(M){const u=localStorage.getItem("userToken");if(!u)throw new Error("Not authenticated");const f=ca(`/assistant/get_assistant/${M}`);console.log("Fetching assistant by ID from absolute URL:",f);const q=await fetch(f,{headers:{Authorization:`Bearer ${u}`,"Content-Type":"application/json"}});if(!q.ok){let C=`Failed to fetch assistant with ID ${M}`;try{const s=await q.json();C=(s==null?void 0:s.detail)||C}catch{}throw console.error("API error response status:",q.status,"Detail:",C),new Error(C)}return await q.json()}async function Ns(M,u,f){const q=localStorage.getItem("userToken");if(!q)throw new Error("Not authenticated");const C=ca(`/assistant/unpublish_assistant/${M}/${u}?user_email=${encodeURIComponent(f)}`),s=await fetch(C,{method:"DELETE",headers:{Authorization:`Bearer ${q}`,"Content-Type":"application/json"}});if(!s.ok){let g="Failed to unpublish assistant";try{const l=await s.json();g=(l==null?void 0:l.detail)||g}catch{}throw console.error("Unpublish error:",s.status,g),new Error(g)}return await s.json()}async function Is(M){try{const u=localStorage.getItem("userToken");if(!u)throw new Error("Not authenticated");const f=localStorage.getItem("userEmail");if(!f)throw new Error("User email not found in localStorage");const q=ca(`/assistant/delete_assistant/${M}?owner=${encodeURIComponent(f)}`),C=await fetch(q,{method:"DELETE",headers:{Authorization:`Bearer ${u}`}});if(!C.ok){let g={detail:`Error: ${C.status}`};try{g=await C.json()}catch{}throw C.status===403?new Error("You do not have permission to delete this assistant"):C.status===404?new Error("Assistant not found"):new Error(g.detail||`Error: ${C.status}`)}const s=await C.text();return s?JSON.parse(s):{}}catch(u){throw console.error("Error deleting assistant:",u),u instanceof Error?u:new Error("An unknown error occurred during assistant deletion")}}async function xs(M){var q;const u=localStorage.getItem("userToken");if(!u)throw new Error("Not authenticated");const f=ca("/assistant/create_assistant");console.log("Creating assistant with data:",M);try{const C=await Dr.post(f,M,{headers:{Authorization:`Bearer ${u}`,"Content-Type":"application/json"}});return console.log("Assistant created successfully:",C.data),C.data}catch(C){console.error("Error creating assistant:",C);let s="Failed to create assistant.";if(Dr.isAxiosError(C)&&C.response){const g=C.response.data;if(console.error("API Error Response:",g),(q=g==null?void 0:g.detail)!=null&&q.includes("already exists for this owner")){const l=g.detail.match(/named '([^']+)' already exists/);s=`An assistant named '${l?l[1]:"this name"}' already exists. Please choose a different name.`}else s=(g==null?void 0:g.detail)||(g==null?void 0:g.message)||`Request failed with status ${C.response.status}`}else C instanceof Error&&(s=C.message);throw new Error(s)}}async function Ts(M,u){const f=localStorage.getItem("userToken");if(!f)throw new Error("Not authenticated");const q=["name","description","system_prompt","prompt_template","RAG_Top_k","RAG_collections","metadata"],C=Object.keys(u).filter(g=>q.includes(g)).reduce((g,l)=>{const d=g;return u[l]!==null&&u[l]!==void 0?d[l]=u[l]:l==="description"&&(d[l]=""),d},{}),s=ca(`/assistant/update_assistant/${M}`);console.log(`Updating assistant ${M} at URL:`,s),console.log("With data:",C);try{const g=await fetch(s,{method:"PUT",headers:{Authorization:`Bearer ${f}`,"Content-Type":"application/json"},body:JSON.stringify(C)});if(!g.ok){let l=`Failed to update assistant with ID ${M}`;try{const d=await g.json();l=(d==null?void 0:d.detail)||l}catch{}throw console.error("API error response status:",g.status,"Detail:",l),new Error(l)}return await g.json()}catch(g){console.error("Error updating assistant:",g);let l="Failed to update assistant.";throw g instanceof Error&&(l=g.message),new Error(l)}}async function Ds(M,u){const f=localStorage.getItem("userToken");if(!f)throw new Error("Not authenticated");const q=`/assistant/publish/${M}`,C=ca(q);console.log(`Setting publish status to ${u} for ${M} at ${C}`);const s="PUT";try{const g=await fetch(C,{method:s,headers:{Authorization:`Bearer ${f}`,"Content-Type":"application/json"},body:JSON.stringify({publish_status:u})});if(!g.ok){let l=`Failed to set publish status for assistant ${M}`;try{const d=await g.json();l=(d==null?void 0:d.detail)||l}catch{}throw console.error("API error response status:",g.status,"Detail:",l),new Error(l)}return await g.json()}catch(g){console.error("Error setting publish status:",g);let l="Failed to set publish status.";throw g instanceof Error&&(l=g.message),new Error(l)}}ma(["click"]);async function Ms(M,u,f,q,C){e(u)||(console.log("Manual refresh triggered..."),a(u,!0),await f(e(q),C),a(u,!1))}function Rs(M,u,f,q){e(u)>1&&f(e(u)-1,q)}function Ls(M,u,f,q,C){e(u)<e(f)&&q(e(u)+1,C)}var Fs=v('<p class="text-center text-gray-500 py-4"> </p>'),Bs=v('<div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative" role="alert"><strong class="font-bold"> </strong> <span class="block sm:inline"> </span></div>'),Us=v('<p class="text-center text-gray-500 py-4"> </p>'),Os=(M,u,f)=>u(e(f).id),js=v('<span class="inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800 px-2 py-0.5"> </span>'),Gs=v('<span class="inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800 px-2 py-0.5"> </span>'),Ks=(M,u,f)=>u(e(f).id),zs=(M,u,f)=>u("duplicate",{id:e(f).id,name:e(f).name}),qs=(M,u,f)=>u("export",{id:e(f).id}),Js=(M,u,f)=>u({detail:{assistantId:e(f).id,groupId:e(f).group_id,ownerEmail:e(f).owner}}),Vs=v('<button class="text-yellow-600 hover:text-yellow-900 p-1 rounded hover:bg-yellow-100 transition-colors duration-150"><!></button>'),Hs=(M,u,f)=>u("delete",{id:e(f).id,name:e(f).name,published:e(f).published}),Ws=v('<button class="text-red-600 hover:text-red-900 p-1 rounded hover:bg-red-100 transition-colors duration-150"><!></button>'),Ys=v('<tr class="bg-gray-50 border-b border-gray-200"><td colspan="2" class="px-6 py-2 text-sm"><div class="flex flex-wrap"><div class="mr-6 mb-1"><span class="text-brand font-medium"> </span> <span class="ml-1"> </span></div> <div><span class="text-brand font-medium"> </span> <span class="ml-1 truncate"> </span></div></div></td><td class="px-6 py-2"></td></tr>'),Zs=v('<tr class="bg-gray-50 border-b border-gray-200"><td colspan="2" class="px-6 py-2 text-sm"><div class="flex flex-wrap items-center"><span class="text-brand font-medium mr-1"> </span> <span class="mr-3"> </span> <span class="text-brand font-medium mr-1"> </span> <span class="mr-3"> </span> <span class="text-brand font-medium mr-1"> </span> <span class="mr-3"> </span> <span class="text-brand font-medium mr-1"> </span> <span> </span></div></td><td class="px-6 py-2"></td></tr> <!>',1),Xs=v('<tr class="bg-gray-50 border-b border-gray-200"><td colspan="2" class="px-6 py-2 text-sm text-gray-500"><span class="text-brand font-medium"> </span> <span class="ml-1"> </span></td><td class="px-6 py-2"></td></tr>'),Qs=v('<tr class="hover:bg-gray-50"><td class="px-6 py-4 whitespace-normal align-top"><button class="text-sm font-medium text-brand hover:underline break-words text-left"> </button> <div class="mt-1"><!></div></td><td class="px-6 py-4 align-top"><div class="text-sm text-gray-500 break-words max-w-md"> </div></td><td class="px-6 py-4 whitespace-nowrap text-sm font-medium align-top"><div class="flex items-center space-x-1 sm:space-x-2"><button class="text-green-600 hover:text-green-900 p-1 rounded hover:bg-green-100 transition-colors duration-150"><!></button> <button class="text-blue-600 hover:text-blue-900 p-1 rounded hover:bg-blue-100 transition-colors duration-150"><!></button> <button class="text-green-600 hover:text-green-900 p-1 rounded hover:bg-green-100 transition-colors duration-150"><!></button> <!></div> <div class="text-xs text-gray-400 mt-2"> </div></td></tr> <!>',1),eo=v('<div class="flex justify-center items-center mt-4 space-x-4 text-sm text-gray-700"><button class="p-1.5 font-medium bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"><span><!></span></button> <button class="px-3 py-1 font-medium bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"> </button> <span> <span class="mx-2">|</span> <span class="font-medium text-brand"> </span> <span class="font-medium text-brand"> </span> <span class="font-medium text-brand"> </span></span> <button class="px-3 py-1 font-medium bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"> </button></div>'),to=v('<div class="overflow-x-auto shadow-md sm:rounded-lg mb-6 border border-gray-200"><table class="min-w-full divide-y divide-gray-200"><thead class="bg-gray-50"><tr><th scope="col" class="px-6 py-3 text-left text-xs font-medium text-brand uppercase tracking-wider"> </th><th scope="col" class="px-6 py-3 text-left text-xs font-medium text-brand uppercase tracking-wider"> </th><th scope="col" class="px-6 py-3 text-left text-xs font-medium text-brand uppercase tracking-wider"> </th></tr></thead><tbody class="bg-white divide-y divide-gray-200"></tbody></table></div> <!>',1),ro=v('<div class="container mx-auto px-4 py-8"><!></div> <!>',1);function ao(M,u){la(u,!0);const[f,q]=ga(),C=()=>wr(rs,"$user",f),s=()=>wr(Ta,"$_",f),g=()=>wr(Ss,"$publishModalOpen",f);let l=w(!!fa(Na));const d=gs();let x=w(jt([])),O=w(!0),X=w(null),B=5,J=w(1),H=w(0),j=Wr(()=>Math.ceil(e(H)/B)),Ne=()=>{},ye=()=>{};Oa(()=>(Ne=Na.subscribe(T=>{T&&a(l,!0)}),ye=rs.subscribe(W=>{W.isLoggedIn?e(x).length===0&&!e(O)&&(console.log("User logged in, loading initial assistants..."),ve(1,B)):(console.log("User logged out, clearing assistants."),a(x,[],!0),a(H,0),a(J,1),a(X,null),a(O,!1))}),C().isLoggedIn&&(console.log("User already logged in on mount, loading initial assistants..."),ve(e(J),B)),()=>{Ne(),ye&&ye()}));let ue=w(!1);async function ve(T,W){a(O,!0),a(X,null);try{const le=(T-1)*W;console.log(`Calling getAssistants with limit=${W}, offset=${le}`);const ee=await Ps(W,le);console.log("Received data from getAssistants:",ee),a(x,ee.assistants,!0),a(H,ee.total_count,!0),a(J,T,!0)}catch(le){console.error("Error loading assistants:",le),a(X,le instanceof Error?le.message:"Failed to load assistants",!0),a(x,[],!0),a(H,0)}finally{a(O,!1)}await new Promise(le=>setTimeout(le,500)),a(O,!1)}function Z(T){console.log(`View assistant (navigate to detail view): ${T}`);const W=`${oa}/assistants?view=detail&id=${T}`;console.log("[AssistantsList] Navigating to view:",W),ia(W)}async function we(T){const W=Number(T.detail.assistantId),{groupId:le,ownerEmail:ee}=T.detail;if(!le||!ee){alert(e(l)?s()("assistants.unpublishErrorMissingData"):"Cannot unpublish: Missing group ID or owner email.");return}const se=e(x).find(je=>je.id===W),be=e(l)?s()("assistants.unpublishConfirm",{values:{name:(se==null?void 0:se.name)||W}}):`Are you sure you want to unpublish assistant ${W}?`;if(confirm(be))try{await Ns(W.toString(),le,ee),await ve(e(J),B),alert(e(l)?s()("assistants.unpublishSuccess"):"Assistant unpublished successfully!")}catch(je){console.error("Error unpublishing assistant:",je);const he=je instanceof Error?je.message:"Failed to unpublish assistant";a(X,he,!0),alert(e(l)?s()("assistants.unpublishError",{values:{error:he}}):`Error: ${he}`)}}function ne(T){if(!T)return{};try{return JSON.parse(T)}catch(W){return console.error("Error parsing metadata:",W,T),{}}}const Ve='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z" /><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" /></svg>',Re='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75c-.621 0-1.125-.504-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75" /></svg>',Ie='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" /></svg>',pe='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99" /></svg>',Q='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3" /></svg>',$e='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75c-.621 0-1.125-.504-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75" /></svg>';var _e=ro(),He=Je(_e),We=r(He);{var F=T=>{var W=Fs(),le=r(W,!0);t(W),p(ee=>i(le,ee),[()=>e(l)?s()("assistants.loading",{default:"Loading assistants..."}):"Loading assistants..."]),n(T,W)},k=(T,W)=>{{var le=se=>{var be=Bs(),je=r(be),he=r(je,!0);t(je);var ke=o(je,2),Y=r(ke,!0);t(ke),t(be),p(de=>{i(he,de),i(Y,e(X))},[()=>e(l)?s()("assistants.errorTitle"):"Error:"]),n(se,be)},ee=(se,be)=>{{var je=ke=>{var Y=Us(),de=r(Y,!0);t(Y),p(Me=>i(de,Me),[()=>e(l)?s()("assistants.noAssistants",{default:"No assistants found."}):"No assistants found."]),n(ke,Y)},he=ke=>{var Y=to(),de=Je(Y),Me=r(de),Tt=r(Me),tr=r(Tt),rr=r(tr),qr=r(rr,!0);t(rr);var Dt=o(rr),kr=r(Dt,!0);t(Dt);var Zt=o(Dt),ar=r(Zt,!0);t(Zt),t(tr),t(Tt);var sr=o(Tt);It(sr,21,()=>e(x),ae=>ae.id,(ae,oe)=>{var Ce=Qs(),tt=Je(Ce),fe=r(tt),me=r(fe);me.__click=[Os,Z,oe];var Ge=r(me,!0);t(me);var rt=o(me,2),Ye=r(rt);{var st=G=>{var V=js(),K=r(V,!0);t(V),p(re=>i(K,re),[()=>e(l)?s()("assistants.status.published",{default:"Published"}):"Published"]),n(G,V)},vt=G=>{var V=Gs(),K=r(V,!0);t(V),p(re=>i(K,re),[()=>e(l)?s()("assistants.status.unpublished",{default:"Unpublished"}):"Unpublished"]),n(G,V)};b(Ye,G=>{e(oe).published?G(st):G(vt,!1)})}t(rt),t(fe);var Ke=o(fe),Te=r(Ke),De=r(Te,!0);t(Te),t(Ke);var Ze=o(Ke),m=r(Ze),_=r(m);_.__click=[Ks,Z,oe];var S=r(_);sa(S,()=>Ve),t(_);var L=o(_,2);L.__click=[zs,d,oe];var U=r(L);sa(U,()=>Re),t(L);var Be=o(L,2);Be.__click=[qs,d,oe];var te=r(Be);sa(te,()=>Q),t(Be);var c=o(Be,2);{var h=G=>{var V=Vs();V.__click=[Js,we,oe];var K=r(V);sa(K,()=>$e),t(V),p(re=>ut(V,"title",re),[()=>e(l)?s()("assistants.actions.unpublish",{default:"Unpublish"}):"Unpublish"]),n(G,V)},I=G=>{var V=Ws();V.__click=[Hs,d,oe];var K=r(V);sa(K,()=>Ie),t(V),p(re=>ut(V,"title",re),[()=>e(l)?s()("assistants.actions.delete",{default:"Delete"}):"Delete"]),n(G,V)};b(c,G=>{e(oe).published?G(h):G(I,!1)})}t(m);var y=o(m,2),N=r(y);t(y),t(Ze),t(tt);var R=o(tt,2);{var z=G=>{var V=Zs();const K=Wr(()=>ne(e(oe).metadata));var re=Je(V),Le=r(re),Mt=r(Le),ir=r(Mt),Ar=r(ir);t(ir);var Se=o(ir,2),ge=r(Se,!0);t(Se);var Er=o(Se,2),pt=r(Er);t(Er);var Ue=o(Er,2),ft=r(Ue,!0);t(Ue);var ot=o(Ue,2),it=r(ot);t(ot);var wt=o(ot,2),Lr=r(wt,!0);t(wt);var nr=o(wt,2),Fr=r(nr);t(nr);var Xt=o(nr,2),Br=r(Xt,!0);t(Xt),t(Mt),t(Le),na(),t(re);var Ur=o(re,2);{var $r=_t=>{var kt=Ys(),lr=r(kt),Gt=r(lr),mt=r(Gt),At=r(mt),Et=r(At);t(At);var nt=o(At,2),Rt=r(nt,!0);t(nt),t(mt);var fr=o(mt,2),Lt=r(fr),Or=r(Lt);t(Lt);var Ft=o(Lt,2),dr=r(Ft,!0);t(Ft),t(fr),t(Gt),t(lr),na(),t(kt),p(($t,Cr,ht,Kt)=>{i(Et,`${$t??""}:`),i(Rt,Cr),i(Or,`${ht??""}:`),ut(Ft,"title",e(oe).RAG_collections||""),i(dr,Kt)},[()=>e(l)?s()("assistants.table.ragTopK",{default:"RAG Top K"}):"RAG Top K",()=>e(oe).RAG_Top_k??(e(l)?s()("assistants.notSet",{default:"Not set"}):"Not set"),()=>e(l)?s()("assistants.table.ragCollections",{default:"RAG Collections"}):"RAG Collections",()=>e(oe).RAG_collections||(e(l)?s()("assistants.notSet",{default:"Not set"}):"Not set")]),n(_t,kt)};b(Ur,_t=>{e(K).rag_processor==="simple_rag"&&_t($r)})}p((_t,kt,lr,Gt,mt,At,Et,nt)=>{i(Ar,`${_t??""}:`),i(ge,kt),i(pt,`${lr??""}:`),i(ft,Gt),i(it,`${mt??""}:`),i(Lr,At),i(Fr,`${Et??""}:`),i(Br,nt)},[()=>e(l)?s()("assistants.table.promptProcessor",{default:"Prompt Processor"}):"Prompt Processor",()=>e(K).prompt_processor||(e(l)?s()("assistants.notSet",{default:"Not set"}):"Not set"),()=>e(l)?s()("assistants.table.connector",{default:"Connector"}):"Connector",()=>e(K).connector||(e(l)?s()("assistants.notSet",{default:"Not set"}):"Not set"),()=>e(l)?s()("assistants.table.llm",{default:"LLM"}):"LLM",()=>e(K).llm||(e(l)?s()("assistants.notSet",{default:"Not set"}):"Not set"),()=>e(l)?s()("assistants.table.ragProcessor",{default:"RAG Processor"}):"RAG Processor",()=>e(K).rag_processor||(e(l)?s()("assistants.notSet",{default:"Not set"}):"Not set")]),n(G,V)},ie=G=>{var V=Xs(),K=r(V),re=r(K),Le=r(re);t(re);var Mt=o(re,2),ir=r(Mt,!0);t(Mt),t(K),na(),t(V),p((Ar,Se)=>{i(Le,`${Ar??""}:`),i(ir,Se)},[()=>e(l)?s()("assistants.table.config",{default:"Configuration"}):"Configuration",()=>e(l)?s()("assistants.notSet",{default:"Not available"}):"Not available"]),n(G,V)};b(R,G=>{e(oe).metadata?G(z):G(ie,!1)})}p((G,V,K,re)=>{i(Ge,e(oe).name||"-"),i(De,G),ut(_,"title",V),ut(L,"title",K),ut(Be,"title",re),i(N,`ID: ${e(oe).id??""}`)},[()=>e(oe).description||(e(l)?s()("assistants.noDescription",{default:"No description provided"}):"No description provided"),()=>e(l)?s()("assistants.actions.view",{default:"View"}):"View",()=>e(l)?s()("assistants.actions.duplicate",{default:"Duplicate"}):"Duplicate",()=>e(l)?s()("assistants.actions.export",{default:"Export JSON"}):"Export JSON"]),n(ae,Ce)}),t(sr),t(Me),t(de);var or=o(de,2);{var ce=ae=>{var oe=eo(),Ce=r(oe);Ce.__click=[Ms,ue,ve,J,B];var tt=r(Ce);let fe;var me=r(tt);sa(me,()=>pe),t(tt),t(Ce);var Ge=o(Ce,2);Ge.__click=[Rs,J,ve,B];var rt=r(Ge,!0);t(Ge);var Ye=o(Ge,2),st=r(Ye),vt=o(st,2),Ke=o(vt),Te=r(Ke,!0);t(Ke);var De=o(Ke),Ze=o(De),m=r(Ze,!0);t(Ze);var _=o(Ze),S=o(_),L=r(S,!0);t(S),t(Ye);var U=o(Ye,2);U.__click=[Ls,J,j,ve,B];var Be=r(U,!0);t(U),t(oe),p((te,c,h,I,y,N,R,z,ie,G)=>{Ce.disabled=e(O)||e(ue),ut(Ce,"title",te),fe=yt(tt,1,"",null,fe,c),Ge.disabled=e(J)===1||e(O),i(rt,h),i(st,`${I??""} ${e(J)??""} ${y??""} ${e(j)??""} `),i(vt,` ${N??""} `),i(Te,(e(J)-1)*B+1),i(De,` ${R??""} `),i(m,z),i(_,` ${ie??""} `),i(L,e(H)),U.disabled=e(J)===e(j)||e(O),i(Be,G)},[()=>e(l)?s()("common.refresh",{default:"Refresh"}):"Refresh",()=>({"animate-spin":e(ue)}),()=>e(l)?s()("pagination.previousShort",{default:"<"}):"<",()=>e(l)?s()("pagination.page",{default:"Page"}):"Page",()=>e(l)?s()("pagination.of",{default:"of"}):"of",()=>e(l)?s()("pagination.resultsSimple",{default:"Results"}):"Results",()=>e(l)?s()("pagination.to",{default:"to"}):"to",()=>Math.min(e(J)*B,e(H)),()=>e(l)?s()("pagination.of",{default:"of"}):"of",()=>e(l)?s()("pagination.nextShort",{default:">"}):">"]),n(ae,oe)};b(or,ae=>{e(j)>1&&ae(ce)})}p((ae,oe,Ce)=>{i(qr,ae),i(kr,oe),i(ar,Ce)},[()=>e(l)?s()("assistants.table.name",{default:"Assistant Name"}):"Assistant Name",()=>e(l)?s()("assistants.table.description",{default:"Description"}):"Description",()=>e(l)?s()("assistants.table.actions",{default:"Actions"}):"Actions"]),n(ke,Y)};b(se,ke=>{e(x).length===0&&e(H)===0?ke(je):ke(he,!1)},be)}};b(T,se=>{e(X)?se(le):se(ee,!1)},W)}};b(We,T=>{e(O)?T(F):T(k,!1)})}t(He);var P=o(He,2);{var A=T=>{};b(P,T=>{g()&&T(A)})}n(M,_e),da(),q()}ma(["click"]);const ls="lamb_assistant_capabilities",ds="lamb_assistant_defaults",so=60*60*1e3,ts={systemCapabilities:null,configDefaults:null,loading:!1,error:null,lastLoadedTimestamp:null};function cs(){return console.warn("Using hardcoded fallback defaults"),{config:{system_prompt:"You are a wise surfer dude and a helpful teaching assistant that uses Retrieval-Augmented Generation (RAG) to improve your answers.",prompt_template:`You are a wise surfer dude and a helpful teaching assistant that uses Retrieval-Augmented Generation (RAG) to improve your answers.
This is the user input: {user_input}
This is the context: {context}
Now answer the question:`,prompt_processor:"simple_augment",connector:"openai",llm:"gpt-4o-mini",rag_processor:"no_rag",RAG_Top_k:"3"}}}function us(){return console.warn("Using hardcoded fallback capabilities"),{prompt_processors:["simple_augment"],connectors:{openai:{models:["gpt-4o-mini","gpt-4"]}},rag_processors:["no_rag","simple_rag","single_file_rag"]}}function vs(M){const u=localStorage.getItem(M);if(!u)return null;try{const f=JSON.parse(u);if(Date.now()-f.timestamp<so)return f.value}catch(f){console.error(`Error reading cache for ${M}:`,f)}return localStorage.removeItem(M),null}function ps(M,u){try{const f={value:u,timestamp:Date.now()};localStorage.setItem(M,JSON.stringify(f))}catch(f){console.error(`Error setting cache for ${M}:`,f)}}function oo(){const{subscribe:M,set:u,update:f}=ms(ts);async function q(){var l;console.log("assistantConfigStore: loadConfig called (with caching).");let C=!1;if(f(d=>(C=d.loading,d)),C){console.log("assistantConfigStore: Config load already in progress...");return}console.log("assistantConfigStore: Checking cache...");let s=vs(ls),g=vs(ds);if(s&&g){console.log("assistantConfigStore: Config loaded from cache."),u({systemCapabilities:s,configDefaults:g,loading:!1,error:null,lastLoadedTimestamp:Date.now()});return}f(d=>({...d,loading:!0,error:null})),f(d=>({...ts,loading:!0,systemCapabilities:s,configDefaults:g})),console.log("assistantConfigStore: Cache miss or expired. Fetching fresh config...");try{if(!s)try{const d=Ua(),x=(l=d==null?void 0:d.api)==null?void 0:l.lambServer;if(!x)throw new Error("Lamb server base URL (lambServer) is not configured within config.api.");const O=`${x.replace(/\/$/,"")}/lamb/v1/completions/list`;console.log(`assistantConfigStore: Fetching capabilities from: ${O}`),s=(await Dr.get(O)).data,console.log("Fetched Capabilities (raw):",s),ps(ls,s)}catch(d){console.error("Error fetching system capabilities:",d),s=us()}if(!g)try{const d="/static/json/defaults.json";console.log(`assistantConfigStore: Fetching defaults from: ${d}`),g=(await Dr.get(d)).data,console.log("Fetched Defaults:",g),ps(ds,g)}catch(d){console.error("Error fetching defaults.json:",d),g=cs()}u({systemCapabilities:s,configDefaults:g,loading:!1,error:null,lastLoadedTimestamp:Date.now()})}catch(d){console.error("Error in loadConfig process:",d),f(x=>({...x,systemCapabilities:x.systemCapabilities||us(),configDefaults:x.configDefaults||cs(),loading:!1,error:d instanceof Error?d.message:"Failed to load assistant configuration"}))}}return{subscribe:M,loadConfig:q,reset:()=>{console.log("assistantConfigStore: Resetting store to initial state."),u(ts)}}}const Hr=oo();function io(M,u,f,q,C){e(u)&&f(e(u)),a(q,""),a(C,""),console.log("Switched back to VIEW mode")}async function no(M,u,f,q,C){console.log("Connector changed to:",e(u)),f(),await aa(),e(q).includes(e(C))||(a(C,e(q).length>0?e(q)[0]:"",!0),console.log("Resetting LLM to:",e(C)))}function lo(){var M;(M=document.getElementById("import-assistant-json"))==null||M.click()}var co=v(" <!>",1),uo=v('<div><button type="button" class="inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand"><svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"></path></svg> </button></div>'),vo=v('<div class="mt-3 p-3 border border-red-200 bg-red-50 rounded-md"><div class="flex"><div class="flex-shrink-0"><svg class="h-5 w-5 text-red-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path></svg></div> <div class="ml-3"><h3 class="text-sm font-medium text-red-800"> </h3> <p class="mt-1 text-sm text-red-700"> </p></div></div></div>'),po=v('<p class="text-center text-gray-600 py-10"> </p>'),fo=v('<p class="text-center text-red-600 py-10"> </p>'),mo=v('<p class="text-center text-gray-600 py-10"> </p>'),go=v('<input type="text" id="assistant-name" name="name" class="mt-1 block w-full px-3 py-2 border border-gray-300 bg-gray-100 rounded-md shadow-sm focus:outline-none focus:ring-brand focus:border-brand sm:text-sm">'),bo=v('<input type="text" id="assistant-name" name="name" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-brand focus:border-brand sm:text-sm">'),_o=(M,u,f)=>u(e(f)),ho=v('<button type="button" class="ml-1 px-2 py-0.5 text-xs bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 rounded focus:outline-none focus:ring-2 focus:ring-brand-500"> </button>'),xo=v('<div class="mt-2 p-3 bg-gray-50 border border-gray-200 rounded text-sm"><div class="text-xs text-gray-500 mb-1"> </div> <div class="whitespace-pre-wrap" data-testid="prompt-preview"><!></div></div>'),yo=v('<p class="mt-1 text-xs text-gray-500"> </p>'),wo=v(`<div class="mb-3"><label class="inline-flex items-center cursor-pointer"><input type="checkbox" class="sr-only peer"> <div class="relative w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"></div> <span class="ms-3 text-sm font-medium text-gray-900 dark:text-gray-300"> </span></label></div>`),ko=v("<option> </option>"),Ao=v('<div><label for="prompt-processor" class="block text-sm font-medium text-gray-700"> </label> <select id="prompt-processor" name="prompt_processor" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-brand focus:border-brand sm:text-sm"></select></div>'),Eo=v("<option> </option>"),$o=v('<div><label for="connector" class="block text-sm font-medium text-gray-700"> </label> <select id="connector" name="connector" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-brand focus:border-brand sm:text-sm"></select></div>'),Co=v("<option> </option>"),So=v("<option disabled> </option>"),Po=v("<option> </option>"),No=v('<div><label for="rag-top-k" class="block text-sm font-medium text-gray-700"> </label> <input type="number" id="rag-top-k" name="RAG_Top_k" min="1" max="10" class="mt-1 block w-24 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-brand focus:border-brand sm:text-sm disabled:bg-gray-100 disabled:cursor-not-allowed"> <p class="mt-1 text-xs text-gray-500"> </p></div>'),Io=v('<p class="text-sm text-gray-500"> </p>'),To=v('<p class="text-sm text-red-600"> </p>'),Do=v('<p class="text-sm text-gray-500"> </p>'),Mo=v('<label class="flex items-center space-x-2 cursor-pointer"><input type="checkbox" class="rounded border-gray-300 text-brand shadow-sm focus:border-brand focus:ring focus:ring-offset-0 focus:ring-brand focus:ring-opacity-50"> <span class="text-sm text-gray-700"> </span></label>'),Ro=v('<div class="mt-2 space-y-2 max-h-48 overflow-y-auto border rounded p-2" role="group" aria-labelledby="kb-group-label"><span id="kb-group-label" class="sr-only"> </span> <!></div>'),Lo=v('<div><h4 class="block text-sm font-medium text-gray-700 mb-1"> </h4> <!></div>'),Fo=v('<span class="ml-2 text-sm text-gray-500"> </span>'),Bo=v('<p class="mt-1 text-sm text-red-600"> </p>'),Uo=v('<p class="text-sm text-gray-500"> </p>'),Oo=v('<p class="text-sm text-red-600"> </p>'),jo=v('<p class="text-sm text-gray-500"> </p>'),Go=v('<label><input type="radio" name="file-selector" class="h-4 w-4 text-brand rounded focus:ring-brand"> <span class="text-sm text-gray-700"> </span></label>'),Ko=v('<p class="mt-1 text-xs text-red-500"> </p>'),zo=v('<div class="mt-2 space-y-2 max-h-48 overflow-y-auto border rounded p-2"></div> <!>',1),qo=v(`<div><h4 class="block text-sm font-medium text-gray-700 mb-1"> </h4> <div class="mb-4"><label for="file-upload" class="block text-sm text-gray-700"> </label> <div class="mt-1 flex items-center"><input id="file-upload" type="file" accept=".txt,.json,.md,.pdf,.doc,.docx" class="block w-full text-sm text-gray-500
														file:mr-4 file:py-2 file:px-4
														file:rounded-md file:border-0
														file:text-sm file:font-semibold
														file:bg-gray-50 file:text-gray-700
														hover:file:bg-gray-100 disabled:cursor-not-allowed"> <!></div> <!></div> <!></div>`),Jo=v('<div class="pt-4 border-t border-gray-200 space-y-4"><h4 class="text-md font-medium text-gray-700"> </h4> <!> <!> <!></div>'),Vo=v('<p class="text-sm text-red-600 mt-4 p-2 border border-red-200 bg-red-50 rounded"> </p>'),Ho=v('<p class="text-sm text-green-600 mt-4 p-2 border border-green-200 bg-green-50 rounded"> </p>'),Wo=v('<button type="button" class="py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed"> </button>'),Yo=v('<form class="space-y-6" id="assistant-form-main"><div class="flex flex-col md:flex-row md:space-x-6"><div class="md:w-2/3 space-y-6"><div><label for="assistant-name" class="block text-sm font-medium text-gray-700"> <span class="text-red-600">*</span></label> <!></div> <div><label for="assistant-description" class="block text-sm font-medium text-gray-700"> </label> <div class="mt-1 flex rounded-md shadow-sm"><textarea id="assistant-description" name="description" rows="3" class="flex-1 block w-full px-3 py-2 border border-blue-300 rounded-l-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-white"></textarea> <button type="button" class="relative -ml-px inline-flex items-center space-x-2 rounded-r-md border border-gray-300 bg-gray-50 px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand disabled:opacity-50 disabled:cursor-not-allowed"><span> </span></button></div> <p class="mt-1 text-xs text-gray-500"> </p></div> <div><label for="system-prompt" class="block text-sm font-medium text-gray-700"> </label> <textarea id="system-prompt" name="system_prompt" rows="4" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-brand focus:border-brand sm:text-sm"></textarea></div> <div><label for="prompt-template" class="block text-sm font-medium text-gray-700"> </label> <div class="mt-1 mb-2"><span class="text-xs text-gray-600 dark:text-gray-400"> </span> <!></div> <textarea id="prompt_template" rows="6" class="mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white"></textarea> <!> <!></div></div> <div class="md:w-1/3"><!> <fieldset class="border p-4 rounded-md space-y-4 h-full"><legend class="text-lg font-medium text-brand px-1"> </legend> <!> <!> <div><label for="llm" class="block text-sm font-medium text-gray-700"> </label> <select id="llm" name="llm" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-brand focus:border-brand sm:text-sm rounded-md"><!></select></div> <div><label for="rag-processor" class="block text-sm font-medium text-gray-700"> </label> <select id="rag-processor" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-brand focus:border-brand sm:text-sm rounded-md disabled:bg-gray-100 disabled:cursor-not-allowed"></select></div> <!></fieldset></div></div> <!> <!> <div class="pt-5"><div class="flex justify-end space-x-3"><!> <button type="submit" form="assistant-form-main" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-brand hover:bg-brand-hover focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand disabled:opacity-50 disabled:cursor-not-allowed" style="background-color: #2271b3;"><!></button></div></div></form>'),Zo=v('<div class="p-4 md:p-6 border rounded-md shadow-sm bg-white"><div class="mb-6 pb-4 border-b border-gray-200"><div class="flex justify-between items-center"><h2 class="text-2xl font-semibold text-brand"><!></h2> <!></div> <!></div> <!> <input type="file" id="import-assistant-json" accept=".json" style="display: none;"></div>');function fs(M,u){la(u,!0);const[f,q]=ga(),C=()=>wr(Hr,"$assistantConfigStore",f),s=()=>wr(Ta,"$_",f),g=[],l=[];console.log("AssistantForm.svelte: Initializing script...");const d=gs();let x=Yt(u,"assistant",3,null),O=Yt(u,"startInEdit",3,!1);console.log(`[AssistantForm] Received props: assistant=${!!x()}, startInEdit=${O()}`);let X=x()?"edit":"create";console.log(`[AssistantForm] Calculated initialMode: ${X}`);let B=w(jt(X)),J=w(null),H=w(""),j=w(""),Ne=w(""),ye=w(""),ue=w(3),ve=w(!1),Z=w(jt([])),we=w(jt([])),ne=w(jt([])),Ve=w(jt([])),Re=w(""),Ie=w(""),pe=w(""),Q=w(""),$e=w(jt([])),_e=w(jt([])),He=w(!1),We=w(""),F=w(!1),k=w(jt([])),P=w(""),A=w(!1),T=w(""),W=w(!1),le=w(""),ee=w(!1),se=w(""),be=w(!1),je=w(!1),he=w(!1),ke=w(""),Y=w(""),de=w(null),Me=w(jt([]));const Tt="e.g. Use the {context} to answer the question: {user_input}";function tr(c){return e(B)==="create",!0}function rr(c){if(!c)return"";let h=c;h=h.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;");for(const I of e(Me)){const y=I.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;");h=h.replace(new RegExp(y.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"g"),`<span class="bg-blue-100 text-blue-800 font-medium px-1 rounded">${y}</span>`)}return h}Yr(()=>{var I,y;console.log("AssistantForm.svelte: $effect (assistant prop) running...");const c=((I=x())==null?void 0:I.id)!==((y=e(J))==null?void 0:y.id),h=x()===null&&e(J)!==null||x()!==null&&e(J)===null;c||h?(console.log(`[AssistantForm] Assistant change detected (ID changed: ${c}, Null status changed: ${h})`),x()?(console.log("[AssistantForm] Assistant prop received or changed:",x()),console.log("Assistant prop received or changed:",x()),a(J,{...x()},!0),console.log("Stored initial assistant data:",e(J)),a(B,"edit"),console.log(`Initial formState set to: ${e(B)}`),Dt(x()),a(se,""),a(ke,"")):(console.log("No assistant prop, setting create mode."),a(B,"create"),a(J,null),e(he)&&qr())):x()&&(console.log("Assistant reference changed, repopulating fields (preserving description)."),Dt(x(),!0))}),ks(()=>(!e(he)&&!C().loading&&!C().systemCapabilities&&(console.log("AssistantForm.svelte: $effect.pre - Explicitly calling loadConfig()..."),Hr.loadConfig()),Hr.subscribe(h=>{if(!h.loading&&h.systemCapabilities&&h.configDefaults&&!e(he)){const I=h.systemCapabilities;console.log("Populating dropdown options from capabilities..."),a(Z,I.prompt_processors||[],!0),a(we,Object.keys(I.connectors||{}),!0),a(Ve,I.rag_processors||[],!0),a(he,!0),e(B)==="create"?(console.log("Applying defaults for CREATE mode..."),qr()):(console.log("Config loaded for VIEW/EDIT mode. Repopulating fields."),Dt(e(J)))}})));function qr(){var I,y;const c=((I=fa(Hr).configDefaults)==null?void 0:I.config)||{};a(Ne,c.system_prompt||"",!0),a(ye,c.prompt_template||"",!0),a(ue,parseInt(c.RAG_Top_k||"3",10)||3,!0),a(Re,c.prompt_processor||(e(Z).length>0?e(Z)[0]:""),!0),a(Ie,c.connector||(e(we).length>0?e(we)[0]:""),!0);let h=(y=c.rag_processor)==null?void 0:y.trim().toLowerCase();h==="no rag"&&(h="no_rag"),a(Q,h||(e(Ve).length>0?e(Ve)[0]:""),!0);try{a(Me,Array.isArray(c.rag_placeholders)?c.rag_placeholders:["{context}","{user_input}"],!0)}catch(N){console.warn("Could not load rag_placeholders from config, using defaults:",N),a(Me,["{context}","{user_input}"],!0)}Zt(),a(pe,c.llm||(e(ne).length>0?e(ne)[0]:""),!0),a(_e,[],!0),a(P,""),console.log("Form reset to defaults for CREATE:",{selectedPromptProcessor:e(Re),selectedConnector:e(Ie),selectedLlm:e(pe),selectedRagProcessor:e(Q)}),e(Q)==="simple_rag"&&aa().then(ar),e(Q)==="single_file_rag"&&aa().then(sr)}function Dt(c,h=!1){var I,y,N;if(c){if(console.log("Populating form fields from:",c),a(H,((I=c.name)==null?void 0:I.replace(/^\d+_/,""))||"",!0),h||a(j,c.description||"",!0),a(Ne,c.system_prompt||"",!0),a(ye,c.prompt_template||"",!0),a(ue,c.RAG_Top_k??3,!0),e(he)){a(Re,c.prompt_processor||(e(Z).length>0?e(Z)[0]:""),!0),a(Ie,c.connector||(e(we).length>0?e(we)[0]:""),!0),a(Q,c.rag_processor||(e(Ve).length>0?e(Ve)[0]:""),!0),Zt(),a(pe,c.llm||(e(ne).length>0?e(ne)[0]:""),!0),a(_e,((y=c.RAG_collections)==null?void 0:y.split(",").filter(Boolean))||[],!0);const R=((N=fa(Hr).configDefaults)==null?void 0:N.config)||{};try{a(Me,Array.isArray(R.rag_placeholders)?R.rag_placeholders:["{context}","{user_input}"],!0)}catch(z){console.warn("Could not load rag_placeholders from config in edit mode, using defaults:",z),a(Me,["{context}","{user_input}"],!0)}e(Q)==="simple_rag"&&!e(F)&&!e(He)&&(console.log("Populate: Triggering KB fetch"),aa().then(ar))}console.log("Form fields populated:",{name:e(H),description:e(j),selectedPromptProcessor:e(Re),selectedConnector:e(Ie),selectedLlm:e(pe),selectedRagProcessor:e(Q)})}}function kr(c){return c?Array.isArray(c.models)?c.models:Array.isArray(c.available_llms)?c.available_llms:typeof c.models=="object"&&c.models!==null?Object.keys(c.models):[]:[]}function Zt(){const c=fa(Hr);if(!c||!c.systemCapabilities||!c.systemCapabilities.connectors){a(ne,[],!0);return}const h=c.systemCapabilities.connectors[e(Ie)];a(ne,kr(h),!0)}async function ar(){if(e(He)||e(F)){console.log(`Skipping KB fetch (Loading: ${e(He)}, Attempted: ${e(F)})`);return}if(e(Q)!=="simple_rag"){console.log("Skipping KB fetch (RAG processor is not simple_rag)");return}console.log("Fetching knowledge bases..."),a(He,!0),a(We,"");try{const c=await hs();c.sort((h,I)=>h.name.localeCompare(I.name)),a($e,c,!0)}catch(c){console.error("Error fetching knowledge bases:",c),a(We,c instanceof Error?c.message:"Failed to load knowledge bases",!0),a($e,[],!0)}finally{a(He,!1),a(F,!0),console.log(`KB Fetch complete (Attempted: ${e(F)}, Error: '${e(We)}', Count: ${e($e).length})`)}}async function sr(){var c,h,I,y;if(e(A)){console.log("Skipping files fetch (already loading)");return}console.log("Fetching user files..."),a(A,!0),a(T,"");try{const N=ce();if(!N)throw new Error("Authentication token not found");const R=(h=(c=window.LAMB_CONFIG)==null?void 0:c.api)==null?void 0:h.lambServer;if(!R)throw new Error("LAMB server URL not configured in window.LAMB_CONFIG.api.lambServer");const ie=`${R.replace(/\/$/,"")}/creator/files/list`,G=await fetch(ie,{headers:{Authorization:`Bearer ${N}`}});if(!G.ok){const re=await G.text();throw new Error(`API error: ${G.status} - ${re||"Unknown error"}`)}const V=await G.json();a(k,V,!0);const K=((I=x())==null?void 0:I.metadata)||((y=x())==null?void 0:y.api_callback);if(K)try{const re=JSON.parse(K);re.file_path&&e(k).some(Le=>Le.path===re.file_path)&&a(P,re.file_path,!0)}catch(re){console.error("Error parsing metadata for file path:",re)}console.log(`Fetched ${e(k).length} files`)}catch(N){console.error("Error fetching user files:",N),a(T,N instanceof Error?N.message:"Failed to load files",!0),a(k,[],!0)}finally{a(A,!1),a(ee,!0)}}async function or(c){var y,N;const h=c.target;if(!h||!(h instanceof HTMLInputElement)||!h.files||h.files.length===0)return;const I=h.files[0];if(I){a(W,!0),a(le,"");try{const R=ce();if(!R)throw new Error("Authentication token not found");const z=(N=(y=window.LAMB_CONFIG)==null?void 0:y.api)==null?void 0:N.lambServer;if(!z)throw new Error("LAMB server URL not configured");const ie=new FormData;ie.append("file",I);const V=`${z.replace(/\/$/,"")}/creator/files/upload`,K=await fetch(V,{method:"POST",headers:{Authorization:`Bearer ${R}`},body:ie});if(!K.ok){const Le=await K.text();throw new Error(`API error: ${K.status} - ${Le||"Unknown error"}`)}const re=await K.json();console.log("File uploaded successfully:",re),await sr(),re.path&&a(P,re.path,!0),h.value=""}catch(R){console.error("Error uploading file:",R),a(le,R instanceof Error?R.message:"Failed to upload file",!0)}finally{a(W,!1)}}}function ce(){if(typeof localStorage<"u"){const c=localStorage.getItem("userToken");if(c)return console.debug("Auth token found in localStorage"),c}return console.debug("Token not found in localStorage, checking cookie"),document.cookie.replace(/(?:(?:^|.*;\\s*)token\\s*=\\s*([^;]*).*$)|^.*$/,"$1")}async function ae(){var I,y;if(!e(H).trim()){alert(s()("assistants.form.description.nameRequired",{default:"Please provide an assistant name first"}));return}const c=ce();if(console.debug("Auth token found:",c?"Yes (length: "+c.length+")":"No"),!c){console.error("Authentication token not found"),alert(s()("assistants.form.description.authError",{default:"Authentication error. Please try logging in again."}));return}a(je,!0);let h="";try{const N=(y=(I=window.LAMB_CONFIG)==null?void 0:I.api)==null?void 0:y.lambServer;if(!N)throw new Error("LAMB server URL not configured in window.LAMB_CONFIG.api.lambServer");const R=new AbortController,z=setTimeout(()=>R.abort(),15e3),G=`${N.replace(/\/$/,"")}/creator/assistant/generate_assistant_description`;console.debug("Calling generate_assistant_description at URL:",G);const V={name:e(H),instructions:e(Ne)||"",prompt_template:e(ye)||"",connector:e(Ie)||"",llm:e(pe)||"",rag_processor:e(Q)||""},K=await fetch(G,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify(V),signal:R.signal});if(clearTimeout(z),!K.ok){const Le=await K.text();throw console.error("API error response:",Le),K.status===403||K.status===401?new Error(`Authentication error (${K.status}): Please try logging in again.`):new Error(`API error: ${K.status} - ${Le||"Unknown error"}`)}const re=await K.json();if(re.description){let Le=re.description.trim().replace(/^["']|["']$/g,"");Le.length>500&&(Le=Le.substring(0,497)+"..."),a(j,Le,!0),console.log("Description generated successfully")}else throw new Error(re.error||"Failed to generate description")}catch(N){console.error("Error generating description:",N),N instanceof Error&&N.name==="AbortError"?h=s()("assistants.form.description.timeout",{default:"Request timed out. Please try again."}):h=N instanceof Error?N.message:s()("assistants.form.description.error",{default:"Failed to generate description"}),alert(h)}finally{a(je,!1)}}const oe=Wr(()=>e(Q)&&e(Q)!=="no_rag"),Ce=Wr(()=>e(Q)==="simple_rag"),tt=Wr(()=>e(Q)==="single_file_rag");Yr(()=>{console.log(`Effect: RAG processor changed to ${e(Q)}`),e(Q)==="simple_rag"&&e(he)?(console.log(`Effect: Checking KB fetch need (Attempted: ${e(F)})`),!e(F)&&!e(He)?(console.log("Effect: Conditions met (simple_rag, not attempted), calling fetchKnowledgeBases()"),ar()):console.log("Effect: Skipping KB fetch (already attempted or loading).")):e(Q)==="single_file_rag"&&e(he)?!e(ee)&&!e(A)?(console.log("Effect: Conditions met (single_file_rag, not attempted), calling fetchUserFiles()"),sr()):console.log("Effect: Skipping files fetch (already attempted or loading)."):((e($e).length>0||e(_e).length>0||e(We)||e(F))&&(console.log("Effect: Clearing KB state and fetch attempt flag"),a($e,[],!0),a(_e,[],!0),a(We,""),a(F,!1)),e(Q)!=="single_file_rag"&&(e(P)||e(k).length>0)&&a(P,""))});async function fe(c){var y,N,R;if(c.preventDefault(),a(se,""),a(ke,""),a(be,!0),!((y=e(H))!=null&&y.trim())){a(se,"Assistant Name is required."),a(be,!1);return}if(e(B)==="create"&&!e(ve)){const z=((N=fa(Hr).configDefaults)==null?void 0:N.config)||{};a(Re,z.prompt_processor||(e(Z).length>0?e(Z)[0]:""),!0),a(Ie,z.connector||(e(we).length>0?e(we)[0]:""),!0),await aa(),Zt(),e(ne).includes(e(pe))||a(pe,z.llm||(e(ne).length>0?e(ne)[0]:""),!0)}const h={prompt_processor:e(Re),connector:e(Ie),llm:e(pe),rag_processor:e(Q),file_path:e(Q)==="single_file_rag"?e(P):""},I={name:e(H).trim(),description:e(j),system_prompt:e(Ne),prompt_template:e(ye),RAG_Top_k:Number(e(ue))||3,RAG_collections:e(Q)==="simple_rag"?e(_e).join(","):"",metadata:JSON.stringify(h),pre_retrieval_endpoint:"",post_retrieval_endpoint:"",RAG_endpoint:""};try{let z;if(e(B)==="edit"&&((R=e(J))!=null&&R.id)){console.log("Submitting UPDATE for assistant:",e(J).id,I);const ie=await Ts(e(J).id.toString(),I);a(ke,"Assistant updated successfully!"),a(J,{...e(J),...I},!0),Dt(e(J)),d("formSuccess",{assistantId:e(J).id})}else if(e(B)==="create"){const ie=await xs(I);if(!(ie!=null&&ie.assistant_id))throw new Error("Create assistant response did not include an assistant_id.");a(ke,"Assistant created successfully!"),d("formSuccess",{assistantId:ie.assistant_id})}else throw new Error("Invalid form state for submission.")}catch(z){console.error(`Error ${e(B)==="edit"?"updating":"creating"} assistant:`,z),a(se,z instanceof Error?z.message:`Failed to ${e(B)==="edit"?"update":"create"} assistant`,!0),a(ke,"")}finally{a(be,!1)}}function me(c){const h=c.target,I=h.files;a(Y,"");let y=["Starting validation..."];if(I&&I.length>0){const N=I[0];if(console.log("Selected file:",N.name,N.type,N.size),N.type!=="application/json"&&!N.name.toLowerCase().endsWith(".json")){a(Y,s()("assistants.form.import.invalidFile",{default:"Invalid file type. Please select a .json file."}),!0),console.error(e(Y)),h.value="";return}const R=new FileReader;R.onload=async z=>{var G,V,K,re,Le,Mt,ir,Ar;const ie=(G=z.target)==null?void 0:G.result;if(typeof ie=="string"){console.log("--- Imported Assistant JSON Content ---"),console.log("-------------------------------------");let Se;try{Se=JSON.parse(ie),y.push("✅ JSON parsed successfully.")}catch(pt){y.push(`❌ Invalid JSON format: ${pt instanceof Error?pt.message:"Unknown JSON error"}`),Se=null}let ge=null;if(Se&&typeof Se=="object"){const Ue=fa(Hr).systemCapabilities;if(!Ue)y.push("⚠️ System capabilities not loaded. Skipping detailed validation.");else{y.push("ℹ️ System capabilities loaded. Performing detailed checks...");const ft=["name","system_prompt","metadata"];for(const it of ft)it in Se||y.push(`❌ Missing required field: ${it}`);const ot=Se.metadata||Se.api_callback;if(ot&&typeof ot=="string")try{if(ge=JSON.parse(ot),y.push("✅ Parsed metadata successfully."),ge.prompt_processor&&!((V=Ue.prompt_processors)!=null&&V.includes(ge.prompt_processor))&&y.push(`⚠️ Invalid prompt_processor: ${ge.prompt_processor}. Available: ${(K=Ue.prompt_processors)==null?void 0:K.join(", ")}`),ge.connector&&!((re=Ue.connectors)!=null&&re[ge.connector]))y.push(`⚠️ Invalid connector: ${ge.connector}. Available: ${Object.keys(Ue.connectors||{}).join(", ")}`);else if(ge.connector&&ge.llm){const it=(Le=Ue.connectors)==null?void 0:Le[ge.connector];if(it){const wt=kr(it);wt.includes(ge.llm)||y.push(`⚠️ Invalid llm for connector ${ge.connector}: ${ge.llm}. Available: ${wt.join(", ")}`)}else y.push(`⚠️ Could not retrieve capabilities for connector ${ge.connector}.`)}ge.rag_processor&&!((Mt=Ue.rag_processors)!=null&&Mt.includes(ge.rag_processor))&&y.push(`⚠️ Invalid rag_processor: ${ge.rag_processor}. Available: ${(ir=Ue.rag_processors)==null?void 0:ir.join(", ")}`),ge.rag_processor==="single_file_rag"&&!ge.file_path&&y.push("❌ Missing file_path in metadata for single_file_rag processor.")}catch(it){y.push(`❌ Error parsing metadata JSON: ${it instanceof Error?it.message:"Unknown error"}`)}else y.push("❌ metadata field is missing or not a string.");(ge==null?void 0:ge.rag_processor)==="simple_rag"&&((Se.RAG_Top_k===void 0||typeof Se.RAG_Top_k!="number")&&y.push(`⚠️ RAG_Top_k is missing or not a number (Required for simple_rag). Found: ${typeof Se.RAG_Top_k}`),(Se.RAG_collections===void 0||typeof Se.RAG_collections!="string")&&y.push(`⚠️ RAG_collections is missing or not a string (Required for simple_rag). Found: ${typeof Se.RAG_collections}`))}}else Se!==null&&y.push("❌ Imported data is not a valid JSON object.");if(console.log("--- Assistant Import Validation Results ---"),y.forEach(pt=>console.log(pt)),console.log("-------------------------------------------"),!y.some(pt=>pt.startsWith("❌"))&&Se&&ge)try{y.push("ℹ️ Populating form fields..."),a(H,Se.name||"",!0),a(j,Se.description||"",!0),a(Ne,Se.system_prompt||"",!0),a(ye,Se.prompt_template||"",!0),a(ue,Se.RAG_Top_k??3,!0),a(Re,ge.prompt_processor||(e(Z).length>0?e(Z)[0]:""),!0),a(Ie,ge.connector||(e(we).length>0?e(we)[0]:""),!0),a(Q,ge.rag_processor||(e(Ve).length>0?e(Ve)[0]:""),!0),Zt(),await aa(),e(ne).includes(ge.llm)?a(pe,ge.llm,!0):(a(pe,e(ne).length>0?e(ne)[0]:"",!0),y.push(`⚠️ Imported LLM '${ge.llm}' not available for connector '${e(Ie)}'. Defaulting to '${e(pe)}'.`)),e(Q)==="simple_rag"?(a(_e,((Ar=Se.RAG_collections)==null?void 0:Ar.split(",").filter(Boolean))||[],!0),a(P,""),e(F)||ar()):e(Q)==="single_file_rag"?(a(P,ge.file_path||"",!0),a(_e,[],!0),e(ee)||sr()):(a(_e,[],!0),a(P,"")),y.push("✅ Form fields populated successfully."),a(Y,""),a(ke,s()("assistants.form.import.success",{default:"Assistant data imported successfully! Please review and save."}),!0),setTimeout(()=>{a(ke,"")},5e3)}catch(pt){y.push(`❌ Error populating form: ${pt instanceof Error?pt.message:"Unknown population error"}`),a(Y,s()("assistants.form.import.populationError",{default:"Error populating form from imported data. Check console."}),!0)}else a(Y,s()("assistants.form.import.validationFailed",{default:"Import validation failed. Form not populated. Check console for details."}),!0)}else console.error("Failed to read file content as string."),a(Y,s()("assistants.form.import.readError",{default:"Could not read file content."}),!0),y.push(`❌ ${e(Y)}`)},R.onerror=z=>{console.error("Error reading file:",z),a(Y,s()("assistants.form.import.fileReadError",{default:"Error reading the selected file."}),!0),y.push(`❌ ${e(Y)}`)},R.readAsText(N)}h.value=""}function Ge(c){if(e(de)){const h=e(de).selectionStart,I=e(de).selectionEnd,y=e(ye);a(ye,y.substring(0,h)+c+y.substring(I)),e(de).focus(),aa().then(()=>{e(de)&&(e(de).selectionStart=e(de).selectionEnd=h+c.length)})}}var rt=Zo(),Ye=r(rt),st=r(Ye),vt=r(st),Ke=r(vt);{var Te=c=>{var h=yr();p(I=>i(h,I),[()=>s()("assistants.form.titleCreate",{default:"Create New Assistant"})]),n(c,h)},De=c=>{var h=co(),I=Je(h),y=o(I);{var N=R=>{var z=yr();p(()=>i(z,`(ID: ${e(J).id??""})`)),n(R,z)};b(y,R=>{var z;(z=e(J))!=null&&z.id&&R(N)})}p(R=>i(I,`${R??""} `),[()=>s()("assistants.form.titleViewEdit",{default:"Assistant Details"})]),n(c,h)};b(Ke,c=>{e(B)==="create"?c(Te):c(De,!1)})}t(vt);var Ze=o(vt,2);{var m=c=>{var h=uo(),I=r(h);I.__click=[lo];var y=o(r(I));t(I),t(h),p(N=>i(y,` ${N??""}`),[()=>s()("assistants.form.import.button",{default:"Import from JSON"})]),n(c,h)};b(Ze,c=>{e(B)==="create"&&c(m)})}t(st);var _=o(st,2);{var S=c=>{var h=vo(),I=r(h),y=o(r(I),2),N=r(y),R=r(N,!0);t(N);var z=o(N,2),ie=r(z,!0);t(z),t(y),t(I),t(h),p(G=>{i(R,G),i(ie,e(Y))},[()=>s()("assistants.form.import.error",{default:"Import Error"})]),n(c,h)};b(_,c=>{e(Y)&&c(S)})}t(Ye);var L=o(Ye,2);{var U=c=>{var h=po(),I=r(h,!0);t(h),p(y=>i(I,y),[()=>s()("assistants.loadingConfig",{default:"Loading configuration..."})]),n(c,h)},Be=(c,h)=>{{var I=N=>{var R=fo(),z=r(R);t(R),p(ie=>i(z,`${ie??""} ${C().error??""}`),[()=>s()("assistants.errorConfig",{default:"Error loading configuration:"})]),n(N,R)},y=(N,R)=>{{var z=G=>{var V=mo(),K=r(V,!0);t(V),p(re=>i(K,re),[()=>s()("assistants.initializingForm",{default:"Initializing form..."})]),n(G,V)},ie=G=>{var V=Yo(),K=r(V),re=r(K),Le=r(re),Mt=r(Le),ir=r(Mt);na(),t(Mt);var Ar=o(Mt,2);{var Se=$=>{var E=go();Tr(E),E.disabled=!0,p(D=>ut(E,"placeholder",D),[()=>s()("assistants.form.name.placeholder")]),Mr(E,()=>e(H),D=>a(H,D)),n($,E)},ge=$=>{var E=bo();Tr(E),E.disabled=!1,p(D=>ut(E,"placeholder",D),[()=>s()("assistants.form.name.placeholder")]),Mr(E,()=>e(H),D=>a(H,D)),n($,E)};b(Ar,$=>{e(B)==="edit"?$(Se):$(ge,!1)})}t(Le);var Er=o(Le,2),pt=r(Er),Ue=r(pt,!0);t(pt);var ft=o(pt,2),ot=r(ft);Qa(ot),ot.disabled=!1;var it=o(ot,2);it.__click=ae;var wt=r(it),Lr=r(wt,!0);t(wt),t(it),t(ft);var nr=o(ft,2),Fr=r(nr,!0);t(nr),t(Er);var Xt=o(Er,2),Br=r(Xt),Ur=r(Br,!0);t(Br);var $r=o(Br,2);Qa($r),$r.disabled=!1,t(Xt);var _t=o(Xt,2),kt=r(_t),lr=r(kt,!0);t(kt);var Gt=o(kt,2),mt=r(Gt),At=r(mt);t(mt);var Et=o(mt,2);It(Et,17,()=>e(Me),pr,($,E)=>{var D=ho();D.__click=[_o,Ge,E];var xe=r(D,!0);t(D),p(()=>i(xe,e(E))),n($,D)}),t(Gt);var nt=o(Gt,2);Qa(nt),ut(nt,"placeholder",Tt),_s(nt,$=>a(de,$),()=>e(de));var Rt=o(nt,2);{var fr=$=>{var E=xo(),D=r(E),xe=r(D,!0);t(D);var Pe=o(D,2),Ae=r(Pe);sa(Ae,()=>rr(e(ye))),t(Pe),t(E),p(Ee=>i(xe,Ee),[()=>s()("preview")||"Preview with highlighted placeholders:"]),n($,E)};b(Rt,$=>{e(ye)&&$(fr)})}var Lt=o(Rt,2);{var Or=$=>{var E=yo(),D=r(E,!0);t(E),p(xe=>i(D,xe),[()=>s()("assistants.form.promptTemplate.help",{default:"This processor requires a valid prompt template."})]),n($,E)};b(Lt,$=>{e(Re)==="template_validator_processor"&&$(Or)})}t(_t),t(re);var Ft=o(re,2),dr=r(Ft);{var $t=$=>{var E=wo(),D=r(E),xe=r(D);Tr(xe);var Pe=o(xe,4),Ae=r(Pe,!0);t(Pe),t(D),t(E),p(Ee=>i(Ae,Ee),[()=>s()("assistants.form.advancedMode")||"Advanced Mode"]),Es(xe,()=>e(ve),Ee=>a(ve,Ee)),n($,E)};b(dr,$=>{e(B)==="create"&&$($t)})}var Cr=o(dr,2),ht=r(Cr),Kt=r(ht,!0);t(ht);var zt=o(ht,2);{var Sr=$=>{var E=Ao(),D=r(E),xe=r(D,!0);t(D);var Pe=o(D,2);Pe.disabled=!1,It(Pe,21,()=>e(Z),pr,(Ae,Ee)=>{var Oe=ko(),ze={},Ct=r(Oe,!0);t(Oe),p(()=>{ze!==(ze=e(Ee))&&(Oe.value=(Oe.__value=e(Ee))??""),i(Ct,e(Ee))}),n(Ae,Oe)}),t(Pe),t(E),p(Ae=>i(xe,Ae),[()=>s()("assistants.form.promptProcessor.label",{default:"Prompt Processor"})]),Ba(Pe,()=>e(Re),Ae=>a(Re,Ae)),n($,E)};b(zt,$=>{(e(ve)||e(B)==="edit")&&$(Sr)})}var Zr=o(zt,2);{var Xr=$=>{var E=$o(),D=r(E),xe=r(D,!0);t(D);var Pe=o(D,2);Pe.__change=[no,Ie,Zt,ne,pe],Pe.disabled=!1,It(Pe,21,()=>e(we),pr,(Ae,Ee)=>{var Oe=Eo(),ze={},Ct=r(Oe,!0);t(Oe),p(()=>{ze!==(ze=e(Ee))&&(Oe.value=(Oe.__value=e(Ee))??""),i(Ct,e(Ee))}),n(Ae,Oe)}),t(Pe),t(E),p(Ae=>i(xe,Ae),[()=>s()("assistants.form.connector.label",{default:"Connector"})]),Ba(Pe,()=>e(Ie),Ae=>a(Ie,Ae)),n($,E)};b(Zr,$=>{(e(ve)||e(B)==="edit")&&$(Xr)})}var jr=o(Zr,2),Qr=r(jr),ja=r(Qr,!0);t(Qr);var ea=o(Qr,2),Ga=r(ea);{var ba=$=>{var E=Rr(),D=Je(E);It(D,17,()=>e(ne),pr,(xe,Pe)=>{var Ae=Co(),Ee={},Oe=r(Ae,!0);t(Ae),p(()=>{Ee!==(Ee=e(Pe))&&(Ae.value=(Ae.__value=e(Pe))??""),i(Oe,e(Pe))}),n(xe,Ae)}),n($,E)},_a=$=>{var E=So();E.value=E.__value="";var D=r(E,!0);t(E),p(xe=>i(D,xe),[()=>s()("assistants.form.llm.noneAvailable",{default:"No models available for selected connector"})]),n($,E)};b(Ga,$=>{e(ne).length>0?$(ba):$(_a,!1)})}t(ea),t(jr);var ha=o(jr,2),ua=r(ha),Ka=r(ua,!0);t(ua);var Jr=o(ua,2);It(Jr,21,()=>e(Ve),pr,($,E)=>{var D=Po(),xe={},Pe=r(D,!0);t(D),p(Ae=>{xe!==(xe=e(E))&&(D.value=(D.__value=e(E))??""),i(Pe,Ae)},[()=>e(E).replace(/_/g," ").replace(/\b\w/g,Ae=>Ae.toUpperCase())]),n($,D)}),t(Jr),t(ha);var xa=o(ha,2);{var za=$=>{var E=Jo(),D=r(E),xe=r(D,!0);t(D);var Pe=o(D,2);{var Ae=at=>{var bt=No(),lt=r(bt),mr=r(lt,!0);t(lt);var St=o(lt,2);Tr(St),St.disabled=!1;var Bt=o(St,2),Gr=r(Bt,!0);t(Bt),t(bt),p((et,xt)=>{i(mr,et),i(Gr,xt)},[()=>s()("assistants.form.ragTopK.label",{default:"RAG Top K"}),()=>s()("assistants.form.ragTopK.help",{default:"Number of relevant documents to retrieve (1-10)."})]),Mr(St,()=>e(ue),et=>a(ue,et)),n(at,bt)};b(Pe,at=>{e(Q)==="simple_rag"&&at(Ae)})}var Ee=o(Pe,2);{var Oe=at=>{var bt=Lo(),lt=r(bt),mr=r(lt,!0);t(lt);var St=o(lt,2);{var Bt=et=>{var xt=Io(),gr=r(xt,!0);t(xt),p(cr=>i(gr,cr),[()=>s()("assistants.form.knowledgeBases.loading",{default:"Loading knowledge bases..."})]),n(et,xt)},Gr=(et,xt)=>{{var gr=ur=>{var Qt=To(),Pr=r(Qt);t(Qt),p(br=>i(Pr,`${br??""} ${e(We)??""}`),[()=>s()("assistants.form.knowledgeBases.error",{default:"Error loading knowledge bases:"})]),n(ur,Qt)},cr=(ur,Qt)=>{{var Pr=Jt=>{var Fe=Do(),qe=r(Fe,!0);t(Fe),p(Ut=>i(qe,Ut),[()=>s()("assistants.form.knowledgeBases.noneFound",{default:"No accessible knowledge bases found."})]),n(Jt,Fe)},br=Jt=>{var Fe=Ro(),qe=r(Fe),Ut=r(qe,!0);t(qe);var _r=o(qe,2);It(_r,17,()=>e($e),Pt=>Pt.id,(Pt,Xe)=>{var Ot=Mo(),Nt=r(Ot);Tr(Nt);var er;Nt.disabled=!1;var Vt=o(Nt,2),hr=r(Vt,!0);t(Vt),t(Ot),p(()=>{er!==(er=e(Xe).id)&&(Nt.value=(Nt.__value=e(Xe).id)??""),i(hr,e(Xe).name)}),ss(g,[],Nt,()=>(e(Xe).id,e(_e)),Nr=>a(_e,Nr)),n(Pt,Ot)}),t(Fe),p(Pt=>i(Ut,Pt),[()=>s()("assistants.form.knowledgeBases.label",{default:"Knowledge Bases"})]),n(Jt,Fe)};b(ur,Jt=>{e($e).length===0?Jt(Pr):Jt(br,!1)},Qt)}};b(et,ur=>{e(We)?ur(gr):ur(cr,!1)},xt)}};b(St,et=>{e(He)?et(Bt):et(Gr,!1)})}t(bt),p(et=>i(mr,et),[()=>s()("assistants.form.knowledgeBases.label",{default:"Knowledge Bases"})]),n(at,bt)};b(Ee,at=>{e(Ce)&&at(Oe)})}var ze=o(Ee,2);{var Ct=at=>{var bt=qo(),lt=r(bt),mr=r(lt,!0);t(lt);var St=o(lt,2),Bt=r(St),Gr=r(Bt,!0);t(Bt);var et=o(Bt,2),xt=r(et);xt.__change=or;var gr=o(xt,2);{var cr=Fe=>{var qe=Fo(),Ut=r(qe,!0);t(qe),p(_r=>i(Ut,_r),[()=>s()("assistants.form.singleFile.uploading",{default:"Uploading..."})]),n(Fe,qe)};b(gr,Fe=>{e(W)&&Fe(cr)})}t(et);var ur=o(et,2);{var Qt=Fe=>{var qe=Bo(),Ut=r(qe,!0);t(qe),p(()=>i(Ut,e(le))),n(Fe,qe)};b(ur,Fe=>{e(le)&&Fe(Qt)})}t(St);var Pr=o(St,2);{var br=Fe=>{var qe=Uo(),Ut=r(qe,!0);t(qe),p(_r=>i(Ut,_r),[()=>s()("assistants.form.singleFile.loading",{default:"Loading files..."})]),n(Fe,qe)},Jt=(Fe,qe)=>{{var Ut=Pt=>{var Xe=Oo(),Ot=r(Xe);t(Xe),p(Nt=>i(Ot,`${Nt??""} ${e(T)??""}`),[()=>s()("assistants.form.singleFile.error",{default:"Error loading files:"})]),n(Pt,Xe)},_r=(Pt,Xe)=>{{var Ot=er=>{var Vt=jo(),hr=r(Vt,!0);t(Vt),p(Nr=>i(hr,Nr),[()=>s()("assistants.form.singleFile.noneFound",{default:"No files found. Please upload a file."})]),n(er,Vt)},Nt=er=>{var Vt=zo(),hr=Je(Vt);It(hr,21,()=>e(k),Kr=>Kr.path,(Kr,xr)=>{var dt=Go(),ct=r(dt);Tr(ct);var Ht;ct.disabled=!1;var Vr=o(ct,2),zr=r(Vr,!0);t(Vr),t(dt),p(()=>{yt(dt,1,`flex items-center space-x-2 p-1 cursor-pointer ${e(P)===e(xr).path?"bg-blue-50":"hover:bg-gray-50"}`),Ht!==(Ht=e(xr).path)&&(ct.value=(ct.__value=e(xr).path)??""),i(zr,e(xr).name)}),ss(l,[],ct,()=>(e(xr).path,e(P)),ta=>a(P,ta)),n(Kr,dt)}),t(hr);var Nr=o(hr,2);{var $a=Kr=>{var xr=Ko(),dt=r(xr,!0);t(xr),p(ct=>i(dt,ct),[()=>s()("assistants.form.singleFile.required",{default:"Please select a file"})]),n(Kr,xr)};b(Nr,Kr=>{!e(P)&&e(B)==="edit"&&Kr($a)})}n(er,Vt)};b(Pt,er=>{e(k).length===0?er(Ot):er(Nt,!1)},Xe)}};b(Fe,Pt=>{e(T)?Pt(Ut):Pt(_r,!1)},qe)}};b(Pr,Fe=>{e(A)?Fe(br):Fe(Jt,!1)})}t(bt),p((Fe,qe)=>{i(mr,Fe),i(Gr,qe),xt.disabled=e(W)},[()=>s()("assistants.form.singleFile.label",{default:"Select File"}),()=>s()("assistants.form.singleFile.upload",{default:"Upload New File"})]),n(at,bt)};b(ze,at=>{e(tt)&&at(Ct)})}t(E),p(at=>i(xe,at),[()=>s()("assistants.form.ragOptions.title",{default:"RAG Options"})]),n($,E)};b(xa,$=>{e(oe)&&$(za)})}t(Cr),t(Ft),t(K);var ya=o(K,2);{var qa=$=>{var E=Vo(),D=r(E);t(E),p(()=>i(D,`Error: ${e(se)??""}`)),n($,E)};b(ya,$=>{e(se)&&$(qa)})}var wa=o(ya,2);{var ka=$=>{var E=Ho(),D=r(E,!0);t(E),p(()=>i(D,e(ke))),n($,E)};b(wa,$=>{e(ke)&&e(B)!=="edit"&&$(ka)})}var Da=o(wa,2),Aa=r(Da),Ma=r(Aa);{var Ja=$=>{var E=Wo();E.__click=[io,J,Dt,se,ke];var D=r(E,!0);t(E),p(xe=>{E.disabled=e(be),i(D,xe)},[()=>s()("common.cancel",{default:"Cancel"})]),n($,E)};b(Ma,$=>{e(B)==="edit"&&$(Ja)})}var Ea=o(Ma,2),Qe=r(Ea);{var gt=$=>{var E=yr();p(D=>i(E,D),[()=>e(be)?s()("common.saving",{default:"Saving..."}):s()("common.save",{default:"Save"})]),n($,E)},qt=$=>{var E=yr();p(D=>i(E,D),[()=>e(be)?s()("common.saving",{default:"Saving..."}):s()("common.saveChanges",{default:"Save Changes"})]),n($,E)};b(Qe,$=>{e(B)==="create"?$(gt):$(qt,!1)})}t(Ea),t(Aa),t(Da),t(V),p(($,E,D,xe,Pe,Ae,Ee,Oe,ze,Ct,at,bt,lt)=>{i(ir,`${$??""} `),i(Ue,E),ut(ot,"placeholder",D),it.disabled=e(je),i(Lr,xe),i(Fr,Pe),i(Ur,Ae),ut($r,"placeholder",Ee),i(lr,Oe),i(At,`${ze??""}:`),nt.disabled=Ct,i(Kt,at),i(ja,bt),ea.disabled=e(ne).length===0,i(Ka,lt),Jr.disabled=e(B)==="edit",Ea.disabled=e(be)||e(B)==="create"&&!C().systemCapabilities},[()=>s()("assistants.form.name.label"),()=>s()("assistants.form.description.label",{default:"Description"}),()=>s()("assistants.form.description.placeholder",{default:"A brief summary of the assistant"}),()=>e(je)?s()("assistants.form.description.generating",{default:"Generating..."}):s()("assistants.form.description.generateButton",{default:"Generate"}),()=>s()("assistants.form.description.help",{default:"Click Generate after filling in name and prompts."}),()=>s()("assistants.form.systemPrompt.label",{default:"System Prompt"}),()=>s()("assistants.form.systemPrompt.placeholder",{default:"Define the assistant's role and personality..."}),()=>s()("assistants.form.promptTemplate.label",{default:"Prompt Template"}),()=>s()("insert_placeholder")||"Insert placeholder:",()=>!tr(),()=>s()("assistants.form.configSection.title",{default:"Configuration"}),()=>s()("assistants.form.llm.label",{default:"Language Model (LLM)"}),()=>s()("assistants.form.ragProcessor.label")]),vr("submit",V,fe),Mr(ot,()=>e(j),$=>a(j,$)),Mr($r,()=>e(Ne),$=>a(Ne,$)),Mr(nt,()=>e(ye),$=>a(ye,$)),Ba(ea,()=>e(pe),$=>a(pe,$)),Ba(Jr,()=>e(Q),$=>a(Q,$)),n(G,V)};b(N,G=>{e(he)?G(ie,!1):G(z)},R)}};b(c,N=>{C().error?N(I):N(y,!1)},h)}};b(L,c=>{C().loading&&!e(he)?c(U):c(Be,!1)})}var te=o(L,2);te.__change=me,t(rt),n(M,rt),da(),q()}ma(["click","change"]);var Xo=v('<span class="italic"> </span>'),Qo=v('<p class="whitespace-pre-wrap"> </p>'),ei=v("<div><div><!></div></div>"),ti=v('<div class="flex justify-start"><div class="max-w-xs md:max-w-md lg:max-w-lg xl:max-w-xl px-4 py-2 rounded-lg shadow bg-gray-200 text-gray-800 italic">Thinking...</div></div>'),ri=Ia('<svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>'),ai=v('<div class="flex flex-col h-full chat-max-height border border-gray-300 rounded-md overflow-hidden shadow-sm svelte-18hjw8q"><div class="p-2 border-b border-gray-200 bg-gray-50 flex items-center justify-between"><h2 class="text-lg font-semibold text-gray-700">Chat</h2> <!></div> <div class="flex-grow p-4 overflow-y-auto space-y-4 bg-white"><!> <!></div> <div class="p-3 border-t border-gray-200 bg-gray-50"><form class="flex items-center space-x-2"><input type="text" placeholder="Type your message..." class="flex-grow border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100"> <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed"><!></button></form></div></div>');function si(M,u){la(u,!0);let f=Yt(u,"apiUrl",3,""),q=Yt(u,"apiKey",3,""),C=Yt(u,"initialModel",3,null),s=Yt(u,"assistantId",3,null),g=w(jt([])),l=w(""),d=w(!1),x=w(jt([])),O=w(jt(C()??"gpt-3.5-turbo")),X=w(!1),B=w(null),J=w(!1),H=w(null);function j(F){const k=new Date().toISOString().split("T")[1].replace("Z","");console.log(`[${k}] CHAT: ${F}`)}async function Ne(){if(!f()||!q()){a(B,"API URL or API Key is not configured."),console.error(e(B));return}a(X,!0),a(B,null),j(`Fetching models from ${f()}/models`);try{const F=await fetch(`${f()}/models`,{method:"GET",headers:{Authorization:`Bearer ${q()}`}});if(!F.ok)throw new Error(`Failed to fetch models: ${F.status}`);const k=await F.json();if(k.data&&Array.isArray(k.data)){const P=k.data.map(A=>A.id).sort();if(a(x,P,!0),j(`Models loaded: ${P.join(", ")}`),P.length>0&&(!e(O)||!P.includes(e(O)))){if(C()&&P.includes(C()))a(O,C());else{const A=P.filter(T=>T.includes("gpt"));a(O,A.length>0?A[0]:P[0],!0)}j(`Selected model set to: ${e(O)}`)}}else throw new Error("Invalid model data format")}catch(F){const k=F instanceof Error?F.message:"Failed to load models";a(B,k,!0),console.error("Error fetching models:",F),a(x,["gpt-3.5-turbo","gpt-4"],!0),(!e(O)||!e(x).includes(e(O)))&&a(O,e(x)[0],!0),j(`Using fallback models due to error. Selected: ${e(O)}`)}finally{a(X,!1)}}async function ye(){if(!e(l).trim()||e(d)||!f()||!q())return;j(`Submitting message with model: ${e(O)}`),a(d,!0),a(J,!0);const F={id:Date.now().toString(),role:"user",content:e(l)};a(g,[...e(g),F],!0);const k={model:s()?`lamb_assistant.${s()}`:e(O),messages:e(g).map(({role:T,content:W})=>({role:T,content:W})),stream:!0};j(`Using model: ${k.model}`),a(l,"");const P=(Date.now()+1).toString();a(g,[...e(g),{id:P,role:"assistant",content:""}],!0);let A="";try{j(`Sending request to ${f()}/chat/completions`);const T=await fetch(`${f()}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${q()}`},body:JSON.stringify(k)});if(!T.ok){const se=await T.text();throw new Error(`API Error: ${T.status} - ${se}`)}if(!T.body)throw new Error("Response body is null");const W=T.body.getReader(),le=new TextDecoder;let ee="";for(j("Starting stream processing");;){const{done:se,value:be}=await W.read();if(se){j("Stream finished.");break}ee+=le.decode(be,{stream:!0});const je=ee.split(`
`);ee=je.pop()||"";for(const he of je){if(he.trim()===""||!he.startsWith("data: "))continue;const ke=he.substring(5).trim();if(ke==="[DONE]"){j("Received [DONE] signal");continue}try{const Y=JSON.parse(ke);if(Y.choices&&Y.choices[0]&&Y.choices[0].delta){const de=Y.choices[0].delta.content;de&&(A+=de,a(g,e(g).map(Me=>Me.id===P?{...Me,content:A}:Me),!0))}else j(`Received non-delta data chunk: ${ke.slice(0,100)}...`)}catch(Y){j(`Error parsing JSON line: ${he} - Error: ${Y}`)}}if(ee.startsWith("data: ")){const he=ee.substring(5).trim()}}a(g,e(g).map(se=>se.id===P?{...se,content:A}:se),!0)}catch(T){j(`Error during chat submission: ${T.message}`),console.error("Chat error:",T),a(g,e(g).map(W=>W.id===P?{...W,content:`Error: ${T.message}`}:W),!0)}finally{a(d,!1),a(J,!1),j("Chat submission finished.")}}Oa(()=>{j("ChatInterface mounted."),Ne()}),Yr(()=>{e(g)&&e(H)&&Promise.resolve().then(()=>{e(H)&&(e(H).scrollTop=e(H).scrollHeight,j("Scrolled chat container to bottom."))})});var ue=ai(),ve=r(ue),Z=o(r(ve),2);b(Z,F=>{}),t(ve);var we=o(ve,2),ne=r(we);It(ne,17,()=>e(g),F=>F.id,(F,k)=>{var P=ei(),A=r(P),T=r(A);{var W=ee=>{var se=Xo(),be=r(se,!0);t(se),p(()=>i(be,e(k).content||"Thinking...")),n(ee,se)},le=ee=>{var se=Qo(),be=r(se,!0);t(se),p(()=>i(be,e(k).content)),n(ee,se)};b(T,ee=>{e(k).role==="assistant"&&e(J)&&e(k).id===e(g)[e(g).length-1].id?ee(W):ee(le,!1)})}t(A),t(P),p(()=>{yt(P,1,`flex ${e(k).role==="user"?"justify-end":"justify-start"}`),yt(A,1,`max-w-xs md:max-w-md lg:max-w-lg xl:max-w-xl px-4 py-2 rounded-lg shadow ${e(k).role==="user"?"bg-blue-500 text-white":"bg-gray-200 text-gray-800"}`)}),n(F,P)});var Ve=o(ne,2);{var Re=F=>{var k=ti();n(F,k)};b(Ve,F=>{var k;e(d)&&!e(J)&&((k=e(g)[e(g).length-1])==null?void 0:k.role)==="user"&&F(Re)})}t(we),_s(we,F=>a(H,F),()=>e(H));var Ie=o(we,2),pe=r(Ie),Q=r(pe);Tr(Q);var $e=o(Q,2),_e=r($e);{var He=F=>{var k=ri();n(F,k)},We=F=>{var k=yr("Send");n(F,k)};b(_e,F=>{e(d)?F(He):F(We,!1)})}t($e),t(pe),t(Ie),t(ue),p(F=>{Q.disabled=e(d),$e.disabled=F},[()=>e(d)||!e(l).trim()]),vr("submit",pe,F=>(F.preventDefault(),ye(),!1)),Mr(Q,()=>e(l),F=>a(l,F)),n(M,ue),da()}var oi=v('<div class="bg-yellow-100 border border-yellow-400 text-yellow-700 px-4 py-3 rounded"><strong>Authentication Required:</strong> Please log in to access the MCP testing interface.</div>'),ii=v('<div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded"><strong>Error:</strong> </div>'),ni=v('<div class="bg-blue-100 border border-blue-400 text-blue-700 px-4 py-3 rounded">Loading...</div>'),li=v('<span class="px-2 py-1 bg-blue-100 text-blue-800 rounded text-sm"> </span>'),di=v('<div class="space-y-3"><div class="flex items-center"><span class="font-medium text-gray-700 w-24">Status:</span> <span class="px-2 py-1 bg-green-100 text-green-800 rounded-full text-sm">Connected</span></div> <div class="flex items-center"><span class="font-medium text-gray-700 w-24">Version:</span> <span class="text-gray-600"> </span></div> <div class="flex items-center"><span class="font-medium text-gray-700 w-24">Capabilities:</span> <div class="flex flex-wrap gap-2"></div></div></div>'),ci=v('<p class="text-gray-500">Loading status...</p>'),ui=v('<button><div class="font-medium"> </div> <div class="text-sm text-gray-600"> </div></button>'),vi=v('<div><label class="block text-sm font-medium text-gray-700 mb-1"> </label> <input type="text" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#2271b3] focus:border-transparent"></div>'),pi=v('<div class="mt-4"><h5 class="font-medium text-gray-700 mb-2">Result:</h5> <pre class="bg-gray-100 p-3 rounded text-sm overflow-auto"> </pre></div>'),fi=v('<div><h4 class="font-medium text-gray-700 mb-2"> </h4> <div class="space-y-3"><!> <button class="bg-[#2271b3] text-white px-4 py-2 rounded hover:bg-[#1e5a8a]">Test Prompt</button></div> <!></div>'),mi=v('<div class="p-6"><div class="grid grid-cols-1 lg:grid-cols-2 gap-6"><div><h4 class="font-medium text-gray-700 mb-3">Available Prompts</h4> <div class="space-y-2"></div></div> <!></div></div>'),gi=v('<div class="p-6 text-center text-gray-500"><p>No prompts available. You need to create assistants first.</p></div>'),bi=v('<button><div class="font-medium"> </div> <div class="text-sm text-gray-600"> </div></button>'),_i=v('<div><label class="block text-sm font-medium text-gray-700 mb-1"> </label> <input type="text" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#2271b3] focus:border-transparent"></div>'),hi=v('<div class="mt-4"><h5 class="font-medium text-gray-700 mb-2">Result:</h5> <pre class="bg-gray-100 p-3 rounded text-sm overflow-auto"> </pre></div>'),xi=v('<div><h4 class="font-medium text-gray-700 mb-2"> </h4> <div class="space-y-3"><!> <button class="bg-[#2271b3] text-white px-4 py-2 rounded hover:bg-[#1e5a8a]">Test Tool</button></div> <!></div>'),yi=v('<div class="p-6"><div class="grid grid-cols-1 lg:grid-cols-2 gap-6"><div><h4 class="font-medium text-gray-700 mb-3">Available Tools</h4> <div class="space-y-2"></div></div> <!></div></div>'),wi=v('<div class="p-6 text-center text-gray-500"><p>No tools available yet.</p></div>'),ki=v('<div class="border rounded p-3"><div class="font-medium"> </div> <div class="text-sm text-gray-600"> </div> <div class="text-xs text-gray-500 mt-1"> </div></div>'),Ai=v('<div class="p-6"><h4 class="font-medium text-gray-700 mb-3">Available Resources</h4> <div class="space-y-3"></div></div>'),Ei=v('<div class="p-6 text-center text-gray-500"><p>No resources available yet.</p></div>'),$i=v('<div class="p-6"><h4 class="font-medium text-gray-700 mb-3">MCP Client Setup</h4> <div class="space-y-4"><div class="bg-gray-50 p-4 rounded"><h5 class="font-medium mb-2">Server Configuration</h5> <pre class="text-sm text-gray-700"> </pre></div> <div class="text-sm text-gray-600"><p>Add this configuration to your MCP client to connect to the LAMB server.</p> <p class="mt-2"><strong>Note:</strong> Replace the API key with your actual LAMB API key.</p></div></div></div>'),Ci=v('<!> <!> <div class="bg-white rounded-lg shadow-md p-6"><h3 class="text-lg font-semibold text-gray-800 mb-4">MCP Server Status</h3> <!></div> <div class="bg-white rounded-lg shadow-md"><div class="border-b border-gray-200"><nav class="-mb-px flex space-x-8 px-6"><button>Prompts</button> <button>Tools</button> <button>Resources</button> <button>Client Setup</button></nav></div> <!> <!> <!> <!></div>',1),Si=v('<div class="space-y-6"><!></div>');function Pi(M,u){la(u,!1);const[f,q]=ga(),C=()=>wr(rs,"$user",f);let s=Wt({}),g=Wt(null),l=Wt([]),d=Wt([]),x=Wt([]),O=Wt(!1),X=Wt(null),B=Wt(null),J=Wt({}),H=Wt(null),j=Wt(null),Ne=Wt({}),ye=Wt(null),ue=Wt("prompts");Oa(()=>{a(s,Ua()),we()});function ve(k){var A,T;return`${(((T=(A=e(s))==null?void 0:A.api)==null?void 0:T.lambServer)||"http://localhost:9099").replace(/\/$/,"")}/lamb/v1/mcp${k}`}function Z(){var A,T;const k=((T=(A=e(s))==null?void 0:A.api)==null?void 0:T.ltiSecret)||"pepino-secret-key",P=C().email||"test@example.com";return{Authorization:`Bearer ${k}`,"X-User-Email":P,"Content-Type":"application/json"}}async function we(){var k,P;a(O,!0),a(X,null);try{const A=await Dr.get(ve("/status"),{headers:Z()});a(g,A.data)}catch(A){console.error("Error loading MCP status:",A),a(X,((P=(k=A.response)==null?void 0:k.data)==null?void 0:P.detail)||A.message||"Failed to load MCP status")}finally{a(O,!1)}}async function ne(){var k,P;a(ue,"prompts"),a(O,!0),a(X,null);try{const A=await Dr.get(ve("/prompts"),{headers:Z()});a(l,A.data.prompts||[])}catch(A){console.error("Error loading MCP prompts:",A),a(X,((P=(k=A.response)==null?void 0:k.data)==null?void 0:P.detail)||A.message||"Failed to load MCP prompts")}finally{a(O,!1)}}async function Ve(){var k,P;a(ue,"tools"),a(O,!0),a(X,null);try{const A=await Dr.get(ve("/tools"),{headers:Z()});a(d,A.data.tools||[])}catch(A){console.error("Error loading MCP tools:",A),a(X,((P=(k=A.response)==null?void 0:k.data)==null?void 0:P.detail)||A.message||"Failed to load MCP tools")}finally{a(O,!1)}}async function Re(){var k,P;a(ue,"resources"),a(O,!0),a(X,null);try{const A=await Dr.get(ve("/resources"),{headers:Z()});a(x,A.data.resources||[])}catch(A){console.error("Error loading MCP resources:",A),a(X,((P=(k=A.response)==null?void 0:k.data)==null?void 0:P.detail)||A.message||"Failed to load MCP resources")}finally{a(O,!1)}}async function Ie(){var k,P;if(e(B)){a(O,!0),a(X,null);try{const A=await Dr.post(ve("/prompts/get"),{name:e(B).name,arguments:e(J)},{headers:Z()});a(H,A.data)}catch(A){console.error("Error testing prompt:",A),a(X,((P=(k=A.response)==null?void 0:k.data)==null?void 0:P.detail)||A.message||"Failed to test prompt")}finally{a(O,!1)}}}async function pe(){var k,P;if(e(j)){a(O,!0),a(X,null);try{const A=await Dr.post(ve("/tools/call"),{name:e(j).name,arguments:e(Ne)},{headers:Z()});a(ye,A.data)}catch(A){console.error("Error testing tool:",A),a(X,((P=(k=A.response)==null?void 0:k.data)==null?void 0:P.detail)||A.message||"Failed to test tool")}finally{a(O,!1)}}}function Q(k){a(B,k),a(J,{}),a(H,null),k.arguments&&k.arguments.forEach(P=>{Fa(J,e(J)[P.name]="")})}function $e(k){a(j,k),a(Ne,{}),a(ye,null),k.inputSchema&&k.inputSchema.properties&&Object.keys(k.inputSchema.properties).forEach(P=>{Fa(Ne,e(Ne)[P]="")})}$s();var _e=Si(),He=r(_e);{var We=k=>{var P=oi();n(k,P)},F=k=>{var P=Ci(),A=Je(P);{var T=ce=>{var ae=ii(),oe=o(r(ae));t(ae),p(()=>i(oe,` ${e(X)??""}`)),n(ce,ae)};b(A,ce=>{e(X)&&ce(T)})}var W=o(A,2);{var le=ce=>{var ae=ni();n(ce,ae)};b(W,ce=>{e(O)&&ce(le)})}var ee=o(W,2),se=o(r(ee),2);{var be=ce=>{var ae=di(),oe=o(r(ae),2),Ce=o(r(oe),2),tt=r(Ce,!0);t(Ce),t(oe);var fe=o(oe,2),me=o(r(fe),2);It(me,5,()=>e(g).capabilities||[],pr,(Ge,rt)=>{var Ye=li(),st=r(Ye,!0);t(Ye),p(()=>i(st,e(rt))),n(Ge,Ye)}),t(me),t(fe),t(ae),p(()=>i(tt,e(g).version||"Unknown")),n(ce,ae)},je=ce=>{var ae=ci();n(ce,ae)};b(se,ce=>{e(g)?ce(be):ce(je,!1)})}t(ee);var he=o(ee,2),ke=r(he),Y=r(ke),de=r(Y),Me=o(de,2),Tt=o(Me,2),tr=o(Tt,2);t(Y),t(ke);var rr=o(ke,2);{var qr=ce=>{var ae=Rr(),oe=Je(ae);{var Ce=fe=>{var me=mi(),Ge=r(me),rt=r(Ge),Ye=o(r(rt),2);It(Ye,5,()=>e(l),pr,(Ke,Te)=>{var De=ui(),Ze=r(De),m=r(Ze,!0);t(Ze);var _=o(Ze,2),S=r(_,!0);t(_),t(De),p(()=>{var L;yt(De,1,`w-full text-left p-3 border rounded hover:bg-gray-50 ${((L=e(B))==null?void 0:L.name)===e(Te).name?"border-[#2271b3] bg-blue-50":"border-gray-200"}`),i(m,e(Te).name),i(S,e(Te).description)}),vr("click",De,()=>Q(e(Te))),n(Ke,De)}),t(Ye),t(rt);var st=o(rt,2);{var vt=Ke=>{var Te=fi(),De=r(Te),Ze=r(De);t(De);var m=o(De,2),_=r(m);{var S=te=>{var c=Rr(),h=Je(c);It(h,1,()=>e(B).arguments,pr,(I,y)=>{var N=vi(),R=r(N),z=r(R);t(R);var ie=o(R,2);Tr(ie),t(N),p(()=>{ut(R,"for",`prompt-arg-${e(y).name??""}`),i(z,`${e(y).name??""} ${e(y).required?"*":""}`),ut(ie,"id",`prompt-arg-${e(y).name??""}`),ut(ie,"placeholder",e(y).description)}),Mr(ie,()=>e(J)[e(y).name],G=>Fa(J,e(J)[e(y).name]=G)),n(I,N)}),n(te,c)};b(_,te=>{e(B).arguments&&te(S)})}var L=o(_,2);t(m);var U=o(m,2);{var Be=te=>{var c=pi(),h=o(r(c),2),I=r(h,!0);t(h),t(c),p(y=>i(I,y),[()=>JSON.stringify(e(H),null,2)],La),n(te,c)};b(U,te=>{e(H)&&te(Be)})}t(Te),p(()=>{i(Ze,`Test Prompt: ${e(B).name??""}`),L.disabled=e(O)}),vr("click",L,Ie),n(Ke,Te)};b(st,Ke=>{e(B)&&Ke(vt)})}t(Ge),t(me),n(fe,me)},tt=fe=>{var me=gi();n(fe,me)};b(oe,fe=>{e(l).length>0?fe(Ce):fe(tt,!1)})}n(ce,ae)};b(rr,ce=>{e(ue)==="prompts"&&ce(qr)})}var Dt=o(rr,2);{var kr=ce=>{var ae=Rr(),oe=Je(ae);{var Ce=fe=>{var me=yi(),Ge=r(me),rt=r(Ge),Ye=o(r(rt),2);It(Ye,5,()=>e(d),pr,(Ke,Te)=>{var De=bi(),Ze=r(De),m=r(Ze,!0);t(Ze);var _=o(Ze,2),S=r(_,!0);t(_),t(De),p(()=>{var L;yt(De,1,`w-full text-left p-3 border rounded hover:bg-gray-50 ${((L=e(j))==null?void 0:L.name)===e(Te).name?"border-[#2271b3] bg-blue-50":"border-gray-200"}`),i(m,e(Te).name),i(S,e(Te).description)}),vr("click",De,()=>$e(e(Te))),n(Ke,De)}),t(Ye),t(rt);var st=o(rt,2);{var vt=Ke=>{var Te=xi(),De=r(Te),Ze=r(De);t(De);var m=o(De,2),_=r(m);{var S=te=>{var c=Rr(),h=Je(c);It(h,1,()=>Object.entries(e(j).inputSchema.properties),pr,(I,y)=>{let N=()=>e(y)[0],R=()=>e(y)[1];var z=_i(),ie=r(z),G=r(ie);t(ie);var V=o(ie,2);Tr(V),t(z),p(K=>{ut(ie,"for",`tool-arg-${N()??""}`),i(G,`${N()??""} ${K??""}`),ut(V,"id",`tool-arg-${N()??""}`),ut(V,"placeholder",R().description||"")},[()=>{var K;return(K=e(j).inputSchema.required)!=null&&K.includes(N())?"*":""}],La),Mr(V,()=>e(Ne)[N()],K=>Fa(Ne,e(Ne)[N()]=K)),n(I,z)}),n(te,c)};b(_,te=>{var c;(c=e(j).inputSchema)!=null&&c.properties&&te(S)})}var L=o(_,2);t(m);var U=o(m,2);{var Be=te=>{var c=hi(),h=o(r(c),2),I=r(h,!0);t(h),t(c),p(y=>i(I,y),[()=>JSON.stringify(e(ye),null,2)],La),n(te,c)};b(U,te=>{e(ye)&&te(Be)})}t(Te),p(()=>{i(Ze,`Test Tool: ${e(j).name??""}`),L.disabled=e(O)}),vr("click",L,pe),n(Ke,Te)};b(st,Ke=>{e(j)&&Ke(vt)})}t(Ge),t(me),n(fe,me)},tt=fe=>{var me=wi();n(fe,me)};b(oe,fe=>{e(d).length>0?fe(Ce):fe(tt,!1)})}n(ce,ae)};b(Dt,ce=>{e(ue)==="tools"&&ce(kr)})}var Zt=o(Dt,2);{var ar=ce=>{var ae=Rr(),oe=Je(ae);{var Ce=fe=>{var me=Ai(),Ge=o(r(me),2);It(Ge,5,()=>e(x),pr,(rt,Ye)=>{var st=ki(),vt=r(st),Ke=r(vt,!0);t(vt);var Te=o(vt,2),De=r(Te,!0);t(Te);var Ze=o(Te,2),m=r(Ze);t(Ze),t(st),p(()=>{i(Ke,e(Ye).name),i(De,e(Ye).description),i(m,`URI: ${e(Ye).uri??""}`)}),n(rt,st)}),t(Ge),t(me),n(fe,me)},tt=fe=>{var me=Ei();n(fe,me)};b(oe,fe=>{e(x).length>0?fe(Ce):fe(tt,!1)})}n(ce,ae)};b(Zt,ce=>{e(ue)==="resources"&&ce(ar)})}var sr=o(Zt,2);{var or=ce=>{var ae=$i(),oe=o(r(ae),2),Ce=r(oe),tt=o(r(Ce),2),fe=r(tt,!0);t(tt),t(Ce),na(2),t(oe),t(ae),p(me=>i(fe,me),[()=>{var me,Ge;return JSON.stringify({command:"python",args:["-m","lamb.mcp_server"],env:{LAMB_SERVER_URL:((Ge=(me=e(s))==null?void 0:me.api)==null?void 0:Ge.lambServer)||"http://localhost:9099",LAMB_API_KEY:"***REDACTED***"}},null,2)}],La),n(ce,ae)};b(sr,ce=>{e(ue)==="setup"&&ce(or)})}t(he),p(()=>{yt(de,1,`py-4 px-1 border-b-2 font-medium text-sm ${e(ue)==="prompts"?"border-[#2271b3] text-[#2271b3]":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`),yt(Me,1,`py-4 px-1 border-b-2 font-medium text-sm ${e(ue)==="tools"?"border-[#2271b3] text-[#2271b3]":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`),yt(Tt,1,`py-4 px-1 border-b-2 font-medium text-sm ${e(ue)==="resources"?"border-[#2271b3] text-[#2271b3]":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`),yt(tr,1,`py-4 px-1 border-b-2 font-medium text-sm ${e(ue)==="setup"?"border-[#2271b3] text-[#2271b3]":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`)}),vr("click",de,ne),vr("click",Me,Ve),vr("click",Tt,Re),vr("click",tr,()=>a(ue,"setup")),n(k,P)};b(He,k=>{C().isLoggedIn?k(F,!1):k(We)})}t(_e),n(M,_e),da(),q()}var Ni=v('<div class="mt-4 bg-red-100 border border-red-400 text-red-700 px-4 py-2 rounded text-sm" role="alert"> </div>'),Ii=Ia('<svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> ',1),Ti=v('<div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity z-40" aria-hidden="true"></div> <div class="fixed inset-0 z-50 flex items-center justify-center p-4"><div class="relative bg-white rounded-lg shadow-xl overflow-hidden max-w-lg w-full border border-gray-300" role="dialog" aria-modal="true" aria-labelledby="modal-title"><div class="bg-gray-50 px-4 py-3 sm:px-6 border-b border-gray-200"><h3 class="text-lg leading-6 font-medium text-gray-900" id="modal-title"> </h3></div> <div class="px-4 py-5 sm:p-6"><p class="text-sm text-gray-600 mb-4"> </p> <div><label for="new-assistant-name" class="block text-sm font-medium text-gray-700"> </label> <div class="mt-1"><input type="text" id="new-assistant-name" class="shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md disabled:bg-gray-100"></div></div> <!></div> <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse border-t border-gray-200"><button type="button" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-brand text-base font-medium text-white hover:bg-brand-hover focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:ml-3 sm:w-auto sm:text-sm disabled:opacity-50" style="background-color: #2271b3;"><!></button> <button type="button" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm disabled:opacity-50"> </button></div></div></div>',1);function Di(M,u){la(u,!0);const[f,q]=ga(),C=()=>wr(Ta,"$_",f);let s=Yt(u,"isOpen",11,!1),g=Yt(u,"originalName",3,""),l=Yt(u,"defaultNewName",3,""),d=Yt(u,"isSubmitting",11,!1),x=Yt(u,"error",3,""),O=w(""),X=w(!1);Yr(()=>{l()&&a(O,l())});let B=()=>{};Yr(()=>(B=Na.subscribe(Z=>{a(X,!!Z)}),()=>{B()}));function J(){var Z;!e(O).trim()||d()||(Z=u.onSubmit)==null||Z.call(u,{newName:e(O).trim()})}function H(){var Z;(Z=u.onClose)==null||Z.call(u)}function j(Z){const we=Z.target,ne=we.value.replace(/[^a-zA-Z0-9_-]/g,"");we.value!==ne&&(we.value=ne),a(O,ne,!0)}function Ne(Z){Z.key==="Escape"&&H(),Z.key==="Enter"&&J()}var ye=Rr();vr("keydown",bs,Ne);var ue=Je(ye);{var ve=Z=>{var we=Ti(),ne=Je(we);ne.__click=H;var Ve=o(ne,2),Re=r(Ve),Ie=r(Re),pe=r(Ie),Q=r(pe,!0);t(pe),t(Ie);var $e=o(Ie,2),_e=r($e),He=r(_e,!0);t(_e);var We=o(_e,2),F=r(We),k=r(F,!0);t(F);var P=o(F,2),A=r(P);Tr(A),A.__input=j,t(P),t(We);var T=o(We,2);{var W=Y=>{var de=Ni(),Me=r(de,!0);t(de),p(()=>i(Me,x())),n(Y,de)};b(T,Y=>{x()&&Y(W)})}t($e);var le=o($e,2),ee=r(le);ee.__click=J;var se=r(ee);{var be=Y=>{var de=Ii(),Me=o(Je(de),1,!0);p(Tt=>i(Me,Tt),[()=>e(X)?C()("assistants.duplicateModal.submitting",{default:"Creating..."}):"Creating..."]),n(Y,de)},je=Y=>{var de=yr();p(Me=>i(de,Me),[()=>e(X)?C()("assistants.duplicateModal.submitButton",{default:"Create Duplicate"}):"Create Duplicate"]),n(Y,de)};b(se,Y=>{d()?Y(be):Y(je,!1)})}t(ee);var he=o(ee,2);he.__click=H;var ke=r(he,!0);t(he),t(le),t(Re),t(Ve),p((Y,de,Me,Tt,tr,rr)=>{i(Q,Y),i(He,de),i(k,Me),A.disabled=d(),ut(A,"placeholder",Tt),ee.disabled=tr,he.disabled=d(),i(ke,rr)},[()=>e(X)?C()("assistants.duplicateModal.title",{default:"Duplicate Assistant"}):"Duplicate Assistant",()=>e(X)?C()("assistants.duplicateModal.description",{values:{name:g()},default:`Creating a copy of assistant: ${g()}`}):`Creating a copy of assistant: ${g()}`,()=>e(X)?C()("assistants.duplicateModal.newNameLabel",{default:"New Assistant Name"}):"New Assistant Name",()=>e(X)?C()("assistants.duplicateModal.newNamePlaceholder",{default:"Enter name for the copy..."}):"Enter name for the copy...",()=>d()||!e(O).trim(),()=>e(X)?C()("common.cancel",{default:"Cancel"}):"Cancel"]),Mr(A,()=>e(O),Y=>a(O,Y)),n(Z,we)};b(ue,Z=>{s()&&Z(ve)})}n(M,ye),da(),q()}ma(["click","input"]);function Mi(M,u,f){var q;u()||(q=f.onConfirm)==null||q.call(f)}var Ri=v('<p class="text-sm text-red-600 mt-2"> </p>'),Li=Ia('<svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>'),Fi=v('<div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity z-40" aria-hidden="true"></div> <div class="fixed inset-0 z-50 flex items-center justify-center p-4"><div class="relative bg-white rounded-lg shadow-xl overflow-hidden max-w-lg w-full border border-gray-300" role="dialog" aria-modal="true" aria-labelledby="modal-title-delete"><div class="bg-red-50 px-4 py-3 sm:px-6 border-b border-red-200 flex items-center"><svg class="h-6 w-6 text-red-600 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z"></path></svg> <h3 class="text-lg leading-6 font-medium text-red-900" id="modal-title-delete"> </h3></div> <div class="px-4 py-5 sm:p-6"><p class="text-sm text-gray-700"> </p> <!></div> <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse border-t border-gray-200"><button type="button" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:ml-3 sm:w-auto sm:text-sm disabled:opacity-50"><!> </button> <button type="button" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm disabled:opacity-50"> </button></div></div></div>',1);function Bi(M,u){la(u,!0);const[f,q]=ga(),C=()=>wr(Ta,"$_",f);let s=Yt(u,"isOpen",11,!1),g=Yt(u,"assistantName",3,""),l=Yt(u,"isDeleting",11,!1),d=w(!1),x=()=>{};Yr(()=>(x=Na.subscribe(j=>{a(d,!!j)}),()=>{x()}));function O(){var j;l()||(j=u.onClose)==null||j.call(u)}function X(j){j.key==="Escape"&&O()}var B=Rr();vr("keydown",bs,X);var J=Je(B);{var H=j=>{var Ne=Fi(),ye=Je(Ne);ye.__click=O;var ue=o(ye,2),ve=r(ue),Z=r(ve),we=o(r(Z),2),ne=r(we,!0);t(we),t(Z);var Ve=o(Z,2),Re=r(Ve),Ie=r(Re,!0);t(Re);var pe=o(Re,2);{var Q=A=>{var T=Ri(),W=r(T,!0);t(T),p(le=>i(W,le),[()=>e(d)?C()("assistants.deleteModal.deleting",{default:"Deleting..."}):"Deleting..."]),n(A,T)};b(pe,A=>{l()&&A(Q)})}t(Ve);var $e=o(Ve,2),_e=r($e);_e.__click=[Mi,l,u];var He=r(_e);{var We=A=>{var T=Li();n(A,T)};b(He,A=>{l()&&A(We)})}var F=o(He);t(_e);var k=o(_e,2);k.__click=O;var P=r(k,!0);t(k),t($e),t(ve),t(ue),p((A,T,W,le)=>{i(ne,A),i(Ie,T),_e.disabled=l(),i(F,` ${W??""}`),k.disabled=l(),i(P,le)},[()=>e(d)?C()("assistants.deleteModal.title",{default:"Delete Assistant"}):"Delete Assistant",()=>e(d)?C()("assistants.deleteModal.confirmation",{values:{name:g()},default:`Are you sure you want to delete the assistant "${g()}"? This action cannot be undone.`}):`Are you sure you want to delete the assistant "${g()}"? This action cannot be undone.`,()=>e(d)?C()("assistants.deleteModal.confirmButton",{default:"Delete"}):"Delete",()=>e(d)?C()("common.cancel",{default:"Cancel"}):"Cancel"]),n(j,Ne)};b(J,j=>{s()&&j(H)})}n(M,B),da(),q()}ma(["click"]);function Ui(M,u,f,q,C){console.log("Navigating to MCP Testing"),a(u,null),a(f,"mcp"),a(q,!1),a(C,"properties"),ia(`${oa}/assistants?view=mcp`,{replaceState:!0})}var Oi=v('<div class="relative"><button class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm rounded-t-md bg-brand text-white border-brand cursor-default" style="background-color: #2271b3; color: white; border-color: #2271b3;" disabled> <!></button></div>'),ji=v('<div class="mt-6"><div class="bg-white shadow rounded-lg p-4 border border-gray-200"><!></div></div>'),Gi=v('<div class="mt-6"><div class="bg-white shadow rounded-lg p-6 border border-gray-200"><!></div></div>'),Ki=(M,u)=>a(u,"properties"),zi=(M,u)=>a(u,"edit"),qi=(M,u)=>a(u,"chat"),Ji=v("<p> </p>"),Vi=v('<div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative" role="alert"><strong class="font-bold"> </strong> <span class="block sm:inline"> </span> <button class="ml-4 underline"> </button></div>'),Hi=(M,u)=>a(u,"edit"),Wi=(M,u,f)=>u({detail:{id:e(f).id,name:e(f).name}}),Yi=(M,u,f)=>u({detail:{id:e(f).id}}),Zi=Ia('<svg class="animate-spin -ml-1 mr-2 h-4 w-4 text-white inline" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> ',1),Xi=Ia('<svg class="animate-spin -ml-1 mr-2 h-4 w-4 text-white inline" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> ',1),Qi=(M,u,f)=>u({detail:{id:e(f).id,name:e(f).name,published:e(f).published}}),en=v('<div class="p-4 border border-blue-200 rounded bg-blue-50"><h3 class="text-lg font-semibold text-blue-800 mb-2"> </h3> <div class="space-y-1 text-sm text-blue-700 break-words"><div><span class="font-medium"> </span> <code class="ml-1 bg-blue-100 px-1 rounded"> </code></div> <div><span class="font-medium"> </span> <code class="ml-1 bg-blue-100 px-1 rounded"> </code></div> <div><span class="font-medium"> </span> <code class="ml-1 bg-blue-100 px-1 rounded">ASK ADMIN FOR THE SECRET</code></div></div></div>'),tn=v('<div><div class="font-medium text-gray-700 mb-1"> </div> <div class="bg-white border border-gray-200 p-2 rounded w-24 text-center"> </div></div>'),rn=v('<div class="bg-white border border-gray-200 p-2 rounded text-gray-500 italic"> </div>'),an=v('<div class="bg-red-50 border border-red-200 p-2 rounded text-red-600 italic"> </div>'),sn=v('<span class="inline-block bg-gray-200 rounded px-2 py-0.5 text-xs font-medium text-gray-700"> </span>'),on=v('<div class="bg-white border border-gray-200 p-2 rounded space-y-1"></div>'),nn=v('<div class="bg-white border border-gray-200 p-2 rounded text-gray-500 italic"> </div>'),ln=v('<div><div class="font-medium text-gray-700 mb-1"> </div> <!></div>'),dn=v('<div><div class="font-medium text-gray-700 mb-1"> </div> <div class="bg-white border border-gray-200 p-2 rounded break-all"> </div></div>'),cn=v('<div class="pt-3 mt-3 border-t border-gray-300 space-y-3"><h4 class="text-md font-medium text-gray-700"> </h4> <!> <!> <!></div>'),un=v('<div class="space-y-3 text-sm"><div><div class="font-medium text-gray-700 mb-1"> </div> <div class="bg-white border border-gray-200 p-2 rounded"> </div></div> <div><div class="font-medium text-gray-700 mb-1"> </div> <div class="bg-white border border-gray-200 p-2 rounded"> </div></div> <div><div class="font-medium text-gray-700 mb-1"> </div> <div class="bg-white border border-gray-200 p-2 rounded"> </div></div> <div><div class="font-medium text-gray-700 mb-1"> </div> <div class="bg-white border border-gray-200 p-2 rounded"> </div></div> <!></div>'),vn=v('<div class="md:w-1/3 mt-6 md:mt-0 space-y-4"><!> <div class="p-4 border border-gray-200 rounded bg-gray-50"><h3 class="text-lg font-semibold text-gray-800 mb-2"> </h3> <!></div></div>'),pn=v('<div class="flex justify-between items-center px-6 py-4 border-b border-gray-200"><h2 class="text-xl font-semibold text-gray-800"> </h2> <div class="flex space-x-2"><button type="button" class="px-3 py-1 text-sm font-medium rounded text-indigo-600 bg-white border border-indigo-600 hover:bg-indigo-100 transition-colors"> </button> <button type="button" class="px-3 py-1 text-sm font-medium rounded text-white hover:bg-opacity-90 transition-colors" style="background-color: #2271b3;"> </button> <button type="button" class="px-3 py-1 text-sm font-medium rounded bg-green-600 text-white hover:bg-green-700 transition-colors"><!></button> <button type="button"><!></button> <button type="button" class="px-3 py-1 text-sm font-medium rounded bg-red-600 text-white hover:bg-red-700 transition-colors"> </button></div></div> <div class="flex flex-col md:flex-row md:space-x-6 px-6 py-4"><div class="flex-grow md:w-2/3 space-y-4"><div><div class="block text-sm font-medium text-gray-700"> <span class="text-red-600">*</span></div> <div class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm bg-gray-100 cursor-not-allowed sm:text-sm"> </div></div> <div><div class="block text-sm font-medium text-gray-700"> </div> <div class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm bg-gray-100 cursor-not-allowed sm:text-sm min-h-[6em] whitespace-pre-wrap"> </div></div> <div><div class="block text-sm font-medium text-gray-700"> </div> <div class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm bg-gray-100 cursor-not-allowed sm:text-sm min-h-[8em] whitespace-pre-wrap"> </div></div> <div><div class="block text-sm font-medium text-gray-700"> </div> <div class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm bg-gray-100 cursor-not-allowed sm:text-sm min-h-[8em] whitespace-pre-wrap"> </div></div></div> <!></div>',1),fn=v('<div class="px-6 py-4"><div class="mb-6 pb-4 border-b border-gray-200"><h2 class="text-xl font-semibold text-gray-800"> </h2></div> <div class="w-full"><!></div></div>'),mn=v('<div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative" role="alert"><strong class="font-bold"> </strong> <span class="block sm:inline"> </span></div>'),gn=v('<div class="px-6 py-4 border-b border-gray-200"><h2 class="text-xl font-semibold text-gray-800"> </h2></div> <!>',1),bn=v("<p> </p>"),_n=v('<div class="mb-4 border-b border-gray-300 flex space-x-4"><button> </button> <button> </button> <button> <!></button></div> <div class="bg-white shadow rounded-lg border border-gray-200"><!></div>',1),hn=v("<p> </p>"),xn=v("<p> </p>"),yn=v('<h1 class="text-3xl font-bold mb-4 text-brand"> </h1> <div class="mb-6 border-b border-gray-200"><nav class="-mb-px flex space-x-8" aria-label="Tabs"><button> </button> <button> </button> <button> </button> <!></nav></div> <!> <!> <!> <!>',1);function jn(M,u){la(u,!0);const[f,q]=ga(),C=()=>wr(os,"$page",f),s=()=>wr(Ta,"$_",f),g=()=>wr(Na,"$locale",f);let l=w("list"),d=w(null),x=w(null),O=w(null),X=w(!1),B=w(""),J=w(!1),H=w(jt(C().url.searchParams.get("startInEdit")==="true"?"edit":"properties")),j=w(""),Ne=w(""),ye=w(""),ue=null,ve=w(!1),Z=w(null),we=w(null),ne=w(null),Ve=w(!1),Re=w(!1),Ie=w(""),pe=w(""),Q=w(!1),$e=w(null),_e=w(null),He=w(!1),We=w(""),F=w(!1),k=w(null),P=w(!1),A=w(""),T=w(jt([])),W=w(!1),le=w(""),ee=w(!1);function se(){console.log("Navigating to create form"),a(x,null),a(l,"create"),a(J,!1),ia(`${oa}/assistants?view=create`,{replaceState:!0})}function be(){console.log("Navigating back to list view (assistants base path)"),a(l,"list"),a(J,!1),ia(`${oa}/assistants`,{replaceState:!0})}async function je(m){if(e(O)!==m){a(O,m,!0),a(X,!0),a(B,""),a(x,null),a(l,"detail");try{console.log(`Fetching assistant ID: ${m}.`);const _=await ns(m);if(_){let S={};const L=_.metadata||_.api_callback;if(L)try{S=JSON.parse(L)}catch(Be){console.error("Error parsing metadata JSON:",Be)}const U={..._,...S,id:_.id.toString()};a(x,U,!0),console.log("Assigned selectedAssistantData:",e(x)),ia(`${oa}/assistants?view=detail&id=${m}`,{replaceState:!0,noScroll:!0})}else a(B,s()("assistant_not_found",{values:{id:m}}),!0),console.error(e(B)),be()}catch(_){console.error("Error fetching assistant details:",_),a(B,_ instanceof Error?_.message:s()("error_fetching_assistant"),!0),be()}finally{a(X,!1)}}}Oa(()=>{console.log("Assistants page mounted");try{const m=Ua();if(console.log("[DEBUG] Assistants page onMount: Config object received:",JSON.stringify(m,null,2)),m&&m.api&&m.api.lambServer&&m.api.lambApiKey)a(j,m.api.lambServer.replace(/\/$/,""),!0),a(Ne,m.api.lambApiKey,!0),console.log("LAMB config loaded for chat - API URL:",e(j)),console.log("LAMB config loaded for chat - Has API Key:",!!e(Ne));else throw new Error("Missing required LAMB configuration (lambServer or lambApiKey).")}catch(m){a(ye,m instanceof Error?m.message:"Failed to load LAMB configuration.",!0),console.error(e(ye))}a(d,g()??null,!0),ue=os.subscribe(m=>{var Be;console.log("Page store updated:",m.url.searchParams.toString());const _=m.url.searchParams.get("view"),S=m.url.searchParams.get("id"),L=m.url.searchParams.get("startInEdit");console.log(`[+page.svelte] URL Params: view=${_}, id=${S}, startInEdit=${L}`);const U=L==="true";if(console.log(`[+page.svelte] requestedStartEdit evaluated to: ${U}`),_==="create")e(l)!=="create"&&(console.log("URL indicates 'create' view."),se());else if(_==="mcp")e(l)!=="mcp"&&(console.log("URL indicates 'mcp' view."),a(l,"mcp"));else if(_==="detail"&&S){const te=parseInt(S,10);isNaN(te)?(console.warn("Invalid assistant ID in URL parameter."),be()):(a(J,U),console.log(`[+page.svelte] Set startEditMode state to: ${e(J)}`),e(l)!=="detail"&&(a(l,"detail"),a(H,"properties")),((Be=e(x))==null?void 0:Be.id)!==te.toString()?(console.log(`[+page.svelte] Fetching detail for new ID: ${te}`),je(te)):(console.log(`[+page.svelte] ID ${te} already loaded. Skipping fetch.`),a(X,!1)))}else e(l)!=="list"&&(console.log("URL indicates 'list' view."),be())})}),As(()=>{console.log("Assistants page unmounting"),ue&&ue()}),Yr(()=>{(g()??null)!==e(d)&&(console.log(`Locale changed from ${e(d)} to ${g()}`),a(d,g()??null,!0))});function he(m){if(m.detail&&typeof m.detail.assistantId=="number"){const _=m.detail.assistantId;console.log(`Assistant created with ID: ${_}, navigating to list view.`),ia(`${oa}/assistants`,{replaceState:!0})}else console.error("handleAssistantCreated received event without expected detail:",m),a(B,"Failed to navigate to new assistant. Event detail missing."),be()}async function ke(m){const{id:_,name:S}=m.detail;console.log(`Duplicate request received for ID: ${_}, Name: ${S}`),a(Z,_,!0),a(we,S,!0),a(ne,null),a(Ve,!0),a(ve,!1),a(pe,"");try{const L=await ns(_);if(L){a(ne,L,!0);const U=S.includes("_")?S.substring(S.indexOf("_")+1):S;a(Ie,`Copy_${U}`),a(ve,!0)}else throw new Error(`Assistant with ID ${_} not found.`)}catch(L){console.error("Error fetching assistant details for duplication:",L),a(pe,L instanceof Error?L.message:s()("error_fetching_assistant"),!0),alert(`Error preparing duplication: ${e(pe)}`)}finally{a(Ve,!1)}}async function Y(m){const _=m.detail.newName;if(!e(ne)||!_){a(pe,"Missing data for duplication.");return}a(Re,!0),a(pe,"");try{const S=e(ne),L={name:_,description:S.description||"",system_prompt:S.system_prompt||S.instructions||"",prompt_template:S.prompt_template||"",metadata:S.metadata||S.api_callback||"",pre_retrieval_endpoint:S.pre_retrieval_endpoint||"",post_retrieval_endpoint:S.post_retrieval_endpoint||"",RAG_endpoint:S.RAG_endpoint||"",RAG_Top_k:S.RAG_Top_k??3,RAG_collections:S.RAG_collections||""};console.log("Creating duplicate assistant with data:",L);const U=await xs(L);if(U&&U.assistant_id)console.log("Duplicate created successfully, ID:",U.assistant_id),a(ve,!1),a(Z,null),a(ne,null),a(we,null),a(Ie,""),ia(`${oa}/assistants?view=detail&id=${U.assistant_id}`,{replaceState:!0});else throw new Error("Create operation did not return a valid assistant ID.")}catch(S){console.error("Error creating duplicate assistant:",S),a(pe,S instanceof Error?S.message:s()("assistants.duplicateModal.submitError",{default:"Failed to create duplicate."}),!0)}finally{a(Re,!1)}}function de({detail:m}){const{id:_,name:S,published:L}=m;if(console.log(`Delete request received for ID: ${_}, Name: ${S}, Published: ${L}`),L){alert(e(d)?s()("assistants.deleteErrorPublished"):"Cannot delete a published assistant. Please unpublish it first.");return}a($e,_,!0),a(_e,S,!0),a(We,""),a(Q,!0)}async function Me(){var m;if(e($e)){a(He,!0),a(We,"");try{console.log(`Attempting to delete assistant ID: ${e($e)}`),await Is(e($e)),console.log(`Assistant ${e($e)} deleted successfully.`),a(Q,!1);const _=e($e);a($e,null),a(_e,null),e(l)==="detail"&&((m=e(x))==null||m.id,_.toString()),be()}catch(_){console.error(`Error deleting assistant ${e($e)}:`,_),a(We,_ instanceof Error?_.message:s()("assistants.deleteModal.deleteError",{default:"Failed to delete assistant."}),!0)}finally{a(He,!1)}}}function Tt(m){if(!m)return"assistant_export.json";const _=m.match(/filename=["']?([^"';]+)["']?/);return(_==null?void 0:_[1])||"assistant_export.json"}async function tr({detail:m}){var L;const{id:_}=m;if(console.log(`Export request received for ID: ${_}`),e(F))return;a(k,_,!0),a(F,!0);let S=null;try{if(is&&(S=localStorage.getItem("userToken")),!S)throw new Error("Authentication token not found.");let U="";try{const R=Ua();if(U=(L=R==null?void 0:R.api)==null?void 0:L.lambServer,!U)throw new Error}catch{throw console.error("Failed to get server URL from config for export"),new Error("Configuration error, cannot determine export URL.")}const Be=`${U.replace(/\/$/,"")}/creator/assistant/export/${_}`;console.log(`Fetching export from: ${Be}`);const te=await fetch(Be,{headers:{Authorization:`Bearer ${S}`}});if(!te.ok){let R=`Failed to export assistant ${_}`;try{const z=await te.json();R=(z==null?void 0:z.detail)||`${R} (Status: ${te.status})`}catch{R=`${R} (Status: ${te.status})`}throw new Error(R)}const c=te.headers.get("Content-Disposition"),h=Tt(c),I=await te.blob(),y=URL.createObjectURL(I),N=document.createElement("a");N.href=y,N.download=h,document.body.appendChild(N),N.click(),document.body.removeChild(N),URL.revokeObjectURL(y),console.log(`Successfully triggered download for ${h}`)}catch(U){console.error("Error during assistant export:",U),alert(`Export failed: ${U instanceof Error?U.message:"Unknown error"}`)}finally{a(F,!1),a(k,null)}}async function rr(){if(!e(x)||!e(x).id)return;const m=parseInt(e(x).id,10),S=!e(x).published;a(P,!0),a(A,"");let L=null;try{if(is&&(L=localStorage.getItem("userToken")),!L)throw new Error("Authentication token not found.");console.log(`Attempting to set publish status for ${m} to ${S}`);const U=await Ds(m,S);a(x,U,!0),console.log("Publish status updated successfully.")}catch(U){console.error("Error toggling publish status:",U),a(A,U instanceof Error?U.message:"Failed to update publish status.",!0),alert(`Error: ${e(A)}`)}finally{a(P,!1)}}async function qr(){var S,L;if(e(W)||e(ee))return;let m="";const _=((S=e(x))==null?void 0:S.metadata)||((L=e(x))==null?void 0:L.api_callback);if(_)try{m=JSON.parse(_).rag_processor}catch(U){console.error("Error parsing metadata for KB fetch check:",U)}if(m!=="simple_rag"){console.log("Skipping KB fetch for detail view (not simple_rag)"),a(T,[],!0),a(le,""),a(ee,!0);return}console.log("Fetching knowledge bases for detail view..."),a(W,!0),a(le,""),a(T,[],!0);try{const U=await hs();U.sort((Be,te)=>Be.name.localeCompare(te.name)),a(T,U,!0),console.log("Fetched KBs for detail view:",e(T))}catch(U){console.error("Error fetching knowledge bases for detail view:",U),a(le,U instanceof Error?U.message:"Failed to load knowledge bases",!0)}finally{a(W,!1),a(ee,!0)}}Yr(()=>{var S,L,U;const m=(L=(S=e(x))==null?void 0:S.id)==null?void 0:L.toString(),_=(U=e(O))==null?void 0:U.toString();e(l)==="detail"&&m&&m===_&&!e(ee)&&(console.log(`$effect triggering KB fetch for detail view (ID: ${m})`),qr()),(e(l)!=="detail"||m&&_&&m!==_)&&e(ee)&&(console.log(`$effect resetting KB fetch trigger. CurrentView: ${e(l)}, assistantIdStr: ${m}, lastAttemptedIdStr: ${_}`),a(ee,!1),a(T,[],!0),a(le,""))});var Dt=yn(),kr=Je(Dt),Zt=r(kr,!0);t(kr);var ar=o(kr,2),sr=r(ar),or=r(sr);or.__click=be;var ce=r(or,!0);t(or);var ae=o(or,2);ae.__click=se;var oe=r(ae,!0);t(ae);var Ce=o(ae,2);Ce.__click=[Ui,x,l,J,H];var tt=r(Ce,!0);t(Ce);var fe=o(Ce,2);{var me=m=>{var _=Oi(),S=r(_),L=r(S),U=o(L);{var Be=te=>{var c=yr();p(h=>i(c,`(${h??""})`),[()=>{var h;return((h=e(x).name)==null?void 0:h.replace(/^\d+_/,""))||"..."}]),n(te,c)};b(U,te=>{e(x)&&te(Be)})}t(S),t(_),p(te=>i(L,`${te??""} `),[()=>e(d)?s()("assistants.detailViewTab"):"Assistant Detail"]),n(m,_)};b(fe,m=>{e(l)==="detail"&&(e(x)||e(X))&&m(me)})}t(sr),t(ar);var Ge=o(ar,2);{var rt=m=>{var _=ji(),S=r(_),L=r(S);ao(L,{$$events:{duplicate:ke,delete:de,export:tr}}),t(S),t(_),n(m,_)},Ye=(m,_)=>{{var S=U=>{fs(U,{assistant:null,$$events:{formSuccess:he}})},L=(U,Be)=>{{var te=h=>{var I=Gi(),y=r(I),N=r(y);Pi(N,{}),t(y),t(I),n(h,I)},c=(h,I)=>{{var y=R=>{var z=_n(),ie=Je(z),G=r(ie);G.__click=[Ki,H];var V=r(G,!0);t(G);var K=o(G,2);K.__click=[zi,H];var re=r(K,!0);t(K);var Le=o(K,2);Le.__click=[qi,H];var Mt=r(Le),ir=o(Mt);{var Ar=Ue=>{var ft=yr();p((ot,it)=>i(ft,`${ot??""} ${it??""}`),[()=>e(d)?s()("assistants.detail.chatWith",{default:"with"}):"with",()=>e(x).name.replace(/^\d+_/,"")]),n(Ue,ft)};b(ir,Ue=>{e(x)&&e(x).name&&Ue(Ar)})}t(Le),t(ie);var Se=o(ie,2),ge=r(Se);{var Er=Ue=>{var ft=Ji(),ot=r(ft,!0);t(ft),p(it=>i(ot,it),[()=>e(d)?s()("assistants.loadingDetail"):"Loading assistant details..."]),n(Ue,ft)},pt=(Ue,ft)=>{{var ot=wt=>{var Lr=Vi(),nr=r(Lr),Fr=r(nr,!0);t(nr);var Xt=o(nr,2),Br=r(Xt,!0);t(Xt);var Ur=o(Xt,2);Ur.__click=be;var $r=r(Ur,!0);t(Ur),t(Lr),p((_t,kt)=>{i(Fr,_t),i(Br,e(B)),i($r,kt)},[()=>e(d)?s()("assistants.errorTitle"):"Error:",()=>e(d)?s()("common.backToList"):"Back to list"]),n(wt,Lr)},it=(wt,Lr)=>{{var nr=Fr=>{var Xt=Rr(),Br=Je(Xt);{var Ur=_t=>{var kt=pn(),lr=Je(kt),Gt=r(lr),mt=r(Gt,!0);t(Gt);var At=o(Gt,2),Et=r(At);Et.__click=[Hi,H];var nt=r(Et,!0);t(Et);var Rt=o(Et,2);Rt.__click=[Wi,ke,x];var fr=r(Rt,!0);t(Rt);var Lt=o(Rt,2);Lt.__click=[Yi,tr,x];var Or=r(Lt);{var Ft=Qe=>{var gt=Zi(),qt=o(Je(gt),1,!0);p($=>i(qt,$),[()=>e(d)?s()("common.exporting",{default:"Exporting..."}):"Exporting..."]),n(Qe,gt)},dr=Qe=>{var gt=yr();p(qt=>i(gt,qt),[()=>e(d)?s()("common.export",{default:"Export"}):"Export"]),n(Qe,gt)};b(Or,Qe=>{e(F)&&e(k)===e(x).id?Qe(Ft):Qe(dr,!1)})}t(Lt);var $t=o(Lt,2);$t.__click=rr;var Cr=r($t);{var ht=Qe=>{var gt=Xi(),qt=o(Je(gt),1,!0);p($=>i(qt,$),[()=>e(d)?s()("common.updating",{default:"Updating..."}):"Updating..."]),n(Qe,gt)},Kt=(Qe,gt)=>{{var qt=E=>{var D=yr();p(xe=>i(D,xe),[()=>e(d)?s()("common.unpublish",{default:"Unpublish"}):"Unpublish"]),n(E,D)},$=E=>{var D=yr();p(xe=>i(D,xe),[()=>e(d)?s()("common.publish",{default:"Publish"}):"Publish"]),n(E,D)};b(Qe,E=>{var D;(D=e(x))!=null&&D.published?E(qt):E($,!1)},gt)}};b(Cr,Qe=>{e(P)?Qe(ht):Qe(Kt,!1)})}t($t);var zt=o($t,2);zt.__click=[Qi,de,x];var Sr=r(zt,!0);t(zt),t(At),t(lr);var Zr=o(lr,2),Xr=r(Zr),jr=r(Xr),Qr=r(jr),ja=r(Qr);na(),t(Qr);var ea=o(Qr,2),Ga=r(ea,!0);t(ea),t(jr);var ba=o(jr,2),_a=r(ba),ha=r(_a,!0);t(_a);var ua=o(_a,2),Ka=r(ua,!0);t(ua),t(ba);var Jr=o(ba,2),xa=r(Jr),za=r(xa,!0);t(xa);var ya=o(xa,2),qa=r(ya,!0);t(ya),t(Jr);var wa=o(Jr,2),ka=r(wa),Da=r(ka,!0);t(ka);var Aa=o(ka,2),Ma=r(Aa,!0);t(Aa),t(wa),t(Xr);var Ja=o(Xr,2);{var Ea=Qe=>{var gt=vn(),qt=r(gt);{var $=Ee=>{var Oe=en(),ze=r(Oe),Ct=r(ze,!0);t(ze);var at=o(ze),bt=o(at),lt=r(bt),mr=r(lt),St=r(mr);t(mr);var Bt=o(mr,2),Gr=r(Bt);t(Bt),t(lt);var et=o(lt,2),xt=r(et),gr=r(xt);t(xt);var cr=o(xt,2),ur=r(cr,!0);t(cr),t(et);var Qt=o(et,2),Pr=r(Qt),br=r(Pr);t(Pr),na(2),t(Qt),t(bt),t(Oe),p((Jt,Fe,qe,Ut,_r,Pt)=>{i(Ct,Jt),i(at,` ${Fe??""} `),i(St,`${qe??""}:`),i(Gr,`${e(j)??""}/lamb/v1/lti_users/lti`),i(gr,`${Ut??""}:`),i(ur,_r),i(br,`${Pt??""}:`)},[()=>e(d)?s()("assistants.detail.ltiTitle",{default:"LTI Publish Details"}):"LTI Publish Details",()=>console.log("Checking selectedAssistantData for LTI box:",e(x)),()=>e(d)?s()("assistants.detail.ltiToolUrl",{default:"Tool URL"}):"Tool URL",()=>e(d)?s()("assistants.detail.ltiConsumerKey",{default:"Consumer Key"}):"Consumer Key",()=>e(x).oauth_consumer_name||(e(d)?s()("common.notAvailable",{default:"N/A"}):"N/A"),()=>e(d)?s()("assistants.detail.ltiSecret",{default:"Secret"}):"Secret"]),n(Ee,Oe)};b(qt,Ee=>{e(x).published&&Ee($)})}var E=o(qt,2),D=r(E),xe=r(D,!0);t(D);var Pe=o(D,2);{var Ae=Ee=>{var Oe=un();const ze=Wr(()=>(()=>{try{const Xe=e(x).metadata||e(x).api_callback;return typeof Xe=="string"?JSON.parse(Xe):Xe||{}}catch(Xe){return console.error("Error parsing metadata:",Xe),{}}})());var Ct=r(Oe),at=r(Ct),bt=r(at,!0);t(at);var lt=o(at,2),mr=r(lt,!0);t(lt),t(Ct);var St=o(Ct,2),Bt=r(St),Gr=r(Bt,!0);t(Bt);var et=o(Bt,2),xt=r(et,!0);t(et),t(St);var gr=o(St,2),cr=r(gr),ur=r(cr,!0);t(cr);var Qt=o(cr,2),Pr=r(Qt,!0);t(Qt),t(gr);var br=o(gr,2),Jt=r(br),Fe=r(Jt,!0);t(Jt);var qe=o(Jt,2),Ut=r(qe,!0);t(qe),t(br);var _r=o(br,2);{var Pt=Xe=>{var Ot=cn(),Nt=r(Ot),er=r(Nt,!0);t(Nt);var Vt=o(Nt,2);{var hr=dt=>{var ct=tn(),Ht=r(ct),Vr=r(Ht,!0);t(Ht);var zr=o(Ht,2),ta=r(zr,!0);t(zr),t(ct),p(Ca=>{i(Vr,Ca),i(ta,e(x).RAG_Top_k??3)},[()=>s()("assistants.form.ragTopK.label",{default:"RAG Top K"})]),n(dt,ct)};b(Vt,dt=>{e(ze).rag_processor!=="single_file_rag"&&dt(hr)})}var Nr=o(Vt,2);{var $a=dt=>{var ct=ln(),Ht=r(ct),Vr=r(Ht,!0);t(Ht);var zr=o(Ht,2);{var ta=Ir=>{var Sa=rn(),Va=r(Sa,!0);t(Sa),p(Ha=>i(Va,Ha),[()=>s()("assistants.form.knowledgeBases.loading",{default:"Loading..."})]),n(Ir,Sa)},Ca=(Ir,Sa)=>{{var Va=va=>{var Pa=an(),Wa=r(Pa,!0);t(Pa),p(Ya=>i(Wa,Ya),[()=>s()("assistants.form.knowledgeBases.error",{default:"Error loading KBs"})]),n(va,Pa)},Ha=(va,Pa)=>{{var Wa=pa=>{var ra=on();It(ra,21,()=>e(x).RAG_collections.split(","),pr,(Za,Ra)=>{var Xa=sn();const as=Wr(()=>e(T).find(ws=>ws.id===e(Ra)));var ys=r(Xa,!0);t(Xa),p(()=>i(ys,e(as)?e(as).name:`${e(Ra)} (Not Found)`)),n(Za,Xa)}),t(ra),n(pa,ra)},Ya=pa=>{var ra=nn(),Za=r(ra,!0);t(ra),p(Ra=>i(Za,Ra),[()=>s()("common.none",{default:"None"})]),n(pa,ra)};b(va,pa=>{e(x).RAG_collections?pa(Wa):pa(Ya,!1)},Pa)}};b(Ir,va=>{e(le)?va(Va):va(Ha,!1)},Sa)}};b(zr,Ir=>{e(W)?Ir(ta):Ir(Ca,!1)})}t(ct),p(Ir=>i(Vr,Ir),[()=>s()("assistants.form.knowledgeBases.label",{default:"Knowledge Bases"})]),n(dt,ct)};b(Nr,dt=>{e(ze).rag_processor==="simple_rag"&&dt($a)})}var Kr=o(Nr,2);{var xr=dt=>{var ct=dn(),Ht=r(ct),Vr=r(Ht,!0);t(Ht);var zr=o(Ht,2),ta=r(zr,!0);t(zr),t(ct),p((Ca,Ir)=>{i(Vr,Ca),i(ta,Ir)},[()=>s()("assistants.form.singleFile.selectedLabel",{default:"Selected File"}),()=>e(ze).file_path||(e(d)?s()("common.notSpecified",{default:"Not specified"}):"Not specified")]),n(dt,ct)};b(Kr,dt=>{e(ze).rag_processor==="single_file_rag"&&dt(xr)})}t(Ot),p(dt=>i(er,dt),[()=>s()("assistants.form.ragOptions.title",{default:"RAG Options"})]),n(Xe,Ot)};b(_r,Xe=>{e(ze).rag_processor&&e(ze).rag_processor!=="no_rag"&&Xe(Pt)})}t(Oe),p((Xe,Ot,Nt,er,Vt,hr,Nr,$a)=>{i(bt,Xe),i(mr,Ot),i(Gr,Nt),i(xt,er),i(ur,Vt),i(Pr,hr),i(Fe,Nr),i(Ut,$a)},[()=>e(d)?s()("assistants.form.promptProcessor.label",{default:"Prompt Processor"}):"Prompt Processor",()=>e(ze).prompt_processor||(e(d)?s()("common.notSpecified",{default:"Not specified"}):"Not specified"),()=>e(d)?s()("assistants.form.connector.label",{default:"Connector"}):"Connector",()=>e(ze).connector||(e(d)?s()("common.notSpecified",{default:"Not specified"}):"Not specified"),()=>e(d)?s()("assistants.form.llm.label",{default:"Language Model (LLM)"}):"Language Model (LLM)",()=>e(ze).llm||(e(d)?s()("common.notSpecified",{default:"Not specified"}):"Not specified"),()=>e(d)?s()("assistants.form.ragProcessor.label",{default:"RAG Processor"}):"RAG Processor",()=>{var Xe;return((Xe=e(ze).rag_processor)==null?void 0:Xe.replace(/_/g," ").replace(/\b\w/g,Ot=>Ot.toUpperCase()))||(e(d)?s()("common.notSpecified",{default:"Not specified"}):"Not specified")}]),n(Ee,Oe)};b(Pe,Ee=>{e(x)&&Ee(Ae)})}t(E),t(gt),p(Ee=>i(xe,Ee),[()=>e(d)?s()("assistants.detail.configuration",{default:"Configuration"}):"Configuration"]),n(Qe,gt)};b(Ja,Qe=>{e(x)&&Qe(Ea)})}t(Zr),p((Qe,gt,qt,$,E,D,xe,Pe,Ae,Ee,Oe,ze)=>{var Ct;i(mt,Qe),i(nt,gt),Rt.disabled=e(Ve),i(fr,qt),Lt.disabled=e(F)&&e(k)===e(x).id,yt($t,1,`px-3 py-1 text-sm font-medium rounded text-white transition-colors ${(Ct=e(x))!=null&&Ct.published?"bg-yellow-600 hover:bg-yellow-700 disabled:bg-gray-400 disabled:cursor-not-allowed":"bg-green-600 hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed"}`),$t.disabled=e(P),i(Sr,$),i(ja,`${E??""} `),i(Ga,D),i(ha,xe),i(Ka,Pe),i(za,Ae),i(qa,Ee),i(Da,Oe),i(Ma,ze)},[()=>e(d)?s()("assistants.detail.propertiesTitle",{default:"Assistant Properties"}):"Assistant Properties",()=>e(d)?s()("common.edit",{default:"Edit"}):"Edit",()=>e(d)?s()("common.duplicate"):"Duplicate",()=>e(d)?s()("common.delete"):"Delete",()=>s()("assistants.form.name.label"),()=>{var Qe;return((Qe=e(x).name)==null?void 0:Qe.replace(/^\d+_/,""))||(e(d)?s()("common.notAvailable",{default:"N/A"}):"N/A")},()=>s()("assistants.form.description.label",{default:"Description"}),()=>e(x).description||(e(d)?s()("common.notSpecified",{default:"Not specified"}):"Not specified"),()=>s()("assistants.form.systemPrompt.label",{default:"System Prompt"}),()=>e(x).system_prompt||(e(d)?s()("common.notSpecified",{default:"Not specified"}):"Not specified"),()=>s()("assistants.form.promptTemplate.label",{default:"Prompt Template"}),()=>e(x).prompt_template||(e(d)?s()("common.notSpecified",{default:"Not specified"}):"Not specified")]),n(_t,kt)},$r=(_t,kt)=>{{var lr=mt=>{var At=fn(),Et=r(At),nt=r(Et),Rt=r(nt,!0);t(nt),t(Et);var fr=o(Et,2),Lt=r(fr);fs(Lt,{get assistant(){return e(x)},id:"assistant-edit-form",$$events:{formSuccess:()=>{je(e(x).id),a(H,"properties")}}}),t(fr),t(At),p(Or=>i(Rt,Or),[()=>e(d)?s()("assistants.detail.editTitle",{default:"Edit Assistant"}):"Edit Assistant"]),n(mt,At)},Gt=(mt,At)=>{{var Et=nt=>{var Rt=Rr(),fr=Je(Rt);{var Lt=Ft=>{var dr=mn(),$t=r(dr),Cr=r($t,!0);t($t);var ht=o($t,2),Kt=r(ht);t(ht),t(dr),p((zt,Sr)=>{i(Cr,zt),i(Kt,`${e(ye)??""} - ${Sr??""}`)},[()=>e(d)?s()("assistants.detail.configErrorTitle",{default:"Configuration Error:"}):"Configuration Error:",()=>e(d)?s()("assistants.chatDisabled"):"Chat functionality is disabled."]),n(Ft,dr)},Or=(Ft,dr)=>{{var $t=ht=>{var Kt=gn(),zt=Je(Kt),Sr=r(zt),Zr=r(Sr,!0);t(Sr),t(zt);var Xr=o(zt,2);si(Xr,{get apiUrl(){return e(j)},get apiKey(){return e(Ne)},get assistantId(){return e(x).id},get initialModel(){return e(x).llm}}),p(jr=>i(Zr,jr),[()=>e(d)?s()("assistants.detail.chatTitle",{default:"Chat"}):"Chat"]),n(ht,Kt)},Cr=ht=>{var Kt=bn(),zt=r(Kt,!0);t(Kt),p(Sr=>i(zt,Sr),[()=>e(d)?s()("assistants.chatLoadingConfig"):"Loading chat configuration..."]),n(ht,Kt)};b(Ft,ht=>{e(j)&&e(Ne)?ht($t):ht(Cr,!1)},dr)}};b(fr,Ft=>{e(ye)?Ft(Lt):Ft(Or,!1)})}n(nt,Rt)};b(mt,nt=>{e(H)==="chat"&&nt(Et)},At)}};b(_t,mt=>{e(H)==="edit"?mt(lr):mt(Gt,!1)},kt)}};b(Br,_t=>{e(H)==="properties"?_t(Ur):_t($r,!1)})}n(Fr,Xt)};b(wt,Fr=>{e(x)&&Fr(nr)},Lr)}};b(Ue,wt=>{e(B)?wt(ot):wt(it,!1)},ft)}};b(ge,Ue=>{e(X)?Ue(Er):Ue(pt,!1)})}t(Se),p((Ue,ft,ot)=>{yt(G,1,`py-2 px-4 text-sm font-medium rounded-t-md ${e(H)==="properties"?"bg-gray-100 border border-b-0 border-gray-300 text-brand":"text-gray-600 hover:text-gray-800"}`),i(V,Ue),yt(K,1,`py-2 px-4 text-sm font-medium rounded-t-md ${e(H)==="edit"?"bg-gray-100 border border-b-0 border-gray-300 text-brand":"text-gray-600 hover:text-gray-800"}`),i(re,ft),yt(Le,1,`py-2 px-4 text-sm font-medium rounded-t-md ${e(H)==="chat"?"bg-gray-100 border border-b-0 border-gray-300 text-brand":"text-gray-600 hover:text-gray-800"}`),i(Mt,`${ot??""} `)},[()=>e(d)?s()("assistants.detail.propertiesTab",{default:"Properties"}):"Properties",()=>e(d)?s()("assistants.detail.editTab",{default:"Edit"}):"Edit",()=>e(d)?s()("assistants.detail.chatTab",{default:"Chat"}):"Chat"]),n(R,z)},N=R=>{var z=hn(),ie=r(z,!0);t(z),p(G=>i(ie,G),[()=>e(d)?s()("assistants.noAssistantData"):"Assistant data not available."]),n(R,z)};b(h,R=>{e(l)==="detail"?R(y):R(N,!1)},I)}};b(U,h=>{e(l)==="mcp"?h(te):h(c,!1)},Be)}};b(m,U=>{e(l)==="create"?U(S):U(L,!1)},_)}};b(Ge,m=>{e(l)==="list"?m(rt):m(Ye,!1)})}var st=o(Ge,2);{var vt=m=>{Di(m,{get originalName(){return e(we)},get defaultNewName(){return e(Ie)},get error(){return e(pe)},get isOpen(){return e(ve)},set isOpen(_){a(ve,_,!0)},get isSubmitting(){return e(Re)},set isSubmitting(_){a(Re,_,!0)},$$events:{submit:Y,close:()=>{a(ve,!1),a(Z,null),a(ne,null),a(pe,"")}}})};b(st,m=>{e(ve)&&m(vt)})}var Ke=o(st,2);{var Te=m=>{const _=Wr(()=>e(_e)||"");Bi(m,{get assistantName(){return e(_)},get error(){return e(We)},get isOpen(){return e(Q)},set isOpen(S){a(Q,S,!0)},get isDeleting(){return e(He)},set isDeleting(S){a(He,S,!0)},$$events:{confirm:Me,close:()=>{a(Q,!1),a($e,null),a(_e,null),a(We,"")}}})};b(Ke,m=>{e(Q)&&m(Te)})}var De=o(Ke,2);{var Ze=m=>{var _=xn(),S=r(_,!0);t(_),p(L=>i(S,L),[()=>e(d)?s()("assistants.loadingDetail"):"Loading assistant details..."]),n(m,_)};b(De,m=>{e(X)&&m(Ze)})}p((m,_,S,L)=>{i(Zt,m),yt(or,1,`whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm rounded-t-md transition-colors duration-150 ${e(l)==="list"?"bg-brand text-white border-brand":"border-transparent text-gray-800 hover:text-gray-900 hover:border-gray-400"}`),es(or,e(l)==="list"?"background-color: #2271b3; color: white; border-color: #2271b3;":""),i(ce,_),yt(ae,1,`whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm rounded-t-md ${e(l)==="create"?"bg-brand text-white border-brand":"border-transparent text-gray-800 hover:text-gray-900 hover:border-gray-400"}`),es(ae,e(l)==="create"?"background-color: #2271b3; color: white; border-color: #2271b3;":""),i(oe,S),yt(Ce,1,`whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm rounded-t-md ${e(l)==="mcp"?"bg-brand text-white border-brand":"border-transparent text-gray-800 hover:text-gray-900 hover:border-gray-400"}`),es(Ce,e(l)==="mcp"?"background-color: #2271b3; color: white; border-color: #2271b3;":""),i(tt,L)},[()=>e(d)?s()("assistants.title"):"Learning Assistants",()=>e(d)?s()("assistants.myAssistantsTab"):"My Assistants",()=>e(d)?s()("assistants.createAssistantTab"):"Create Assistant",()=>e(d)?s()("assistants.mcpTestingTab",{default:"MCP Testing"}):"MCP Testing"]),n(M,Dt),da(),q()}ma(["click"]);export{jn as component};
