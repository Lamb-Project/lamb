import"../chunks/Bzak7iHL.js";import{d as ye,p as Se,s as b,a as ae,u as ne,f as h,b as u,t as O,e as ke,g as t,c as p,h as Ee,i as a,j as m,r as g,k as ie,l as G,m as Y,n as Ie,o as $e,q as Ae}from"../chunks/D10uF6KO.js";import{i as I}from"../chunks/B5RjaZpx.js";import{e as le,i as de}from"../chunks/BY88_K0J.js";import{r as Me,s as ce}from"../chunks/gDFrtnMu.js";import{b as Ce}from"../chunks/CF2p2rhS.js";import{b as De}from"../chunks/DRu2A6f6.js";import"../chunks/CjgJlaKl.js";function Re(Z,U){U()}var Pe=h('<div class="flex items-center"><svg class="animate-spin mr-3 h-5 w-5 text-indigo-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> <span>Loading available models...</span></div>'),Te=h('<div class="text-red-500 mb-2"> </div> <button class="px-4 py-1 bg-indigo-500 text-white rounded hover:bg-indigo-600">Retry</button>',1),ze=h("<p>No models available.</p>"),Le=h("<option> </option>"),Oe=h('<div class="flex items-center"><label for="model-select" class="mr-2">Choose a model:</label> <select id="model-select" class="border p-2 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"></select></div>'),Ue=h('<span class="ml-1 inline-block w-2 h-4 bg-current animate-pulse"></span>'),qe=h("<div><div> <!></div></div>"),Be=h('<div class="text-left"><div class="inline-block px-4 py-2 rounded-lg bg-gray-200 text-gray-800 animate-pulse">...</div></div>'),Ne=Ie('<svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> Sending...',1),Fe=h('<div class="space-y-6"><h1 class="text-2xl font-bold text-gray-800">OpenAI Chat</h1> <div class="p-4 border rounded-md bg-white shadow-sm"><h2 class="text-lg font-semibold text-gray-700">Connection Details</h2> <p></p> <p></p></div> <div class="p-4 border rounded-md bg-white shadow-sm"><h2 class="text-lg font-semibold text-gray-700 mb-2">Model Selection</h2> <!></div> <div class="p-4 border rounded-md bg-white shadow-sm space-y-4"><h2 class="text-lg font-semibold text-gray-700">Chat</h2> <div class="h-96 overflow-y-auto border rounded p-3 space-y-3 bg-gray-50" id="chat-messages"><!> <!></div> <form class="flex space-x-2"><input type="text" placeholder="Send a message..." class="flex-grow px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"/> <button type="submit" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-brand hover:bg-brand-hover focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand disabled:opacity-50 disabled:cursor-not-allowed" style="background-color: #2271b3;"><!></button></form></div></div>');function Ze(Z,U){Se(U,!0);let i=b(ae([])),$=b(""),k=b(!1),D=b(ae([])),E=b("gpt-3.5-turbo"),q=b(!1),R=b(null),B=b(!1);const N="http://localhost:9099",Q="0p3n-w3bu!";function n(e){const r=new Date().toISOString().split("T")[1].replace("Z","");console.log(`[${r}] ${e}`)}async function X(){a(q,!0),a(R,null);try{const e=await fetch(`${N}/models`,{method:"GET",headers:{Authorization:`Bearer ${Q}`}});if(!e.ok)throw new Error(`Failed to fetch models: ${e.status}`);const r=await e.json();if(r.data&&Array.isArray(r.data)){const o=r.data.map(d=>d.id).sort();if(a(D,o,!0),o.length>0){const d=o.filter(f=>f.includes("gpt"));d.length>0?a(E,d[0],!0):a(E,o[0],!0)}}else throw new Error("Invalid model data format")}catch(e){console.error("Error fetching models:",e);const r=e instanceof Error?e.message:"Failed to load models";a(R,r,!0),a(D,["gpt-3.5-turbo","gpt-4"],!0)}finally{a(q,!1)}}ne(()=>{const e=document.getElementById("chat-messages");e&&(e.scrollTop=e.scrollHeight)}),ne(()=>{localStorage.removeItem("messages"),localStorage.removeItem("userInputField"),X()});function ue(e){if(!e)return;const r=Date.now();n(`Starting UI update with content length: ${e.length}`);const o=t(i).length-1;o>=0&&t(i)[o].role==="assistant"?(n(`Found assistant message at index ${o}, updating content`),a(i,[...t(i).slice(0,o),{...t(i)[o],content:e}],!0)):n("No assistant message found to update"),n(`Message store updated in ${Date.now()-r}ms`)}async function pe(e){var d,f,v;e.preventDefault();const r=t($);if(!r.trim())return;n(`Submitting message: "${r}"`);const o={id:Date.now().toString(),role:"user",content:r};a(i,[...t(i),o],!0),a($,""),a(k,!0),a(B,!0);try{const l=t(i).map(s=>({role:s.role,content:s.content}));n(`Sending request with ${l.length} messages to model: ${t(E)}`);const c={id:(Date.now()+1).toString(),role:"assistant",content:""};a(i,[...t(i),c],!0),n("Added placeholder assistant message");const w=Date.now(),A={method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${Q}`},body:JSON.stringify({model:t(E),messages:l,stream:!0})};n(`Request details prepared, connecting to ${N}/chat/completions`);try{const s=await fetch(`${N}/chat/completions`,A);if(n(`API responded in ${Date.now()-w}ms with status: ${s.status}`),!s.ok)throw new Error(`API error: ${s.status}`);if(!s.body)throw new Error("Response body is not readable");n("Starting to process response stream");const x=s.body.getReader(),M=new TextDecoder;let _="",y="";for(;;){const{done:S,value:T}=await x.read();if(S){n("Stream completed");break}n(`Received chunk of size: ${T.byteLength} bytes`);const z=M.decode(T,{stream:!0});y+=z;const se=y.split(`
`);y=se.pop()||"";for(const W of se){if(!W.trim()||!W.startsWith("data: "))continue;const oe=W.slice(5).trim();if(oe!=="[DONE]")try{const C=(v=(f=(d=JSON.parse(oe).choices)==null?void 0:d[0])==null?void 0:f.delta)==null?void 0:v.content;C&&(_+=C,n(`Received text: "${C}" (current length: ${_.length})`),ue(_))}catch(L){const C=L instanceof Error?L.message:String(L);n(`Error parsing: ${C}`)}}}n("Streaming completed successfully")}catch(s){throw n(`Stream error: ${s instanceof Error?s.message:String(s)}`),s}}catch(l){n(`Error during request: ${l instanceof Error?l.message:"Unknown error"}`),console.error("Error details:",l);const c={id:Date.now().toString(),role:"assistant",content:"Sorry, an error occurred. Please try again."};a(i,[...t(i),c],!0)}finally{a(k,!1),a(B,!1),n("Request handling completed")}}var F=Fe(),j=u(m(F),2),ee=u(m(j),2);ee.textContent="Using API URL: http://localhost:9099";var ge=u(ee,2);ge.textContent="Using API Key: 0p3n-w3bu!",g(j);var H=u(j,2),me=u(m(H),2);{var ve=e=>{var r=Pe();p(e,r)},fe=e=>{var r=ie(),o=G(r);{var d=v=>{var l=Te(),c=G(l),w=m(c,!0);g(c);var A=u(c,2);A.__click=[Re,X],O(()=>Y(w,t(R))),p(v,l)},f=v=>{var l=ie(),c=G(l);{var w=s=>{var x=ze();p(s,x)},A=s=>{var x=Oe(),M=u(m(x),2);le(M,21,()=>t(D),de,(_,y)=>{var S=Le(),T=m(S,!0);g(S);var z={};O(()=>{Y(T,t(y)),z!==(z=t(y))&&(S.value=(S.__value=t(y))??"")}),p(_,S)}),g(M),g(x),De(M,()=>t(E),_=>a(E,_)),p(s,x)};I(c,s=>{t(D).length===0?s(w):s(A,!1)},!0)}p(v,l)};I(o,v=>{t(R)?v(d):v(f,!1)},!0)}p(e,r)};I(me,e=>{t(q)?e(ve):e(fe,!1)})}g(H);var te=u(H,2),V=u(m(te),2),re=m(V);le(re,17,()=>t(i),de,(e,r)=>{var o=qe(),d=m(o),f=m(d),v=u(f);{var l=c=>{var w=Ue();p(c,w)};I(v,c=>{t(B)&&t(r).role==="assistant"&&t(r)===t(i)[t(i).length-1]&&c(l)})}g(d),g(o),O(()=>{ce(o,1,t(r).role==="user"?"text-right":"text-left"),ce(d,1,`inline-block px-4 py-2 rounded-lg ${t(r).role==="user"?"bg-blue-500 text-white":"bg-gray-200 text-gray-800"}`),Y(f,`${t(r).content??""} `)}),p(e,o)});var he=u(re,2);{var be=e=>{var r=Be();p(e,r)};I(he,e=>{t(k)&&t(i).length===0&&e(be)})}g(V);var J=u(V,2),P=m(J);Me(P);var K=u(P,2),we=m(K);{var xe=e=>{var r=Ne();$e(),p(e,r)},_e=e=>{var r=Ae("Send");p(e,r)};I(we,e=>{t(k)?e(xe):e(_e,!1)})}g(K),g(J),g(te),g(F),O(()=>{P.disabled=t(k),K.disabled=t(k)||!t($).length}),ke("submit",J,pe),Ce(P,()=>t($),e=>a($,e)),p(Z,F),Ee()}ye(["click"]);export{Ze as component};
