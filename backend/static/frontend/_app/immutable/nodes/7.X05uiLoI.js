import{t as v,e as D,a as f,r as Ve,s as A}from"../chunks/C82hPXC8.js";import{i as it}from"../chunks/C9TgNfkd.js";import{p as nt,ak as ct,o as br,al as ie,am as pt,t as b,c as p,i as e,a as dt,s as n,j as a,an as x,ao as u,r as c,ap as ge,aq as _e,f as Ye,e as mt}from"../chunks/DZNCS3vC.js";import{i as k}from"../chunks/fI70I6vP.js";import{e as V,i as ne}from"../chunks/D6J79d0_.js";import{r as be,s as hr,A as ut,a as ft,b as vt}from"../chunks/D5v_xaba.js";import{s as $}from"../chunks/D8EjMQFO.js";import{b as Y}from"../chunks/ei6fuu5i.js";import{b as he}from"../chunks/TETYgnKo.js";import{p as gt}from"../chunks/Bfc47y5P.js";import{s as _t,a as Ze}from"../chunks/CVH_3kCa.js";import{g as yr}from"../chunks/JSp2UL00.js";import{a as bt,g as ht,b as yt,c as wt}from"../chunks/Bms-deWG.js";import{g as xt}from"../chunks/BhMXpYJc.js";import{w as Qe}from"../chunks/DMe9dMdG.js";import"../chunks/GobYesUP.js";var kt=v('<div class="mb-4 p-4 bg-red-100 text-red-600 rounded-lg shadow-sm flex items-center gap-3 animate-fade-in relative overflow-hidden"><div class="absolute inset-0 bg-red-50 animate-pulse"></div> <div class="relative flex items-center gap-3 w-full"><div class="flex-shrink-0"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-8.707l-3-3a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path></svg></div> <div class="flex-grow"><div class="font-medium"> </div></div></div></div>'),At=v('<p class="text-red-500 text-sm mt-1"> </p>'),Tt=v('<button type="button" class="text-sm bg-gray-100 hover:bg-gray-200 text-gray-700 px-2 py-1 rounded-md transition-colors duration-200 flex items-center gap-1" title="Clear description"><svg class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg> <span>Clear</span></button>'),Gt=v('<div class="absolute inset-0 bg-blue-500 rounded-md animate-pulse"></div> <div class="relative flex items-center gap-2"><svg class="animate-spin h-4 w-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> <span>Generating...</span></div>',1),Rt=v('<svg class="h-4 w-4 transition-transform group-hover:scale-110" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-8.707l-3-3a1 1 0 00-1.414 1.414L10.586 9H7a1 1 0 100 2h3.586l-1.293 1.293a1 1 0 101.414 1.414l3-3a1 1 0 000-1.414z" clip-rule="evenodd"></path></svg> <span>Generate Description</span>',1),Ct=v('<div class="text-sm text-green-600 mb-2 flex items-center gap-2 animate-fade-in relative overflow-hidden rounded-md p-2 bg-green-50"><div class="absolute inset-0 bg-green-100 animate-pulse opacity-50"></div> <div class="relative flex items-center gap-2 w-full"><div class="flex-shrink-0"><div class="absolute -inset-1 bg-green-200 rounded-full animate-ping opacity-25"></div> <svg class="relative h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg></div> <span class="font-medium relative"> </span></div></div>'),Nt=v('<div class="absolute inset-0 bg-gray-50 bg-opacity-50 flex items-center justify-center rounded pointer-events-none"><div class="text-sm text-gray-500 flex items-center gap-2"><div class="relative"><div class="absolute -inset-1 bg-blue-100 rounded-full animate-ping opacity-25"></div> <svg class="relative animate-spin h-4 w-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg></div> <span class="font-medium">Generating description...</span> <span class="text-xs text-gray-400">(This may take a few seconds)</span></div></div>'),St=v("<span>Enter a name to enable description generation</span>"),Et=v("<span>Enter a system prompt to enable description generation</span>"),Dt=v('<p class="text-sm text-gray-500 mt-1 flex items-center gap-1"><svg class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg> <!></p>'),$t=v("<option> </option>"),jt=v("<option> </option>"),Ft=v("<option> </option>"),Lt=v("<option> </option>"),Pt=v('<div class="py-1 flex items-center justify-between"><span> </span> <a target="_blank" class="text-blue-500 hover:underline ml-2">Open</a></div>'),zt=v('<div class="mb-4"><label class="block text-gray-700 font-medium mb-1">Available Files (click to select)</label> <div class="border px-3 py-2 rounded overflow-y-auto max-h-40"></div></div> <div class="mb-4"><label class="block text-gray-700 font-medium mb-1">Upload New File</label> <input type="file" class="w-full border px-3 py-2 rounded"> <button type="button" class="mt-2 bg-blue-500 text-white px-4 py-2 rounded">Upload</button> <p class="text-sm text-gray-600 mt-1"> </p></div>',1),Ot=v('<div class="py-2 flex items-center justify-center"><div class="animate-spin rounded-full h-6 w-6 border-b-2 border-blue-500"></div> <span class="ml-2 text-gray-600">Loading knowledge bases...</span></div>'),Bt=v('<div class="text-red-500 py-2"> </div>'),Mt=v('<div class="text-gray-500 py-2">No knowledge bases available</div>'),It=v('<span class="ml-2 text-xs bg-blue-100 text-blue-800 px-2 py-0.5 rounded-full">My KB</span>'),qt=v('<span class="ml-2 text-xs bg-gray-100 text-gray-800 px-2 py-0.5 rounded-full">Public</span>'),Kt=v('<div class="text-sm text-gray-600"> </div>'),Jt=v('<div class="text-xs text-gray-500 mt-1"> </div>'),Ht=v('<div class="py-1 mb-1 border-b border-gray-100 last:border-0"><label class="flex items-start cursor-pointer hover:bg-blue-50 p-1 rounded"><input type="checkbox" class="mt-1"> <div class="ml-2"><div class="font-medium flex items-center"> <!></div> <!> <!></div></label></div>'),Ut=v('<div class="border px-3 py-2 rounded overflow-y-auto max-h-60 bg-white"></div> <div class="text-sm text-gray-600 mt-1"> </div>',1),Vt=v('<div class="mb-4"><label class="block text-gray-700 font-medium mb-1">RAG Top K</label> <input type="number" placeholder="e.g., 5" min="1"></div> <input type="hidden"> <div class="mb-4"><label class="block text-gray-700 font-medium mb-1">Knowledge Bases</label> <!></div>',1),Yt=v('<div class="absolute inset-0 bg-blue-600 animate-pulse"></div> <div class="relative flex items-center gap-2"><svg class="animate-spin h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> <span>Creating...</span></div>',1),Zt=v('<svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-8.707l-3-3a1 1 0 00-1.414 1.414L10.586 9H7a1 1 0 100 2h3.586l-1.293 1.293a1 1 0 101.414 1.414l3-3a1 1 0 000-1.414z" clip-rule="evenodd"></path></svg> <span>Create Assistant</span>',1),Qt=v('<div class="max-w-2xl mx-auto p-6 bg-white shadow-md rounded-md"><h1 class="text-2xl font-bold mb-4">Create New Assistant</h1> <!> <form><div class="mb-4"><label class="block text-gray-700 font-medium mb-1">Name (no spaces, max 20 chars)</label> <input type="text" required maxlength="20" pattern="[^\\s]+" placeholder="assistant_name"> <!></div> <div class="mb-4"><div class="flex justify-between items-center mb-1"><label class="block text-gray-700 font-medium">Description</label> <div class="flex items-center gap-2"><!> <button type="button"><!></button></div></div> <!> <div class="relative"><textarea rows="3"></textarea> <!></div> <!></div> <div class="mb-4"><label class="block text-gray-700 font-medium mb-1">System Prompt</label> <textarea rows="3" placeholder="Enter the system prompt for your assistant"></textarea></div> <div class="mb-4"><label class="block text-gray-700 font-medium mb-1">Prompt Template</label> <textarea class="w-full border px-3 py-2 rounded transition-all duration-200 border-gray-300 focus:border-blue-500 focus:ring-blue-200 focus:outline-none focus:ring-2" rows="3" placeholder="Enter the prompt template for your assistant (optional)"></textarea></div> <hr class="my-6"> <h2 class="text-xl font-semibold mb-4">API Callback Configuration</h2> <div class="mb-4"><label class="block text-gray-700 font-medium mb-1">Prompt Processor</label> <select required><option disabled selected>Select a prompt processor</option><!></select></div> <div class="mb-4"><label class="block text-gray-700 font-medium mb-1">Connector</label> <select required><option disabled selected>Select a connector</option><!></select></div> <div class="mb-4"><label class="block text-gray-700 font-medium mb-1">Language Model</label> <select required><option disabled selected>Select a language model</option><!></select></div> <div class="mb-4"><label class="block text-gray-700 font-medium mb-1">RAG Processor</label> <select required><option disabled selected>Select a RAG type</option><!></select></div> <!> <!> <div class="mt-8 flex items-center justify-between"><button type="button" class="text-gray-600 hover:text-gray-800 transition-colors duration-200">Cancel</button> <button type="submit"><div class="flex items-center gap-2"><!></div></button></div></form></div>');function fs(wr,xr){nt(xr,!1);const[ye,kr]=_t(),Z=()=>Ze(We,"$errorTimer",ye),Q=()=>Ze(Xe,"$successTimer",ye),ce=()=>Ze(xe,"$redirectTimer",ye),pe=x(),P=x();let r=x({name:"",description:"",system_prompt:"",prompt_template:"",prompt_processor:"",connector:"",llm:"",rag_processor:"",file_path:"",RAG_Top_k:"3",RAG_collections:"",selected_knowledge_bases:[]}),m=x(""),y=x(!1),G=x(""),de=new Set,R=x(""),C=x(!1),z=x(""),W=x([]),we=x(!1),M=x("");const We=Qe(null),Xe=Qe(null),xe=Qe(null);ct(()=>{Z()&&clearTimeout(Z()),Q()&&clearTimeout(Q()),ce()&&clearTimeout(ce())});async function er(){a(we,!0),a(M,"");try{a(W,await xt()),e(W).sort((t,s)=>t.isOwned&&!s.isOwned?-1:!t.isOwned&&s.isOwned?1:t.name.localeCompare(s.name)),console.log("Loaded knowledge bases:",e(W))}catch(t){console.error("Error fetching knowledge bases:",t),typeof t=="string"?a(M,t):t&&typeof t=="object"&&"message"in t&&typeof t.message=="string"?a(M,t.message):a(M,"Failed to fetch knowledge bases")}finally{a(we,!1)}}let I=x([]),F=x({}),q=x([]),j=x([]);async function rr(){try{const t=await ht();de=new Set(t.map(o=>o.name));const s=Array.from(de).map(o=>({fullName:o,unprefixedName:o.replace(/^\d+_/,""),hasPrefix:o.includes("_"),prefix:o.split("_")[0]}));console.log("Loaded existing assistants:",{total:s.length,names:s})}catch(t){throw console.error("Error loading existing assistants:",t),t}}function me(t){if(a(R,""),!(t!=null&&t.trim()))return!1;const s=t.trim();if(console.log("Validating name:",s),console.log("Existing names:",Array.from(de)),!/^[a-zA-Z0-9_-]+$/.test(s))return a(R,"Name can only contain letters, numbers, underscores, and hyphens"),console.log("Name validation failed: invalid characters"),!1;if(s.length>20)return a(R,"Name must be 20 characters or less"),console.log("Name validation failed: too long"),!1;if(s.length<3)return a(R,"Name must be at least 3 characters"),console.log("Name validation failed: too short"),!1;const o=Array.from(de).find(i=>{const l=i.replace(/^\d+_/,""),d=s.replace(/^\d+_/,""),g=l.toLowerCase()===d.toLowerCase();return g&&console.log("Found matching name:",{existing:i,unprefixedExisting:l,input:s,unprefixedNew:d}),g});if(o){const i=o.replace(/^\d+_/,"");return a(R,`An assistant named '${i}' already exists`),console.log("Name validation failed:",{matchingName:o,unprefixedMatch:i,input:s}),!1}return console.log("Name validation passed for:",s),!0}async function Ar(){console.log("Loading defaults, current formData:",JSON.stringify(e(r),null,2));try{const t=`${ut.lambServer}/static/json/defaults.json`;console.log("Accessing endpoint:",t);const o=await(await fetch(t)).text();console.log("Raw response text:",o);let i={};if(o&&o.trim()!=="")try{i=JSON.parse(o),console.log("Defaults loaded from server:",JSON.stringify(i,null,2))}catch(l){console.error("Error parsing JSON:",l),i=ke()}else console.warn("Empty response received, using fallback defaults"),i=ke();if(i!=null&&i.config){const l=i.config;if(l.system_prompt&&(console.log("Setting system_prompt from defaults:",l.system_prompt),u(r,e(r).system_prompt=l.system_prompt)),l.prompt_template&&(console.log("Setting prompt_template from defaults:",l.prompt_template),u(r,e(r).prompt_template=l.prompt_template)),l.prompt_processor&&u(r,e(r).prompt_processor=l.prompt_processor.trim()),l.connector&&u(r,e(r).connector=l.connector.trim()),l.llm&&u(r,e(r).llm=l.llm.trim()),l.rag_processor){const d=l.rag_processor.trim();u(r,e(r).rag_processor=d.toLowerCase()==="no rag"?"no_rag":d.toLowerCase().replace(/\s+/g,"_"))}console.log("After setting defaults, formData is:",JSON.stringify(e(r),null,2))}}catch(t){console.error("Error loading defaults:",t);const s=ke();s!=null&&s.config&&Tr(s.config)}}function ke(){return console.log("Using hardcoded fallback defaults"),{config:{lamb_helper_assistant:"lamb_assistant.1",system_prompt:"You are a wise surfer dude and a helpful teaching assistant that uses Retrieval-Augmented Generation (RAG) to improve your answers.",prompt_template:`You are a wise surfer dude and a helpful teaching assistant that uses Retrieval-Augmented Generation (RAG) to improve your answers.
This is the user input: {user_input}
This is the context: {context}
Now answer the question:`,prompt_processor:"simple_augment",connector:"openai",llm:"gpt-4o-mini",rag_processor:"No RAG",RAG_Top_k:"3"}}}function Tr(t){if(t.system_prompt&&(console.log("Setting system_prompt from fallback:",t.system_prompt),u(r,e(r).system_prompt=t.system_prompt)),t.prompt_template&&(console.log("Setting prompt_template from fallback:",t.prompt_template),u(r,e(r).prompt_template=t.prompt_template)),t.prompt_processor&&u(r,e(r).prompt_processor=t.prompt_processor.trim()),t.connector&&u(r,e(r).connector=t.connector.trim()),t.llm&&u(r,e(r).llm=t.llm.trim()),t.rag_processor){const s=t.rag_processor.trim();u(r,e(r).rag_processor=s.toLowerCase()==="no rag"?"no_rag":s.toLowerCase().replace(/\s+/g,"_"))}console.log("After setting fallback defaults, formData is:",JSON.stringify(e(r),null,2))}function tr(t){return t?Array.isArray(t.models)?t.models:Array.isArray(t.available_llms)?t.available_llms:typeof t.models=="object"?Object.keys(t.models):[]:[]}br(async()=>{try{await rr();let t={};try{t=await bt(),console.log("Loaded system capabilities:",t)}catch(s){console.warn("Could not load system capabilities, using defaults:",s),t={prompt_processors:["zero_shot"],connectors:{rest_api:{models:["gpt-4"]}},rag_processors:["no_rag","simple_rag","single_file_rag"]}}if(a(I,t.prompt_processors||[]),a(F,t.connectors||{}),a(q,t.rag_processors||[]),console.log("Loading defaults from onMount"),await Ar(),console.log("Defaults loaded, system_prompt:",e(r).system_prompt,"prompt_template:",e(r).prompt_template),!e(r).prompt_processor&&e(I).length>0&&u(r,e(r).prompt_processor=e(I)[0]),!e(r).connector&&Object.keys(e(F)).length>0&&u(r,e(r).connector=Object.keys(e(F))[0]),!e(r).rag_processor&&e(q).length>0&&u(r,e(r).rag_processor=e(q)[0]),e(r).connector){const s=e(F)[e(r).connector];a(j,tr(s)),!e(r).llm&&e(j).length>0&&u(r,e(r).llm=e(j)[0])}e(r).rag_processor==="simple_rag"&&er()}catch(t){console.error("Error loading system capabilities",t)}});function Gr(){const t=e(F)[e(r).connector];a(j,tr(t)),e(j).includes(e(r).llm)||u(r,e(r).llm=e(j).length>0?e(j)[0]:"")}async function Rr(t){var o,i,l;if(t==null||t.preventDefault(),e(C))return;if(a(m,""),a(G,""),a(z,""),(o=e(r).name)!=null&&o.trim()){if(!me(e(r).name)){a(m,e(R)),a(z,e(m));return}}else{a(m,"Please enter an assistant name"),a(z,e(m));return}a(C,!0);const s=Date.now();try{u(r,e(r).description="");const d={name:e(r).name.trim(),system_prompt:e(r).system_prompt.trim(),prompt_template:((i=e(r).prompt_template)==null?void 0:i.trim())||"",llm:e(r).llm||"",rag_processor:e(r).rag_processor||"no_rag"};console.log("Generating description with payload:",d);const g=await yt(d);console.log("Description generation response:",g);const _=Date.now()-s;if(_<500&&await new Promise(N=>setTimeout(N,500-_)),!g)throw new Error("No response received from the server");if((l=g==null?void 0:g.description)!=null&&l.trim())u(r,e(r).description=g.description.trim()),a(G,"Description generated successfully!"),a(m,"");else throw new Error("Failed to generate a description. The server returned an empty response.")}catch(d){if(console.error("Description generation failed:",d),typeof d=="object"&&d!==null)if("message"in d&&typeof d.message=="string")if(d.message.includes("Failed to fetch")||d.message.includes("NetworkError"))a(m,"Network error: Please check your connection and try again");else if("response"in d&&typeof d.response=="object"&&d.response!==null&&"status"in d.response){const g=d.response.status;g===429?a(m,"Too many requests. Please wait a moment and try again"):g===400?a(m,"Invalid input: Please check your inputs and try again"):g===500?a(m,"Server error: The description could not be generated at this time"):a(m,d.message)}else a(m,d.message);else a(m,"An error occurred while generating the description");else typeof d=="string"?a(m,d):a(m,"An error occurred while generating the description");a(z,e(m)),a(G,""),u(r,e(r).description="")}finally{a(C,!1)}}function Cr(){var s,o,i,l,d,g;let t=[];if((s=e(r).name)!=null&&s.trim()?me(e(r).name)||t.push(e(R)):t.push("Name is required"),(o=e(r).system_prompt)!=null&&o.trim()?e(r).system_prompt.trim().length<10&&t.push("System prompt should be at least 10 characters"):t.push("System prompt is required"),e(r).description&&!e(r).description.trim()&&t.push("Description cannot be empty if provided"),e(r).prompt_processor?e(I).includes(e(r).prompt_processor)||t.push(`Invalid prompt processor: ${e(r).prompt_processor}`):t.push("Prompt processor is required"),e(r).connector?Object.keys(e(F)).includes(e(r).connector)||t.push(`Invalid connector: ${e(r).connector}`):t.push("Connector is required"),e(r).llm?e(j).includes(e(r).llm)||t.push(`Invalid language model: ${e(r).llm}`):t.push("Language model is required"),e(r).rag_processor?e(q).includes(e(r).rag_processor)||t.push(`Invalid RAG processor: ${e(r).rag_processor}`):t.push("RAG processor is required"),e(P)){const _=parseInt(e(r).RAG_Top_k);isNaN(_)||_<1?t.push("RAG Top K must be a positive number"):_>100&&t.push("RAG Top K should not exceed 100 for optimal performance"),!((i=e(r).RAG_collections)!=null&&i.trim())&&e(r).selected_knowledge_bases.length===0&&t.push("Please select at least one Knowledge Base")}return e(pe)&&((l=e(r).file_path)!=null&&l.trim()?e(r).file_path.match(/\.(txt|pdf|md|json|csv|html|xml)$/i)||t.push("File must be one of: txt, pdf, md, json, csv, html, xml"):t.push("File path is required")),e(r).rag_processor==="single_file_rag"&&!((d=e(r).file_path)!=null&&d.trim())&&t.push("File path is required for single file RAG"),e(r).rag_processor==="simple_rag"&&(e(r).RAG_Top_k?parseInt(e(r).RAG_Top_k,10)<1&&t.push("RAG Top K must be at least 1"):t.push("RAG Top K is required for simple RAG"),!((g=e(r).RAG_collections)!=null&&g.trim())&&e(r).selected_knowledge_bases.length===0&&t.push("Please select at least one Knowledge Base for RAG")),t}async function Nr(t){var s,o,i;if(t.preventDefault(),!(e(y)||e(C))){a(m,""),a(R,""),a(G,""),a(y,!0);try{const l=Cr();if(l.length>0){a(m,l.join(". ")),window.scrollTo({top:0,behavior:"smooth"});return}if(!me(e(r).name.trim())){a(m,e(R)||"Invalid assistant name"),window.scrollTo({top:0,behavior:"smooth"});return}if(e(P)){if(parseInt(e(r).RAG_Top_k)>100&&!confirm("Using a high value for RAG Top K might impact performance. Continue anyway?")){a(m,"Submission cancelled. Please adjust RAG Top K to a lower value."),window.scrollTo({top:0,behavior:"smooth"});return}if(e(r).selected_knowledge_bases.length===0&&((s=e(r).RAG_collections)!=null&&s.trim())&&e(r).RAG_collections.trim().split(",").some(T=>!T.trim())){a(m,"Invalid RAG Collections format. Please provide comma-separated values without empty entries."),window.scrollTo({top:0,behavior:"smooth"});return}}let d="";e(P)&&e(r).selected_knowledge_bases.length>0?(d=e(r).selected_knowledge_bases.join(","),console.log("Setting RAG_collections from selected knowledge bases:",d)):e(P)&&e(r).RAG_collections&&(d=e(r).RAG_collections.split(",").map(N=>N.trim()).join(","));const g={...e(r),name:e(r).name.trim(),description:e(r).description.trim(),system_prompt:e(r).system_prompt.trim(),prompt_template:((o=e(r).prompt_template)==null?void 0:o.trim())||"",RAG_collections:d,file_path:e(pe)?e(r).file_path.trim():"",RAG_Top_k:e(P)&&parseInt(e(r).RAG_Top_k)||3,rag_processor:e(r).rag_processor,api_callback:JSON.stringify({prompt_processor:e(r).prompt_processor,connector:e(r).connector,llm:e(r).llm,rag_processor:e(r).rag_processor,file_path:e(r).file_path}),RAG_endpoint:"https://api.company.com/rag",pre_retrieval_endpoint:"https://api.company.com/pre-retrieval",post_retrieval_endpoint:"https://api.company.com/post-retrieval"},_=await wt(g);if(console.log("Create assistant response:",{response:_,type:typeof _,keys:_?Object.keys(_):null,id:_==null?void 0:_.assistant_id,raw:JSON.stringify(_,null,2)}),!(_!=null&&_.assistant_id))throw new Error("Failed to create assistant: No ID returned");a(G,"Assistant created successfully!"),ce()&&clearTimeout(ce()),xe.set(setTimeout(()=>{yr(`/assistants/${_.assistant_id}`),xe.set(null)},500))}catch(l){console.error("Error creating assistant:",l),(i=l.message)!=null&&i.includes("already exists for this owner")?(await rr(),a(m,"This name is already taken. Please choose a different name.")):a(m,l.message||"An error occurred while creating the assistant"),window.scrollTo({top:0,behavior:"smooth"})}finally{a(y,!1)}}}let sr=x([]),Ae=null,X=x("");async function Te(){try{const t=await fetch("/creator/files/list",{headers:{Authorization:`Bearer ${localStorage.getItem("userToken")}`}});if(!t.ok)throw new Error(`Error: ${t.status}`);a(sr,await t.json())}catch(t){console.error("Error loading files:",t),a(X,`Error loading files: ${t.message}`)}}function Sr(t){if(t.target){const s=t.target;Ae=s.files?s.files[0]:null}}async function Er(){if(!Ae){a(X,"Please select a file to upload");return}try{const t=new FormData;t.append("file",Ae);const s=await fetch("/creator/files/upload",{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("userToken")}`},body:t});if(!s.ok)throw new Error(`Error: ${s.status}`);a(X,"File uploaded successfully!"),await Te()}catch(t){console.error("Error uploading file:",t),a(X,`Error uploading file: ${t.message}`)}}br(()=>{e(r).rag_processor==="single_file_rag"&&Te()}),ie(()=>(e(m),Z(),e(z)),()=>{e(m)&&(Z()&&clearTimeout(Z()),We.set(setTimeout(()=>{e(m)===e(z)&&(a(m,""),a(z,""))},5e3)))}),ie(()=>(e(G),Q()),()=>{e(G)&&(Q()&&clearTimeout(Q()),Xe.set(setTimeout(()=>{a(G,"")},3e3)))}),ie(()=>e(r),()=>{a(pe,e(r).rag_processor==="single_file_rag")}),ie(()=>e(r),()=>{a(P,e(r).rag_processor==="simple_rag")}),ie(()=>e(r),()=>{e(r).rag_processor==="single_file_rag"?Te():e(r).rag_processor==="simple_rag"&&er()}),pt(),it();var Ge=Qt(),or=n(p(Ge),2);{var Dr=t=>{var s=kt(),o=n(p(s),2),i=n(p(o),2),l=p(i),d=p(l,!0);c(l),c(i),c(o),c(s),b(()=>A(d,e(m))),f(t,s)};k(or,t=>{e(m)&&t(Dr)})}var Re=n(or,2),Ce=p(Re),K=n(p(Ce),2);be(K);var $r=n(K,2);{var jr=t=>{var s=At(),o=p(s,!0);c(s),b(()=>A(o,e(R))),f(t,s)};k($r,t=>{e(R)&&t(jr)})}c(Ce);var Ne=n(Ce,2),Se=p(Ne),ar=n(p(Se),2),lr=p(ar);{var Fr=t=>{var s=Tt();D("click",s,()=>{u(r,e(r).description=""),a(G,""),a(m,"")}),f(t,s)};k(lr,t=>{e(r).description&&t(Fr)})}var ee=n(lr,2),Lr=p(ee);{var Pr=t=>{var s=Gt();_e(2),f(t,s)},zr=t=>{var s=Rt();_e(2),f(t,s)};k(Lr,t=>{e(C)?t(Pr):t(zr,!1)})}c(ee),c(ar),c(Se);var ir=n(Se,2);{var Or=t=>{var s=Ct(),o=n(p(s),2),i=n(p(o),2),l=p(i,!0);c(i),c(o),c(s),b(()=>A(l,e(G))),f(t,s)};k(ir,t=>{e(G)&&t(Or)})}var Ee=n(ir,2),J=p(Ee);Ve(J);var Br=n(J,2);{var Mr=t=>{var s=Nt();f(t,s)};k(Br,t=>{e(C)&&t(Mr)})}c(Ee);var Ir=n(Ee,2);{var qr=t=>{var s=Dt(),o=n(p(s),2);{var i=d=>{var g=St();f(d,g)},l=(d,g)=>{{var _=N=>{var w=Et();f(N,w)};k(d,N=>{e(r).system_prompt||N(_)},g)}};k(o,d=>{e(r).name?d(l,!1):d(i)})}c(s),f(t,s)};k(Ir,t=>{(!e(r).name||!e(r).system_prompt)&&t(qr)})}c(Ne);var De=n(Ne,2),ue=n(p(De),2);Ve(ue),c(De);var $e=n(De,2),je=n(p($e),2);Ve(je),c($e);var Fe=n($e,6),re=n(p(Fe),2);b(()=>{e(r),ge(()=>{e(m),e(y),e(I)})});var Le=p(re);Le.value=((Le.__value="")==null,"");var Kr=n(Le);V(Kr,1,()=>e(I),ne,(t,s)=>{var o=$t(),i={},l=p(o,!0);c(o),b(()=>{i!==(i=e(s))&&(o.value=(o.__value=e(s))==null?"":e(s)),A(l,e(s))}),f(t,o)}),c(re),c(Fe);var Pe=n(Fe,2),H=n(p(Pe),2);b(()=>{e(r),ge(()=>{e(m),e(y),e(F)})});var ze=p(H);ze.value=((ze.__value="")==null,"");var Jr=n(ze);V(Jr,1,()=>Object.keys(e(F)),ne,(t,s)=>{var o=jt(),i={},l=p(o,!0);c(o),b(()=>{i!==(i=e(s))&&(o.value=(o.__value=e(s))==null?"":e(s)),A(l,e(s))}),f(t,o)}),c(H),c(Pe);var Oe=n(Pe,2),te=n(p(Oe),2);b(()=>{e(r),ge(()=>{e(m),e(y),e(j)})});var Be=p(te);Be.value=((Be.__value="")==null,"");var Hr=n(Be);V(Hr,1,()=>e(j),ne,(t,s)=>{var o=Ft(),i={},l=p(o,!0);c(o),b(()=>{i!==(i=e(s))&&(o.value=(o.__value=e(s))==null?"":e(s)),A(l,e(s))}),f(t,o)}),c(te),c(Oe);var Me=n(Oe,2),se=n(p(Me),2);b(()=>{e(r),ge(()=>{e(m),e(y),e(q)})});var Ie=p(se);Ie.value=((Ie.__value="")==null,"");var Ur=n(Ie);V(Ur,1,()=>e(q),ne,(t,s)=>{var o=Lt(),i={},l=p(o,!0);c(o),b(()=>{i!==(i=e(s))&&(o.value=(o.__value=e(s))==null?"":e(s)),A(l,e(s))}),f(t,o)}),c(se),c(Me);var nr=n(Me,2);{var Vr=t=>{var s=zt(),o=Ye(s),i=n(p(o),2);V(i,5,()=>e(sr),ne,(w,T)=>{var oe=Pt(),O=p(oe),L=p(O,!0);c(O);var B=n(O,2);c(oe),b(()=>{$(O,1,`cursor-pointer ${(e(r).file_path===e(T).path?"bg-blue-500 text-white":"")??""}`),A(L,e(T).name),hr(B,"href",`/static/public/${e(T).path}`)}),D("click",O,()=>u(r,e(r).file_path=e(T).path)),f(w,oe)}),c(i),c(o);var l=n(o,2),d=n(p(l),2),g=n(d,2),_=n(g,2),N=p(_,!0);c(_),c(l),b(()=>A(N,e(X))),D("change",d,Sr),D("click",g,Er),f(t,s)};k(nr,t=>{e(pe)&&t(Vr)})}var cr=n(nr,2);{var Yr=t=>{var s=Vt(),o=Ye(s),i=n(p(o),2);be(i),c(o);var l=n(o,2);be(l);var d=n(l,2),g=n(p(d),2);{var _=w=>{var T=Ot();f(w,T)},N=(w,T)=>{{var oe=L=>{var B=Bt(),qe=p(B,!0);c(B),b(()=>A(qe,e(M))),f(L,B)},O=(L,B)=>{{var qe=U=>{var ve=Mt();f(U,ve)},Xr=U=>{var ve=Ut(),Ke=Ye(ve);V(Ke,5,()=>e(W),Je=>Je.id,(Je,E)=>{var He=Ht(),fr=p(He),ae=p(fr);be(ae);var vr=n(ae,2),Ue=p(vr),gr=p(Ue),rt=n(gr);{var tt=h=>{var S=It();f(h,S)},st=h=>{var S=qt();f(h,S)};k(rt,h=>{e(E).isOwned?h(tt):h(st,!1)})}c(Ue);var _r=n(Ue,2);{var ot=h=>{var S=Kt(),le=p(S,!0);c(S),b(()=>A(le,e(E).description)),f(h,S)};k(_r,h=>{e(E).description&&h(ot)})}var at=n(_r,2);{var lt=h=>{var S=Jt(),le=p(S);c(S),b(()=>A(le,`${e(E).files.length??""} file(s)`)),f(h,S)};k(at,h=>{e(E).files&&e(E).files.length>0&&h(lt)})}c(vr),c(fr),c(He),b(h=>{ft(ae,e(E).id),vt(ae,h),A(gr,`${e(E).name??""} `)},[()=>e(r).selected_knowledge_bases.includes(e(E).id)],mt),D("change",ae,h=>{h.target&&(h.target.checked?u(r,e(r).selected_knowledge_bases=[...e(r).selected_knowledge_bases,e(E).id]):u(r,e(r).selected_knowledge_bases=e(r).selected_knowledge_bases.filter(le=>le!==e(E).id)))}),f(Je,He)}),c(Ke);var ur=n(Ke,2),et=p(ur);c(ur),b(()=>A(et,`Selected: ${e(r).selected_knowledge_bases.length??""} knowledge base(s)`)),f(U,ve)};k(L,U=>{e(W).length===0?U(qe):U(Xr,!1)},B)}};k(w,L=>{e(M)?L(oe):L(O,!1)},T)}};k(g,w=>{e(we)?w(_):w(N,!1)})}c(d),b(()=>{$(i,1,`w-full border px-3 py-2 rounded transition-all duration-200 ${(e(m)&&!e(r).RAG_Top_k?"border-red-300 focus:border-red-500 focus:ring-red-200":"border-gray-300 focus:border-blue-500 focus:ring-blue-200")??""} focus:outline-none focus:ring-2`),i.disabled=e(y)}),Y(i,()=>e(r).RAG_Top_k,w=>u(r,e(r).RAG_Top_k=w)),D("input",i,w=>{if(w.target){const T=w.target;u(r,e(r).RAG_Top_k=T.value?parseInt(T.value,10).toString():"")}}),Y(l,()=>e(r).RAG_collections,w=>u(r,e(r).RAG_collections=w)),f(t,s)};k(cr,t=>{e(P)&&t(Yr)})}var pr=n(cr,2),dr=p(pr),fe=n(dr,2),mr=p(fe),Zr=p(mr);{var Qr=t=>{var s=Yt();_e(2),f(t,s)},Wr=t=>{var s=Zt();_e(2),f(t,s)};k(Zr,t=>{e(y)?t(Qr):t(Wr,!1)})}c(mr),c(fe),c(pr),c(Re),c(Ge),b(()=>{$(K,1,`w-full border px-3 py-2 rounded transition-all duration-200 ${(e(R)?"border-red-500 focus:border-red-600 focus:ring-red-200":"border-gray-300 focus:border-blue-500 focus:ring-blue-200")??""} focus:outline-none focus:ring-2`),K.disabled=e(y),$(ee,1,`text-sm ${(e(C)?"bg-blue-500 text-white":e(r).name?"bg-blue-100 hover:bg-blue-200 text-blue-700":"bg-gray-100 text-gray-400 cursor-not-allowed")??""} px-3 py-1.5 rounded-md transition-colors duration-200 flex items-center gap-2 relative group`),ee.disabled=e(C)||!e(r).name,$(J,1,`w-full border px-3 py-2 rounded transition-all duration-200 ${(e(C)?"bg-gray-50 cursor-wait animate-pulse":"")??""} ${(e(m)?"border-red-300 focus:border-red-500 focus:ring-red-200":e(G)?"border-green-300 focus:border-green-500 focus:ring-green-200":"border-gray-300 focus:border-blue-500 focus:ring-blue-200")??""} focus:outline-none focus:ring-2`),hr(J,"placeholder",e(C)?"Generating description...":"Assistant description (click Generate Description to auto-generate)"),J.disabled=e(C),$(ue,1,`w-full border px-3 py-2 rounded transition-all duration-200 ${(e(m)&&!e(r).system_prompt?"border-red-300 focus:border-red-500 focus:ring-red-200":"border-gray-300 focus:border-blue-500 focus:ring-blue-200")??""} focus:outline-none focus:ring-2`),ue.disabled=e(y),je.disabled=e(y),$(re,1,`w-full border px-3 py-2 rounded transition-all duration-200 ${(e(m)&&!e(r).prompt_processor?"border-red-300 focus:border-red-500 focus:ring-red-200":"border-gray-300 focus:border-blue-500 focus:ring-blue-200")??""} focus:outline-none focus:ring-2`),re.disabled=e(y),$(H,1,`w-full border px-3 py-2 rounded transition-all duration-200 ${(e(m)&&!e(r).connector?"border-red-300 focus:border-red-500 focus:ring-red-200":"border-gray-300 focus:border-blue-500 focus:ring-blue-200")??""} focus:outline-none focus:ring-2`),H.disabled=e(y),$(te,1,`w-full border px-3 py-2 rounded transition-all duration-200 ${(e(m)&&!e(r).llm?"border-red-300 focus:border-red-500 focus:ring-red-200":"border-gray-300 focus:border-blue-500 focus:ring-blue-200")??""} focus:outline-none focus:ring-2`),te.disabled=e(y),$(se,1,`w-full border px-3 py-2 rounded transition-all duration-200 ${(e(m)&&!e(r).rag_processor?"border-red-300 focus:border-red-500 focus:ring-red-200":"border-gray-300 focus:border-blue-500 focus:ring-blue-200")??""} focus:outline-none focus:ring-2`),se.disabled=e(y),$(fe,1,`px-6 py-2 bg-blue-600 text-white rounded-md relative overflow-hidden transition-all duration-200 ${(e(y)?"cursor-wait":"hover:bg-blue-700")??""}`),fe.disabled=e(y)||e(C)}),Y(K,()=>e(r).name,t=>u(r,e(r).name=t)),D("input",K,()=>me(e(r).name)),D("click",ee,Rr),Y(J,()=>e(r).description,t=>u(r,e(r).description=t)),Y(ue,()=>e(r).system_prompt,t=>u(r,e(r).system_prompt=t)),Y(je,()=>e(r).prompt_template,t=>u(r,e(r).prompt_template=t)),he(re,()=>e(r).prompt_processor,t=>u(r,e(r).prompt_processor=t)),he(H,()=>e(r).connector,t=>u(r,e(r).connector=t)),D("change",H,Gr),he(te,()=>e(r).llm,t=>u(r,e(r).llm=t)),he(se,()=>e(r).rag_processor,t=>u(r,e(r).rag_processor=t)),D("click",dr,()=>yr("/assistants")),D("submit",Re,gt(Nr)),f(wr,Ge),dt(),kr()}export{fs as component};
