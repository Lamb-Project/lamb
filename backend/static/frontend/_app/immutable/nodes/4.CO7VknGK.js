import{t as U,a as x,s as i,e as fe,n as Fe,b as De,d as ot}from"../chunks/C82hPXC8.js";import{p as Ie,t as $,a as Te,e as Q,c as t,r as e,aD as nt,f as Me,s as a,i as r,an as I,j as s,ap as ft,a6 as je,o as pt}from"../chunks/DZNCS3vC.js";import{i as N}from"../chunks/fI70I6vP.js";import{e as gt,i as xt}from"../chunks/D6J79d0_.js";import{g as bt,r as qe,s as wt}from"../chunks/D5v_xaba.js";import{s as Ze,c as ht}from"../chunks/D8EjMQFO.js";import{p as oe}from"../chunks/B_zbZ6nJ.js";import{s as He,a as Ee}from"../chunks/CVH_3kCa.js";import{u as Ne}from"../chunks/CJASC4tQ.js";import{g as at}from"../chunks/JSp2UL00.js";import{$ as Oe}from"../chunks/weotW1oH.js";import{i as et}from"../chunks/C9TgNfkd.js";import{p as _t}from"../chunks/DbCUo_rN.js";import{b as Le}from"../chunks/ei6fuu5i.js";import{b as yt}from"../chunks/TETYgnKo.js";import{g as Re}from"../chunks/DMe9dMdG.js";import{p as st}from"../chunks/LPlWZjWK.js";var kt=U('<nav class="bg-white border-b border-gray-200"><div class="flex space-x-8"><a href="/admin/users"> </a></div></nav>');function $t(C,d){Ie(d,!1);const[h,v]=He(),n=()=>Ee(_t,"$page",h),p=()=>Ee(Oe,"$_",h);et();var _=kt(),A=t(_),b=t(A),B=t(b,!0);e(b),e(A),e(_),$((P,y)=>{Ze(b,1,P),i(B,y)},[()=>`py-4 px-1 border-b-2 font-medium text-sm ${n().url.pathname.includes("/admin/users")?"border-[#2271b3] text-[#2271b3]":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,()=>p()("admin.users",{default:"Users"})],Q),x(C,_),Te(),v()}async function Ct(C,d={}){try{const h=Re(Ne),v=h==null?void 0:h.token;if(!v)throw new Error("Authentication token not available");const n=new Headers(d.headers||{});n.set("Authorization",`Bearer ${v}`);const p=await fetch(bt(C),{...d,headers:n});let _;try{const A=await p.text();_=A?JSON.parse(A):{}}catch(A){console.error("Failed to parse response:",A),_={}}if(!p.ok)throw new Error(_.error||`Request failed with status ${p.status}`);return _}catch(h){return console.error(`API error (${C}):`,h),{success:!1,error:(h instanceof Error?h:new Error(String(h))).message||"An error occurred during the API request"}}}var At=U('<div class="mb-4 p-2 bg-red-100 border border-red-300 text-red-800 rounded-md"> </div>'),jt=Fe('<svg class="animate-spin -ml-1 mr-2 h-4 w-4 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> ',1),Mt=U('<form class="mt-4"><div class="mb-4"><label for="email" class="block text-sm font-medium text-gray-700"> </label> <input type="email" id="email" name="email" required class="mt-1 focus:ring-blue-500 focus:border-blue-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md"></div> <div class="mb-4"><label for="name" class="block text-sm font-medium text-gray-700"> </label> <input type="text" id="name" name="name" required class="mt-1 focus:ring-blue-500 focus:border-blue-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md"></div> <div class="mb-4"><label for="password" class="block text-sm font-medium text-gray-700"> </label> <input type="password" id="password" name="password" required class="mt-1 focus:ring-blue-500 focus:border-blue-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md"></div> <div class="mb-4"><label for="role" class="block text-sm font-medium text-gray-700"> </label> <select id="role" name="role" class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"><option> </option><option> </option></select></div> <!> <div class="flex justify-end"><button type="button" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm"> </button> <button type="submit" class="ml-3 w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-[#2271b3] text-base font-medium text-white hover:bg-[#1a5b8f] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm"><!></button></div></form>'),Et=U('<div class="mt-4 p-4 bg-green-100 border border-green-300 text-green-800 rounded-md text-center"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mx-auto mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg> <p class="font-medium"> </p> <button type="button" class="mt-4 inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-green-600 text-base font-medium text-white hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 sm:text-sm"> </button></div>'),St=U('<div class="mt-4 p-4 bg-red-100 border border-red-300 text-red-800 rounded-md text-center"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mx-auto mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg> <p class="font-medium"> </p> <div class="flex justify-center mt-4"><button type="button" class="inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:text-sm"> </button> <button type="button" class="ml-3 inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 sm:text-sm"> </button></div></div>'),Ut=U('<div class="fixed z-10 inset-0 overflow-y-auto" aria-labelledby="modal-title" role="dialog" aria-modal="true"><div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"><div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" aria-hidden="true"></div> <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"><div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4"><div class="sm:flex sm:items-start"><div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-blue-100 sm:mx-0 sm:h-10 sm:w-10"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg></div> <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full"><h3 class="text-lg leading-6 font-medium text-gray-900" id="modal-title"> </h3> <!></div></div></div></div></div></div>'),Pt=U('<button class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-[#2271b3] hover:bg-[#1a5b8f] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg> </button> <!>',1);function zt(C,d){Ie(d,!1);const[h,v]=He(),n=()=>Ee(Oe,"$_",h),p=nt();let _=I(""),A=I(""),b=I(""),B=I("user"),P=I(!1),y=I(null),R=I(!1),ne=I(!0);async function ie(J){J.preventDefault(),s(P,!0),s(y,null),s(R,!1);try{const l=new FormData;l.append("email",r(_)),l.append("name",r(A)),l.append("password",r(b)),l.append("role",r(B));const u=await Ct("/admin/users/create",{method:"POST",body:l});u&&"success"in u&&u.success===!0?(s(R,!0),s(ne,!1),p("userCreated",!0)):s(y,u&&"error"in u?u.error:"Failed to create user")}catch(l){console.error("Error creating user:",l),s(y,"An unexpected error occurred")}finally{s(P,!1)}}let ee=I(!1);function le(){s(ee,!0)}function Z(){s(ee,!1),s(y,null),s(R,!1),s(ne,!0),s(_,""),s(A,""),s(b,""),s(B,"user")}et();var pe=Pt(),te=Me(pe),Se=a(t(te));e(te);var we=a(te,2);{var he=J=>{var l=Ut(),u=t(l),z=t(u),de=a(z,2),T=t(de),V=t(T),ue=a(t(V),2),X=t(ue),ge=t(X,!0);e(X);var _e=a(X,2);{var ye=D=>{var G=Mt(),o=t(G),g=t(o),k=t(g,!0);e(g);var f=a(g,2);qe(f),e(o);var c=a(o,2),j=t(c),E=t(j,!0);e(j);var q=a(j,2);qe(q),e(c);var H=a(c,2),O=t(H),w=t(O,!0);e(O);var F=a(O,2);qe(F),e(H);var L=a(H,2),W=t(L),K=t(W,!0);e(W);var re=a(W,2);$(()=>{r(B),ft(()=>{n()})});var ae=t(re);ae.value=(ae.__value="user")==null?"":"user";var Je=t(ae,!0);e(ae);var ce=a(ae);ce.value=(ce.__value="admin")==null?"":"admin";var Ve=t(ce,!0);e(ce),e(re),e(L);var Ue=a(L,2);{var Ge=m=>{var S=At(),se=t(S,!0);e(S),$(()=>i(se,r(y))),x(m,S)};N(Ue,m=>{r(y)&&m(Ge)})}var Pe=a(Ue,2),$e=t(Pe),We=t($e,!0);e($e);var Y=a($e,2),M=t(Y);{var me=m=>{var S=jt(),se=a(Me(S),1,!0);$(be=>i(se,be),[()=>n()("common.loading",{default:"Loading..."})],Q),x(m,S)},xe=m=>{var S=De();$(se=>i(S,se),[()=>n()("admin.users.create",{default:"Create"})],Q),x(m,S)};N(M,m=>{r(P)?m(me):m(xe,!1)})}e(Y),e(Pe),e(G),$((m,S,se,be,Ke,ze,Be)=>{i(k,m),i(E,S),i(w,se),i(K,be),i(Je,Ke),i(Ve,ze),i(We,Be),Y.disabled=r(P)},[()=>n()("admin.users.email",{default:"Email"}),()=>n()("admin.users.name",{default:"Name"}),()=>n()("admin.users.password",{default:"Password"}),()=>n()("admin.users.role",{default:"Role"}),()=>n()("admin.users.role_user",{default:"User"}),()=>n()("admin.users.role_admin",{default:"Admin"}),()=>n()("common.cancel",{default:"Cancel"})],Q),Le(f,()=>r(_),m=>s(_,m)),Le(q,()=>r(A),m=>s(A,m)),Le(F,()=>r(b),m=>s(b,m)),yt(re,()=>r(B),m=>s(B,m)),fe("click",$e,Z),fe("submit",G,ie),x(D,G)},ke=(D,G)=>{{var o=k=>{var f=Et(),c=a(t(f),2),j=t(c,!0);e(c);var E=a(c,2),q=t(E,!0);e(E),e(f),$((H,O)=>{i(j,H),i(q,O)},[()=>n()("admin.users.user_created",{default:"User created successfully"}),()=>n()("common.close",{default:"Close"})],Q),fe("click",E,Z),x(k,f)},g=(k,f)=>{{var c=j=>{var E=St(),q=a(t(E),2),H=t(q,!0);e(q);var O=a(q,2),w=t(O),F=t(w,!0);e(w);var L=a(w,2),W=t(L,!0);e(L),e(O),e(E),$((K,re)=>{i(H,r(y)),i(F,K),i(W,re)},[()=>n()("common.retry",{default:"Try Again"}),()=>n()("common.close",{default:"Close"})],Q),fe("click",w,()=>{s(y,null),s(ne,!0)}),fe("click",L,Z),x(j,E)};N(k,j=>{r(y)&&j(c)},f)}};N(D,k=>{r(R)?k(o):k(g,!1)},G)}};N(_e,D=>{r(ne)?D(ye):D(ke,!1)})}e(ue),e(V),e(T),e(de),e(u),e(l),$(D=>i(ge,D),[()=>n()("admin.users.create_new_user",{default:"Create New User"})],Q),fe("click",z,Z),x(J,l)};N(we,J=>{r(ee)&&J(he)})}$(J=>i(Se,` ${J??""}`),[()=>n()("admin.users.add_user",{default:"Add User"})],Q),fe("click",te,le),x(C,pe),Te(),v()}async function Bt(){const C=Re(Ne);if(!C.token)throw new Error("Authentication required");try{const d=await fetch("/creator/users",{method:"GET",headers:{Authorization:`Bearer ${C.token}`,"Content-Type":"application/json"}});if(!d.ok)throw d.status===403?new Error("Access denied. Admin privileges required."):new Error(`Server error: ${d.status}`);return await d.json()}catch(d){throw console.error("Error fetching users:",d),d}}async function qt(C,d){const h=Re(Ne);if(!h.token)throw new Error("Authentication required");try{const v=new FormData;v.append("email",C),v.append("new_password",d),console.log(`Attempting to update password for user: ${C}`);const n=await fetch("/creator/admin/users/update-password",{method:"POST",headers:{Authorization:`Bearer ${h.token}`},body:v});if(!n.ok){if(n.status===403)throw new Error("Access denied. Admin privileges required.");const _=await n.json();throw new Error(_.error||`Server error: ${n.status}`)}return await n.json()}catch(v){return console.error("Error updating password:",v),{success:!1,error:v instanceof Error?v.message:"An error occurred while updating the password"}}}async function Lt(C,d){const h=Re(Ne);if(!h.token)throw new Error("Authentication required");if(d!=="admin"&&d!=="user")return{success:!1,error:'Invalid role. Must be either "admin" or "user".'};try{console.log(`Attempting to update role for user email ${C} to ${d}`);const v=await fetch("/creator/admin/users/update-role-by-email",{method:"PUT",headers:{Authorization:`Bearer ${h.token}`,"Content-Type":"application/json"},body:JSON.stringify({email:C,role:d})});if(!v.ok){if(v.status===403)throw new Error("Access denied. Admin privileges required or you are trying to modify the primary admin user.");const p=await v.json();throw new Error(p.error||p.detail||`Server error: ${v.status}`)}return{success:!0,data:(await v.json()).data}}catch(v){return console.error("Error updating user role by email:",v),{success:!1,error:v instanceof Error?v.message:"An error occurred while updating the user role"}}}function Ye(C,d){d("close")}var Nt=U('<div class="text-center py-4"><div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100 mb-4"><svg class="h-6 w-6 text-green-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg></div> <p class="text-sm text-[#6c757d] mb-4"> </p> <button type="button" class="inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md shadow-sm text-white bg-[#2271b3] hover:bg-[#195a91] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#2271b3]"> </button></div>'),Dt=U('<div class="bg-[#f8d7da] border-l-4 border-[#721c24] p-4 mb-4"><div class="flex"><div class="flex-shrink-0"><svg class="h-5 w-5 text-[#721c24]" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path></svg></div> <div class="ml-3"><p class="text-sm text-[#721c24]"> </p></div></div></div>'),Ft=Fe('<svg class="animate-spin -ml-1 mr-2 h-4 w-4 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>'),It=U('<form class="space-y-4"><!> <div><p class="text-sm text-[#6c757d] mb-4"> </p></div> <div><label for="password" class="block text-sm font-medium text-[#333]"> </label> <div class="mt-1"><input id="password" name="password" type="password" required class="shadow-sm focus:ring-[#2271b3] focus:border-[#2271b3] block w-full sm:text-sm border-[#dee2e6] rounded-md"></div></div> <div><label for="confirmPassword" class="block text-sm font-medium text-[#333]"> </label> <div class="mt-1"><input id="confirmPassword" name="confirmPassword" type="password" required class="shadow-sm focus:ring-[#2271b3] focus:border-[#2271b3] block w-full sm:text-sm border-[#dee2e6] rounded-md"></div></div> <div class="flex justify-end pt-5 gap-2"><button type="button" class="inline-flex items-center px-3 py-2 border border-[#dee2e6] shadow-sm text-sm leading-4 font-medium rounded-md text-[#333] bg-[#e9ecef] hover:bg-[#dee2e6] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#2271b3]"> </button> <button type="submit" class="inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md shadow-sm text-white bg-[#2271b3] hover:bg-[#195a91] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#2271b3]"><!> </button></div></form>'),Tt=U('<div class="bg-white p-6 rounded-lg shadow-xl max-w-lg w-full"><div class="flex justify-between items-center mb-5"><h3 class="text-lg leading-6 font-medium text-gray-900"><!></h3> <button type="button" class="rounded-md p-1 inline-flex items-center justify-center text-[#6c757d] hover:text-[#333] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#2271b3]" aria-label="Close"><svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div> <!></div>');function Ht(C,d){Ie(d,!1);const[h,v]=He(),n=()=>Ee(Oe,"$_",h);let p=st(d,"email",8,""),_=st(d,"userName",8,"");const A=nt();let b=I(""),B=I(""),P=I(!1),y=I(null),R=I(!1);async function ne(){if(s(y,null),!r(b)){s(y,n()("admin.users.password_required",{default:"Password is required"}));return}if(r(b)!==r(B)){s(y,n()("admin.users.passwords_dont_match",{default:"Passwords do not match"}));return}s(P,!0);try{const l=await qt(p(),r(b));l.success?(s(R,!0),s(b,""),s(B,"")):s(y,l.error||n()("admin.users.update_failed",{default:"Failed to update password"}))}catch(l){const u=l instanceof Error?l.message:n()("admin.users.server_error",{default:"Server error"});s(y,u),console.error("Error updating password:",l)}finally{s(P,!1)}}et();var ie=Tt(),ee=t(ie),le=t(ee),Z=t(le);{var pe=l=>{var u=De();$(z=>i(u,z),[()=>n()("admin.users.password_updated",{default:"Password Updated"})],Q),x(l,u)},te=l=>{var u=De();$(z=>i(u,z),[()=>n()("admin.users.change_password",{default:"Change Password"})],Q),x(l,u)};N(Z,l=>{r(R)?l(pe):l(te,!1)})}e(le);var Se=a(le,2);Se.__click=[Ye,A],e(ee);var we=a(ee,2);{var he=l=>{var u=Nt(),z=a(t(u),2),de=t(z,!0);e(z);var T=a(z,2);T.__click=[Ye,A];var V=t(T,!0);e(T),e(u),$((ue,X)=>{i(de,ue),i(V,X)},[()=>n()("admin.users.password_updated_for",{default:`Password updated successfully for ${_()}`}),()=>n()("admin.users.close",{default:"Close"})],Q),x(l,u)},J=l=>{var u=It(),z=t(u);{var de=w=>{var F=Dt(),L=t(F),W=a(t(L),2),K=t(W),re=t(K,!0);e(K),e(W),e(L),e(F),$(()=>i(re,r(y))),x(w,F)};N(z,w=>{r(y)&&w(de)})}var T=a(z,2),V=t(T),ue=t(V,!0);e(V),e(T);var X=a(T,2),ge=t(X),_e=t(ge,!0);e(ge);var ye=a(ge,2),ke=t(ye);qe(ke),e(ye),e(X);var D=a(X,2),G=t(D),o=t(G,!0);e(G);var g=a(G,2),k=t(g);qe(k),e(g),e(D);var f=a(D,2),c=t(f);c.__click=[Ye,A];var j=t(c,!0);e(c);var E=a(c,2),q=t(E);{var H=w=>{var F=Ft();x(w,F)};N(q,w=>{r(P)&&w(H)})}var O=a(q);e(E),e(f),e(u),$((w,F,L,W,K)=>{i(ue,w),i(_e,F),i(o,L),i(j,W),E.disabled=r(P),i(O,` ${K??""}`)},[()=>n()("admin.users.changing_password_for",{default:`Changing password for ${_()} (${p()})`}),()=>n()("admin.users.new_password",{default:"New Password"}),()=>n()("admin.users.confirm_password",{default:"Confirm Password"}),()=>n()("admin.users.cancel",{default:"Cancel"}),()=>n()("admin.users.update_password",{default:"Update Password"})],Q),fe("submit",u,w=>{w.preventDefault(),ne()}),Le(ke,()=>r(b),w=>s(b,w)),Le(k,()=>r(B),w=>s(B,w)),x(l,u)};N(we,l=>{r(R)?l(he):l(J,!1)})}e(ie),x(C,ie),Te(),v()}ot(["click"]);var Ot=(C,d)=>d(),Rt=Fe('<svg class="animate-spin -ml-1 mr-2 h-4 w-4 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> ',1),Jt=Fe('<svg class="-ml-1 mr-2 h-4 w-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg> ',1),Vt=U('<div class="bg-red-50 border-l-4 border-red-400 p-4 mb-4"><div class="flex"><div class="flex-shrink-0"><svg class="h-5 w-5 text-red-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path></svg></div> <div class="ml-3"><p class="text-sm text-red-700"> </p></div></div></div>'),Gt=U('<div class="flex justify-center items-center py-8"><div class="animate-spin rounded-full h-12 w-12 border-b-2 border-[#2271b3]"></div></div>'),Wt=U('<div class="bg-gray-50 p-4 text-center text-gray-500 rounded-md"> </div>'),Kt=U('<span class="inline-block animate-pulse">Updating...</span>'),Qt=U('<tr><td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"> </td><td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"> </td><td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"><span> </span></td><td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"> </td><td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"><span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">Active</span></td><td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium"><div class="flex justify-end space-x-4"><button type="button" class="text-[#2271b3] hover:text-[#195a91] font-medium disabled:text-gray-400 disabled:cursor-not-allowed"><!></button> <button type="button" class="text-[#2271b3] hover:text-[#195a91] font-medium"> </button></div></td></tr>'),Xt=(C,d)=>d(),Yt=U('<div class="fixed z-10 inset-0 overflow-y-auto" aria-labelledby="modal-title" role="dialog" aria-modal="true"><div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"><div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" aria-hidden="true"></div> <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"><!></div></div></div>'),Zt=U('<div class="overflow-x-auto"><table class="min-w-full divide-y divide-gray-200"><thead class="bg-gray-50"><tr><th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"> </th><th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"> </th><th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"> </th><th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"> </th><th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"> </th><th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"> </th></tr></thead><tbody class="bg-white divide-y divide-gray-200"></tbody></table></div> <!>',1),er=U('<div class="bg-white shadow"><div class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8"><h1 class="text-3xl font-bold text-gray-900"> </h1></div></div> <main class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8"><div class="px-4 py-6 sm:px-0"><!> <div class="mt-6"><div class="flex items-center justify-between mb-4"><h2 class="text-xl font-semibold text-gray-800"> </h2> <!> <button class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-[#2271b3] hover:bg-[#195a91] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#2271b3]"><!></button></div> <!> <!></div></div></main>',1);function br(C,d){Ie(d,!0);const[h,v]=He(),n=()=>Ee(Ne,"$user",h),p=()=>Ee(Oe,"$_",h);let _=je(oe([])),A=je(!0),b=je(null),B=je(!1),P=je(null),y=je(null);pt(async()=>{if(!n().isLoggedIn){at("/");return}if(!n().data||n().data.role!=="admin"){at("/");return}await R()});async function R(){s(A,!0),s(b,null);try{const o=await Bt();o.success&&o.data?(s(_,oe(o.data)),console.log("Users list:",JSON.stringify(r(_),null,2))):s(b,oe(o.error||"Failed to load users"))}catch(o){const g=o&&typeof o=="object"&&"message"in o?String(o.message):"An error occurred while fetching users";s(b,oe(g)),console.error("Error loading users:",o)}finally{s(A,!1)}}function ne(o){s(P,oe(o)),s(B,!0)}function ie(){s(B,!1),s(P,null)}async function ee(o){if(String(o.id)==="1"){s(b,"Cannot change role for primary admin (User ID 1)"),setTimeout(()=>{r(b)==="Cannot change role for primary admin (User ID 1)"&&s(b,null)},5e3);return}s(y,oe(String(o.id)));const k=o.role==="admin"?"user":"admin";try{const f=await Lt(o.email,k);f.success?s(_,oe(r(_).map(c=>String(c.id)===String(o.id)?{...c,role:k}:c))):s(b,oe(f.error||`Failed to update role for ${o.email}`))}catch(f){const c=f&&typeof f=="object"&&"message"in f?String(f.message):"An error occurred while updating user role";s(b,oe(c)),console.error("Error updating user role:",f)}finally{s(y,null)}}var le=er(),Z=Me(le),pe=t(Z),te=t(pe),Se=t(te,!0);e(te),e(pe),e(Z);var we=a(Z,2),he=t(we),J=t(he);$t(J,{});var l=a(J,2),u=t(l),z=t(u),de=t(z,!0);e(z);var T=a(z,2);zt(T,{$$events:{userCreated:()=>R()}});var V=a(T,2);V.__click=[Ot,R];var ue=t(V);{var X=o=>{var g=Rt(),k=a(Me(g),1,!0);$(f=>i(k,f),[()=>p()("admin.loading",{default:"Loading..."})]),x(o,g)},ge=o=>{var g=Jt(),k=a(Me(g),1,!0);$(f=>i(k,f),[()=>p()("admin.refresh",{default:"Refresh"})]),x(o,g)};N(ue,o=>{r(A)?o(X):o(ge,!1)})}e(V),e(u);var _e=a(u,2);{var ye=o=>{var g=Vt(),k=t(g),f=a(t(k),2),c=t(f),j=t(c,!0);e(c),e(f),e(k),e(g),$(()=>i(j,r(b))),x(o,g)};N(_e,o=>{r(b)&&o(ye)})}var ke=a(_e,2);{var D=o=>{var g=Gt();x(o,g)},G=(o,g)=>{{var k=c=>{var j=Wt(),E=t(j,!0);e(j),$(q=>i(E,q),[()=>p()("admin.users.no_users",{default:"No users found"})]),x(c,j)},f=c=>{var j=Zt(),E=Me(j),q=t(E),H=t(q),O=t(H),w=t(O),F=t(w,!0);e(w);var L=a(w),W=t(L,!0);e(L);var K=a(L),re=t(K,!0);e(K);var ae=a(K),Je=t(ae,!0);e(ae);var ce=a(ae),Ve=t(ce,!0);e(ce);var Ue=a(ce),Ge=t(Ue,!0);e(Ue),e(O),e(H);var Pe=a(H);gt(Pe,21,()=>r(_),xt,(Y,M,me,xe)=>{var m=Qt();Ze(m,1,ht(me%2===0?"bg-white":"bg-gray-50"));var S=t(m),se=t(S,!0);e(S);var be=a(S),Ke=t(be,!0);e(be);var ze=a(be),Be=t(ze),it=t(Be,!0);e(Be),e(ze);var Qe=a(ze),lt=t(Qe,!0);e(Qe);var tt=a(Qe,2),rt=t(tt),Ce=t(rt);Ce.__click=()=>ee(r(M));var dt=t(Ce);{var ut=ve=>{var Ae=Kt();x(ve,Ae)},ct=ve=>{var Ae=De();$(()=>i(Ae,r(M).role==="admin"?"Make User":"Make Admin")),x(ve,Ae)};N(dt,ve=>{r(y)===String(r(M).id)?ve(ut):ve(ct,!1)})}e(Ce);var Xe=a(Ce,2);Xe.__click=()=>ne(r(M));var mt=t(Xe,!0);e(Xe),e(rt),e(tt),e(m),$((ve,Ae,vt)=>{i(se,r(M).email||"N/A"),i(Ke,r(M).name||"N/A"),Ze(Be,1,`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${r(M).role==="admin"?"bg-purple-100 text-purple-800":"bg-green-100 text-green-800"}`),i(it,r(M).role||"user"),i(lt,r(M).id||"N/A"),Ce.disabled=ve,wt(Ce,"title",Ae),i(mt,vt)},[()=>r(y)===String(r(M).id),()=>String(r(M).id)==="1"?"Cannot change role for primary admin":`Make ${r(M).role==="admin"?"Regular User":"Admin"}`,()=>p()("admin.users.change_password",{default:"Change Password"})]),x(Y,m)}),e(Pe),e(q),e(E);var $e=a(E,2);{var We=Y=>{var M=Yt(),me=t(M),xe=t(me);xe.__click=[Xt,ie];var m=a(xe,2),S=t(m);Ht(S,{get email(){return r(P).email},get userName(){return r(P).name},$$events:{close:()=>ie()}}),e(m),e(me),e(M),x(Y,M)};N($e,Y=>{r(B)&&r(P)&&Y(We)})}$((Y,M,me,xe,m,S)=>{i(F,Y),i(W,M),i(re,me),i(Je,xe),i(Ve,m),i(Ge,S)},[()=>p()("admin.users.email",{default:"Email"}),()=>p()("admin.users.name",{default:"Name"}),()=>p()("admin.users.role",{default:"Role"}),()=>p()("admin.users.id",{default:"User ID"}),()=>p()("admin.users.status",{default:"Status"}),()=>p()("admin.users.actions",{default:"Actions"})]),x(c,j)};N(o,c=>{r(_).length===0?c(k):c(f,!1)},g)}};N(ke,o=>{r(A)?o(D):o(G,!1)})}e(l),e(he),e(we),$((o,g)=>{i(Se,o),i(de,g),V.disabled=r(A)},[()=>p()("admin.users.title",{default:"User Management"}),()=>p()("admin.users.list_title",{default:"All Creator Users"})]),x(C,le),Te(),v()}ot(["click"]);export{br as component};
